import{y as _,l as a,G as k,p as T,q as c,r as n,o as x,c as F,i,w as L,Q as D,D as E}from"./index-BR7JSMnu.js";const C={__name:"user",setup(N){const d=_(),r=a(),p=e=>E(e.list||e),f=a({list:[{type:"input",control:{modelValue:"",placeholder:"请输入登录名称"},config:{},name:"userName",formItem:{label:"登录名称"}},{type:"input",control:{modelValue:"",placeholder:"请输入昵称"},config:{},name:"nickName",formItem:{label:"昵称"}},{type:"input",control:{modelValue:"",placeholder:"请输入手机号码"},config:{},name:"phone",formItem:{label:"手机号"}},{type:"select",control:{modelValue:"",style:{width:"100px"}},options:[],config:{optionsType:2,optionsFun:"sys-status"},name:"status",formItem:{label:"用户状态"}},{type:"select",control:{modelValue:[],style:{width:"100px"}},options:[],config:{optionsType:1,optionsFun:"roleList",method:"post",label:"name",value:"id"},name:"roleId",formItem:{label:"角色"}}],form:{size:"default"},config:{submitCancel:!0}}),b=a({columns:[{label:"多选",type:"selection"},{label:"序号",type:"index",width:"70px"},{label:"登录名称",prop:"userName"},{label:"昵称",prop:"nickName"},{label:"手机号码",prop:"phone"},{label:"状态",prop:"status",render:"tag",custom:{1:"success",0:"info"},replaceValue:"sys-status"},{prop:"creatTime",label:"创建时间",render:"datetime"},{label:"操作",prop:"__control",render:"buttons",buttons:[{label:"编辑",key:"edit"},{label:"删除",key:"del"}]}],config:{openType:"dialog",searchJump:!0},controlBtn:[{label:"新增",key:"add",type:"primary",size:"small",icon:"plus"},{label:"批量删除",key:"del",type:"danger",size:"small",icon:"delete"}],treeData:{show:!0,treeProps:{nodeKey:"id",props:{label:"name"}},name:"department",method:"post",requestUrl:"deptList",after:p}}),m=a(),y=a({list:[{type:"input",control:{modelValue:"",placeholder:"请输入用户名称"},config:{},name:"userName",formItem:{label:"用户名称"},customRules:[{type:"required",message:"请输入用户名称",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入用户昵称"},config:{},name:"nickName",formItem:{label:"用户昵称"}},{type:"password",control:{modelValue:"",placeholder:"请输入登录密码"},config:{},name:"password",formItem:{label:"登录密码"},customRules:[{type:"required",message:"请输入登录密码",trigger:"blur"}]},{type:"password",control:{modelValue:"",placeholder:"请输入确认登录密码"},config:{},name:"password2",formItem:{label:"确认密码",rules:[{validator:(e,l,t)=>{const s=getuserFormValueByName("password");console.log(s),l===""?t(new Error("请输入密码")):l!==s?t(new Error("两次密码不一样")):t()},trigger:"change"}]},customRules:[{type:"required",message:"请输入确认密码",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入手机号码"},config:{},name:"phone",formItem:{label:"手机号码"},customRules:[{type:"mobile",message:"请输入手机号码",trigger:"blur"}]},{type:"treeSelect",control:{modelValue:"",data:[],renderAfterExpand:!1,props:{label:"name",value:"id"}},config:{optionsType:1,optionsFun:"deptList",method:"post",after:p},name:"departmentId",formItem:{label:"归属部门"}},{type:"select",control:{modelValue:""},options:[],config:{optionsType:1,optionsFun:"postList",method:"post",label:"name",value:"id"},name:"post",formItem:{label:"岗位"}},{type:"radio",control:{modelValue:1},options:[],config:{optionsType:2,optionsFun:"sys-status"},name:"status",formItem:{label:"状态"}},{type:"select",control:{modelValue:[],multiple:!0},options:[],config:{optionsType:1,optionsFun:"roleList",method:"post",label:"name",value:"id"},name:"roleId",formItem:{label:"角色"}},{type:"textarea",control:{modelValue:""},config:{span:24},name:"remark",formItem:{label:"备注"}}],form:{size:"default",class:"form-row-2",labelWidth:"100px",name:"userForm"},config:{submitCancel:!0}}),o=k({visible:!1,title:"",formType:"add",dict:{},editId:""}),g=(e,l)=>{if(e==="add"||e==="edit"){const t=D(l);o.visible=!0,o.title=e==="add"?"新增":"编辑",o.formType=e,o.editId=t&&t.id,e==="edit"&&c(()=>{console.log(t),t.roleId?t.roleId=t.roleId.split(",").map(Number):t.roleId=[],t.password2=t.password,m.value.setValue(t)})}},I=e=>(e.roleId&&(e.roleId=e.roleId.join(",")),o.formType==="edit"&&(e.id=o.editId),delete e.password2,e),h=(e,l)=>{l&&(u(),r.value.getListData())},u=()=>{o.visible=!1,o.editId=""},V=e=>{e==="reset"&&u()};return T(()=>{d.query.roleId&&r.value.setSearchFormValue({roleId:parseInt(d.query.roleId)}),c(()=>{r.value.getListData()})}),(e,l)=>{const t=n("ak-list"),s=n("ak-form"),v=n("el-dialog");return x(),F("div",null,[i(t,{ref_key:"tableListEl",ref:r,"api-key":{list:"userList",del:"userDelete"},"search-data":f.value,data:b.value,"auto-load":!1,onBtnClick:g},null,8,["search-data","data"]),i(v,{modelValue:o.visible,"onUpdate:modelValue":l[0]||(l[0]=w=>o.visible=w),"destroy-on-close":"",title:o.title,width:"600px"},{default:L(()=>[i(s,{ref_key:"formEl",ref:m,data:y.value,dict:o.dict,"operate-type":o.formType,"submit-url":o.formType==="add"?"userSave":"userEdit",before:I,after:h,onBtnClick:V},null,8,["data","dict","operate-type","submit-url"])]),_:1},8,["modelValue","title"])])}}};export{C as default};
