import{A as _,l as a,L as T,p as w,q as c,r as n,o as B,c as L,i,w as x,O as D,I as R}from"./index-62047d8c.js";const C={__name:"user",setup(E){const p=_(),r=a(),m=e=>R(e.list||e),f=a({list:[{type:"input",control:{modelValue:"",placeholder:"请输入登录名称"},config:{},name:"userName",formItem:{label:"登录名称"}},{type:"input",control:{modelValue:"",placeholder:"请输入昵称"},config:{},name:"nickName",formItem:{label:"昵称"}},{type:"input",control:{modelValue:"",placeholder:"请输入手机号码"},config:{},name:"phone",formItem:{label:"手机号"}},{type:"select",control:{modelValue:"",appendToBody:!0},options:[],config:{optionsType:2,optionsFun:"sys-status",transformData:"string"},name:"status",formItem:{label:"用户状态"}},{type:"select",control:{modelValue:[],appendToBody:!0},options:[],config:{optionsType:1,optionsFun:"roleList",method:"post",label:"name",value:"id"},name:"role",formItem:{label:"角色"}}],form:{size:"default"},config:{submitCancel:!0}}),y=a({columns:[{label:"多选",type:"selection"},{label:"序号",type:"index",width:"70px"},{label:"登录名称",prop:"userName"},{label:"昵称",prop:"nickName"},{label:"手机号码",prop:"phone"},{label:"角色",prop:"role"},{label:"状态",prop:"status",config:{dictKey:"sys-status",tagList:{1:"success",0:"info"}}},{prop:"dateTime",label:"创建时间",config:{formatter:"{y}-{m}-{d} {h}:{i}:{s}"}},{label:"操作",prop:"__control"}],config:{openType:"dialog",searchJump:!0},operateBtn:[{label:"编辑",key:"edit"},{label:"删除",key:"del"}],controlBtn:[{label:"新增",key:"add",type:"primary",size:"small",icon:"plus"},{label:"批量删除",key:"del",type:"danger",size:"small",icon:"delete"}],treeData:{show:!0,treeProps:{nodeKey:"id",props:{label:"name"}},name:"department",method:"post",requestUrl:"deptList",afterResponse:m}}),d=a(),g=a({list:[{type:"input",control:{modelValue:"",placeholder:"请输入用户名称"},config:{},name:"userName",formItem:{label:"用户名称"},customRules:[{type:"required",message:"请输入用户名称",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入用户昵称"},config:{},name:"nickName",formItem:{label:"用户昵称"}},{type:"password",control:{modelValue:"",placeholder:"请输入登录密码"},config:{},name:"password",formItem:{label:"登录密码"},customRules:[{type:"required",message:"请输入登录密码",trigger:"blur"}]},{type:"password",control:{modelValue:"",placeholder:"请输入确认登录密码"},config:{},name:"password2",formItem:{label:"确认密码",rules:[{validator:(e,l,t)=>{const s=getuserFormValueByName("password");console.log(s),l===""?t(new Error("请输入密码")):l!==s?t(new Error("两次密码不一样")):t()},trigger:"change"}]},customRules:[{type:"required",message:"请输入确认密码",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入手机号码"},config:{},name:"phone",formItem:{label:"手机号码"},customRules:[{type:"mobile",message:"请输入手机号码",trigger:"blur"}]},{type:"treeSelect",control:{modelValue:"",data:[],renderAfterExpand:!1,props:{label:"name",value:"id"}},config:{optionsType:1,optionsFun:"deptList",method:"post",afterResponse:m},name:"department",formItem:{label:"归属部门"}},{type:"select",control:{modelValue:"",appendToBody:!0},options:[],config:{optionsType:0},name:"post",formItem:{label:"岗位"}},{type:"radio",control:{modelValue:1},options:[],config:{optionsType:2,optionsFun:"sys-status"},name:"status",formItem:{label:"状态"}},{type:"select",control:{modelValue:[],appendToBody:!0,multiple:!0},options:[],config:{optionsType:1,optionsFun:"roleList",method:"post",label:"name",value:"id",transformData:"string"},name:"role",formItem:{label:"角色"}},{type:"textarea",control:{modelValue:""},config:{span:24},name:"remark",item:{label:"备注"}}],form:{size:"default",class:"form-row-2",labelWidth:"100px",name:"userForm"},config:{submitCancel:!0}}),o=T({visible:!1,title:"",formType:1,dict:{},editId:""}),b=(e,l)=>{if(e.key==="add"||e.key==="edit"){const t=D(l);o.visible=!0,o.title=e.key==="add"?"新增":"编辑",o.formType=e.key==="add"?1:2,o.editId=t&&t.id,e.key==="edit"&&c(()=>{console.log(t),typeof t.role=="string"?t.role=t.role.split(","):t.role=[],t.password2=t.password,d.value.setValue(t)})}},h=e=>(e.role&&(e.role=e.role.join(",")),o.formType===2&&(e.id=o.editId),delete e.password2,e),k=e=>{e==="success"&&(u(),r.value.getListData())},u=()=>{o.visible=!1,o.editId=""},V=e=>{e==="reset"&&u()};return w(()=>{p.query.role&&r.value.setSearchFormValue({role:parseInt(p.query.role)}),c(()=>{r.value.getListData()})}),(e,l)=>{const t=n("ak-list"),s=n("ak-form"),v=n("el-dialog");return B(),L("div",null,[i(t,{ref_key:"tableListEl",ref:r,"request-url":"userList","delete-url":"userDelete","search-data":f.value,data:y.value,onBtnClick:b,"auto-load":!1},null,8,["search-data","data"]),i(v,{"destroy-on-close":"",modelValue:o.visible,"onUpdate:modelValue":l[0]||(l[0]=I=>o.visible=I),title:o.title,width:"600px"},{default:x(()=>[i(s,{ref_key:"formEl",ref:d,data:g.value,dict:o.dict,type:o.formType,"submit-url":"userSave","edit-url":"userEdit","before-submit":h,"after-submit":k,onBtnClick:V},null,8,["data","dict","type"])]),_:1},8,["modelValue","title"])])}}};export{C as default};
