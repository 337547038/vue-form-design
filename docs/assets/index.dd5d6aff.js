import{d as q,o as a,c as f,g as n,w as l,f as d,F as w,r as x,n as N,p as v,t as V,h as _,i as I,B as Q,a as g,q as k,e as D,m as R,G as M,j as W,a5 as z,y as H}from"./index.13ff13d8.js";const J={class:"flow-add"},K=d("i",{class:"icon-plus"},null,-1),P={class:"flow-node-down"},X=d("h3",null,"\u6DFB\u52A0\u6D41\u7A0B\u8282\u70B9",-1),S=q({__name:"popover",emits:["click"],setup(E,{emit:s}){const p=[{label:"\u5BA1\u6279\u4EBA",icon:"icon-sp",key:2},{label:"\u6284\u9001\u4EBA",icon:"icon-cs",key:3},{label:"\u6761\u4EF6\u5206\u652F",icon:"icon-branch",key:4}],o=A=>{s("click",A)};return(A,b)=>{const C=_("el-button"),i=_("el-popover");return a(),f("div",J,[n(i,{placement:"bottom-start",trigger:"hover",width:"400"},{reference:l(()=>[K]),default:l(()=>[d("div",P,[X,d("div",null,[(a(),f(w,null,x(p,(e,r)=>n(C,{size:"small",type:"primary",plain:"",onClick:t=>o(e.key),key:r},{default:l(()=>[d("i",{class:N(e.icon)},null,2),v(" "+V(e.label),1)]),_:2},1032,["onClick"])),64))])])]),_:1})])}}}),G={0:"\u6307\u5B9A\u6210\u5458",1:"\u4E3B\u7BA1",2:"\u53D1\u8D77\u4EBA\u81EA\u9009",3:"\u8FDE\u7EED\u591A\u7EA7\u4E3B\u7BA1",4:"\u7CFB\u7EDF\u89D2\u8272"},Y={1:"\u53D1\u8D77\u4EBA",2:"\u5BA1\u6279\u4EBA",3:"\u6284\u9001\u4EBA",4:"\u6761\u4EF6\u7EC4",5:"\u6761\u4EF6 \u4F18\u5148\u7EA7"},Z={class:"flow-drawer"},j=v("1"),ee=d("div",null,"\u6761\u4EF6\u89C4\u5219",-1),ue=d("div",{class:"tip"},[v(" \u53EF\u4F7F\u7528\u8FD0\u7B97\u7B26+-*/()<>=&&||\u7B26\u53F7\u7F16\u5199\u6761\u4EF6\u89C4\u5219\uFF0C$\u4EE3\u8868\u5F53\u524D\u6D41\u7A0B\u8868\u5355\u6240\u6709\u503C\uFF0C\u5982$.name\u5373\u4E3A\u6D41\u7A0B\u8868\u5355\u8F93\u5165\u5B57\u6BB5\u540D\u79F0\u4E3Aname\u7684\u503C\u3002"),d("br"),v(" \u5982\u8BF7\u5047\u6D41\u7A0B\u8868\u5355day\u4E3A\u8BF7\u5047\u5929\u6570\uFF0C\u5F53\u6761\u4EF6\u89C4\u5219\u8BBE\u7F6E\u4E3A $.day>2 \u5373\u8868\u793A\u8BF7\u5047\u5929\u5047\u5927\u4E8E2\u5929\u65F6\uFF0C\u8BE5\u6761\u4EF6\u6210\u7ACB ")],-1),te=v("\u591A\u4EBA\u5BA1\u6279\uFF0C\u91C7\u7528\u4F9D\u6B21\u5BA1\u6279"),le=v("\u591A\u4EBA\u5BA1\u6279\uFF0C\u901A\u8FC7\u53EA\u9700\u4E00\u4E2A\uFF0C\u62D2\u7EDD\u9700\u5168\u5458"),ne=v("\u591A\u4EBA\u5BA1\u6279\uFF0C\u4E00\u4E2A\u901A\u8FC7\u6216\u62D2\u7EDD"),oe=d("div",{class:"tip"},[d("p",null,"\u63D0\u793A\uFF1A"),d("p",null,"\xB7 \u5BA1\u6279\u4EBA\u4E3A\u7A7A\u65F6\uFF0C\u81EA\u52A8\u8DF3\u8FC7"),d("p",null,"\xB7 \u82E5\u5BA1\u6279\u4EBA\u79BB\u804C\uFF0C\u4F1A\u81EA\u52A8\u8F6C\u4EA4\u7ED9\u5BA1\u6279\u4EBA\u7684\u4E0A\u7EA7\u4EE3\u4E3A\u5904\u7406")],-1),ae=v("\u53D6\u6D88"),se=v("\u786E\u8BA4"),de=q({__name:"drawer",setup(E,{expose:s}){const p=I(!1),o=Q({userType:"0",flowType:"1",userList:[],priority:0,rules:""}),A=I({}),b=I(0),C=()=>{},i=()=>{p.value=!1;const r={userType:o.userType,flowType:o.flowType,content:A.value.nodeType===5?o.rules:o.userList.join(","),priority:o.priority};Object.assign(A.value,r)};return s({open:(r,t)=>{p.value=!0,A.value=r,b.value=t}}),(r,t)=>{const F=_("el-option"),y=_("el-select"),h=_("el-form-item"),u=_("el-input"),c=_("el-radio"),U=_("el-radio-group"),L=_("el-button"),B=_("el-tag"),T=_("el-form"),$=_("el-drawer");return a(),g($,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=m=>p.value=m),direction:"rtl",title:"\u7F16\u8F91\u8282\u70B9",size:"540px","modal-class":"flow-modal-class","append-to-body":!0},{default:l(()=>[d("div",Z,[n(T,null,{default:l(()=>[A.value.nodeType===5?(a(),f(w,{key:0},[n(h,{label:"\u4F18\u5148\u7EA7"},{default:l(()=>[n(y,{modelValue:o.priority,"onUpdate:modelValue":t[0]||(t[0]=m=>o.priority=m)},{default:l(()=>[n(F,{value:"1"},{default:l(()=>[j]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(h,null,{default:l(()=>[ee,n(u,{type:"textarea",rows:"5",modelValue:o.rules,"onUpdate:modelValue":t[1]||(t[1]=m=>o.rules=m)},null,8,["modelValue"])]),_:1}),ue],64)):(a(),f(w,{key:1},[n(h,null,{default:l(()=>[n(U,{modelValue:o.userType,"onUpdate:modelValue":t[2]||(t[2]=m=>o.userType=m)},{default:l(()=>[(a(!0),f(w,null,x(k(G),(m,O)=>(a(),g(c,{label:O,key:O},{default:l(()=>[v(V(m),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),["0","4"].includes(o.userType)?(a(),g(h,{key:0},{default:l(()=>[n(L,{type:"primary",onClick:C},{default:l(()=>[v("\u9009\u62E9/\u4FEE\u6539"+V(k(G)[o.userType]),1)]),_:1})]),_:1})):D("",!0),n(h,null,{default:l(()=>[(a(!0),f(w,null,x(o.userList,m=>(a(),g(B,{key:m.label,closable:""},{default:l(()=>[v(V(m.label),1)]),_:2},1024))),128))]),_:1}),n(h,{label:"\u5BA1\u6279\u65B9\u5F0F"},{default:l(()=>[n(U,{modelValue:o.flowType,"onUpdate:modelValue":t[3]||(t[3]=m=>o.flowType=m)},{default:l(()=>[n(c,{label:"1"},{default:l(()=>[te]),_:1}),n(c,{label:"2"},{default:l(()=>[le]),_:1}),n(c,{label:"3"},{default:l(()=>[ne]),_:1})]),_:1},8,["modelValue"])]),_:1}),oe],64)),n(h,null,{default:l(()=>[n(L,{onClick:t[4]||(t[4]=m=>p.value=!1)},{default:l(()=>[ae]),_:1}),n(L,{type:"primary",onClick:i},{default:l(()=>[se]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue"])}}}),re={key:0,class:"flow-branch-btn"},ce=v("\u6DFB\u52A0\u6761\u4EF6 "),ie={class:"flow-row"},pe={key:0,class:"mask-left"},_e={key:1,class:"mask-right"},fe=["onClick"],ye={key:0},me=["onClick"],Ee=["title"],Be=q({__name:"flowGroup",props:{data:{default:()=>[]},dataList:{default:()=>[]},type:null},emits:["clickEvent"],setup(E,{emit:s}){const p=E,o=I(),A=u=>{switch(u.nodeType){case 1:case 2:return"icon-user";case 4:return"icon-cs"}return""},b=u=>{let c="";return u.userType&&(c=G[u.userType]+":"),["1","2","3"].includes(u.userType)?c:u.content?c+u.content:u.nodeType===5?"\u4FEE\u6539\u5BA1\u6279\u6761\u4EF6":u.nodeType===3?"\u6307\u5B9A\u6284\u9001\u4EBA":"\u6307\u5B9A\u5BA1\u6279\u4EBA"},C=R(()=>i.value?p.dataList.filter(u=>u.parentId===p.data.id):[p.data]),i=R(()=>p.data.nodeType===4),e=u=>p.dataList.filter(c=>c.parentId===u.id),r=()=>{s("clickEvent",{event:"addBranch",id:p.data.id})},t=(u,c)=>{s("clickEvent",{event:"addNode",id:c.id,parentId:c.parentId,nodeType:c.nodeType,addType:u})},F=u=>{s("clickEvent",{event:"del",id:u.id,nodeType:u.nodeType,parentId:u.parentId})},y=u=>{s("clickEvent",u)},h=(u,c)=>{u.nodeType===1||u.nodeType===5&&c===C.value.length-1||o.value.open(u,c)};return(u,c)=>{const U=_("el-button"),L=_("flow-group",!0);return a(),f("div",{class:N(["flow-group",{"flow-branch":k(i)}])},[k(i)&&!E.type?(a(),f("div",re,[n(U,{size:"small",type:"primary",plain:"",round:"",onClick:r},{default:l(()=>[ce]),_:1})])):D("",!0),d("div",ie,[(a(!0),f(w,null,x(k(C),(B,T)=>(a(),f("div",{class:"flow-col",key:T},[T===0&&k(i)?(a(),f("span",pe)):D("",!0),T===k(C).length-1&&k(i)?(a(),f("span",_e)):D("",!0),d("div",{class:"flow-item",onClick:$=>h(B,T)},[d("div",{class:N(["title",`bg-${B.nodeType}`])},[d("i",{class:N(A(B))},null,2),d("span",null,[v(V(k(Y)[B.nodeType]),1),B.nodeType===5?(a(),f("span",ye,V(T+1),1)):D("",!0)]),B.nodeType!==1&&!E.type&&!(T===k(C).length-1&&k(i))?(a(),f("i",{key:0,class:"icon-close close",onClick:$=>F(B)},null,8,me)):D("",!0)],2),d("div",{class:"text",title:b(B)},[d("div",null,V(b(B)),1)],8,Ee)],8,fe),E.type?D("",!0):(a(),g(S,{key:2,onClick:$=>t($,B)},null,8,["onClick"])),(a(!0),f(w,null,x(e(B),($,m)=>(a(),g(L,{key:m,data:$,"data-list":E.dataList,type:E.type,onClickEvent:y},null,8,["data","data-list","type"]))),128))]))),128))]),k(i)&&!E.type?(a(),g(S,{key:1,onClick:c[0]||(c[0]=B=>t(B,E.data))})):D("",!0),n(de,{ref_key:"drawerEl",ref:o},null,512)],2)}}}),ve={class:"flow-main"},Fe=d("div",{class:"flow-end"}," \u7ED3\u675F",-1),Ae=q({__name:"flow",props:{direction:{default:"vertical"},type:{default:0}},setup(E){const s=I([{id:"start",nodeType:1,parentId:"",content:"\u53D1\u8D77\u4EBA"}]),p=M().query,o=R(()=>s.value.filter(e=>!e.parentId)),A=e=>{switch(e.event){case"del":i(e);break;case"addNode":C(e);break;case"addBranch":b(e.id);break}},b=e=>{let r=0;s.value.forEach((t,F)=>{t.parentId===e&&(r=F)}),s.value.splice(r,0,{id:z(8),nodeType:5,parentId:e})},C=e=>{const r=z(8),t=e.nodeType===5?e.id:e.parentId;s.value.forEach((F,y)=>{F.id===e.id&&s.value.splice(y+1,0,{id:r,nodeType:e.addType,parentId:t})}),e.addType===4&&(s.value.push({id:z(8),nodeType:5,parentId:r}),s.value.push({id:z(8),nodeType:5,parentId:r,content:"\u5176\u4ED6\u6761\u4EF6\u8FDB\u5165\u6B64\u6D41\u7A0B"}))},i=e=>{const r=s.value.findIndex(t=>t.id===e.id);if(s.value.splice(r,1),e.nodeType===5){s.value.filter(y=>y.parentId===e.id).forEach(y=>{i({id:y.id,nodeType:y.nodeType,parentId:y.parentId})});const F=s.value.filter(y=>y.parentId===e.parentId);if(F.length===1){const{id:y,nodeType:h,parentId:u}=F[0];i({id:y,nodeType:h,parentId:u}),i({id:u})}}};return W(()=>{p.id}),(e,r)=>(a(),f("div",{class:N(["flow-container",{[E.direction]:!0,"type-show":E.type}])},[d("div",ve,[(a(!0),f(w,null,x(k(o),(t,F)=>(a(),g(Be,{key:F,data:t,"data-list":s.value,type:E.type,onClickEvent:A},null,8,["data","data-list","type"]))),128)),Fe])],2))}}),ke={class:"design-flow-container"},Ce={class:"tools"},he=v("\u4FDD\u5B58"),Te=q({__name:"index",setup(E){const s=M().query,p=H(),o=I(s.tabs||"info"),A=I({list:[{type:"input",control:{modelValue:""},config:{},name:"input1679749921564",item:{label:"\u6D41\u7A0B\u540D\u79F0",showLabel:!1},customRules:[{type:"required",message:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",trigger:"blur"}]},{type:"select",control:{modelValue:"",appendToBody:!0},options:[{label:"\u6807\u7B7E1",value:"value1"},{label:"\u6807\u7B7E2",value:"value2"},{label:"\u6807\u7B7E3",value:"value3"}],config:{optionsType:0},name:"select1679750228669",item:{label:"\u6D41\u7A0B\u8868\u5355",showLabel:!1,rules:[{required:!0,message:"\u5FC5\u586B\u9879",trigger:"change"}]}},{type:"select",control:{modelValue:"",appendToBody:!0},options:[{label:"\u6807\u7B7E1",value:"value1"},{label:"\u6807\u7B7E2",value:"value2"},{label:"\u6807\u7B7E3",value:"value3"}],config:{type:"fixed",source:0,request:"get",sourceFun:""},name:"status",item:{label:"\u72B6\u6001"}},{type:"component",control:{modelValue:""},config:{},name:"component1679749975848",item:{label:"\u6D41\u7A0B\u56FE\u6807",showLabel:!1}},{type:"select",control:{modelValue:"",appendToBody:!0},options:[{label:"\u6807\u7B7E1",value:"value1"},{label:"\u6807\u7B7E2",value:"value2"},{label:"\u6807\u7B7E3",value:"value3"}],config:{type:"fixed",source:0,request:"get",sourceFun:""},name:"select1679749959675",item:{label:"\u6240\u5728\u5206\u7EC4",showLabel:!1}},{type:"select",control:{modelValue:"",appendToBody:!0},options:[{label:"\u6807\u7B7E1",value:"value1"},{label:"\u6807\u7B7E2",value:"value2"},{label:"\u6807\u7B7E3",value:"value3"}],config:{type:"fixed",source:0,request:"get",sourceFun:""},name:"select1679750006572",item:{label:"\u89D2\u8272\u6743\u9650",showLabel:!1}},{type:"textarea",control:{modelValue:""},config:{},name:"textarea1679750029874",item:{label:"\u5907\u6CE8\u8BF4\u660E",showLabel:!1}}],form:{labelWidth:"80px",class:"",size:"default",name:"form1679749919739"},config:{title:"form1679749919739",formId:""}}),b=()=>{p.push({path:"/design/flow",query:{id:"id",tabs:"flow"}})};return(C,i)=>{const e=_("el-button"),r=_("ak-form"),t=_("el-tab-pane"),F=_("el-tabs");return a(),f("div",ke,[d("div",Ce,[n(e,{type:"primary",onClick:b},{default:l(()=>[he]),_:1})]),n(F,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=y=>o.value=y),class:"flow-tabs"},{default:l(()=>[n(t,{label:"\u57FA\u7840\u4FE1\u606F",name:"info"},{default:l(()=>[n(r,{formData:A.value},null,8,["formData"])]),_:1}),n(t,{label:"\u5BA1\u6279\u6D41\u7A0B",name:"flow"},{default:l(()=>[n(Ae)]),_:1})]),_:1},8,["modelValue"])])}}});export{Te as default};
