import{d as T,l as s,G as V,r as d,c as x,o as N,j as u,w as C,D as f,q as c,A as D}from"./index-CuNR3IJH.js";const B=T({__name:"dept",setup(E){const m=s(),r=s(),p=s([]),b=s({list:[{type:"input",control:{modelValue:"",placeholder:"请输入部门名称"},config:{},name:"name",formItem:{label:"部门名称"}},{type:"select",control:{modelValue:"",style:{width:"100px"}},options:[],config:{optionsType:2,optionsFun:"sys-status"},name:"status",formItem:{label:"状态"}}],form:{labelWidth:"",class:"",size:"default"},config:{submitCancel:!0}}),y=s({tableProps:{rowKey:"id"},columns:[{label:"部门名称",prop:"name"},{label:"排序",prop:"sort"},{label:"状态",prop:"status",render:"tag",custom:{1:"success",2:"info"},replaceValue:"sys-status",config:{}},{label:"操作",prop:"__control",render:"buttons",buttons:[{label:"新增",click:e=>{t.visible=!0,t.title="新增部门",t.formType="add",c(()=>{r.value.setValue({parentId:e.id})}),n()}},{label:"编辑",click:e=>{t.visible=!0,t.title="编辑部门",t.formType="edit",t.editId=e.id,e.parentId===0&&(e.parentId=""),c(()=>{e.userId&&D("userById",{id:e.userId}).then(l=>{var o;const a=(o=l.data)==null?void 0:o.userName;a&&r.value.setOptions({userId:[{userName:a,id:e.userId}]})}),r.value.setValue(e)}),n()}},{label:"删除",key:"del"}]}],controlBtn:[{label:"新增",type:"primary",size:"small",icon:"plus",click:()=>{t.visible=!0,t.title="新增部门",t.formType="add",n()}}],config:{fixedBottomScroll:!1}}),t=V({visible:!1,title:"",formType:"add",editId:""}),g=s({list:[{type:"treeSelect",control:{modelValue:"",data:[],renderAfterExpand:!1,props:{label:"name",value:"id"},checkStrictly:!0,placeholder:"请选择上级部门"},config:{optionsType:0},name:"parentId",formItem:{label:"上级部门"}},{type:"input",control:{modelValue:"",placeholder:"请输入部门名称"},config:{},name:"name",formItem:{label:"部门名称"},customRules:[{type:"required",message:"部门名称不能为空",trigger:"blur"}]},{type:"select",control:{modelValue:"",placeholder:"请输入负责人",teleported:!0,filterable:!0,remote:!0},config:{optionsType:1,optionsFun:"userList",method:"post",label:"userName",value:"id",cache:!1,queryName:"userName",before:e=>({extend:{pageSize:20,pageNum:1},query:e})},name:"userId",formItem:{label:"负责人"}},{type:"inputNumber",control:{modelValue:0,controlsPosition:"right"},config:{},name:"sort",formItem:{label:"排序"}},{type:"radio",control:{modelValue:1},options:[],config:{optionsType:2,optionsFun:"sys-status"},name:"status",formItem:{label:"状态"}},{type:"textarea",control:{modelValue:""},config:{},name:"remark",formItem:{label:"备注"}}],form:{labelWidth:"100px",size:"default"},config:{submitCancel:!0}}),v=e=>(t.formType==="edit"&&(e.id=t.editId,delete e.children),e),I=(e,l)=>{t.visible=!1,l&&m.value.getListData()},_=e=>{e==="reset"&&(t.visible=!1)},h=(e,l,a)=>{if(a==="fetch"){const o=e.list,i=f(o);return p.value=i,f(i)}},n=()=>{c(()=>{r.value.setOptions({parentId:p.value})})};return(e,l)=>{const a=d("ak-list"),o=d("ak-form"),i=d("el-dialog");return N(),x("div",null,[u(a,{ref_key:"tableListEl",ref:m,"api-key":{list:"deptList",del:"deptDelete"},"search-data":b.value,data:y.value,after:h},null,8,["search-data","data"]),u(i,{modelValue:t.visible,"onUpdate:modelValue":l[0]||(l[0]=k=>t.visible=k),title:t.title,width:"400px","destroy-on-close":""},{default:C(()=>[u(o,{ref_key:"formNameEl",ref:r,type:t.formType,data:g.value,"submit-url":t.formType==="add"?"deptSave":"deptEdit",before:v,after:I,onBtnClick:_},null,8,["type","data","submit-url"])]),_:1},8,["modelValue","title"])])}}});export{B as default};
