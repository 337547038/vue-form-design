import{d as L,l as d,G as T,h as b,i as q,r as f,W as x,b as y,o as _,w as m,j as i,e as A,s as $,c as R,ae as G,f as l,A as M,X as I,N as O,L as P}from"./index-CYQNA_yI.js";const W={class:"form-info"},X=L({__name:"tabs",props:{pane:{default:""}},setup(E,{expose:N}){const r=E,v=d(),w=d(),c=d(),a=T({loading:!0,obj:{},flowName:"",formId:"",callback:""}),p=d({list:[],form:{},config:{}}),g=b(()=>q("userInfo",!0)),k=b(()=>r.pane==="start"?"add":"edit"),C=b(()=>!(r.pane==="start"||r.pane==="applyed"&&a.obj.status===0)),D=e=>{e==="record"&&v.value.getListData()},F=d({columns:[{label:"处理人",prop:"name",render:"text",renderFormatter:e=>e||"系统"},{label:"状态",prop:"status",render:"tag",replaceValue:{0:"拒绝",1:"同意",2:"流转",3:"撤回"},custom:{0:"danger",1:"success",2:"primary",3:"info"}},{label:"处理时间",prop:"datetime",render:"datetime"},{label:"审批意见",prop:"content"}],config:{columnsSetting:!1}}),S=(e,o)=>{a.obj=e,a.callback=o;const t={id:e.flowId};M("flowFrom",t).then(s=>{const{flow:u,form:n}=s.data;c.value.setValue(I(u.data),e),p.value=I(n.data),a.loading=!1,a.flowName=u.name,a.formId=n.id,r.pane!=="start"&&w.value.getData({formId:n.id,id:e.formId})})},V=(e,o)=>{if(o==="submit"){if(!c.value.flowValidate(1))return O({type:"error",message:"请选择节点自选审批人"}),!1;let t={form:e,flow:{flowId:a.obj.flowId,formId:a.formId,userId:g.value.id,title:`${g.value.userName}提交的${a.flowName}申请审批`,creatTime:new Date,status:0,nodeApprover:c.value.getDiyNodeApprover()}};r.pane==="applyed"&&a.obj.status===0&&(t=e,t.formId=a.formId);const s=p.value.events?.before;return typeof s=="function"?s(t):t}},h=(e,o,t)=>{t==="submit"&&o&&a.callback&&a.callback()};return N({initFlowForm:S}),(e,o)=>{const t=f("ak-form"),s=f("el-tab-pane"),u=f("ak-flow"),n=f("ak-list"),j=f("el-tabs"),B=x("loading");return _(),y(j,{onTabChange:D},{default:m(()=>[i(s,{label:"表单信息"},{default:m(()=>[$((_(),R("div",W,[G(e.$slots,"default",{},void 0,!0),i(t,{ref_key:"formEl",ref:w,data:p.value,before:V,after:h,disabled:C.value,"operate-type":k.value,"submit-url":k.value==="add"?"flowSave":"editFormContent","request-url":"getFormContent"},null,8,["data","disabled","operate-type","submit-url"])])),[[B,a.loading]])]),_:3}),i(s,{label:"流程图",name:"flow",class:"flow-box"},{default:m(()=>[o[0]||(o[0]=l("div",{class:"status"},[l("ul",null,[l("li",{class:"s1"}," ● 已通过 "),l("li",{class:"s4"}," ● 已拒绝 "),l("li",{class:"s2"}," ● 进行中 "),l("li",{class:"s3"}," ● 未进行 ")])],-1)),i(u,{ref_key:"flowEl",ref:c,type:e.pane==="start"?2:1},null,8,["type"])]),_:1}),e.pane!=="start"?(_(),y(s,{key:0,label:"流转记录",name:"record"},{default:m(()=>[i(n,{ref_key:"tableListEl",ref:v,"auto-load":!1,"api-key":{list:"flowRecordList"},data:F.value,query:{flowId:a.obj.id}},null,8,["data","query"])]),_:1})):A("",!0)]),_:3})}}}),H=P(X,[["__scopeId","data-v-08df038a"]]);export{H as F};
