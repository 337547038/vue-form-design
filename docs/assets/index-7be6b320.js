import{d as ce,r as N,e as Z,o as Ue,a as f,g as O,w as s,l as o,x as q,u as A,a7 as De,c as E,f as oe,F as J,b as y,j as H,B as Me,m as R,a1 as Oe,I as fe,G as Ae,t as te,k as P,J as ze,L as ye,z as be,A as Ce,n as ae,v as je,y as pe,a5 as qe,a3 as Te,_ as Be,a4 as Fe,a8 as $e,V as Xe,D as Se,a9 as Ye,X as We,W as Le,q as Ge,S as Ve,E as Ke,h as Ne,C as Pe,p as He,aa as Ee}from"./index-8552587b.js";import{_ as Je,a as Qe}from"./vueFile.vue_vue_type_script_setup_true_lang-8e7d5bcb.js";import{_ as Ze}from"./aceDrawer.vue_vue_type_script_setup_true_lang-b6c4e63d.js";import{g as el,a as ll}from"./getData-d0ab4ffd.js";const tl=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],ol=[],nl=[],he={bg:tl,border:ol,img:nl},al={class:"img-list"},sl=["onClick"],il=["src"],cl={key:0},rl=ce({__name:"upload",emits:["click"],setup(j,{expose:U,emit:b}){const d=N(!1),c=N(),D=N("bg"),e=Z(()=>{if(!he)return[];const g=[];for(const V in he)g.push(V);return g}),F=Z(()=>D.value.name==="upload"?[]:he?he[D.value]:[]),x=Z(()=>`./static/screen/${D.value}/`),w=g=>{d.value=!1,b("click",x.value+g,c.value)},L=g=>{D.value="upload",Me(()=>{F.value.unshift(g.path)})};return U({open:(g,V)=>{d.value=!0,c.value=V,g?D.value=g:D.value=e.value[0]}}),Ue(()=>{}),(g,V)=>{const v=R("el-button"),G=R("el-upload"),z=R("el-tab-pane"),le=R("el-tabs"),ne=R("el-dialog");return f(),O(ne,{modelValue:d.value,"onUpdate:modelValue":V[1]||(V[1]=B=>d.value=B),width:"800px",title:"选择上传图片"},{default:s(()=>{var B;return[o(G,{action:A(De),"on-success":L,"show-file-list":!1},{default:s(()=>[o(v,{type:"primary"},{default:s(()=>[q("上传")]),_:1})]),_:1},8,["action"]),o(le,{modelValue:D.value,"onUpdate:modelValue":V[0]||(V[0]=X=>D.value=X)},{default:s(()=>[(f(!0),E(J,null,oe(A(e),X=>(f(),O(z,{label:X,name:X,key:X},null,8,["label","name"]))),128)),o(z,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),y("div",al,[y("ul",null,[(f(!0),E(J,null,oe(A(F),X=>(f(),E("li",{key:X,onClick:se=>w(X)},[y("img",{src:A(x)+X,alt:""},null,8,il)],8,sl))),128))]),(B=A(F))!=null&&B.length?H("",!0):(f(),E("p",cl,"暂无相关素材资源"))])]}),_:1},8,["modelValue"])}}});const ul=Oe(rl,[["__scopeId","data-v-b06a5e4b"]]),dl={key:0},pl=y("h3",null,"接口数据处理事件",-1),fl=y("h3",null,"全局数据",-1),gl=y("h3",null,"接口数据处理事件",-1),vl=ce({__name:"configControl",props:{config:null},emits:["update:config","openDrawer","update"],setup(j,{expose:U,emit:b}){const d=j,c=N({}),D=N(),e=Z(()=>c.value.type),F=r=>{b("update:config",Object.assign({},d.config,r))},x=fe({bgColor:"",bgLinear:"",bgAngle:0,bgUpload:"",bgSelect:""});Ae(()=>d.config,r=>{if(!Object.keys(c.value).length){const n=r.background||"";if(n.indexOf("url")!==-1){const M=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),S=n.match(M);Object.assign(x,{bgUpload:S,bgSelect:3})}else if(n.indexOf("linear")!==-1){const S=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")).split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/);Object.assign(x,{bgColor:S[1].trim(),bgLinear:S[2].trim(),bgAngle:Number(S[0].replace("deg","")),bgSelect:2})}else Object.assign(x,{bgColor:n,bgSelect:1})}},{immediate:!0});const w=()=>{let r="";switch(x.bgSelect){case 1:r=x.bgColor;break;case 2:r=`linear-gradient(${x.bgAngle}deg, ${x.bgColor}, ${x.bgLinear})`;break;case 3:r=`url(${x.bgUpload})`;break}L("background",r)},L=(r,n)=>{F({[r]:n})},a=r=>{c.value=r},g=Z(()=>{var r,n,M,S;if(Object.keys(c.value).length){const{config:k={},position:m,type:I}=c.value;return[{type:"group",title:"位置信息"},{label:"width",value:m.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:m.height,placeholder:"请输入高度",key:"height",path:"position"},{type:"number",label:"left",value:m.left,placeholder:"图层位置",key:"left",path:"position"},{type:"number",label:"top",value:m.top,key:"top",path:"position"},{type:"number",label:"right",value:m.right,placeholder:"设置后left为auto",key:"right",path:"position"},{type:"number",label:"bottom",value:m.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:m.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:k.lock,key:"lock"},{type:"switch",label:"隐藏",value:m.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:k.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:k.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:k.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:k.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:k.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:k.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:(r=k.style)==null?void 0:r.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:(n=k.style)==null?void 0:n.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:(M=k.style)==null?void 0:M.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:(S=k.style)==null?void 0:S.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:k.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:k.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:k.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:k.speed,key:"speed",vShow:["table"]}].filter(ee=>{let C=!0;return ee.vShow&&(C=ee.vShow.includes(I)),ee.vHide&&(C=!ee.vHide.includes(I)),C})}return[]}),V=(r,n)=>{var M;r.path==="position"?c.value.position[r.key]=n:r.path==="style"?((M=c.value.config)!=null&&M.style||(c.value.config.style={}),c.value.config.style[r.key]=n):c.value.config[r.key]=n,["zIndex","display","lock"].includes(r.key)&&b("update")},v=(r,n)=>{D.value.open(r,n)},G=(r,n)=>{switch(n){case"screenBg":x.bgUpload=r,w();break;case"src":c.value.config.src=r;break}},z=()=>{b("openDrawer",{codeType:"css",type:"css",title:"当前应用页的样式，类似于.vue文件中的style scoped中的样式"})},le=()=>{b("openDrawer",{content:c.value.option,title:"可参考echarts相关例子编辑",callback:r=>{c.value.option=r}})},ne=()=>{var r;b("openDrawer",{codeType:"json",content:((r=c.value.config)==null?void 0:r.style)||{},title:"可输入更多的css样式，须为json格式",callback:n=>{c.value.config.style=n}})},B=()=>{var r;b("openDrawer",{codeType:"json",content:((r=c.value.config)==null?void 0:r.props)||{},title:"支持所有表格props属性，可参考el-table。json格式",callback:n=>{c.value.config.props=n}})},X=()=>{let r=c.value.columns;(!r||!r.length)&&(r=[{prop:"",label:""}]),b("openDrawer",{codeType:"json",content:r,title:"表格列设置，可参考table-column属性",callback:n=>{c.value.columns=n}})},se=(r,n)=>{let M;n==="global"?M=d.config&&d.config[r]:M=c.value.events&&c.value.events[r],M||(r==="beforeRequest"?M=S=>(console.log("beforeRequest",S),S):n==="global"?M=S=>(console.log("afterResponse",S),S):M=(S,k,m)=>(console.log("afterResponse",S,k,m),k)),b("openDrawer",{content:M,title:r==="beforeRequest"?"这里可处理请求前的参数，返回相应参数给接口":"接口数据处理。也可为字符串，如opt=formatTest",callback:S=>{n==="global"?d.config[r]=S:(c.value.events||(c.value.events={}),c.value.events[r]=S)}})},me=()=>{var S,k;let r,n;const M=c.value.config.optionsType;M===2?(n="从大屏配置的全局数据里获取指定数据",r=(S=c.value.events)==null?void 0:S.getGlobal,r||(r=(m,I)=>(console.log("getGlobalData",m,I),m))):(n="图表数据，替换相关数据返回即可",["text","sText"].includes(e.value)?(r=(k=c.value.config)==null?void 0:k.text,n="编辑文本内容数据"):r=c.value.option,e.value==="table"&&(n="表格列表数据。根据设定的table-column列数据设置对应的数据")),b("openDrawer",{content:r,title:n,callback:m=>{M===2?(c.value.events||(c.value.events={}),c.value.events.getGlobal=m):["text","sText"].includes(e.value)?c.value.config.text=m:c.value.option=m}})};return U({setCurrent:a}),(r,n)=>{var ve;const M=R("el-switch"),S=R("el-color-picker"),k=R("el-input"),m=R("el-option"),I=R("el-select"),ee=R("el-input-number"),C=R("el-form-item"),K=R("el-button"),ie=R("el-form"),re=R("el-tab-pane"),ue=R("el-radio"),ke=R("el-radio-group"),de=R("el-tabs"),ge=R("el-slider");return f(),E("div",{class:P(["main-right",{lock:(ve=c.value.config)==null?void 0:ve.lock}])},[Object.keys(c.value).length?(f(),O(de,{key:0,class:"tabs","model-value":"screen"},{default:s(()=>[o(re,{label:"位置属性",name:"screen"},{default:s(()=>[o(ie,{size:"small"},{default:s(()=>[(f(!0),E(J,null,oe(A(g),(i,_e)=>(f(),O(C,{label:i.label,key:_e},{default:s(()=>[i.type==="group"?(f(),E("h3",dl,te(i.title),1)):i.type==="switch"?(f(),O(M,{key:1,"model-value":i.value,onChange:W=>V(i,W),class:P([i.key])},null,8,["model-value","onChange","class"])):i.type==="color"?(f(),O(S,{key:2,"show-alpha":"",onChange:W=>V(i,W),"model-value":i.value},null,8,["onChange","model-value"])):i.type==="textarea"?(f(),O(k,{key:3,type:"textarea",placeholder:i.placeholder,onChange:W=>V(i,W),"model-value":i.value},null,8,["placeholder","onChange","model-value"])):i.type==="select"?(f(),O(I,{key:4,allowCreate:i.allowCreate,filterable:i.filterable,placeholder:i.placeholder,onChange:W=>V(i,W),"model-value":i.value},{default:s(()=>[(f(!0),E(J,null,oe(i.options,(W,we)=>(f(),O(m,{key:W,label:W,value:we},null,8,["label","value"]))),128))]),_:2},1032,["allowCreate","filterable","placeholder","onChange","model-value"])):i.type==="number"?(f(),O(ee,{key:5,"controls-position":"right",placeholder:i.placeholder,"model-value":i.value,onInput:W=>V(i,W)},null,8,["placeholder","model-value","onInput"])):(f(),O(k,{key:6,placeholder:i.placeholder,"model-value":i.value,onInput:W=>V(i,W)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(A(e))?(f(),O(C,{key:0,class:"upload-image"},{default:s(()=>[o(k,{placeholder:"请输入图片地址",modelValue:c.value.config.src,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value.config.src=i)},null,8,["modelValue"]),o(K,{type:"primary",onClick:n[1]||(n[1]=i=>v(A(e)==="image"?"img":"bg","src"))},{default:s(()=>[q("选择图片")]),_:1})]),_:1})):H("",!0),["line","bar","pie","echarts"].includes(A(e))?(f(),O(C,{key:1},{default:s(()=>[o(K,{type:"primary",onClick:le},{default:s(()=>[q("图表编辑")]),_:1})]),_:1})):H("",!0),["text","sText","image","background","border","clock"].includes(A(e))?(f(),O(C,{key:2},{default:s(()=>[o(K,{type:"primary",onClick:ne},{default:s(()=>[q("编辑更多内联样式")]),_:1})]),_:1})):H("",!0),["table"].includes(A(e))?(f(),O(C,{key:3},{default:s(()=>[o(K,{type:"primary",onClick:B},{default:s(()=>[q("表格属性")]),_:1}),o(K,{type:"primary",onClick:X},{default:s(()=>[q("Table-column")]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1}),o(re,{label:"数据",name:"data"},{default:s(()=>[["line","bar","pie","echarts","text","sText","table"].includes(A(e))?(f(),O(ie,{key:0,size:"small"},{default:s(()=>[o(C,{label:"数据类型"},{default:s(()=>[o(ke,{modelValue:c.value.config.optionsType,"onUpdate:modelValue":n[2]||(n[2]=i=>c.value.config.optionsType=i)},{default:s(()=>[o(ue,{label:0,style:{"margin-right":"4px"}},{default:s(()=>[q("静态")]),_:1}),o(ue,{label:2,style:{"margin-right":"4px"}},{default:s(()=>[q("全局")]),_:1}),o(ue,{label:1},{default:s(()=>[q("动态")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.value.config.optionsType!==1?(f(),O(C,{key:0},{default:s(()=>[o(K,{type:"primary",onClick:me},{default:s(()=>[q("编辑数据")]),_:1})]),_:1})):H("",!0),c.value.config.optionsType===1?(f(),E(J,{key:1},[o(C,null,{default:s(()=>[o(k,{modelValue:c.value.config.requestUrl,"onUpdate:modelValue":n[4]||(n[4]=i=>c.value.config.requestUrl=i),placeholder:"接口URL或api中的key"},{prepend:s(()=>[o(I,{modelValue:c.value.config.method,"onUpdate:modelValue":n[3]||(n[3]=i=>c.value.config.method=i),style:{width:"60px"}},{default:s(()=>[o(m,{label:"get",value:"get"}),o(m,{label:"post",value:"post"}),o(m,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(C,{label:"刷新时间"},{default:s(()=>[o(ee,{modelValue:c.value.config.loopTime,"onUpdate:modelValue":n[5]||(n[5]=i=>c.value.config.loopTime=i),disabled:""},null,8,["modelValue"])]),_:1}),o(C,null,{default:s(()=>[pl]),_:1}),o(C,null,{default:s(()=>[o(K,{onClick:n[6]||(n[6]=i=>se("beforeRequest"))},{default:s(()=>[q("beforeRequest")]),_:1})]),_:1}),o(C,null,{default:s(()=>[o(K,{onClick:n[7]||(n[7]=i=>se("afterResponse"))},{default:s(()=>[q("afterResponse")]),_:1})]),_:1})],64)):H("",!0)]),_:1})):H("",!0)]),_:1})]),_:1})):(f(),O(de,{key:1,class:"tabs","model-value":"screen"},{default:s(()=>[o(re,{label:"大屏配置",name:"screen"},{default:s(()=>[o(ie,{size:"small"},{default:s(()=>[o(C,{label:"大屏宽度"},{default:s(()=>[o(k,{placeholder:"请输入大屏宽度","model-value":j.config.width,onInput:n[8]||(n[8]=i=>L("width",i))},null,8,["model-value"])]),_:1}),o(C,{label:"大屏高度"},{default:s(()=>[o(k,{placeholder:"请输入大屏高度","model-value":j.config.height,onInput:n[9]||(n[9]=i=>L("height",i))},null,8,["model-value"])]),_:1}),o(C,{class:"color-picker",label:"主色"},{default:s(()=>[o(S,{"show-alpha":"",onChange:n[10]||(n[10]=i=>L("primary",i)),"model-value":j.config.primary},null,8,["model-value"])]),_:1}),o(C,{label:"背景"},{default:s(()=>[o(I,{modelValue:x.bgSelect,"onUpdate:modelValue":n[11]||(n[11]=i=>x.bgSelect=i),onChange:w},{default:s(()=>[o(m,{value:1,label:"背景色"}),o(m,{value:2,label:"渐变色"}),o(m,{value:3,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),x.bgSelect!==3?(f(),O(C,{key:0,class:"color-picker"},{default:s(()=>[o(S,{"show-alpha":"",modelValue:x.bgColor,"onUpdate:modelValue":n[12]||(n[12]=i=>x.bgColor=i),onChange:w},null,8,["modelValue"])]),_:1})):H("",!0),x.bgSelect===2?(f(),E(J,{key:1},[o(C,{class:"color-picker"},{default:s(()=>[o(S,{"show-alpha":"",modelValue:x.bgLinear,"onUpdate:modelValue":n[13]||(n[13]=i=>x.bgLinear=i),onChange:w},null,8,["modelValue"])]),_:1}),o(C,{label:"渐变角度"},{default:s(()=>[o(ge,{modelValue:x.bgAngle,"onUpdate:modelValue":n[14]||(n[14]=i=>x.bgAngle=i),max:360,onChange:w},null,8,["modelValue"])]),_:1})],64)):H("",!0),x.bgSelect===3?(f(),O(C,{key:2,class:"upload-image"},{default:s(()=>[o(k,{placeholder:"请输入图片地址",modelValue:x.bgUpload,"onUpdate:modelValue":n[15]||(n[15]=i=>x.bgUpload=i),onChange:w},null,8,["modelValue"]),o(K,{type:"primary",onClick:n[16]||(n[16]=i=>v("bg","screenBg"))},{default:s(()=>[q("上传")]),_:1})]),_:1})):H("",!0),o(C,null,{default:s(()=>[o(K,{onClick:z},{default:s(()=>[q("编辑样式")]),_:1})]),_:1}),o(C,null,{default:s(()=>[fl]),_:1}),o(C,null,{default:s(()=>[o(k,{"model-value":j.config.requestUrl,placeholder:"接口URL或api中的key",onInput:n[18]||(n[18]=i=>L("requestUrl",i))},{prepend:s(()=>[o(I,{"model-value":j.config.method,style:{width:"60px"},onChange:n[17]||(n[17]=i=>L("method",i))},{default:s(()=>[o(m,{label:"get",value:"get"}),o(m,{label:"post",value:"post"}),o(m,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),o(C,{label:"刷新时间"},{default:s(()=>[o(ee,{disabled:"","model-value":j.config.loopTime,onInput:n[19]||(n[19]=i=>L("loopTime",i))},null,8,["model-value"])]),_:1}),o(C,null,{default:s(()=>[gl]),_:1}),o(C,null,{default:s(()=>[o(K,{onClick:n[20]||(n[20]=i=>se("beforeRequest","global"))},{default:s(()=>[q("beforeRequest")]),_:1})]),_:1}),o(C,null,{default:s(()=>[o(K,{onClick:n[21]||(n[21]=i=>se("afterResponse","global"))},{default:s(()=>[q("afterResponse")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})),o(ul,{ref_key:"uploadImageEl",ref:D,onClick:G},null,512)],2)}}}),hl={class:"main-left"},yl={class:"components-list scroll"},bl={class:"title"},ml=["title"],kl={class:"scroll layer-list"},_l=["onClick"],wl=["onClick"],xl=["onClick"],Il=y("i",{class:"icon-del"},null,-1),Cl=ce({__name:"controlLeft",props:{active:null},emits:["update","update:active"],setup(j,{expose:U,emit:b}){const d={line:["折线图","line"],bar:["柱状图","bar"],pie:["饼图","pie"],echarts:["通用图表",""],table:["表格","table"],text:["文本","text2"],sText:["滚动文本","stext"],image:["图片","image"],background:["背景","image"],border:["边框","border"],clock:["当前时间","time"],component:["自定义","component"]},c=N([]),D=N([{label:"图表",children:[{type:"line",label:d.line[0],icon:d.line[1],position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:d.bar[0],icon:d.bar[1],position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:d.pie[0],icon:d.pie[1],position:{width:300,height:300},option:{series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:d.echarts[0],icon:d.echarts[1],position:{width:400,height:300},option:{}}]},{label:"表格",children:[{type:"table",label:d.table[0],icon:d.table[1],position:{width:500,height:300},option:[],columns:[]}]},{label:"辅助",children:[{type:"text",label:d.text[0],icon:d.text[1],position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:d.sText[0],icon:d.sText[1],position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:d.image[0],icon:d.image[1],position:{width:100,height:50},config:{src:""}},{type:"background",label:d.background[0],icon:d.background[1],position:{width:100,height:50},config:{src:""}},{type:"border",label:d.border[0],icon:d.border[1],position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}}]},{label:"其他",children:[{type:"clock",label:d.clock[0],icon:d.clock[1],position:{width:150,height:30}}]},{label:"自定义组件",children:[{type:"component",label:d.component[0],icon:d.component[1],position:{width:200,height:200},config:{}}]}]),e=w=>ye(w),F=(w,L)=>{let a=!1;switch(L){case"display":a=!w.display,w.display=a;break;case"lock":a=!w.lock,w.lock=a;break;case"active":b("update:active",[w.index]);break}b("update",L,w.index,a)};return U({setLayer:w=>{const L=[];w.forEach((a,g)=>{a.type==="group"?L.push({label:"合并组",zIndex:a.position.zIndex||0,display:a.position.display,lock:a.config.lock,index:g,icon:"",groupId:a.id,type:"group"}):L.push({label:d[a.type][0],icon:d[a.type][1],zIndex:a.position.zIndex||0,display:a.position.display,lock:a.config.lock,index:g,groupId:a.groupId})}),c.value=L.sort(function(a,g){return a.groupId<g.groupId?-1:a.groupId>g.groupId?1:a.icon.localeCompare(g.icon)})}}),(w,L)=>{const a=R("el-tab-pane"),g=R("el-popconfirm"),V=R("el-tabs");return f(),E("div",hl,[o(V,{"model-value":"component",class:"tabs"},{default:s(()=>[o(a,{label:"组件",name:"component"},{default:s(()=>[y("div",yl,[(f(!0),E(J,null,oe(D.value,(v,G)=>(f(),E("div",{key:G},[y("div",bl,te(v.label),1),o(A(ze),{itemKey:"label",tag:"ul",modelValue:v.children,"onUpdate:modelValue":z=>v.children=z,group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:e},{item:s(({element:z})=>[y("li",{class:P([z.type])},[y("i",{class:P(`icon-${z.icon}`)},null,2),y("span",{title:z.label},te(z.label),9,ml)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),o(a,{label:"图层",name:"layer"},{default:s(()=>[y("div",kl,[y("ul",null,[(f(!0),E(J,null,oe(c.value,(v,G)=>(f(),E("li",{key:G,class:P({active:j.active.includes(v.index),lock:v.lock,display:v.display,isGroup:v.groupId&&!v.type})},[y("span",{onClick:z=>F(v,"active")},[y("i",{class:P(`icon-${v.icon}`)},null,2),q(" "+te(v.label),1)],8,_l),y("i",{onClick:z=>F(v,"display"),class:P(["icon",[v.display?"icon-eye-close":"icon-eye"]])},null,10,wl),y("i",{onClick:z=>F(v,"lock"),class:P(["icon",[v.lock?"icon-lock":"icon-lock-open"]])},null,10,xl),o(g,{title:"确认删除",onConfirm:z=>F({index:v.index},"del")},{reference:s(()=>[Il]),_:2},1032,["onConfirm"])],2))),128))])])]),_:1})]),_:1})])}}}),Tl=["onMousedown"],Re=ce({__name:"ruler",props:{direction:{default:"h"},scale:null,offset:null,showRuler:{type:Boolean},showLine:{type:Boolean},size:null,scroll:null},setup(j){const U=j,b=fe({leftTop:0,moveFlag:!1,moveLine:!1,line:[]}),d=Z(()=>{let g={};return U.direction==="v"&&U.scroll[0]>0&&(g={left:U.scroll[0]+20+"px"}),{width:U.size,...g}}),c=Z(()=>{let g;return U.direction==="h"?g={left:b.leftTop+"px"}:g={top:b.leftTop+"px"},{display:b.moveFlag?"block":"none",...g}}),D=Z(()=>{const g=U.direction==="h"?1920:1080,V=[];for(let v=0;v<g;v=v+100)V.push(v);return V}),e=g=>parseInt(`${g/U.scale*100}`),F=()=>{b.moveFlag=!0,document.onmousemove=g=>{if(!b.moveFlag)return;const V=parseInt(`${g.pageX-U.offset[0]+U.scroll[0]}`),v=parseInt(`${g.pageY-U.offset[1]+U.scroll[1]}`);b.leftTop=U.direction==="h"?V:v},document.onmouseup=function(){w()}},x=()=>{b.moveFlag&&(b.line.includes(b.leftTop)||b.line.push(b.leftTop))},w=()=>{b.moveFlag=!1,document.onmousemove=null,document.onmouseup=null},L=g=>U.direction==="h"?{left:g+"px"}:{top:g+"px"},a=(g,V,v)=>{b.moveLine=!0;const G=v.pageX-V,z=v.pageY-V;document.onmousemove=le=>{if(!b.moveLine)return;const ne=parseInt(`${le.pageX-G}`),B=parseInt(`${le.pageY-z}`),X=U.direction==="h"?ne:B;X<30?(b.line.splice(g,1),b.moveLine=!1):b.line[g]=X},document.onmouseup=function(){b.moveLine=!1,w()}};return(g,V)=>(f(),E(J,null,[be(y("div",{class:P(["screen-ruler",`ruler-${j.direction}`]),style:ae(A(d))},[y("div",{class:"ruler-box",onMouseenter:F,onMouseleave:w,onMousedown:x},[(f(!0),E(J,null,oe(A(D),v=>(f(),E("span",{key:v},te(e(v)),1))),128))],32)],6),[[Ce,j.showRuler]]),be(y("div",null,[y("div",{class:P(["ruler-line dotted",`line-${j.direction}`]),style:ae(A(c))},[y("span",null,te(e(b.leftTop-20)),1)],6),(f(!0),E(J,null,oe(b.line,(v,G)=>(f(),E("div",{class:P(["ruler-line",`line-${j.direction}`]),key:v,style:ae(L(v)),onMousedown:z=>a(G,v,z)},[y("span",null,te(e(v-20)),1)],46,Tl))),128))],512),[[Ce,j.showLine]])],64))}});const $l=["onClick"],Sl=ce({__name:"rightMenu",emits:["click"],setup(j,{expose:U,emit:b}){const d=fe({offsetX:0,offsetY:0,visible:!1,type:0}),c=Z(()=>{const w={0:["split","copy"],1:["merge"],2:["merge","split","left","right","top","bottom","horizontally","verticalCenter"]};return[{key:"merge",label:"组合"},{key:"split",label:"拆分"},{key:"left",label:"左对齐"},{key:"right",label:"右对齐",display:!0},{key:"top",label:"顶部对齐",display:!0},{key:"bottom",label:"底部对齐",display:!0},{key:"horizontally",label:"水平居中",display:!0},{key:"verticalCenter",label:"垂直居中",display:!0},{key:"copy",label:"复制"},{key:"del",label:"删除"},{key:"lock",label:"锁定"},{key:"display",label:"隐藏"}].filter(L=>!w[d.type].includes(L.key))}),D=Z(()=>({left:d.offsetX+"px",top:d.offsetY+"px"})),e=()=>{setTimeout(()=>{d.visible=!1},1e3)},F=w=>{b("click",w,d.type),d.visible=!1};return U({open:({x:w,y:L,type:a})=>{d.offsetX=w+10,d.offsetY=L,d.type=a||0,d.visible=!0}}),(w,L)=>be((f(),E("div",{class:"screen-right-menu",style:ae(A(D)),onMouseleave:e},[y("ul",null,[(f(!0),E(J,null,oe(A(c),a=>(f(),E("li",{key:a.key,onClick:g=>F(a.key),class:P({display:a.display})},te(a.label),11,$l))),128))])],36)),[[Ce,d.visible]])}}),Ll={class:"container-screen"},Vl={class:"main-box"},El={class:"control-tools"},Rl=["onMousedown"],Ul={key:0},Ml={key:0,class:"no-date"},zl={class:"design-footer"},Dl={class:"center"},Ol={class:"item"},Al=y("label",{class:"label"},"标尺",-1),jl={class:"item"},ql=y("label",{class:"label"},"参考线",-1),Bl={class:"item slider"},Fl=y("label",{class:"label"},"缩放比例",-1),Xl={class:"item"},Nl=ce({__name:"index",setup(j){je().changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]);const b=Ne(),d=Pe(),c=pe("screenToolWidthLeft")||"",D=pe("screenToolWidthRight")||"",e=fe({showLine:!0,scale:100,autoScale:100,ruler:!0,widthLeft:c==="0"?"":c,widthRight:D==="0"?"":D,offset:[],scroll:[0,0],translateX:0,translateY:0,moveFlag:!1,loading:!1,isEye:!1,activeIndex:[],activeTool:"mouse",rect:{left:"0px",top:"0px",width:"0px",height:"0px",display:"none"}}),F=N(),x=N(),w=N(),L=N(),a=N({list:[],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff"}}),g=N({});He("globalScreen",g);const V=Z(()=>{const{width:t,height:l,background:u,primary:h}=a.value.config,_=e.scale/100;return{width:t,height:l,background:u,transform:`scale(${_})`,color:h,cursor:e.activeTool==="mouse"?"default":"pointer"}}),v=()=>{e.activeIndex=[],k({})},G=(t,l)=>{e.rect.display="none",e.activeIndex=[l],k(t)},z=N({100:{style:{}}}),le=t=>{let l;t==="Left"?(e.widthLeft=e.widthLeft===""?"0px":"",l=e.widthLeft):(e.widthRight=e.widthRight===""?"0px":"",l=e.widthRight),setTimeout(()=>{X()},500),pe("screenToolWidth"+t,l||"0")},ne=t=>{B.value.scrollTo(0,0),t==="auto"?e.scale=e.autoScale:e.scale=100,pe("screenScale",e.scale+"")},B=N(),X=()=>{Me(()=>{const t=B.value.offsetWidth,l=parseInt(a.value.config.width);if(t&&l){const h=parseInt(`${t/l*100}`);e.autoScale=h;const _=pe("screenScale");e.scale=parseInt(_)||h}const u=B.value.getBoundingClientRect();e.offset[1]=u.top+document.documentElement.scrollTop-(document.documentElement.clientTop||0),e.offset[0]=u.left+document.documentElement.scrollLeft-(document.documentElement.clientLeft||0)})},se=t=>{v(),e.moveFlag=!0;const l=B.value.scrollTop,u=B.value.scrollLeft,h=t.pageX+u,_=t.pageY+l,T=(t.pageX-e.offset[0]-20+e.scroll[0])/(e.scale/100),$=(t.pageY-e.offset[1]-20+e.scroll[1])/(e.scale/100);e.rect={left:T+"px",top:$+"px",width:"0px",height:"0px",display:"none"},document.onmousemove=p=>{if(e.moveFlag)if(e.activeTool==="mouse"){const Y=(p.pageX-e.offset[0]-20+e.scroll[0])/(e.scale/100),Q=(p.pageY-e.offset[1]-20+e.scroll[1])/(e.scale/100),xe=T>Y?Y:T,Ie=$>Q?Q:$;e.rect={left:xe+"px",top:Ie+"px",width:Math.abs(T-Y)+"px",height:Math.abs($-Q)+"px",display:"block"}}else{const Y=h-p.pageX,Q=_-p.pageY;B.value.scrollTo(Y,Q)}},document.onmouseup=function(){const{width:p,height:Y}=e.rect;parseInt(p)>10&&parseInt(Y)>10?me():e.rect.display="none",e.moveFlag=!1,document.onmousemove=null}},me=()=>{if(a.value.list.forEach((l,u)=>{$e(l.position)&&t(l.position)&&l.type!=="group"&&!l.groupId&&!l.config.lock&&(e.activeIndex.includes(u)||e.activeIndex.push(u))}),e.activeIndex.length){const{left:l,top:u,width:h,height:_}=r();e.rect={left:l+"px",top:u+"px",width:h+"px",height:_+"px",display:"block"}}else e.rect.display="none";function t(l){const u=l.left,h=l.top,_=l.left+parseInt(l.width),T=l.top+parseInt(l.height),$=parseInt(e.rect.left),p=parseInt(e.rect.top),Y=$+parseInt(e.rect.width),Q=p+parseInt(e.rect.height),xe=u<Y&&$<_,Ie=h<Q&&p<T;return xe&&Ie}},r=()=>{const t={left:0,top:0,ex:0,ey:0};return a.value.list.forEach((u,h)=>{if(e.activeIndex.includes(h)){const{left:_,top:T,width:$,height:p}=u.position;t.left=l(t.left,_),t.top=l(t.top,T),t.ex=Math.max(t.ex,parseInt(`${$}`)+_),t.ey=Math.max(t.ey,parseInt(`${p}`)+T)}}),{left:t.left,top:t.top,width:Math.abs(t.ex-t.left),height:Math.abs(t.ey-t.top)};function l(u,h){return u===0?h:Math.min(u,h)}},n=()=>{const t=B.value.scrollTop,l=B.value.scrollLeft;e.scroll=[l,t]},M=t=>{t.preventDefault()},S=t=>{const l=t.newIndex,u=a.value.list[l];delete u.label,delete u.icon;const{pageX:h,pageY:_}=t.originalEvent;u.position||(u.position={}),u.config||(u.config={}),u.position.left=parseInt(`${h-e.offset[0]+e.scroll[0]}`),u.position.top=parseInt(`${_-e.offset[1]+e.scroll[1]}`),e.rect.display="none",e.activeIndex=[l],k(u),m()},k=t=>{F.value.setCurrent(t)},m=()=>{x.value.setLayer(a.value.list)},I=fe({visible:!1,title:"",direction:"",content:"",codeType:"",callback:""}),ee=()=>{ie()},C=t=>{try{if(typeof I.callback=="function"){const l=I.codeType==="json"?Xe(t):Se(t);I.callback(l)}else switch(I.type){case"css":a.value.config.style=t,Ye("screenStyle",t,!0);break;case"json":a.value=Se(t),m();break}ie()}catch{}},K=t=>{const{type:l,direction:u,codeType:h,title:_,callback:T,content:$}=t;I.direction=u||"ltr",I.type=l,I.codeType=h||"",I.title=_?`提示：${_}`:"",I.visible=!0,I.callback=T;let p=h==="json"?We($,!0):Le($,!0);switch(l){case"css":p=a.value.config.style||"";break}I.content=p},ie=()=>{I.visible=!1,I.type="",I.title="",I.codeType="",I.callback="",I.content=""},re=t=>{switch(t){case"del":a.value.list=[],v(),m();break;case"eye":e.isEye=!0;break;case"json":K({type:"json",content:a.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":w.value.openScreen(a.value);break;case"save":ue();break}},ue=()=>{const t={data:Le(a.value),name:"未命名可视化大屏",type:4};let l="designSave";const u=b.query.id;u&&(Object.assign(t,{id:u}),delete t.name,l="designEdit"),e.loading=!0,Ge(l,t).then(h=>{Ve({message:h.message||"保存成功！",type:"success"}),u||d.push({path:"/design/dataScreen/list"}),e.loading=!1}).catch(h=>{Ve.error(h.message||"保存异常"),e.loading=!1}),v()},ke=()=>{e.loading=!0,el(b.query.id).then(t=>{e.loading=!1,a.value=t,m();const{requestUrl:l,afterResponse:u,beforeRequest:h,method:_}=a.value.config;l&&ll(l,u,h,_).then(T=>{g.value=T})}).catch(()=>{e.loading=!1})},de=(t,l,u)=>{e.rect.display="none";const h=a.value.list[l].id,_=a.value.list;if(["display","lock"].includes(t)&&(t==="display"?_[l].position[t]=u:_[l].config[t]=u,h&&_.forEach(T=>{T.groupId===h&&(t==="display"?T.position.display=u:T.config.lock=u)}),k(_[l])),t==="del"&&(a.value.list.splice(l,1),v(),h&&(a.value.list=_.filter(T=>T.groupId!==h))),t==="copy"){let T="";const $=ye(a.value.list[l]);h&&(T=Ee(8),$.id=T,_.forEach(Y=>{if(Y.groupId===h){const Q=ye(Y);Q.groupId=T,a.value.list.push(Q)}})),a.value.list.push($);const p=a.value.list.length-1;G($,p)}m()},ge=t=>{var h;if(!((h=e.activeIndex)!=null&&h.length))return;const l=ye(e.activeIndex),u=a.value.list[e.activeIndex[0]].id;e.activeIndex.length===1&&u&&a.value.list.forEach((_,T)=>{_.groupId===u&&l.push(T)});for(const _ in l){const T=l[_],$=a.value.list[T];if(!$e($==null?void 0:$.position)){console.log("不能移");break}t.key==="ArrowRight"?$.position.left++:t.key==="ArrowLeft"?$.position.left--:t.key==="ArrowDown"?$.position.top++:t.key==="ArrowUp"&&$.position.top--}e.rect.display==="block"&&(t.key==="ArrowRight"?e.rect.left=parseInt(e.rect.left)+1+"px":t.key==="ArrowLeft"?e.rect.left=parseInt(e.rect.left)-1+"px":t.key==="ArrowDown"?e.rect.top=parseInt(e.rect.top)+1+"px":t.key==="ArrowUp"&&(e.rect.top=parseInt(e.rect.top)-1+"px")),t.preventDefault()},ve=t=>{L.value.open({x:t.pageX,y:t.pageY}),t.preventDefault()},i=({x:t,y:l,type:u})=>{L.value.open({x:t,y:l,type:u})},_e=(t,l)=>{const{list:u}=a.value,{id:h,position:_}=u[e.activeIndex[0]];let T,$=0;switch(t){case"merge":W();break;case"split":u.forEach(p=>{p.groupId===h&&delete p.groupId}),a.value.list.splice(e.activeIndex[0],1),v(),m();break;case"left":l===0?T=parseInt(e.rect.left):l===1&&(T=_.left),a.value.list.forEach((p,Y)=>{(l===0&&e.activeIndex.includes(Y)||l===1&&p.groupId===h)&&(p.position.left=T,p.position.width>$&&($=parseInt(p.position.width)))}),l===0?e.rect.width=$+"px":l===1&&(a.value.list[e.activeIndex[0]].position.width=$);break;case"right":case"top":case"bottom":case"horizontally":case"verticalCenter":break;case"copy":case"del":case"lock":case"display":de(t,e.activeIndex[0],!0);break}},W=()=>{const t=Ee(8);a.value.list.push({type:"group",position:{left:parseInt(e.rect.left),top:parseInt(e.rect.top),width:parseInt(e.rect.width),height:parseInt(e.rect.height),zIndex:110},config:{},id:t}),a.value.list.forEach((u,h)=>{e.activeIndex.includes(h)&&(u.groupId=t)});const l=a.value.list.length-1;G(a.value.list[l],l),m()},we=()=>{};return Ue(()=>{X(),ke(),document.addEventListener("keydown",ge)}),qe(()=>{document.removeEventListener("keydown",ge)}),(t,l)=>{var $;const u=R("el-switch"),h=R("el-slider"),_=R("el-button"),T=Ke("loading");return be((f(),E("div",Ll,[e.isEye?(f(),E("i",{key:0,class:"icon-close close-preview",onClick:l[0]||(l[0]=p=>e.isEye=!1)})):H("",!0),o(Cl,{style:ae({width:e.widthLeft}),ref_key:"controlLeftEl",ref:x,active:e.activeIndex,"onUpdate:active":l[1]||(l[1]=p=>e.activeIndex=p),onUpdate:de},null,8,["style","active"]),y("div",Vl,[o(Je,{onClick:re},{default:s(()=>[y("div",El,[y("i",{class:P(["icon-mouse",{active:e.activeTool==="mouse"}]),title:"矩形选择工具",onClick:l[2]||(l[2]=p=>e.activeTool="mouse")},null,2),y("i",{class:P(["icon-hand",{active:e.activeTool==="hand"}]),title:"手拖动工具",onClick:l[3]||(l[3]=p=>e.activeTool="hand")},null,2)])]),_:1}),y("div",{class:"design-box",ref_key:"designBoxEl",ref:B,onScroll:n},[o(Re,{size:"1920px",scale:e.scale,offset:e.offset,scroll:e.scroll,"show-ruler":e.ruler,"show-line":e.showLine},null,8,["scale","offset","scroll","show-ruler","show-line"]),o(Re,{size:"1080px",scale:e.scale,offset:e.offset,scroll:e.scroll,"show-ruler":e.ruler,"show-line":e.showLine,direction:"v"},null,8,["scale","offset","scroll","show-ruler","show-line"]),y("div",{onMousedown:Te(se,["left"]),class:P(["design-canvas",{preview:e.isEye}]),style:ae(A(V)),onContextmenu:M},[o(A(ze),Fe({itemKey:"id",list:a.value.list,name:"fade",class:"drag"},{group:"form",animation:200,handle:".none"},{onAdd:S}),{item:s(({element:p,index:Y})=>[o(Be,{data:p,onClick:Te(Q=>G(p,Y),["stop"]),type:0,scale:e.scale,current:e.activeIndex.includes(Y),onContextmenu:i,onMoveOrResize:we},null,8,["data","onClick","scale","current"])]),_:1},16,["list"]),y("div",{class:"draw-react",style:ae(e.rect),onContextmenu:ve},[($=e.activeIndex)!=null&&$.length?(f(),E("span",Ul,"选中"+te(e.activeIndex.length)+"个",1)):H("",!0)],36)],46,Rl),a.value.list.length?H("",!0):(f(),E("div",Ml," 请从左则组件栏拖动组件到设计区域 "))],544),y("div",zl,[y("i",{class:"icon-menu icon",onClick:l[4]||(l[4]=p=>le("Left"))}),y("div",Dl,[y("div",Ol,[Al,o(u,{size:"small",modelValue:e.ruler,"onUpdate:modelValue":l[5]||(l[5]=p=>e.ruler=p)},null,8,["modelValue"])]),y("div",jl,[ql,o(u,{size:"small",modelValue:e.showLine,"onUpdate:modelValue":l[6]||(l[6]=p=>e.showLine=p)},null,8,["modelValue"])]),y("div",Bl,[Fl,o(h,{"show-stops":"",max:200,min:e.autoScale-5,size:"small",marks:z.value,modelValue:e.scale,"onUpdate:modelValue":l[7]||(l[7]=p=>e.scale=p)},null,8,["min","marks","modelValue"])]),y("div",Xl,[o(_,{type:"primary",link:"",onClick:l[8]||(l[8]=p=>ne("auto"))},{default:s(()=>[q("自适应 ")]),_:1}),o(_,{type:"primary",link:"",onClick:l[9]||(l[9]=p=>ne("100"))},{default:s(()=>[q("100% ")]),_:1})])]),y("i",{class:"icon-menu icon",onClick:l[10]||(l[10]=p=>le("Right"))})])]),o(vl,{style:ae({width:e.widthRight}),config:a.value.config,"onUpdate:config":l[11]||(l[11]=p=>a.value.config=p),onOpenDrawer:K,onUpdate:m,ref_key:"configEl",ref:F},null,8,["style","config"]),o(Ze,{modelValue:I.visible,"onUpdate:modelValue":l[12]||(l[12]=p=>I.visible=p),title:I.title,direction:I.direction,content:I.content,"code-type":I.codeType,onBeforeClose:ee,onConfirm:C},null,8,["modelValue","title","direction","content","code-type"]),o(Qe,{ref_key:"vueFileEl",ref:w},null,512),o(Sl,{ref_key:"rightMenuEl",ref:L,onClick:_e},null,512)])),[[T,e.loading]])}}});export{Nl as default};
