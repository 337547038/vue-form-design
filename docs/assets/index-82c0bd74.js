import{i as se,r as M,j as J,o as he,b as S,c as d,k as R,w as n,g as e,u as j,a9 as we,h as z,d as L,F as N,f as Q,e as m,q as W,C as ye,L as xe,J as ce,H as Ce,t as le,s as Y,P as _e,Q as ke,A as de,B as fe,n as te,y as Te,l as Se,D as $e,z as re,E as Ve,_ as Le,a4 as Ue,a6 as Ie,Y as Re,G as ge,aa as Ee,$ as De,Z as ve,v as ze,W as me,p as je}from"./index-96eddb90.js";import{_ as Oe,a as qe}from"./vueFile.vue_vue_type_script_setup_true_lang-34f3b489.js";import{_ as Fe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-fa9f5a99.js";import{g as Be,a as Ae}from"./getData-cdc12d8b.js";const Me=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],We=[],Ye=[],ie={bg:Me,border:We,img:Ye},Xe={class:"img-list"},Ge=["onClick"],Ne=["src"],Pe={key:0},Ke=se({__name:"upload",emits:["click"],setup(E,{expose:U,emit:v}){const p=M(!1),s=M(),D=M("bg"),o=J(()=>{if(!ie)return[];const f=[];for(const w in ie)f.push(w);return f}),F=J(()=>D.value.name==="upload"?[]:ie?ie[D.value]:[]),k=J(()=>`./static/screen/${D.value}/`),C=f=>{p.value=!1,v("click",k.value+f,s.value)},r=f=>{D.value="upload",ye(()=>{F.value.unshift(f.path)})};return U({open:(f,w)=>{p.value=!0,s.value=w,f?D.value=f:D.value=o.value[0]}}),he(()=>{}),(f,w)=>{const g=S("el-button"),B=S("el-upload"),I=S("el-tab-pane"),H=S("el-tabs"),Z=S("el-dialog");return d(),R(Z,{modelValue:p.value,"onUpdate:modelValue":w[1]||(w[1]=O=>p.value=O),width:"800px",title:"选择上传图片"},{default:n(()=>{var O;return[e(B,{action:j(we),"on-success":r,"show-file-list":!1},{default:n(()=>[e(g,{type:"primary"},{default:n(()=>[z("上传")]),_:1})]),_:1},8,["action"]),e(H,{modelValue:D.value,"onUpdate:modelValue":w[0]||(w[0]=q=>D.value=q)},{default:n(()=>[(d(!0),L(N,null,Q(j(o),q=>(d(),R(I,{label:q,name:q,key:q},null,8,["label","name"]))),128)),e(I,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),m("div",Xe,[m("ul",null,[(d(!0),L(N,null,Q(j(F),q=>(d(),L("li",{key:q,onClick:ee=>C(q)},[m("img",{src:j(k)+q,alt:""},null,8,Ne)],8,Ge))),128))]),(O=j(F))!=null&&O.length?W("",!0):(d(),L("p",Pe," 暂无相关素材资源 "))])]}),_:1},8,["modelValue"])}}});const He=xe(Ke,[["__scopeId","data-v-7ebb50b6"]]),Je={key:0},Qe=m("h3",null,"接口数据处理事件",-1),Ze=m("h3",null,"全局数据",-1),el=m("h3",null,"接口数据处理事件",-1),ll=se({__name:"configControl",props:{config:null},emits:["update:config","openDrawer","update"],setup(E,{expose:U,emit:v}){const p=E,s=M({}),D=M(),o=J(()=>s.value.type),F=i=>{v("update:config",Object.assign({},p.config,i))},k=ce({bgColor:"",bgLinear:"",bgAngle:0,bgUpload:"",bgSelect:""});Ce(()=>p.config,i=>{if(!Object.keys(s.value).length){const l=i.background||"";if(l.indexOf("url")!==-1){const T=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),y=l.match(T);Object.assign(k,{bgUpload:y,bgSelect:3})}else if(l.indexOf("linear")!==-1){const y=l.substring(l.indexOf("(")+1,l.lastIndexOf(")")).split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/);Object.assign(k,{bgColor:y[1].trim(),bgLinear:y[2].trim(),bgAngle:Number(y[0].replace("deg","")),bgSelect:2})}else Object.assign(k,{bgColor:l,bgSelect:1})}},{immediate:!0});const C=()=>{let i="";switch(k.bgSelect){case 1:i=k.bgColor;break;case 2:i=`linear-gradient(${k.bgAngle}deg, ${k.bgColor}, ${k.bgLinear})`;break;case 3:i=`url(${k.bgUpload})`;break}r("background",i)},r=(i,l)=>{F({[i]:l})},$=i=>{s.value=i},f=J(()=>{var i,l,T,y;if(Object.keys(s.value).length){const{config:c={},position:x,type:X}=s.value;return[{type:"group",title:"位置信息"},{label:"width",value:x.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:x.height,placeholder:"请输入高度",key:"height",path:"position"},{type:"number",label:"left",value:x.left,placeholder:"图层位置",key:"left",path:"position"},{type:"number",label:"top",value:x.top,key:"top",path:"position"},{type:"number",label:"right",value:x.right,placeholder:"设置后left为auto",key:"right",path:"position"},{type:"number",label:"bottom",value:x.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:x.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:c.lock,key:"lock"},{type:"switch",label:"隐藏",value:x.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:c.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:c.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:c.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:c.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:c.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:c.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:(i=c.style)==null?void 0:i.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:(l=c.style)==null?void 0:l.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:(T=c.style)==null?void 0:T.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:(y=c.style)==null?void 0:y.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:c.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:c.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:c.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:c.speed,key:"speed",vShow:["table"]}].filter(G=>{let _=!0;return G.vShow&&(_=G.vShow.includes(X)),G.vHide&&(_=!G.vHide.includes(X)),_})}return[]}),w=(i,l)=>{var T;i.path==="position"?s.value.position[i.key]=l:i.path==="style"?((T=s.value.config)!=null&&T.style||(s.value.config.style={}),s.value.config.style[i.key]=l):s.value.config[i.key]=l,["zIndex","display","lock"].includes(i.key)&&v("update")},g=(i,l)=>{D.value.open(i,l)},B=(i,l)=>{switch(l){case"screenBg":k.bgUpload=i,C();break;case"src":s.value.config.src=i;break}},I=()=>{v("openDrawer",{codeType:"css",type:"css",title:"当前应用页的样式，类似于.vue文件中的style scoped中的样式"})},H=()=>{v("openDrawer",{content:s.value.option,title:"可参考echarts相关例子编辑",callback:i=>{s.value.option=i}})},Z=()=>{var i;v("openDrawer",{codeType:"json",content:((i=s.value.config)==null?void 0:i.style)||{},title:"可输入更多的css样式，须为json格式",callback:l=>{s.value.config.style=l}})},O=()=>{var i;v("openDrawer",{codeType:"json",content:((i=s.value.config)==null?void 0:i.props)||{},title:"支持所有表格props属性，可参考el-table。json格式",callback:l=>{s.value.config.props=l}})},q=()=>{let i=s.value.columns;(!i||!i.length)&&(i=[{prop:"",label:""}]),v("openDrawer",{codeType:"json",content:i,title:"表格列设置，可参考table-column属性",callback:l=>{s.value.columns=l}})},ee=(i,l)=>{let T;l==="global"?T=p.config&&p.config[i]:T=s.value.events&&s.value.events[i],T||(i==="beforeRequest"?T=y=>(console.log("beforeRequest",y),y):l==="global"?T=y=>(console.log("afterResponse",y),y):T=(y,c,x)=>(console.log("afterResponse",y,c,x),c)),v("openDrawer",{content:T,title:i==="beforeRequest"?"这里可处理请求前的参数，返回相应参数给接口":"接口数据处理。也可为字符串，如opt=formatTest",callback:y=>{l==="global"?p.config[i]=y:(s.value.events||(s.value.events={}),s.value.events[i]=y)}})},ue=()=>{var y,c;let i,l;const T=s.value.config.optionsType;T===2?(l="从大屏配置的全局数据里获取指定数据",i=(y=s.value.events)==null?void 0:y.getGlobal,i||(i=(x,X)=>(console.log("getGlobalData",x,X),x))):(l="图表数据，替换相关数据返回即可",["text","sText"].includes(o.value)?(i=(c=s.value.config)==null?void 0:c.text,l="编辑文本内容数据"):i=s.value.option,o.value==="table"&&(l="表格列表数据。根据设定的table-column列数据设置对应的数据")),v("openDrawer",{content:i,title:l,callback:x=>{T===2?(s.value.events||(s.value.events={}),s.value.events.getGlobal=x):["text","sText"].includes(o.value)?s.value.config.text=x:s.value.option=x}})};return U({setCurrent:$}),(i,l)=>{var V;const T=S("el-switch"),y=S("el-color-picker"),c=S("el-input"),x=S("el-option"),X=S("el-select"),G=S("el-input-number"),_=S("el-form-item"),A=S("el-button"),oe=S("el-form"),ne=S("el-tab-pane"),ae=S("el-radio"),u=S("el-radio-group"),a=S("el-tabs"),h=S("el-slider");return d(),L("div",{class:Y(["main-right",{lock:(V=s.value.config)==null?void 0:V.lock}])},[Object.keys(s.value).length?(d(),R(a,{key:0,class:"tabs","model-value":"screen"},{default:n(()=>[e(ne,{label:"位置属性",name:"screen"},{default:n(()=>[e(oe,{size:"small"},{default:n(()=>[(d(!0),L(N,null,Q(j(f),(t,P)=>(d(),R(_,{label:t.label,key:P},{default:n(()=>[t.type==="group"?(d(),L("h3",Je,le(t.title),1)):t.type==="switch"?(d(),R(T,{key:1,"model-value":t.value,onChange:b=>w(t,b),class:Y([t.key])},null,8,["model-value","onChange","class"])):t.type==="color"?(d(),R(y,{key:2,"show-alpha":"",onChange:b=>w(t,b),"model-value":t.value},null,8,["onChange","model-value"])):t.type==="textarea"?(d(),R(c,{key:3,type:"textarea",placeholder:t.placeholder,onChange:b=>w(t,b),"model-value":t.value},null,8,["placeholder","onChange","model-value"])):t.type==="select"?(d(),R(X,{key:4,allowCreate:t.allowCreate,filterable:t.filterable,placeholder:t.placeholder,onChange:b=>w(t,b),"model-value":t.value},{default:n(()=>[(d(!0),L(N,null,Q(t.options,(b,K)=>(d(),R(x,{key:b,label:b,value:K},null,8,["label","value"]))),128))]),_:2},1032,["allowCreate","filterable","placeholder","onChange","model-value"])):t.type==="number"?(d(),R(G,{key:5,"controls-position":"right",placeholder:t.placeholder,"model-value":t.value,onInput:b=>w(t,b)},null,8,["placeholder","model-value","onInput"])):(d(),R(c,{key:6,placeholder:t.placeholder,"model-value":t.value,onInput:b=>w(t,b)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(j(o))?(d(),R(_,{key:0,class:"upload-image"},{default:n(()=>[e(c,{placeholder:"请输入图片地址",modelValue:s.value.config.src,"onUpdate:modelValue":l[0]||(l[0]=t=>s.value.config.src=t)},null,8,["modelValue"]),e(A,{type:"primary",onClick:l[1]||(l[1]=t=>g(j(o)==="image"?"img":"bg","src"))},{default:n(()=>[z("选择图片")]),_:1})]),_:1})):W("",!0),["line","bar","pie","echarts"].includes(j(o))?(d(),R(_,{key:1},{default:n(()=>[e(A,{type:"primary",onClick:H},{default:n(()=>[z("图表编辑")]),_:1})]),_:1})):W("",!0),["text","sText","image","background","border","clock"].includes(j(o))?(d(),R(_,{key:2},{default:n(()=>[e(A,{type:"primary",onClick:Z},{default:n(()=>[z("编辑更多内联样式")]),_:1})]),_:1})):W("",!0),["table"].includes(j(o))?(d(),R(_,{key:3},{default:n(()=>[e(A,{type:"primary",onClick:O},{default:n(()=>[z("表格属性")]),_:1}),e(A,{type:"primary",onClick:q},{default:n(()=>[z("Table-column")]),_:1})]),_:1})):W("",!0)]),_:1})]),_:1}),e(ne,{label:"数据",name:"data"},{default:n(()=>[["line","bar","pie","echarts","text","sText","table"].includes(j(o))?(d(),R(oe,{key:0,size:"small"},{default:n(()=>[e(_,{label:"数据类型"},{default:n(()=>[e(u,{modelValue:s.value.config.optionsType,"onUpdate:modelValue":l[2]||(l[2]=t=>s.value.config.optionsType=t)},{default:n(()=>[e(ae,{label:0,style:{"margin-right":"4px"}},{default:n(()=>[z("静态")]),_:1}),e(ae,{label:2,style:{"margin-right":"4px"}},{default:n(()=>[z("全局")]),_:1}),e(ae,{label:1},{default:n(()=>[z("动态")]),_:1})]),_:1},8,["modelValue"])]),_:1}),s.value.config.optionsType!==1?(d(),R(_,{key:0},{default:n(()=>[e(A,{type:"primary",onClick:ue},{default:n(()=>[z("编辑数据")]),_:1})]),_:1})):W("",!0),s.value.config.optionsType===1?(d(),L(N,{key:1},[e(_,null,{default:n(()=>[e(c,{modelValue:s.value.config.requestUrl,"onUpdate:modelValue":l[4]||(l[4]=t=>s.value.config.requestUrl=t),placeholder:"接口URL或api中的key"},{prepend:n(()=>[e(X,{modelValue:s.value.config.method,"onUpdate:modelValue":l[3]||(l[3]=t=>s.value.config.method=t),style:{width:"60px"}},{default:n(()=>[e(x,{label:"get",value:"get"}),e(x,{label:"post",value:"post"}),e(x,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"刷新时间"},{default:n(()=>[e(G,{modelValue:s.value.config.loopTime,"onUpdate:modelValue":l[5]||(l[5]=t=>s.value.config.loopTime=t),disabled:""},null,8,["modelValue"])]),_:1}),e(_,null,{default:n(()=>[Qe]),_:1}),e(_,null,{default:n(()=>[e(A,{onClick:l[6]||(l[6]=t=>ee("beforeRequest"))},{default:n(()=>[z("beforeRequest")]),_:1})]),_:1}),e(_,null,{default:n(()=>[e(A,{onClick:l[7]||(l[7]=t=>ee("afterResponse"))},{default:n(()=>[z("afterResponse")]),_:1})]),_:1})],64)):W("",!0)]),_:1})):W("",!0)]),_:1})]),_:1})):(d(),R(a,{key:1,class:"tabs","model-value":"screen"},{default:n(()=>[e(ne,{label:"大屏配置",name:"screen"},{default:n(()=>[e(oe,{size:"small"},{default:n(()=>[e(_,{label:"大屏宽度"},{default:n(()=>[e(c,{placeholder:"请输入大屏宽度","model-value":E.config.width,onInput:l[8]||(l[8]=t=>r("width",t))},null,8,["model-value"])]),_:1}),e(_,{label:"大屏高度"},{default:n(()=>[e(c,{placeholder:"请输入大屏高度","model-value":E.config.height,onInput:l[9]||(l[9]=t=>r("height",t))},null,8,["model-value"])]),_:1}),e(_,{class:"color-picker",label:"主色"},{default:n(()=>[e(y,{"show-alpha":"",onChange:l[10]||(l[10]=t=>r("primary",t)),"model-value":E.config.primary},null,8,["model-value"])]),_:1}),e(_,{label:"背景"},{default:n(()=>[e(X,{modelValue:k.bgSelect,"onUpdate:modelValue":l[11]||(l[11]=t=>k.bgSelect=t),onChange:C},{default:n(()=>[e(x,{value:1,label:"背景色"}),e(x,{value:2,label:"渐变色"}),e(x,{value:3,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),k.bgSelect!==3?(d(),R(_,{key:0,class:"color-picker"},{default:n(()=>[e(y,{"show-alpha":"",modelValue:k.bgColor,"onUpdate:modelValue":l[12]||(l[12]=t=>k.bgColor=t),onChange:C},null,8,["modelValue"])]),_:1})):W("",!0),k.bgSelect===2?(d(),L(N,{key:1},[e(_,{class:"color-picker"},{default:n(()=>[e(y,{"show-alpha":"",modelValue:k.bgLinear,"onUpdate:modelValue":l[13]||(l[13]=t=>k.bgLinear=t),onChange:C},null,8,["modelValue"])]),_:1}),e(_,{label:"渐变角度"},{default:n(()=>[e(h,{modelValue:k.bgAngle,"onUpdate:modelValue":l[14]||(l[14]=t=>k.bgAngle=t),max:360,onChange:C},null,8,["modelValue"])]),_:1})],64)):W("",!0),k.bgSelect===3?(d(),R(_,{key:2,class:"upload-image"},{default:n(()=>[e(c,{placeholder:"请输入图片地址",modelValue:k.bgUpload,"onUpdate:modelValue":l[15]||(l[15]=t=>k.bgUpload=t),onChange:C},null,8,["modelValue"]),e(A,{type:"primary",onClick:l[16]||(l[16]=t=>g("bg","screenBg"))},{default:n(()=>[z("上传")]),_:1})]),_:1})):W("",!0),e(_,null,{default:n(()=>[e(A,{onClick:I},{default:n(()=>[z("编辑样式")]),_:1})]),_:1}),e(_,null,{default:n(()=>[Ze]),_:1}),e(_,null,{default:n(()=>[e(c,{"model-value":E.config.requestUrl,placeholder:"接口URL或api中的key",onInput:l[18]||(l[18]=t=>r("requestUrl",t))},{prepend:n(()=>[e(X,{"model-value":E.config.method,style:{width:"60px"},onChange:l[17]||(l[17]=t=>r("method",t))},{default:n(()=>[e(x,{label:"get",value:"get"}),e(x,{label:"post",value:"post"}),e(x,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),e(_,{label:"刷新时间"},{default:n(()=>[e(G,{disabled:"","model-value":E.config.loopTime,onInput:l[19]||(l[19]=t=>r("loopTime",t))},null,8,["model-value"])]),_:1}),e(_,null,{default:n(()=>[el]),_:1}),e(_,null,{default:n(()=>[e(A,{onClick:l[20]||(l[20]=t=>ee("beforeRequest","global"))},{default:n(()=>[z("beforeRequest")]),_:1})]),_:1}),e(_,null,{default:n(()=>[e(A,{onClick:l[21]||(l[21]=t=>ee("afterResponse","global"))},{default:n(()=>[z("afterResponse")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})),e(He,{ref_key:"uploadImageEl",ref:D,onClick:B},null,512)],2)}}}),tl={class:"main-left"},ol={class:"components-list scroll"},nl={class:"title"},al=["title"],sl={class:"scroll layer-list"},il=["onClick"],cl=["onClick"],ul=["onClick"],rl=m("i",{class:"icon-del"},null,-1),dl=se({__name:"controlLeft",props:{active:null},emits:["update","update:active"],setup(E,{expose:U,emit:v}){const p={line:["折线图","line"],bar:["柱状图","bar"],pie:["饼图","pie"],echarts:["通用图表",""],table:["表格","table"],text:["文本","text2"],sText:["滚动文本","stext"],image:["图片","image"],background:["背景","image"],border:["边框","border"],clock:["当前时间","time"],component:["自定义","component"]},s=M([]),D=M([{label:"图表",children:[{type:"line",label:p.line[0],icon:p.line[1],position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:p.bar[0],icon:p.bar[1],position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:p.pie[0],icon:p.pie[1],position:{width:300,height:300},option:{series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:p.echarts[0],icon:p.echarts[1],position:{width:400,height:300},option:{}}]},{label:"表格",children:[{type:"table",label:p.table[0],icon:p.table[1],position:{width:500,height:300},option:[],columns:[]}]},{label:"辅助",children:[{type:"text",label:p.text[0],icon:p.text[1],position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:p.sText[0],icon:p.sText[1],position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:p.image[0],icon:p.image[1],position:{width:100,height:50},config:{src:""}},{type:"background",label:p.background[0],icon:p.background[1],position:{width:100,height:50},config:{src:""}},{type:"border",label:p.border[0],icon:p.border[1],position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}}]},{label:"其他",children:[{type:"clock",label:p.clock[0],icon:p.clock[1],position:{width:150,height:30}}]},{label:"自定义组件",children:[{type:"component",label:p.component[0],icon:p.component[1],position:{width:200,height:200},config:{}}]}]),o=C=>ke(C),F=(C,r)=>{let $=!1;switch(r){case"display":$=!C.display,C.display=$;break;case"lock":$=!C.lock,C.lock=$;break;case"active":v("update:active",C.index);break}v("update",r,C.index,$)};return U({setLayer:C=>{const r=[];C.forEach(($,f)=>{r.push({label:p[$.type][0],icon:p[$.type][1],zIndex:$.position.zIndex||0,display:$.position.display,lock:$.config.lock,index:f})}),s.value=r.sort(($,f)=>$.icon.localeCompare(f.icon))}}),(C,r)=>{const $=S("el-tab-pane"),f=S("el-popconfirm"),w=S("el-tabs");return d(),L("div",tl,[e(w,{"model-value":"component",class:"tabs"},{default:n(()=>[e($,{label:"组件",name:"component"},{default:n(()=>[m("div",ol,[(d(!0),L(N,null,Q(D.value,(g,B)=>(d(),L("div",{key:B},[m("div",nl,le(g.label),1),e(j(_e),{itemKey:"label",tag:"ul",modelValue:g.children,"onUpdate:modelValue":I=>g.children=I,group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:o},{item:n(({element:I})=>[m("li",{class:Y([I.type])},[m("i",{class:Y(`icon-${I.icon}`)},null,2),m("span",{title:I.label},le(I.label),9,al)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),e($,{label:"图层",name:"layer"},{default:n(()=>[m("div",sl,[m("ul",null,[(d(!0),L(N,null,Q(s.value,(g,B)=>(d(),L("li",{key:B,class:Y({active:E.active===g.index,lock:g.lock,display:g.display})},[m("span",{onClick:I=>F(g,"active")},[m("i",{class:Y(`icon-${g.icon}`)},null,2),z(" "+le(g.label),1)],8,il),m("i",{onClick:I=>F(g,"display"),class:Y(["icon",[g.display?"icon-eye-close":"icon-eye"]])},null,10,cl),m("i",{onClick:I=>F(g,"lock"),class:Y(["icon",[g.lock?"icon-lock":"icon-lock-open"]])},null,10,ul),e(f,{title:"确认删除",onConfirm:I=>F({index:g.index},"del")},{reference:n(()=>[rl]),_:2},1032,["onConfirm"])],2))),128))])])]),_:1})]),_:1})])}}}),pl=["onMousedown"],be=se({__name:"ruler",props:{direction:{default:"h"},scale:null,offset:null,showRuler:{type:Boolean},showLine:{type:Boolean},size:null,scroll:null},setup(E){const U=E,v=ce({leftTop:0,moveFlag:!1,moveLine:!1,line:[]}),p=J(()=>{let f={};return U.direction==="v"&&U.scroll[0]>0&&(f={left:U.scroll[0]+20+"px"}),{width:U.size,...f}}),s=J(()=>{let f;return U.direction==="h"?f={left:v.leftTop+"px"}:f={top:v.leftTop+"px"},{display:v.moveFlag?"block":"none",...f}}),D=J(()=>{const f=U.direction==="h"?1920:1080;let w=[];for(let g=0;g<f;g=g+100)w.push(g);return w}),o=f=>parseInt(`${f/U.scale*100}`),F=()=>{v.moveFlag=!0,document.onmousemove=f=>{if(!v.moveFlag)return;const w=parseInt(`${f.pageX-U.offset[0]+U.scroll[0]}`),g=parseInt(`${f.pageY-U.offset[1]+U.scroll[1]}`);v.leftTop=U.direction==="h"?w:g},document.onmouseup=function(){C()}},k=()=>{v.moveFlag&&(v.line.includes(v.leftTop)||v.line.push(v.leftTop))},C=()=>{v.moveFlag=!1,document.onmousemove=null,document.onmouseup=null},r=f=>U.direction==="h"?{left:f+"px"}:{top:f+"px"},$=(f,w,g)=>{v.moveLine=!0;const B=g.pageX-w,I=g.pageY-w;document.onmousemove=H=>{if(!v.moveLine)return;const Z=parseInt(`${H.pageX-B}`),O=parseInt(`${H.pageY-I}`),q=U.direction==="h"?Z:O;q<30?(v.line.splice(f,1),v.moveLine=!1):v.line[f]=q},document.onmouseup=function(){v.moveLine=!1,C()}};return(f,w)=>(d(),L(N,null,[de(m("div",{class:Y(["screen-ruler",`ruler-${E.direction}`]),style:te(j(p))},[m("div",{class:"ruler-box",onMouseenter:F,onMouseleave:C,onMousedown:k},[(d(!0),L(N,null,Q(j(D),g=>(d(),L("span",{key:g},le(o(g)),1))),128))],32)],6),[[fe,E.showRuler]]),de(m("div",null,[m("div",{class:Y(["ruler-line dotted",`line-${E.direction}`]),style:te(j(s))},[m("span",null,le(o(v.leftTop-20)),1)],6),(d(!0),L(N,null,Q(v.line,(g,B)=>(d(),L("div",{class:Y(["ruler-line",`line-${E.direction}`]),key:g,style:te(r(g)),onMousedown:I=>$(B,g,I)},[m("span",null,le(o(g-20)),1)],46,pl))),128))],512),[[fe,E.showLine]])],64))}});const fl={class:"container-screen"},gl={class:"main-box"},vl={key:0,class:"no-date"},ml={class:"design-footer"},bl={class:"center"},hl={class:"item"},yl=m("label",{class:"label"},"标尺",-1),_l={class:"item"},kl=m("label",{class:"label"},"参考线",-1),wl={class:"item slider"},xl=m("label",{class:"label"},"缩放比例",-1),Cl={class:"item"},Ll=se({__name:"index",setup(E){Te().changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]);const v=Se(),p=$e(),s=re("screenToolWidthLeft")||"",D=re("screenToolWidthRight")||"",o=ce({showLine:!0,scale:100,autoScale:100,ruler:!0,widthLeft:s==="0"?"":s,widthRight:D==="0"?"":D,offset:[],scroll:[0,0],translateX:0,translateY:0,moveFlag:!1,loading:!1,isEye:!1,active:null}),F=M(),k=M(),C=M(),r=M({list:[],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff"}}),$=M({});je("globalScreen",$);const f=J(()=>{const{width:u,height:a,background:h,primary:V}=r.value.config,t=o.scale/100;return{width:u,height:a,background:h,transform:`scale(${t})`,color:V}}),w=()=>{o.active=null,T({})},g=(u,a)=>{o.active=a,T(u)},B=(u,a)=>{if(a==="del")r.value.list.splice(u,1),w();else if(a==="clone"){const h=ke(r.value.list[u]);r.value.list.push(h);const V=r.value.list.length-1;g(h,V)}y()},I=M({100:{style:{}}}),H=u=>{let a;u==="Left"?(o.widthLeft=o.widthLeft===""?"0px":"",a=o.widthLeft):(o.widthRight=o.widthRight===""?"0px":"",a=o.widthRight),setTimeout(()=>{q()},500),re("screenToolWidth"+u,a||"0")},Z=()=>{o.scale=o.autoScale},O=M(),q=()=>{ye(()=>{const u=O.value.offsetWidth,a=parseInt(r.value.config.width);if(u&&a){const V=parseInt(`${u/a*100}`);o.autoScale=V,o.scale=V}const h=O.value.getBoundingClientRect();o.offset[1]=h.top+(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),o.offset[0]=h.left+(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0)})},ee=u=>{o.moveFlag=!0;const a=O.value.scrollTop,h=O.value.scrollLeft,V=u.pageX+h,t=u.pageY+a;document.onmousemove=P=>{if(!o.moveFlag)return;const b=V-P.pageX,K=t-P.pageY;O.value.scrollTo(b,K)},document.onmouseup=function(){o.moveFlag=!1,document.onmousemove=null}},ue=()=>{const u=O.value.scrollTop,a=O.value.scrollLeft;o.scroll=[a,u]},i=u=>{u.preventDefault()},l=u=>{const a=u.newIndex,h=r.value.list[a];delete h.label,delete h.icon;const{pageX:V,pageY:t}=u.originalEvent;h.position||(h.position={}),h.config||(h.config={}),h.position.left=parseInt(`${V-o.offset[0]+o.scroll[0]}`),h.position.top=parseInt(`${t-o.offset[1]+o.scroll[1]}`),o.active=a,T(h),y()},T=u=>{F.value.setCurrent(u)},y=()=>{k.value.setLayer(r.value.list)},c=ce({visible:!1,title:"",direction:"",content:"",codeType:"",callback:""}),x=()=>{_()},X=u=>{try{if(typeof c.callback=="function"){const a=c.codeType==="json"?Re(u):ge(u);c.callback(a)}else switch(c.type){case"css":r.value.config.style=u,Ee("screenStyle",u,!0);break;case"json":r.value=ge(u),y();break}_()}catch{}},G=u=>{const{type:a,direction:h,codeType:V,title:t,callback:P,content:b}=u;c.direction=h||"ltr",c.type=a,c.codeType=V||"",c.title=t?`提示：${t}`:"",c.visible=!0,c.callback=P;let K=V==="json"?De(b,!0):ve(b,!0);switch(a){case"css":K=r.value.config.style||"";break}c.content=K},_=()=>{c.visible=!1,c.type="",c.title="",c.codeType="",c.callback="",c.content=""},A=u=>{switch(u){case"del":r.value.list=[],w(),y();break;case"eye":o.isEye=!0;break;case"json":G({type:"json",content:r.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":C.value.openScreen(r.value);break;case"save":oe();break}},oe=()=>{let u={data:ve(r.value),name:"未命名可视化大屏",type:4},a="designSave";const h=v.query.id;h&&(Object.assign(u,{id:h}),delete u.name,a="designEdit"),o.loading=!0,ze(a,u).then(V=>{me({message:V.message||"保存成功！",type:"success"}),h||p.push({path:"/design/dataScreen/list"}),o.loading=!1}).catch(V=>{me.error(V.message||"保存异常"),o.loading=!1}),w()},ne=()=>{o.loading=!0,Be(v.query.id).then(u=>{o.loading=!1,r.value=u,y();const{requestUrl:a,afterResponse:h,beforeRequest:V,method:t}=r.value.config;a&&Ae(a,h,V,t).then(P=>{$.value=P})}).catch(()=>{o.loading=!1})},ae=(u,a,h)=>{switch(u){case"display":case"zIndex":r.value.list[a].position[u]=h;break;case"lock":r.value.list[a].config[u]=h;break;case"del":return B(a,"del")}T(r.value.list[a])};return he(()=>{q(),ne()}),(u,a)=>{const h=S("el-switch"),V=S("el-slider"),t=S("el-button"),P=Ve("loading");return de((d(),L("div",fl,[o.isEye?(d(),L("i",{key:0,class:"icon-close close-preview",onClick:a[0]||(a[0]=b=>o.isEye=!1)})):W("",!0),e(dl,{style:te({width:o.widthLeft}),ref_key:"controlLeftEl",ref:k,active:o.active,"onUpdate:active":a[1]||(a[1]=b=>o.active=b),onUpdate:ae},null,8,["style","active"]),m("div",gl,[e(Oe,{onClick:A}),m("div",{class:"design-box",ref_key:"designBoxEl",ref:O,onScroll:ue},[e(be,{size:"1920px",scale:o.scale,offset:o.offset,scroll:o.scroll,"show-ruler":o.ruler,"show-line":o.showLine},null,8,["scale","offset","scroll","show-ruler","show-line"]),e(be,{size:"1080px",scale:o.scale,offset:o.offset,scroll:o.scroll,"show-ruler":o.ruler,"show-line":o.showLine,direction:"v"},null,8,["scale","offset","scroll","show-ruler","show-line"]),m("div",{onMousedown:ee,class:Y(["design-canvas",{preview:o.isEye}]),style:te(j(f)),onClick:w,onContextmenu:i},[e(j(_e),Ie({itemKey:"id",list:r.value.list,name:"fade",class:"drag"},{group:"form",animation:200,handle:".none"},{onAdd:l}),{item:n(({element:b,index:K})=>[e(Le,{data:b,onClick:Ue(pe=>g(b,K),["stop"]),type:0,current:K===o.active,onControlClick:pe=>B(K,pe)},null,8,["data","onClick","current","onControlClick"])]),_:1},16,["list"])],38),r.value.list.length?W("",!0):(d(),L("div",vl,"请从左则组件栏拖动组件到设计区域 "))],544),m("div",ml,[m("i",{class:"icon-menu icon",onClick:a[2]||(a[2]=b=>H("Left"))}),m("div",bl,[m("div",hl,[yl,e(h,{size:"small",modelValue:o.ruler,"onUpdate:modelValue":a[3]||(a[3]=b=>o.ruler=b)},null,8,["modelValue"])]),m("div",_l,[kl,e(h,{size:"small",modelValue:o.showLine,"onUpdate:modelValue":a[4]||(a[4]=b=>o.showLine=b)},null,8,["modelValue"])]),m("div",wl,[xl,e(V,{"show-stops":"",max:200,min:o.autoScale-5,size:"small",marks:I.value,modelValue:o.scale,"onUpdate:modelValue":a[5]||(a[5]=b=>o.scale=b)},null,8,["min","marks","modelValue"])]),m("div",Cl,[e(t,{type:"primary",link:"",onClick:Z},{default:n(()=>[z("自适应 ")]),_:1})])]),m("i",{class:"icon-menu icon",onClick:a[6]||(a[6]=b=>H("Right"))})])]),e(ll,{style:te({width:o.widthRight}),config:r.value.config,"onUpdate:config":a[7]||(a[7]=b=>r.value.config=b),onOpenDrawer:G,onUpdate:y,ref_key:"configEl",ref:F},null,8,["style","config"]),e(Fe,{modelValue:c.visible,"onUpdate:modelValue":a[8]||(a[8]=b=>c.visible=b),title:c.title,direction:c.direction,content:c.content,"code-type":c.codeType,onBeforeClose:x,onConfirm:X},null,8,["modelValue","title","direction","content","code-type"]),e(qe,{ref_key:"vueFileEl",ref:C},null,512)])),[[P,o.loading]])}}});export{Ll as default};
