import{e as he,z as De,s as ke,r as ve,l as Be,A as Fe,j as ye,q as M,N as Ee,a as c,x as Ce,n as S,o as s,c as r,i,m as N,F as _,b as o,w as u,f as D,g as m,p as C,d as b,t as x,_ as xe,W as A,L as Ve,X as Ie,Y as we,v as Le,Q,P as H,R as Oe,y as V,O as K,E as I,k as J,Z as Te,$ as Ae}from"./index.813d72fb.js";import{_ as Ue,a as $e}from"./vueFile.vue_vue_type_script_setup_true_lang.49d07aff.js";const Re={class:"design-container design-table"},Ge={class:"components-list"},je=i("div",{class:"title"},"\u53EF\u9009\u5B57\u6BB5",-1),ze={class:"content"},qe=i("div",{class:"title"},"\u5176\u4ED6\u5B57\u6BB5",-1),Pe={class:"content"},Me=i("div",{class:"title"},"\u64CD\u4F5C\u6309\u94AE",-1),Se={class:"content"},Ne={class:"title"},Qe=b("\u7F16\u8F91\u81EA\u5B9A\u4E49\u5B57\u6BB5 "),He={class:"main-body"},Ke={class:"main-form main-table"},Je=i("p",{style:{padding:"10px 0"}},"\u63D0\u793A\uFF1A\u70B9\u51FB\u8868\u5934\u53EF\u62D6\u52A8\u6539\u53D8\u987A\u5E8F",-1),We={class:"control-btn"},Xe=["innerHTML"],Ye=i("i",{class:"icon-help"},null,-1),Ze={key:1},et=["onClick"],tt={class:"sidebar-tools"},lt=["onClick"],at=b("\u65B0\u589ETag\u6807\u7B7E\u663E\u793A"),ot=b("\u7F16\u8F91\u8868\u683C\u5C5E\u6027 "),nt=b("\u8BBE\u7F6E\u6570\u636E\u5B57\u5178 "),ut=b("beforeRequest"),st=b("afterResponse"),dt={key:0,id:"editJson"},it={class:"dialog-footer"},ct=b(" \u786E\u5B9A "),ft=he({__name:"table",setup(rt){const W=De(),U=ke(),{proxy:X}=Ae(),$=ve(),v=Be(()=>U.query.type==="table"),e=Fe({direction:"rtl",filedList:[],otherFiled:[{label:"\u52FE\u9009",prop:"__selection",type:"selection"},{label:"\u5E8F\u53F7",prop:"__index",type:"index",width:"70px"},{label:"\u64CD\u4F5C",prop:"__control"}],checkboxGroup:[],controlBtn:[{label:"\u65B0\u589E",key:"add",type:"primary",size:"small",hide:v.value},{label:"\u5220\u9664",key:"del",size:"small"}],controlBtnGroup:[],tableData:{tableProps:{},columns:[],controlBtn:[]},editor:{},visibleDialog:!1,loading:!1,id:U.query.id,selectCheck:"",editIndex:"",dataList:[{}],dataTemp:{},attrObj:{},tagList:[],config:{},name:"",formId:"",dict:{},searchData:{}}),Y=["txt","title","table","component","upload"],w=a=>{a==null||a.list.forEach(t=>{var n;t.type==="grid"||t.type==="tabs"?t.columns.forEach(d=>{w(d)}):t.type==="card"?w(t):Y.indexOf(t.type)===-1&&e.filedList.push({prop:t.name,label:(n=t.item)==null?void 0:n.label,help:t.config.help||""})})},Z=a=>{switch(a){case"del":e.tableData.columns=[],e.checkboxGroup=[];break;case"json":k(e.tableData);break;case"vue":$.value.openTable(e.tableData);break;case"save":te();break}},R=a=>{e.checkboxGroup.indexOf(a.label)===-1?e.tableData.columns.forEach((n,d)=>{n.label===a.label&&n.prop===a.prop&&e.tableData.columns.splice(d,1)}):e.tableData.columns.push(a)},k=(a,t,n)=>{e.direction=t||"rtl",e.visibleDialog=!0;const d=n==="dict"?Q(a,!0):H(a,!0);M(()=>{e.editor=Oe(d)})},ee=()=>{try{const a=V(e.editor.getValue());switch(e.editIndex){case"columns":e.tableData.columns=a;break;case"tableConfig":e.tableData.tableProps=a;break;case"dict":e.dict=K(e.editor.getValue());break;case"beforeRequest":case"afterResponse":e.tableData.events||(e.tableData.events={}),e.tableData.events[e.editIndex]=a;break}e.editIndex!==""?e.tableData.columns[e.editIndex]=a:e.tableData=a,e.editIndex="",e.visibleDialog=!1}catch(a){I.error(a.message)}},te=()=>{const a=e.name||e.dataTemp.name;if(!a){I.error(v.value?"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0":"\u8BF7\u8F93\u5165\u8868\u5355\u540D\u79F0");return}e.loading=!0;const t=Object.assign(e.dataTemp,{tableData:H(e.tableData),id:e.id,name:a,formId:e.formId||e.dataTemp.formId,type:e.dataTemp.type||2,dict:Q(e.dict)});J("saveForm",t).then(n=>{console.log(n),I({message:n.data.message||"\u4FDD\u5B58\u6210\u529F\uFF01",type:"success"}),W.push({path:"/designform/formlist"}),e.loading=!1}).catch(n=>{I.error(n.data.message||"\u4FDD\u5B58\u5F02\u5E38"),e.loading=!1})},le=a=>{e.editIndex="",a()},B=a=>{switch(e.editIndex=a,a){case"dict":k(e.dict||{},"ltr",a);break;case"tableConfig":k(e.tableData.tableProps,"ltr");break;case"columns":k(e.tableData.columns);break;case"beforeRequest":case"afterResponse":const t=e.tableData.events||{},n=d=>d;k(t[a]||n,"ltr");break}},ae=a=>{let t={};e.tableData.columns.forEach((n,d)=>{n.prop===a&&(t=n,e.editIndex=d)}),k(t)},oe=a=>{var d;let t=(d=e.tableData)==null?void 0:d.controlBtn,n=-1;t?t.forEach((p,F)=>{(p.key===a.key||p.label===a.label)&&(n=F)}):e.tableData.controlBtn=[],n!==-1?e.tableData.controlBtn.splice(n,1):(delete a.hide,e.tableData.controlBtn.push(a))},ne=()=>{const a=X.$el.querySelector(".el-table__header-wrapper tr");Te.create(a,{animation:180,delay:0,onEnd:t=>{const n=e.tableData.columns[t.oldIndex];e.tableData.columns.splice(t.oldIndex,1),e.tableData.columns.splice(t.newIndex,0,n)}})},ue=()=>{e.id&&J("getFormById",{id:e.id}).then(a=>{var t;if(a.data.code===200){const n=a.data.data;e.dataTemp=n,w(V(n.formData)),n.tableData&&(e.tableData=V(n.tableData)),n.searchData&&(e.searchData=V(n.searchData)),v.value&&(e.name=n.name,e.formId=n.formId),e.tableData.columns.forEach(d=>{e.checkboxGroup.push(d.label)}),(t=e.tableData.controlBtn)==null||t.forEach(d=>{e.controlBtnGroup.push(d.key||d.label)}),e.dict=K(n.dict)}})},se=a=>{e.attrObj=a,e.config=a.config||{};const t=e.config.tagList;if(e.tagList=[],t)for(const n in t)e.tagList.push({value:n,type:t[n]})},de=a=>{e.tagList.splice(a,1),L()},ie=()=>{e.tagList.push({value:"",type:"default"})},L=()=>{const a={};e.tagList.forEach(t=>{a[t.value]=t.type}),Object.keys(a).length?e.config.tagList=a:delete e.config.tagList,O()},O=()=>{Object.assign(e.attrObj,{config:e.config})};return ye(()=>{M(()=>{ue(),ne()})}),Ee(()=>{Object.keys(e.editor).length!==0&&(e.editor.destroy(),e.editor.container.remove())}),(a,t)=>{var j,z,q,P;const n=c("el-checkbox"),d=c("el-checkbox-group"),p=c("el-button"),F=c("el-tooltip"),ce=c("el-table-column"),re=c("el-table"),f=c("el-option"),T=c("el-select"),g=c("el-form-item"),y=c("el-input"),G=c("el-tab-pane"),pe=c("QuestionFilled"),be=c("el-icon"),fe=c("el-tabs"),_e=c("el-form"),me=c("el-drawer"),ge=Ce("loading");return S((s(),r("div",Re,[i("div",Ge,[((j=e.filedList)==null?void 0:j.length)&&e.id&&!N(v)?(s(),r(_,{key:0},[je,i("div",ze,[o(d,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[0]||(t[0]=l=>e.checkboxGroup=l),size:"small"},{default:u(()=>[(s(!0),r(_,null,D(e.filedList,l=>(s(),m(n,{label:l.label,key:l.prop,onChange:h=>R(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])])],64)):C("",!0),qe,i("div",Pe,[o(d,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[1]||(t[1]=l=>e.checkboxGroup=l),size:"small"},{default:u(()=>[(s(!0),r(_,null,D(e.otherFiled,l=>(s(),m(n,{label:l.label,key:l.prop,onChange:h=>R(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),Me,i("div",Se,[o(d,{modelValue:e.controlBtnGroup,"onUpdate:modelValue":t[2]||(t[2]=l=>e.controlBtnGroup=l),size:"small"},{default:u(()=>[(s(!0),r(_,null,D(e.controlBtn.filter(l=>!l.hide),l=>(s(),m(n,{label:l.key,key:l.prop,onChange:h=>oe(l)},{default:u(()=>[b(x(l.label),1)]),_:2},1032,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),i("div",Ne,[o(p,{size:"small",onClick:t[3]||(t[3]=l=>B("columns"))},{default:u(()=>[Qe]),_:1})])]),i("div",He,[o(Ue,{onClick:Z,type:"2"}),i("div",Ke,[Je,(q=(z=e.searchData)==null?void 0:z.list)!=null&&q.length?(s(),m(xe,{key:0,type:2,"form-data":e.searchData,dict:e.dict,requestUrl:!1},null,8,["form-data","dict"])):C("",!0),i("div",We,[(s(!0),r(_,null,D((P=e.tableData)==null?void 0:P.controlBtn,l=>(s(),m(p,A(l,{key:l.label}),{default:u(()=>[b(x(l.label),1)]),_:2},1040))),128))]),o(re,A({data:e.dataList},e.tableData.tableProps,{ref:"tableEl"}),{default:u(()=>[(s(!0),r(_,null,D(e.tableData.columns,l=>(s(),m(ce,we(A({key:l.prop||l.label},l)),Ve({_:2},[l.help?{name:"header",fn:u(h=>[b(x(h.column.label)+" ",1),o(F,{placement:"top"},{content:u(()=>[i("span",{innerHTML:l.help},null,8,Xe)]),default:u(()=>[Ye]),_:2},1024)])}:void 0,l.type!=="index"?{name:"default",fn:u(()=>[l.type==="selection"?(s(),m(n,{key:0})):l.prop==="__control"?(s(),r("span",Ze,"\u7F16\u8F91 \u5220\u9664")):(s(),r("span",{key:2,onClick:Ie(h=>se(l),["stop"])},"\u70B9\u51FB\u4E2A\u6027\u5316\u8BBE\u7F6E",8,et))])}:void 0]),1040))),128))]),_:1},16,["data"])])]),i("div",tt,[o(_e,{size:"small"},{default:u(()=>[o(fe,{modelValue:"first"},{default:u(()=>[o(G,{label:"\u5B57\u6BB5\u5C5E\u6027",name:"first"},{default:u(()=>[o(g,{label:"\u9009\u62E9\u8868\u5934\u5B57\u6BB5"},{default:u(()=>[o(T,{modelValue:e.selectCheck,"onUpdate:modelValue":t[4]||(t[4]=l=>e.selectCheck=l),onChange:ae},{default:u(()=>[(s(!0),r(_,null,D(e.tableData.columns,l=>(s(),m(f,{key:l.prop,value:l.prop,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(i("div",null,[i("h3",null,x(e.attrObj.label)+"\u4E2A\u6027\u5316\u8BBE\u7F6E",1),o(g,{label:"\u65F6\u95F4\u683C\u5F0F\u5316"},{default:u(()=>[o(T,{modelValue:e.config.formatter,"onUpdate:modelValue":t[5]||(t[5]=l=>e.config.formatter=l),onChange:O},{default:u(()=>[o(f,{label:"{y}-{m}-{d} {h}:{i}:{s}",value:"{y}-{m}-{d} {h}:{i}:{s}"}),o(f,{label:"{y}-{m}-{d}",value:"{y}-{m}-{d}"}),o(f,{label:"{h}:{i}:{s}",value:"{h}:{i}:{s}"})]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"\u503C\u5339\u914D\u5B57\u5178"},{default:u(()=>[o(y,{placeholder:"\u5B57\u5178\u5BF9\u5E94\u7684key",modelValue:e.config.dictKey,"onUpdate:modelValue":t[6]||(t[6]=l=>e.config.dictKey=l),onChange:O},null,8,["modelValue"])]),_:1}),(s(!0),r(_,null,D(e.tagList,(l,h)=>(s(),m(g,{key:h,class:"table-tag"},{default:u(()=>[o(y,{placeholder:"\u503C\u5BF9\u5E94\u7684\u7C7B\u578B",modelValue:l.value,"onUpdate:modelValue":E=>l.value=E,onChange:L},{append:u(()=>[o(T,{style:{width:"80px"},modelValue:l.type,"onUpdate:modelValue":E=>l.type=E,onChange:L},{default:u(()=>[o(f,{label:"default",value:"default"}),o(f,{label:"success",value:"success"}),o(f,{label:"info",value:"info"}),o(f,{label:"warning",value:"warning"}),o(f,{label:"danger",value:"danger"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),i("i",{class:"icon-del",onClick:E=>de(h)},null,8,lt)]),_:2},1024))),128)),o(g,null,{default:u(()=>[o(p,{onClick:ie},{default:u(()=>[at]),_:1})]),_:1})],512),[[Le,Object.keys(e.attrObj).length]])]),_:1}),o(G,{label:"\u6570\u636E\u5217\u8868\u914D\u7F6E",name:"second"},{default:u(()=>[N(v)?(s(),r(_,{key:0},[o(g,{label:"\u6570\u636E\u5217\u8868\u540D\u79F0"},{default:u(()=>[o(y,{modelValue:e.name,"onUpdate:modelValue":t[7]||(t[7]=l=>e.name=l),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(g,{label:"\u6570\u636E\u6E90Id"},{default:u(()=>[o(y,{modelValue:e.formId,"onUpdate:modelValue":t[8]||(t[8]=l=>e.formId=l),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90Id"},null,8,["modelValue"])]),_:1})],64)):C("",!0),o(g,{class:"event-btn"},{default:u(()=>[o(p,{onClick:t[9]||(t[9]=l=>B("tableConfig"))},{default:u(()=>[ot]),_:1}),o(p,{onClick:t[10]||(t[10]=l=>B("dict"))},{default:u(()=>[nt,o(F,{content:"\u6570\u636E\u5B57\u5178\uFF0C\u7528\u4E8E\u5339\u914D\u591A\u9009\u7EC4\u3001\u4E0B\u62C9\u9009\u62E9\u7B49\uFF0C\u63D0\u4F9B\u52A8\u6001\u83B7\u53D6Options\u63A5\u53E3\u5B57\u5178\u6570\u636E\uFF0C\u4E00\u822C\u4E0D\u8BBE\u7F6E\uFF0C\u4ECE\u63A5\u53E3dict\u83B7\u53D6\u3002\u683C\u5F0F\uFF1A{0:'\u7537',1:'\u5973'}",placement:"top"},{default:u(()=>[o(be,null,{default:u(()=>[o(pe)]),_:1})]),_:1})]),_:1}),o(p,{onClick:t[11]||(t[11]=l=>B("beforeRequest"))},{default:u(()=>[ut]),_:1}),o(p,{onClick:t[12]||(t[12]=l=>B("afterResponse"))},{default:u(()=>[st]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o(me,{modelValue:e.visibleDialog,"onUpdate:modelValue":t[13]||(t[13]=l=>e.visibleDialog=l),size:"60%",direction:e.direction,"custom-class":"json-dialog","append-to-body":!0,"before-close":le},{default:u(()=>[e.visibleDialog?(s(),r("div",dt)):C("",!0),i("div",it,[o(p,{type:"primary",size:"small",onClick:ee},{default:u(()=>[ct]),_:1})])]),_:1},8,["modelValue","direction"]),o($e,{ref_key:"vueFileEl",ref:$},null,512)])),[[ge,e.loading]])}}});export{ft as default};
