import{x as w,d as A,A as M,u as N,l as k,L as x,h as L,H as $,G,p as H,r as _,B as P,s as W,o as C,c as Y,b as E,f as F,w as z,i as J,S as u,D as B,Y as R,q as I}from"./index-DLbVpaQ3.js";const K=(f,r,m={})=>new Promise((c,l)=>{const o=Object.assign({},m,{responseType:"blob"});w(f,r,o).then(n=>{const{data:d,headers:p}=n,g=decodeURI(p["content-disposition"].split(";")[1].split("=")[1])||`${f.substr(1).replace(/\//g,"_")}_${new Date().getTime()}.xls`,v=window.URL.createObjectURL(new Blob([d])),i=document.createElement("a");i.style.display="none",i.href=v,i.setAttribute("download",g),document.body.appendChild(i),i.click(),document.body.removeChild(i),c()}).catch(n=>{l(n)})}),X=A({__name:"[id]",setup(f){const r=M(),m=N(),c=k(),l=k(!0),o=x({searchData:[],tableData:[],dict:{},visible:!0,source:""}),n=L(()=>r.params.id),d=()=>{if(!n.value)return u.error("非法操作..."),!1;const e={id:n.value};w("designById",e).then(a=>{const t=a.data;t&&Object.keys(t).length&&(o.searchData=B(t.data),o.tableData=B(t.listData),o.dict=R(t.dict),o.source=t.source,I(()=>{c.value.getListData(),l.value=!1}),T())})};$(()=>{p()});const p=G(()=>r.params.id,()=>{d()},{}),g=e=>{var t;e.extend.formId=o.source;const a=(t=o.tableData.events)==null?void 0:t.beforeFetch;return typeof a=="function"?a(e,r):e},v=e=>{var t;e.formId=o.source;const a=(t=o.tableData.events)==null?void 0:t.beforeDelete;return typeof a=="function"?a(e,r):e},i=k(),s=x({visible:!1,title:"",formType:1,formData:{},width:"",dict:{},editId:""}),b=L(()=>{var e;return o.source&&((e=o.tableData.config)==null?void 0:e.openType)==="dialog"}),T=()=>{var e;b.value&&(s.width=(e=o.tableData.config)==null?void 0:e.dialogWidth,w("designById",{id:o.source}).then(a=>{const t=a.data;t&&Object.keys(t).length&&(s.formData=B(t.data),s.dict=R(t.dict))}).catch(a=>{u.error(a.message||"非法操作.")}))},j=(e,a)=>{var t;if(e.key==="import"){const y=Object.assign({},c.value.getSearchFormValue(),{listId:n.value});K("importExcel",y).then(()=>{u.success("正在导出..")}).catch(D=>{u.error(D.message)})}else(e.key==="add"||e.key==="edit")&&(b.value?(s.visible=!0,s.title=e.key==="add"?"新增":"编辑",s.formType=e.key==="add"?1:2,s.editId=a&&a.id,e.key==="add"&&((t=s.formData.config)!=null&&t.addLoad)&&I(()=>{i.value.getData()}),e.key==="edit"&&I(()=>{i.value.getData()})):m.push({path:"/design/form/form/",query:{form:o.source,id:a==null?void 0:a.id}}))},q=e=>{var t;e==="success"&&(h(),c.value.getListData());const a=(t=s.formData.events)==null?void 0:t.afterSubmit;if(typeof a=="function")return a(e)},O=e=>{(e==="reset"||e==="cancel")&&h()},V=e=>{h(),e&&e()},h=()=>{s.visible=!1,s.editId=""};return H(()=>{d()}),(e,a)=>{const t=_("ak-list"),y=_("ak-form"),D=_("el-dialog"),U=P("loading");return W((C(),Y("div",null,[o.visible?(C(),E(t,{key:0,ref_key:"listEl",ref:c,"search-data":o.searchData,data:o.tableData,dict:o.dict,"request-url":"getContentList","delete-url":"delFormContent","before-fetch":g,"before-delete":v,"auto-load":!1,onBtnClick:j},null,8,["search-data","data","dict"])):F("",!0),b.value?(C(),E(D,{key:1,"destroy-on-close":"",modelValue:s.visible,"onUpdate:modelValue":a[0]||(a[0]=S=>s.visible=S),title:s.title,width:s.width||"600px","before-close":V},{default:z(()=>[J(y,{ref_key:"formEl",ref:i,data:s.formData,dict:s.dict,type:s.formType,"request-url":"getFormContent","submit-url":"saveFormContent","edit-url":"editFormContent","after-submit":q,params:{formId:o.source},onBtnClick:O,query:{formId:o.source,id:s.editId}},null,8,["data","dict","type","params","query"])]),_:1},8,["modelValue","title","width"])):F("",!0)])),[[U,l.value]])}}});export{X as default};
