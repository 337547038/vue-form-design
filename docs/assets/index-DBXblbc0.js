import{d as M,l as g,B as j,b as G,o as y,w as u,f as r,U as T,n as F,j as o,c as C,e as x,ac as K,t as N,a3 as P,I as z,O as J,u as X,y as Q,G as Y,p as Z,ab as ee,r as p,W as te,s as ae,F as oe,m as se,a0 as k,q as le,aa as ie,X as ne,N as h,A,z as L}from"./index-CYQNA_yI.js";import{_ as re,a as ce,b as U}from"./aceTooptip-D_rKBMD-.js";const de=["onClick"],ue={key:0,class:"drag-control"},me={class:"item-control"},pe=["onClick"],fe=["onClick"],ge={class:"tooltip"},ve=M({__name:"echarts",props:{data:{default:()=>({})},type:{default:2}},emits:["controlBtnClick"],setup($,{expose:V,emit:w}){const f=$,d=w,v=g(),c=g({list:[],config:{}});j(()=>f.data,s=>{s&&(c.value=s)},{immediate:!0});const D=s=>{if(f.type!==1)return;const m=s.newIndex,l=new Date().getTime().toString(),e=c.value.list[m];e&&(delete e.label,delete e.icon,Object.assign(e,{name:e.type+l}),a(e))},a=s=>{console.log("groupClick",s),v.value=s.name,d("controlBtnClick",s)},b=(s,m,l)=>{if(f.type!==2){if(s==="clone"){const e=l.type+new Date().getTime().toString(),t=JSON.parse(JSON.stringify(l));c.value.list.splice(m,0,Object.assign(t,{name:e}))}else s==="del"&&c.value.list.splice(m,1);d("controlBtnClick","")}};return V({getData:()=>c.value,setDataList:s=>{c.value=s},setData:s=>{console.log(s)}}),(s,m)=>(y(),G(z(J),P({"item-key":"id",list:c.value.list,name:"fade",class:"drag"},{group:"form",ghostClass:"ghost",animation:200,handle:".drag-move"},{onAdd:D}),{item:u(({element:l,index:e})=>[r("div",{class:F(["group",{["group-"+l.type]:!0,[l.class]:l.class,active:v.value===l.name}]),onClick:T(t=>a(l),["stop"])},[o(K,{option:l.option,width:l.width,height:l.height},null,8,["option","width","height"]),s.type===1?(y(),C("div",ue,[r("div",me,[r("i",{class:"icon-clone",title:"克隆",onClick:T(t=>b("clone",e,l),["stop"])},null,8,pe),r("i",{class:"icon-del",onClick:T(t=>b("del",e,l),["stop"])},null,8,fe)]),m[0]||(m[0]=r("div",{class:"drag-move icon-move"},null,-1))])):x("",!0),r("div",ge,N(l.name),1)],10,de)]),_:1},16,["list"]))}}),_e={class:"design-container design-chart"},he={class:"components-list"},ye=["title"],be={class:"main-body"},ke={class:"main-form design-form"},Ce={class:"sidebar-tools"},Ve=["innerHTML"],we={key:0,id:"editJson"},De={class:"dialog-footer"},Te=M({__name:"index",setup($){const V=X(),w=Q(),f=g(),d=g({}),v=g([{icon:"line",label:"折线图",type:"line",option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{icon:"bar",label:"柱状图",type:"bar",option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{icon:"pie",label:"饼图",type:"pie",option:{series:[{name:"Access From",type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}}]),c=g(),D=e=>JSON.parse(JSON.stringify(e)),a=Y({editor:{},loading:!1,id:w.query.id,direction:"rtl",dialogTitle:"",visible:!1,dialogType:"",name:""}),b=e=>{d.value=e},S=e=>{const t=c.value.getData();switch(e){case"del":c.value.setDataList([]),d.value="";break;case"json":B(t,{type:"export"});break;case"vue":f.value.openEcharts(t);break;case"save":s(t);break}},B=(e,t={})=>{a.direction=t.direction||"rtl",a.visible=!0,a.dialogTitle=t.title,a.dialogType=t.type,e||(e=c.value.getData());let n=k(e,!0);switch(t.type){case"beforeFetch":e.config?.beforeFetch?n=k(e.config.beforeFetch,!0):n=U("beforeFetch");break;case"afterFetch":e.config?.afterFetch?n=k(e.config.afterFetch,!0):n=U("afterFetch");break}le(()=>{a.editor=ie(n)})},E=()=>{try{const e=ne(a.editor.getValue());switch(a.dialogType){case"export":c.value.setDataList(e);break;case"beforeFetch":case"afterFetch":const t=c.value.getData();t.config[a.dialogType]=e;break}a.visible=!1}catch(e){h.error(e.message)}},s=e=>{if(!a.name){h.error("请输入图表保存的名称");return}a.loading=!0;const t={data:k(e),id:a.id,name:a.name};A("saveEcharts",t).then(n=>{console.log(n),h({message:n.data?.message||"保存成功！",type:"success"}),V.push({path:"/echarts/list"}),a.loading=!1}).catch(n=>{h.error(n.data?.message||"保存异常"),a.loading=!1})},m=e=>{e()},l=()=>{a.id&&(a.loading=!0,A("echartsList",{id:a.id}).then(e=>{a.loading=!1;const t=e.data;a.name=t.name,c.value.setDataList(t.list)}).catch(e=>{h.error(e.data?.message||"操作异常"),a.loading=!1}))};return Z(()=>{l()}),ee(()=>{Object.keys(a.editor).length!==0&&(a.editor.destroy(),a.editor.container.remove())}),(e,t)=>{const n=p("el-input"),_=p("el-form-item"),O=p("el-tab-pane"),I=p("el-tabs"),q=p("el-form"),R=p("el-button"),W=p("el-drawer"),H=te("loading");return ae((y(),C("div",_e,[r("div",he,[t[7]||(t[7]=r("div",{class:"title"}," 图表类型 ",-1)),o(z(J),{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=i=>v.value=i),"item-key":"key",tag:"ul",group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:D},{item:u(({element:i})=>[r("li",{class:F([i.type])},[r("i",{class:F(`icon-${i.icon}`)},null,2),r("span",{title:i.label},N(i.label),9,ye)],2)]),_:1},8,["modelValue"])]),r("div",be,[o(re,{type:"2",onClick:S}),r("div",ke,[o(ve,{ref_key:"echartsEl",ref:c,type:1,onControlBtnClick:b},null,512)])]),r("div",Ce,[o(q,{size:"small"},{default:u(()=>[o(I,{"model-value":"first"},{default:u(()=>[o(O,{label:"图表属性",name:"first"},{default:u(()=>[Object.keys(d.value).length?(y(),C(oe,{key:0},[o(_,{label:"自定义Class"},{default:u(()=>[o(n,{modelValue:d.value.class,"onUpdate:modelValue":t[1]||(t[1]=i=>d.value.class=i),placeholder:"自定义Class"},null,8,["modelValue"])]),_:1}),o(_,{label:"字段标识"},{default:u(()=>[o(n,{modelValue:d.value.name,"onUpdate:modelValue":t[2]||(t[2]=i=>d.value.name=i),placeholder:"字段标识"},null,8,["modelValue"])]),_:1}),o(_,{label:"图表宽度"},{default:u(()=>[o(n,{modelValue:d.value.width,"onUpdate:modelValue":t[3]||(t[3]=i=>d.value.width=i),modelModifiers:{number:!0},placeholder:"图表宽度，数字类型"},null,8,["modelValue"])]),_:1}),o(_,{label:"图表高度"},{default:u(()=>[o(n,{modelValue:d.value.height,"onUpdate:modelValue":t[4]||(t[4]=i=>d.value.height=i),modelModifiers:{number:!0},placeholder:"图表高度，数字类型"},null,8,["modelValue"])]),_:1})],64)):x("",!0)]),_:1}),o(O,{label:"图表配置",name:"two"},{default:u(()=>[o(_,{label:"保存名称"},{default:u(()=>[o(n,{modelValue:a.name,"onUpdate:modelValue":t[5]||(t[5]=i=>a.name=i),placeholder:"保存名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),o(W,{modelValue:a.visible,"onUpdate:modelValue":t[6]||(t[6]=i=>a.visible=i),size:"60%",direction:a.direction,class:"ace-dialog","append-to-body":!0,"before-close":m},{header:u(()=>[r("div",{innerHTML:a.dialogTitle},null,8,Ve)]),default:u(()=>[a.visible?(y(),C("div",we)):x("",!0),r("div",De,[o(R,{type:"primary",size:"small",onClick:E},{default:u(()=>[...t[8]||(t[8]=[se(" 确定 ",-1)])]),_:1})])]),_:1},8,["modelValue","direction"]),o(ce,{ref_key:"vueFileEl",ref:f},null,512)])),[[H,a.loading]])}}});typeof L=="function"&&L(Te);export{Te as default};
