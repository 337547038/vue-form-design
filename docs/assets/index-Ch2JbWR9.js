import{d as le,l as W,h as q,p as pe,r as U,b as N,o as v,w as i,j as t,f as C,I as ee,J as _e,m as F,c as R,F as G,a as Z,e as H,q as re,L as xe,M as ie,G as de,B as Ce,C as Se,n as Y,t as te,N as Q,O as Ie,s as se,P as $e,Q as ce,x as oe,v as fe,R as ve,S as ke,U as Te,V as ue,y as Ve,u as Ae,k as De,W as Re,X as ge,Y as Ue,Z as Ee,$ as ze,a0 as ye,A as Me,z as he}from"./index-D9mad5Az.js";import{u as ae,g as Oe,r as $,_ as Le,c as Be,a as Ne,b as Fe}from"./screenGroup.vue_vue_type_script_setup_true_lang-DTA-7yOg.js";import{_ as Pe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-ickqR92R.js";import{_ as qe,a as We,g as Je,b as He}from"./aceTooptip-nI_qXZsX.js";const Xe=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],ne={bg:Xe},Ye={class:"img-list"},Ge=["onClick"],Ke=["src"],Qe={key:0},Ze=le({__name:"upload",emits:["click"],setup(j,{expose:L,emit:z}){const k=z,c=W(!1),M=W(),o=W("bg"),h=q(()=>{if(!ne)return[];const V=[];for(const p in ne)V.push(p);return V}),P=q(()=>o.value.name==="upload"?[]:ne?ne[o.value]:[]),g=q(()=>`./static/screen/${o.value}/`),w=V=>{c.value=!1,k("click",g.value+V,M.value)},b=V=>{o.value="upload",re(()=>{P.value.unshift(V.path)})};return L({open:(V,p)=>{c.value=!0,M.value=p,V?o.value=V:o.value=h.value[0]}}),pe(()=>{}),(V,p)=>{const u=U("el-button"),D=U("el-upload"),B=U("el-tab-pane"),m=U("el-tabs"),S=U("el-dialog");return v(),N(S,{modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=s=>c.value=s),width:"800px",title:"选择上传图片"},{default:i(()=>[t(D,{action:ee(_e),"on-success":b,"show-file-list":!1},{default:i(()=>[t(u,{type:"primary"},{default:i(()=>[...p[2]||(p[2]=[F(" 上传 ",-1)])]),_:1})]),_:1},8,["action"]),t(m,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=s=>o.value=s)},{default:i(()=>[(v(!0),R(G,null,Z(h.value,s=>(v(),N(B,{key:s,label:s,name:s},null,8,["label","name"]))),128)),t(B,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),C("div",Ye,[C("ul",null,[(v(!0),R(G,null,Z(P.value,s=>(v(),R("li",{key:s,onClick:e=>w(s)},[C("img",{src:g.value+s,alt:""},null,8,Ke)],8,Ge))),128))]),P.value?.length?H("",!0):(v(),R("p",Qe," 暂无相关素材资源 "))])]),_:1},8,["modelValue"])}}}),je=xe(Ze,[["__scopeId","data-v-53e58595"]]),et={key:0},tt=le({__name:"configControl",emits:["openDrawer"],setup(j,{emit:L}){const z=L,k=ie("screenData"),c=q(()=>k.value.config||{}),M=ae(),o=q(()=>M.controlAttr),h=q(()=>o.value?.config?.lock||o.value?.position?.display),P=W(),g=q(()=>o.value.type),w=de({bgColor:"",bgUpload:"",bgSelect:""}),b=Ce(()=>c.value,s=>{if(!Object.keys(o.value).length){const e=s.background||"";if(e.indexOf("url")!==-1){const r=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),a=e.match(r);Object.assign(w,{bgUpload:a,bgSelect:2})}else Object.assign(w,{bgColor:e,bgSelect:1})}},{immediate:!0}),A=()=>{let s="";switch(w.bgSelect){case 1:s=w.bgColor;break;case 2:s=`url(${w.bgUpload})`;break}V("background",s)},V=(s,e)=>{k.value.config=Object.assign({},c.value,{[s]:e})},p=q(()=>{if(Object.keys(o.value).length){const{config:s={},position:e,type:r}=o.value;return[{type:"group",title:"位置信息"},{label:"width",value:e.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:e.height,placeholder:"请输入高度",key:"height",path:"position"},{label:"left",value:e.left,placeholder:"图层位置",key:"left",path:"position"},{label:"top",value:e.top,key:"top",path:"position"},{label:"right",value:e.right,placeholder:"设置后left为auto",key:"right",path:"position"},{label:"bottom",value:e.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:e.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:s.lock,key:"lock"},{type:"switch",label:"隐藏",value:e.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:s.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:s.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:s.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:s.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:s.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:s.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:s.style?.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:s.style?.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:s.style?.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:s.style?.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:s.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:s.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:s.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:s.speed,key:"speed",vShow:["table"]}].filter(a=>{let n=!0;return a.vShow&&(n=a.vShow.includes(r)),a.vHide&&(n=!a.vHide.includes(r)),n})}return[]}),u=(s,e)=>{s.path==="position"?o.value.position[s.key]=e:s.path==="style"?(o.value.config?.style||(o.value.config.style={}),o.value.config.style[s.key]=e):o.value.config[s.key]=e},D=(s,e)=>{P.value.open(s,e)},B=(s,e)=>{switch(e){case"screenBg":w.bgUpload=s,A();break;case"src":o.value.config.src=s;break}},m=(s,e)=>{let r="",a,n="";switch(s){case"editCss":r="css";break;case"before":case"after":e?a=c.value&&c.value[s]:(n="获取数据响应处理之后事件，可对请求返回数据进行处理",a=o.value.config&&o.value.config[s]);break;case"style":r="json",a=o.value.config?.style||{},n="可输入更多的css样式，须为json格式";break;case"echartsEdit":a=o.value.option,n="可参考echarts相关例子编辑";break;case"tablePropsEdit":r="json",a=o.value.config?.props||{},n="支持所有表格props属性，可参考el-table。json格式";break;case"editData":const y=o.value.type;n="图表数据，替换相关数据返回即可",["text","sText"].includes(y)?(a=o.value.config?.text,n="编辑文本内容数据"):a=o.value.option,y==="table"&&(n="表格列表数据。根据设定的table-column列数据设置对应的数据");break}const f={content:a,codeType:r,type:s,title:n,isGlobal:e,callback:y=>{switch(s){case"before":case"after":e?c.value[s]=y:o.value.config[s]=y;break;case"style":o.value.config.style=y;break;case"echartsEdit":o.value.option=y;break;case"tablePropsEdit":o.value.config.props=y;break;case"editData":const T=o.value.type;["text","sText"].includes(T)?o.value.config.text=y:o.value.option=y;break}}};console.log("open",f),z("openDrawer",f)},S=()=>{Oe(c.value).then(()=>{Q.success("连接成功")}).catch(s=>{Q.error(s.msg||"连接失败")})};return Se(()=>{b()}),(s,e)=>{const r=U("el-switch"),a=U("el-color-picker"),n=U("el-input"),f=U("el-option"),y=U("el-select"),T=U("el-input-number"),_=U("el-form-item"),x=U("el-button"),d=U("el-form"),I=U("el-radio"),O=U("el-radio-group"),E=U("el-tab-pane"),X=U("el-tabs");return v(),R("div",{class:Y(["main-right",{lock:h.value}])},[t(X,{class:"tabs","model-value":"position"},{default:i(()=>[t(E,{label:"属性配置",name:"position"},{default:i(()=>[t(d,{size:"small"},{default:i(()=>[(v(!0),R(G,null,Z(p.value,(l,K)=>(v(),N(_,{key:K,label:l.label},{default:i(()=>[l.type==="group"?(v(),R("h3",et,te(l.title),1)):l.type==="switch"?(v(),N(r,{key:1,"model-value":l.value,class:Y([l.key]),onChange:J=>u(l,J)},null,8,["model-value","class","onChange"])):l.type==="color"?(v(),N(a,{key:2,"show-alpha":"","model-value":l.value,onChange:J=>u(l,J)},null,8,["model-value","onChange"])):l.type==="textarea"?(v(),N(n,{key:3,type:"textarea",placeholder:l.placeholder,"model-value":l.value,onChange:J=>u(l,J)},null,8,["placeholder","model-value","onChange"])):l.type==="select"?(v(),N(y,{key:4,"allow-create":l.allowCreate,filterable:l.filterable,placeholder:l.placeholder,"model-value":l.value,onChange:J=>u(l,J)},{default:i(()=>[(v(!0),R(G,null,Z(l.options,(J,we)=>(v(),N(f,{key:J,label:J,value:we},null,8,["label","value"]))),128))]),_:2},1032,["allow-create","filterable","placeholder","model-value","onChange"])):l.type==="number"?(v(),N(T,{key:5,"controls-position":"right",placeholder:l.placeholder,"model-value":l.value,onInput:J=>u(l,J)},null,8,["placeholder","model-value","onInput"])):(v(),N(n,{key:6,placeholder:l.placeholder,"model-value":l.value,onInput:J=>u(l,J)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(g.value)?(v(),N(_,{key:0,class:"upload-image"},{default:i(()=>[t(n,{modelValue:o.value.config.src,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.config.src=l),placeholder:"请输入图片地址"},null,8,["modelValue"]),t(x,{type:"primary",onClick:e[1]||(e[1]=l=>D(g.value==="image"?"img":"bg","src"))},{default:i(()=>[...e[25]||(e[25]=[F(" 选择图片 ",-1)])]),_:1})]),_:1})):H("",!0),["line","bar","pie","echarts"].includes(g.value)?(v(),N(_,{key:1},{default:i(()=>[t(x,{type:"primary",onClick:e[2]||(e[2]=l=>m("echartsEdit"))},{default:i(()=>[...e[26]||(e[26]=[F(" 图表编辑 ",-1)])]),_:1})]),_:1})):H("",!0),["text","sText","image","background","border","clock"].includes(g.value)?(v(),N(_,{key:2},{default:i(()=>[t(x,{type:"primary",onClick:e[3]||(e[3]=l=>m("style"))},{default:i(()=>[...e[27]||(e[27]=[F(" 编辑更多内联样式 ",-1)])]),_:1})]),_:1})):H("",!0),["table"].includes(g.value)?(v(),N(_,{key:3},{default:i(()=>[t(x,{type:"primary",onClick:e[4]||(e[4]=l=>m("tablePropsEdit"))},{default:i(()=>[...e[28]||(e[28]=[F(" 表格属性 ",-1)])]),_:1})]),_:1})):H("",!0)]),_:1}),["line","bar","pie","echarts","text","sText","table"].includes(g.value)?(v(),N(d,{key:0,size:"small"},{default:i(()=>[t(_,null,{default:i(()=>[...e[29]||(e[29]=[C("h3",null,"数据",-1)])]),_:1}),t(_,{label:"数据类型"},{default:i(()=>[t(O,{modelValue:o.value.config.optionsType,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.config.optionsType=l)},{default:i(()=>[t(I,{value:0,style:{"margin-right":"4px"}},{default:i(()=>[...e[30]||(e[30]=[F(" 静态/全局 ",-1)])]),_:1}),t(I,{value:1},{default:i(()=>[...e[31]||(e[31]=[F(" 动态 ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.value.config.optionsType!==1?(v(),N(_,{key:0},{default:i(()=>[t(x,{type:"primary",onClick:e[6]||(e[6]=l=>m("editData"))},{default:i(()=>[...e[32]||(e[32]=[F(" 编辑数据 ",-1)])]),_:1})]),_:1})):H("",!0),o.value.config.optionsType===1?(v(),R(G,{key:1},[t(_,null,{default:i(()=>[t(n,{modelValue:o.value.config.requestUrl,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.config.requestUrl=l),placeholder:"接口URL或api中的key"},{prepend:i(()=>[t(y,{modelValue:o.value.config.method,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.config.method=l),style:{width:"60px"}},{default:i(()=>[t(f,{label:"get",value:"get"}),t(f,{label:"post",value:"post"}),t(f,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"刷新时间"},{default:i(()=>[t(T,{modelValue:o.value.config.loopTime,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.config.loopTime=l),disabled:""},null,8,["modelValue"])]),_:1}),t(_,null,{default:i(()=>[...e[33]||(e[33]=[C("h3",null,"接口数据处理事件",-1)])]),_:1}),t(_,null,{default:i(()=>[t(x,{type:"primary",onClick:e[10]||(e[10]=l=>m("before"))},{default:i(()=>[...e[34]||(e[34]=[F(" before事件 ",-1)])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(x,{type:"primary",onClick:e[11]||(e[11]=l=>m("after"))},{default:i(()=>[...e[35]||(e[35]=[F(" after事件 ",-1)])]),_:1})]),_:1})],64)):H("",!0)]),_:1})):H("",!0)]),_:1}),t(E,{label:"大屏配置",name:"screen"},{default:i(()=>[t(d,{size:"small"},{default:i(()=>[t(_,{label:"大屏宽度"},{default:i(()=>[t(n,{placeholder:"请输入大屏宽度","model-value":c.value.width,onInput:e[12]||(e[12]=l=>V("width",l))},null,8,["model-value"])]),_:1}),t(_,{label:"大屏高度"},{default:i(()=>[t(n,{placeholder:"请输入大屏高度","model-value":c.value.height,onInput:e[13]||(e[13]=l=>V("height",l))},null,8,["model-value"])]),_:1}),t(_,{class:"color-picker",label:"主色"},{default:i(()=>[t(a,{"show-alpha":"","model-value":c.value.primary,onChange:e[14]||(e[14]=l=>V("primary",l))},null,8,["model-value"])]),_:1}),t(_,{label:"背景"},{default:i(()=>[t(y,{modelValue:w.bgSelect,"onUpdate:modelValue":e[15]||(e[15]=l=>w.bgSelect=l),onChange:A},{default:i(()=>[t(f,{value:1,label:"背景色"}),t(f,{value:2,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),w.bgSelect===1?(v(),N(_,{key:0,class:"color-picker"},{default:i(()=>[t(a,{modelValue:w.bgColor,"onUpdate:modelValue":e[16]||(e[16]=l=>w.bgColor=l),"show-alpha":"",onChange:A},null,8,["modelValue"])]),_:1})):H("",!0),w.bgSelect===2?(v(),N(_,{key:1,class:"upload-image"},{default:i(()=>[t(n,{modelValue:w.bgUpload,"onUpdate:modelValue":e[17]||(e[17]=l=>w.bgUpload=l),placeholder:"请输入图片地址",onChange:A},null,8,["modelValue"]),t(x,{type:"primary",onClick:e[18]||(e[18]=l=>D("bg","screenBg"))},{default:i(()=>[...e[36]||(e[36]=[F(" 上传 ",-1)])]),_:1})]),_:1})):H("",!0),t(_,null,{default:i(()=>[t(x,{onClick:e[19]||(e[19]=l=>m("editCss"))},{default:i(()=>[...e[37]||(e[37]=[F(" 编辑样式 ",-1)])]),_:1})]),_:1}),t(_,null,{default:i(()=>[...e[38]||(e[38]=[C("h3",null,"全局数据",-1)])]),_:1}),t(_,null,{default:i(()=>[t(n,{"model-value":c.value.requestUrl,placeholder:"接口URL或api中的key",onInput:e[21]||(e[21]=l=>V("requestUrl",l))},{prepend:i(()=>[t(y,{"model-value":c.value.method,style:{width:"60px"},onChange:e[20]||(e[20]=l=>V("method",l))},{default:i(()=>[t(f,{label:"get",value:"get"}),t(f,{label:"post",value:"post"}),t(f,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),c.value.requestUrl?(v(),N(_,{key:2},{default:i(()=>[t(x,{type:"primary",onClick:S},{default:i(()=>[...e[39]||(e[39]=[F(" 连接测试 ",-1)])]),_:1})]),_:1})):H("",!0),t(_,{label:"刷新时间"},{default:i(()=>[t(T,{disabled:"","model-value":c.value.loopTime,onInput:e[22]||(e[22]=l=>V("loopTime",l))},null,8,["model-value"])]),_:1}),t(_,null,{default:i(()=>[...e[40]||(e[40]=[C("h3",null,"接口数据处理事件",-1)])]),_:1}),t(_,null,{default:i(()=>[t(x,{type:"primary",onClick:e[23]||(e[23]=l=>m("before",!0))},{default:i(()=>[...e[41]||(e[41]=[F(" before事件 ",-1)])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(x,{type:"primary",onClick:e[24]||(e[24]=l=>m("after",!0))},{default:i(()=>[...e[42]||(e[42]=[F(" after事件 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(je,{ref_key:"uploadImageEl",ref:P,onClick:B},null,512)],2)}}}),lt={class:"main-left"},ot={class:"components-list scroll"},st={class:"title"},at=["title"],nt={class:"scroll layer-list"},it=["onClick"],rt=["onUpdate:modelValue"],ct=["title"],ut={class:"icon-group"},pt=["onClick"],dt=["onClick"],ft=le({__name:"controlLeft",setup(j){const L=ae(),z=ie("screenData")||{},k=q(()=>{let g=[];return z.value.list.forEach(w=>{w.id!=="rect"&&(g.push(w),["div","group"].includes(w.type)&&w.list?.length&&(w.list.forEach(b=>{b.pid=w.id}),g=[...g,...w.list]))}),g}),c={line:"line",bar:"bar",pie:"pie",echarts:"",table:"table",text:"text2",sText:"sText",image:"image",background:"image",border:"border",clock:"time",div:"div",group:"div",component:"component"},M=g=>`icon-${c[g.type]}`,o=(g,w)=>{switch(w){case"display":g.position.display=!g.position.display;break;case"lock":g.config.lock=!g.config.lock,g.type==="div"&&g.list?.forEach(b=>{b.config.lock=!g.config.lock});break;case"active":L.setActiveId(g.id),L.setControlAttr(g);break;case"del":z.value.list.forEach((b,A)=>{b.id===g.id?z.value.list.splice(A,1):["div","group"].includes(b.type)&&b.list?.length&&b.list.forEach((V,p)=>{V.id===g.id&&b.list.splice(p,1)})});break}},h=W([{label:"图表",children:[{type:"line",label:"折线图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:"柱状图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:"饼图",position:{width:300,height:300},option:{grid:{left:0,top:0,right:0,bottom:0},series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:"通用图表",position:{width:400,height:300},option:{grid:{left:0,top:0,right:0,bottom:0}}}]},{label:"表格",children:[{type:"table",label:"表格",position:{width:500,height:300},option:{columns:[],list:[]}}]},{label:"辅助",children:[{type:"text",label:"文本",position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:"滚动文本",position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:"图片",position:{width:100,height:50},config:{src:""}},{type:"background",label:"背景",position:{width:100,height:50},config:{src:""}},{type:"border",label:"边框",position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}},{type:"clock",label:"当前时间",position:{width:150,height:30}}]},{label:"布局",children:[{type:"div",label:"div布局",position:{height:400},list:[]}]},{label:"自定义组件",children:[{type:"component",label:"自定义",position:{width:200,height:200},config:{}}]}]),P=g=>ce(g);return(g,w)=>{const b=U("el-tab-pane"),A=U("el-popconfirm"),V=U("el-tabs");return v(),R("div",lt,[t(V,{"model-value":"component",class:"tabs"},{default:i(()=>[t(b,{label:"组件",name:"component"},{default:i(()=>[C("div",ot,[(v(!0),R(G,null,Z(h.value,(p,u)=>(v(),R("div",{key:u},[C("div",st,te(p.label),1),t(ee(Ie),{modelValue:p.children,"onUpdate:modelValue":D=>p.children=D,"item-key":"label",tag:"ul",group:{name:"screen",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:P},{item:i(({element:D})=>[C("li",{class:Y([D.type])},[C("i",{class:Y(`icon-${c[D.type]}`)},null,2),C("span",{title:D.label},te(D.label),9,at)],2)]),_:1},8,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),t(b,{label:"图层",name:"layer"},{default:i(()=>[C("div",nt,[C("ul",null,[(v(!0),R(G,null,Z(k.value,(p,u)=>(v(),R("li",{key:u,class:Y({active:ee(L).activeId===p.id,lock:p.config?.lock,display:p.position?.display,"text-indent":p.pid})},[C("div",{class:"name",onClick:D=>o(p,"active")},[C("i",{class:Y(M(p))},null,2),ee(L).activeId===p.id?se((v(),R("input",{key:0,"onUpdate:modelValue":D=>p.layerName=D},null,8,rt)),[[$e,p.layerName]]):(v(),R("span",{key:1,title:p.layerName||p.id},te(p.layerName||p.id),9,ct))],8,it),C("div",ut,[C("i",{class:Y(["icon",[p.position?.display?"icon-eye-close":"icon-eye"]]),onClick:D=>o(p,"display")},null,10,pt),C("i",{class:Y(["icon",[p.config?.lock?"icon-lock":"icon-lock-open"]]),onClick:D=>o(p,"lock")},null,10,dt),t(A,{title:"确认删除",onConfirm:D=>o(p,"del")},{reference:i(()=>[...w[0]||(w[0]=[C("i",{class:"icon-del"},null,-1)])]),_:1},8,["onConfirm"])])],2))),128))])])]),_:1})]),_:1})])}}}),vt={class:"ruler-box"},me=le({__name:"ruler",props:{direction:{default:"h"},scale:{},showRuler:{type:Boolean},size:{}},setup(j){const L=j,z=q(()=>({width:parseInt(L.size)*L.scale/100+"px"})),k=q(()=>{const c=parseInt(L.size)+100,M=[];for(let o=0;o<c;o=o+100)M.push(o);return M});return(c,M)=>se((v(),R("div",{class:Y(["screen-ruler",`ruler-${c.direction}`]),style:oe(z.value)},[C("div",vt,[(v(!0),R(G,null,Z(k.value,o=>(v(),R("span",{key:o,style:oe({width:`${c.scale}px`})},te(o),5))),128))])],6)),[[fe,c.showRuler]])}}),gt=["onClick"],yt=le({__name:"rightMenu",setup(j,{expose:L}){const z=ie("screenData"),k=ae(),c=W({}),M=W(!1),o=q(()=>{let A=c.value.type;["tempRect","group"].includes(A)||(A="single");const V={tempRect:["merge","left","right","top","bottom","horizontally","verticalCenter","del","lock","display"],group:["copy","split","del","lock","display"],single:["copy","del","lock","display"]};return[{key:"merge",label:"组合"},{key:"split",label:"拆分"},{key:"left",label:"左对齐"},{key:"right",label:"右对齐"},{key:"top",label:"顶部对齐"},{key:"bottom",label:"底部对齐"},{key:"horizontally",label:"水平居中"},{key:"verticalCenter",label:"垂直居中"},{key:"copy",label:"复制"},{key:"del",label:"删除"},{key:"lock",label:"锁定"},{key:"display",label:"隐藏"}].filter(p=>V[A].includes(p.key))}),h=q(()=>({left:`${c.value.x+10}px`,top:`${c.value.y+10}px`})),P=()=>{setTimeout(()=>{w()},1e3)},g=A=>{z.value.list.forEach((u,D)=>{u.id===c.value.id&&p(u,D,z.value.list),u.list&&Array.isArray(u.list)&&u.list.forEach((B,m)=>{B.id===c.value.id&&p(B,m,u.list)}),V(u)});function V(u){if(c.value.type==="tempRect")switch(A){case"display":k.tempActiveId.includes(u.id)&&(u.position.display=!0);break;case"lock":k.tempActiveId.includes(u.id)&&(u.config.lock=!0);break}}function p(u,D,B){const m=c.value.type;switch(A){case"copy":const S=ce(u);S.id=S.type+new Date().getTime(),S.layerName="复制"+S.layerName,B.push(S),Q.success("复制成功");break;case"del":m==="tempRect"?(u.position.display=!0,z.value.list=z.value.list.filter(d=>!k.tempActiveId.includes(d.id))):B.splice(D,1),Q.success("删除成功");break;case"lock":m==="tempRect"?u.position.display=!0:u.config.lock=!0,["div","group"].includes(m)&&u.list&&Array.isArray(u.list)&&u.list.forEach(d=>{d.config.lock=!0}),Q.success("锁定成功");break;case"display":u.position.display=!0,Q.success("隐藏成功");break;case"horizontally":case"verticalCenter":const{top:s,height:e,left:r,width:a}=u.position;let n=$(s)+$(e)/2,f="top",y="height";A==="verticalCenter"&&(n=$(r)+$(a)/2,f="left",y="width");let T=0;for(const d in k.tempActiveId){const I=B.filter(O=>O.id===k.tempActiveId[d])[0];I.position[f]=n-$(I.position[y])/2,I.position[y]>T&&(T=$(I.position[y]))}u.position[y]=T+"px",u.position[f]=n-T/2;break;case"left":case"top":const _=A==="left"?"width":"height";if(m==="tempRect"){const d=$(u.position[A]);let I=0;for(const O in k.tempActiveId){const E=B.filter(X=>X.id===k.tempActiveId[O])[0];E.position[A]=d,E.position[_]>I&&(I=$(E.position[_]))}u.position[_]=I+"px"}break;case"bottom":if(m==="tempRect"){const{height:d,top:I}=u.position,O=$(d)+$(I);let E=0;for(const X in k.tempActiveId){const l=B.filter(K=>K.id===k.tempActiveId[X])[0];l.position.top=O-$(l.position.height),l.position.height>E&&(E=$(l.position.height))}u.position.height=E+"px",u.position.top=`${O-E}px`}break;case"right":if(m==="tempRect"){const{width:d,left:I}=u.position,O=$(d)+$(I);let E=0;for(const X in k.tempActiveId){const l=B.filter(K=>K.id===k.tempActiveId[X])[0];l.position.left=O-$(l.position.width),l.position.width>E&&(E=$(l.position.width))}u.position.width=E+"px",u.position.left=`${O-E}px`}break;case"merge":const x=ce(u);x.type="group",x.id=x.type+new Date().getTime(),x.layerName="组合层",x.list=[],x.config={},B.forEach(d=>{if(k.tempActiveId.includes(d.id)){d.position.left=Math.abs(x.position.left-$(d.position.left)),d.position.top=Math.abs(x.position.top-$(d.position.top));const I=d.position.width;typeof I=="number"||I?.toString().indexOf("px")!==-1?d.position.width=$(I)/u.position.width*100+"%":I?.toString().indexOf("%"),x.list.push(d)}d.id==="rect"&&(d.position.display=!0)}),B.push(x),z.value.list=z.value.list.filter(d=>!k.tempActiveId.includes(d.id)),k.setActiveId(x.id),k.setControlAttr(x);break;case"split":u.list?.forEach(d=>{const{left:I,top:O,width:E}=d.position,{left:X,top:l,width:K}=u.position;delete d.pId,d.position.left=$(X)+I,d.position.top=$(l)+O,(E+"").indexOf("%")!==-1&&(typeof K=="number"||K?.toString().indexOf("px")!==-1)&&(d.position.width=$(K)*$(E)/100+"px"),B.push(d)}),z.value.list=z.value.list.filter(d=>d.id!==u.id);break}}w()},w=()=>{M.value=!1};return L({open:A=>{c.value=A,M.value=!0},close:w}),(A,V)=>se((v(),R("div",{class:"screen-right-menu",style:oe(h.value),onMouseleave:P},[C("ul",null,[(v(!0),R(G,null,Z(o.value,p=>(v(),R("li",{key:p.key,onClick:u=>g(p.key)},te(p.label),9,gt))),128))])],36)),[[fe,M.value]])}}),ht={key:0,class:"no-date"},mt={class:"design-footer"},bt={class:"control-tip"},kt={class:"center"},wt={class:"item"},_t={class:"item slider"},xt={class:"item"},Ct=le({__name:"design",props:{preview:{type:Boolean}},setup(j){const L=W(!0),z=()=>{L.value=!1,re(()=>{L.value=!0})},k=ie("screenData"),c=ae(),M=W(),o=q(()=>c.controlTip),h=de({scale:100,autoScale:100,ruler:!0,offset:[0,0],moveFlag:!1,ctrlPress:!1});ue("stateData",h);const P=q(()=>{const{width:r,height:a,background:n,primary:f}=k.value.config,y=h.scale/100;return{width:r,height:a,background:n,transform:`scale(${y})`,color:f}}),g=r=>{A(),h.moveFlag=!0;const a=r.offsetX,n=r.offsetY;let f=0,y=0,T=0,_=0;document.onmousemove=x=>{if(!h.moveFlag)return;const d=(x.pageX-h.offset[0])/(h.scale/100),I=(x.pageY-h.offset[1])/(h.scale/100);T=Math.min(a,d),_=Math.min(n,I),f=Math.abs(a-d),y=Math.abs(n-I);let O=!0;f>10&&y>10&&(O=!1),s({left:T+"px",top:_+"px",width:f+"px",height:y+"px",display:O})},document.onmouseup=function(){if(h.moveFlag){if(f>10&&y>10){V({left:T,top:_,width:f,height:y});const x=c.tempActiveId?.length;if(x>1)c.setControlTip(`当前选区选中 ${x} 个组件目标，可使用键盘方向键调整位置`),e(),c.setActiveId("rect");else if(s({display:!0}),x===1){const d=c.tempActiveId[0];c.setActiveId(d);const I=k.value.list.filter(O=>O.id===d);c.setControlAttr(I[0])}}h.moveFlag=!1,document.onmousemove=null}}},w=W();ue("openRightMenu",r=>{w.value.open(r)});const A=()=>{c.setControlAttr({}),c.setActiveId(""),c.setTempActiveId([]),c.setControlTip("可按住Ctrl键选中多个"),s({display:!0}),w.value.close()},V=r=>{c.setTempActiveId([]),k.value.list.forEach(n=>{!Be(n.position)&&a(n.position,r)&&Ne(n)&&c.setTempActiveId(n.id)});function a(n,f){const y=$(n.left),T=$(n.top),_=y+$(n.width),x=T+$(n.height),d=$(f.left),I=$(f.top),O=d+$(f.width),E=I+$(f.height),X=y<O&&d<_,l=T<E&&I<x;return X&&l}},p=W({100:{style:{}}}),u=r=>{const a=c.getScreenConfig(r)||!1;setTimeout(()=>{S()},500),c.setScreenConfig(r,!a)},D=r=>{M.value.scrollTo(0,0),r==="auto"?h.scale=h.autoScale:h.scale=100,c.setScreenConfig("scale",h.scale)},B=r=>{c.setScreenConfig("scale",r)};ve(document,"keydown",r=>{r.key==="Control"&&(h.ctrlPress||(c.setTempActiveId([]),c.setActiveId(""),s({display:!0})),h.ctrlPress=!0);const a=["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"];if(c.activeId&&a.includes(r.key)){const n=k.value.list.filter(f=>f.id===c.activeId);n?.length&&m(n[0],r.key),c.activeId==="rect"&&k.value.list.forEach(f=>{m(f,r.key)}),r.preventDefault()}});const m=(r,a)=>{const n=r.position,f=$(n.left),y=$(n.top);switch(a){case"ArrowRight":n.left=f+1;break;case"ArrowLeft":n.left=f-1;break;case"ArrowDown":n.top=y+1;break;case"ArrowUp":n.top=y-1;break}};ve(document,"keyup",()=>{h.ctrlPress=!1});const S=()=>{re(()=>{const r=M.value.offsetWidth,a=parseInt(k.value.config?.width);if(r&&a){const f=parseInt(`${r/a*100}`),y=c.getScreenConfig("scale");h.autoScale=f,h.scale=parseInt(y)||f}const n=M.value.getBoundingClientRect();h.offset[0]=n.left+20,h.offset[1]=n.top+20})},s=r=>{const a=k.value.list.filter(n=>n.id==="rect");a[0].position=r},e=()=>{const r={left:0,top:0,ex:0,ey:0,zIndex:1};k.value.list.forEach(n=>{if(c.tempActiveId.includes(n.id)){const{left:f,top:y,width:T,height:_,zIndex:x}=n.position,d=parseInt(f+""),I=parseInt(y+""),O=parseInt(T+""),E=parseInt(_+"");r.left=a(r.left,d),r.top=a(r.top,I),r.ex=Math.max(r.ex,O+d),r.ey=Math.max(r.ey,E+I),r.zIndex=Math.max(r.zIndex,x||1)}}),s({left:r.left,top:r.top,width:Math.abs(r.ex-r.left),height:Math.abs(r.ey-r.top),display:!1,zIndex:r.zIndex+1});function a(n,f){return n===0?f:Math.min(n,f)}};return pe(()=>{S()}),ke(()=>{}),(r,a)=>{const n=U("el-button"),f=U("el-switch"),y=U("el-slider");return v(),R(G,null,[C("div",{ref_key:"designBoxEl",ref:M,class:"design-box"},[se(t(n,{class:"preview-refresh",onClick:z},{default:i(()=>[...a[7]||(a[7]=[F(" 刷新 ",-1)])]),_:1},512),[[fe,r.preview]]),t(me,{scale:h.scale,"show-ruler":h.ruler,size:P.value.width},null,8,["scale","show-ruler","size"]),t(me,{scale:h.scale,"show-ruler":h.ruler,direction:"v",size:P.value.height},null,8,["scale","show-ruler","size"]),C("div",{class:Y([{preview:r.preview},"design-canvas"]),style:oe(P.value),onMousedown:Te(g,["left"])},[L.value?(v(),N(Le,{key:0,modelValue:ee(k).list,"onUpdate:modelValue":a[0]||(a[0]=T=>ee(k).list=T),onItemClick:e},null,8,["modelValue"])):H("",!0)],38),ee(k).list.length===1?(v(),R("div",ht," 请从左则组件栏拖动组件到设计区域 ")):H("",!0)],512),C("div",mt,[C("i",{class:"icon-menu icon",onClick:a[1]||(a[1]=T=>u("left"))}),C("div",bt,te(o.value),1),C("div",kt,[C("div",wt,[a[8]||(a[8]=C("label",{class:"label"},"标尺",-1)),t(f,{modelValue:h.ruler,"onUpdate:modelValue":a[2]||(a[2]=T=>h.ruler=T),size:"small"},null,8,["modelValue"])]),C("div",_t,[a[9]||(a[9]=C("label",{class:"label"},"缩放比例",-1)),t(y,{modelValue:h.scale,"onUpdate:modelValue":a[3]||(a[3]=T=>h.scale=T),marks:p.value,max:200,min:h.autoScale-30,"show-stops":"",size:"small",onChange:B},null,8,["modelValue","marks","min"])]),C("div",xt,[t(n,{link:"",type:"primary",onClick:a[4]||(a[4]=T=>D("auto"))},{default:i(()=>[...a[10]||(a[10]=[F(" 自适应 ",-1)])]),_:1}),t(n,{link:"",type:"primary",onClick:a[5]||(a[5]=T=>D("100"))},{default:i(()=>[...a[11]||(a[11]=[F(" 100% ",-1)])]),_:1})])]),C("i",{class:"icon-menu icon",onClick:a[6]||(a[6]=T=>u("right"))})]),t(yt,{ref_key:"rightMenuEl",ref:w},null,512)],64)}}}),be=JSON.stringify({list:[{id:"rect",type:"tempRect",position:{width:200,height:200,display:!0}}],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff",method:"get"}}),St={class:"container-screen"},It={class:"main-box"},$t=le({__name:"index",setup(j){const L=Ve(),z=Ae(),k=De(),c=ae();k.changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]),k.setCollapseMenu(!0);const M=m=>!c.getScreenConfig(m),o=W(!1),h=W(!1),P=W(),g=W(JSON.parse(be));ue("screenData",g);const w=m=>{switch(c.setControlAttr({}),m){case"del":g.value=JSON.parse(be);break;case"eye":h.value=!0;break;case"json":p({type:"json",content:g.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":P.value.openScreen(g.value);break;case"save":D();break}},b=de({visible:!1,title:"",direction:"ltr",content:"",codeType:"",callback:""}),A=()=>{u()},V=m=>{try{let S;switch(b.codeType){case"json":S=Ue(m);break;case"css":S=m;break;default:S=ge(m)}switch(typeof b.callback=="function"&&b.callback(S),b.type){case"editCss":g.value.config.style=m,Ee("screenStyle",m,!0);break;case"json":g.value=ge(m);break}u()}catch(S){Q.error(S.message||"未知原因")}},p=m=>{const{type:S="",direction:s,codeType:e,title:r,callback:a,content:n,isGlobal:f}=m;b.direction=s||"ltr",b.type=S,b.codeType=e||"",b.title=r||Je[S],b.visible=!0,b.callback=a;let y=e==="json"?ze(n):ye(n,!0);switch(S){case"editCss":y=g.value.config.style||"";break;case"before":case"after":if(!n){let T=S;S==="after"&&(T=f?"afterScreenGlobal":"afterScreen"),y=He(T)}break}b.content=y},u=()=>{b.visible=!1,b.type="",b.title="",b.codeType="",b.callback="",b.content=""},D=()=>{const m={data:ye(g.value),name:"未命名可视化大屏",type:4};let S="designSave";const s=L.query.id;s&&(Object.assign(m,{id:s}),delete m.name,S="designEdit"),o.value=!0,Me(S,m).then(e=>{Q({message:e.message||"保存成功！",type:"success"}),s||z.push({path:"/design/screen/list"}),o.value=!1}).catch(e=>{Q.error(e.message||"保存异常"),o.value=!1})},B=()=>{o.value=!0,Fe(L.query.id).then(m=>{o.value=!1,g.value=m}).catch(()=>{o.value=!1})};return pe(()=>{B()}),ke(()=>{}),(m,S)=>{const s=Re("loading");return se((v(),R("div",St,[h.value?(v(),R("i",{key:0,class:"icon-close close-preview",onClick:S[0]||(S[0]=e=>h.value=!1)})):H("",!0),t(ft,{style:oe({width:M("left")?"":"0px"})},null,8,["style"]),C("div",It,[t(qe,{onClick:w}),t(Ct,{preview:h.value},null,8,["preview"])]),t(tt,{style:oe({width:M("right")?"":"0px"}),onOpenDrawer:p},null,8,["style"]),t(Pe,{modelValue:b.visible,"onUpdate:modelValue":S[1]||(S[1]=e=>b.visible=e),"code-type":b.codeType,content:b.content,direction:b.direction,title:b.title,onConfirm:V,onBeforeClose:A},null,8,["modelValue","code-type","content","direction","title"]),t(We,{ref_key:"vueFileEl",ref:P},null,512)])),[[s,o.value]])}}});typeof he=="function"&&he($t);export{$t as default};
