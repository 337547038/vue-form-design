import{d as le,l as J,h as q,p as ue,r as M,o as m,b as L,w as a,i as l,m as N,I as ee,J as _e,c as U,a as Z,F as Y,g as S,f as H,q as me,L as xe,M as ne,G as pe,B as Ce,C as Se,t as te,n as X,N as Q,O as Ie,s as ie,P as $e,Q as re,v as be,x as oe,R as ce,S as de,U as ke,V as Te,y as Ve,u as Ae,k as De,W as Re,X as fe,Y as Ue,Z as Ee,$ as ze,a0 as ve,A as Me,z as ge}from"./index-BR7JSMnu.js";import{u as se,g as Oe,r as I,_ as Le,c as Be,a as Ne,b as Fe}from"./screenGroup.vue_vue_type_script_setup_true_lang-CWfoEHRn.js";import{_ as Pe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-CsAFQBQn.js";import{_ as qe,a as We,g as Je,b as He}from"./aceTooptip-CljszzDM.js";const Xe=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],ae={bg:Xe},Ye={class:"img-list"},Ge=["onClick"],Ke=["src"],Qe={key:0},Ze=le({__name:"upload",emits:["click"],setup(j,{expose:V,emit:h}){const $=h,k=J(!1),f=J(),s=J("bg"),F=q(()=>{if(!ae)return[];const T=[];for(const u in ae)T.push(u);return T}),B=q(()=>s.value.name==="upload"?[]:ae?ae[s.value]:[]),b=q(()=>`./static/screen/${s.value}/`),_=T=>{k.value=!1,$("click",b.value+T,f.value)},w=T=>{s.value="upload",me(()=>{B.value.unshift(T.path)})};return V({open:(T,u)=>{k.value=!0,f.value=u,T?s.value=T:s.value=F.value[0]}}),ue(()=>{}),(T,u)=>{const r=M("el-button"),E=M("el-upload"),z=M("el-tab-pane"),d=M("el-tabs"),x=M("el-dialog");return m(),L(x,{modelValue:k.value,"onUpdate:modelValue":u[1]||(u[1]=t=>k.value=t),width:"800px",title:"选择上传图片"},{default:a(()=>{var t;return[l(E,{action:ee(_e),"on-success":w,"show-file-list":!1},{default:a(()=>[l(r,{type:"primary"},{default:a(()=>u[2]||(u[2]=[N(" 上传 ")])),_:1})]),_:1},8,["action"]),l(d,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=e=>s.value=e)},{default:a(()=>[(m(!0),U(Y,null,Z(F.value,e=>(m(),L(z,{key:e,label:e,name:e},null,8,["label","name"]))),128)),l(z,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),S("div",Ye,[S("ul",null,[(m(!0),U(Y,null,Z(B.value,e=>(m(),U("li",{key:e,onClick:i=>_(e)},[S("img",{src:b.value+e,alt:""},null,8,Ke)],8,Ge))),128))]),(t=B.value)!=null&&t.length?H("",!0):(m(),U("p",Qe," 暂无相关素材资源 "))])]}),_:1},8,["modelValue"])}}}),je=xe(Ze,[["__scopeId","data-v-53e58595"]]),et={key:0},tt=le({__name:"configControl",emits:["openDrawer"],setup(j,{emit:V}){const h=V,$=ne("screenData"),k=q(()=>$.value.config||{}),f=se(),s=q(()=>f.controlAttr),F=q(()=>{var t,e,i,c;return((e=(t=s.value)==null?void 0:t.config)==null?void 0:e.lock)||((c=(i=s.value)==null?void 0:i.position)==null?void 0:c.display)}),B=J(),b=q(()=>s.value.type),_=pe({bgColor:"",bgUpload:"",bgSelect:""}),w=Ce(()=>k.value,t=>{if(!Object.keys(s.value).length){const e=t.background||"";if(e.indexOf("url")!==-1){const i=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),c=e.match(i);Object.assign(_,{bgUpload:c,bgSelect:2})}else Object.assign(_,{bgColor:e,bgSelect:1})}},{immediate:!0}),C=()=>{let t="";switch(_.bgSelect){case 1:t=_.bgColor;break;case 2:t=`url(${_.bgUpload})`;break}T("background",t)},T=(t,e)=>{$.value.config=Object.assign({},k.value,{[t]:e})},u=q(()=>{var t,e,i,c;if(Object.keys(s.value).length){const{config:n={},position:v,type:D}=s.value;return[{type:"group",title:"位置信息"},{label:"width",value:v.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:v.height,placeholder:"请输入高度",key:"height",path:"position"},{label:"left",value:v.left,placeholder:"图层位置",key:"left",path:"position"},{label:"top",value:v.top,key:"top",path:"position"},{label:"right",value:v.right,placeholder:"设置后left为auto",key:"right",path:"position"},{label:"bottom",value:v.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:v.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:n.lock,key:"lock"},{type:"switch",label:"隐藏",value:v.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:n.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:n.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:n.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:n.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:n.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:n.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:(t=n.style)==null?void 0:t.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:(e=n.style)==null?void 0:e.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:(i=n.style)==null?void 0:i.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:(c=n.style)==null?void 0:c.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:n.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:n.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:n.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:n.speed,key:"speed",vShow:["table"]}].filter(A=>{let p=!0;return A.vShow&&(p=A.vShow.includes(D)),A.vHide&&(p=!A.vHide.includes(D)),p})}return[]}),r=(t,e)=>{var i;t.path==="position"?s.value.position[t.key]=e:t.path==="style"?((i=s.value.config)!=null&&i.style||(s.value.config.style={}),s.value.config.style[t.key]=e):s.value.config[t.key]=e},E=(t,e)=>{B.value.open(t,e)},z=(t,e)=>{switch(e){case"screenBg":_.bgUpload=t,C();break;case"src":s.value.config.src=t;break}},d=(t,e)=>{var D,A,p;let i="",c,n="";switch(t){case"editCss":i="css";break;case"before":case"after":e?c=k.value&&k.value[t]:(n="获取数据响应处理之后事件，可对请求返回数据进行处理",c=s.value.config&&s.value.config[t]);break;case"style":i="json",c=((D=s.value.config)==null?void 0:D.style)||{},n="可输入更多的css样式，须为json格式";break;case"echartsEdit":c=s.value.option,n="可参考echarts相关例子编辑";break;case"tablePropsEdit":i="json",c=((A=s.value.config)==null?void 0:A.props)||{},n="支持所有表格props属性，可参考el-table。json格式";break;case"editData":const g=s.value.type;n="图表数据，替换相关数据返回即可",["text","sText"].includes(g)?(c=(p=s.value.config)==null?void 0:p.text,n="编辑文本内容数据"):c=s.value.option,g==="table"&&(n="表格列表数据。根据设定的table-column列数据设置对应的数据");break}const v={content:c,codeType:i,type:t,title:n,isGlobal:e,callback:g=>{switch(t){case"before":case"after":e?k.value[t]=g:s.value.config[t]=g;break;case"style":s.value.config.style=g;break;case"echartsEdit":s.value.option=g;break;case"tablePropsEdit":s.value.config.props=g;break;case"editData":const y=s.value.type;["text","sText"].includes(y)?s.value.config.text=g:s.value.option=g;break}}};console.log("open",v),h("openDrawer",v)},x=()=>{Oe(k.value).then(()=>{Q.success("连接成功")}).catch(t=>{Q.error(t.msg||"连接失败")})};return Se(()=>{w()}),(t,e)=>{const i=M("el-switch"),c=M("el-color-picker"),n=M("el-input"),v=M("el-option"),D=M("el-select"),A=M("el-input-number"),p=M("el-form-item"),g=M("el-button"),y=M("el-form"),R=M("el-radio"),P=M("el-radio-group"),O=M("el-tab-pane"),G=M("el-tabs");return m(),U("div",{class:X(["main-right",{lock:F.value}])},[l(G,{class:"tabs","model-value":"position"},{default:a(()=>[l(O,{label:"属性配置",name:"position"},{default:a(()=>[l(y,{size:"small"},{default:a(()=>[(m(!0),U(Y,null,Z(u.value,(o,K)=>(m(),L(p,{key:K,label:o.label},{default:a(()=>[o.type==="group"?(m(),U("h3",et,te(o.title),1)):o.type==="switch"?(m(),L(i,{key:1,"model-value":o.value,class:X([o.key]),onChange:W=>r(o,W)},null,8,["model-value","class","onChange"])):o.type==="color"?(m(),L(c,{key:2,"show-alpha":"","model-value":o.value,onChange:W=>r(o,W)},null,8,["model-value","onChange"])):o.type==="textarea"?(m(),L(n,{key:3,type:"textarea",placeholder:o.placeholder,"model-value":o.value,onChange:W=>r(o,W)},null,8,["placeholder","model-value","onChange"])):o.type==="select"?(m(),L(D,{key:4,"allow-create":o.allowCreate,filterable:o.filterable,placeholder:o.placeholder,"model-value":o.value,onChange:W=>r(o,W)},{default:a(()=>[(m(!0),U(Y,null,Z(o.options,(W,we)=>(m(),L(v,{key:W,label:W,value:we},null,8,["label","value"]))),128))]),_:2},1032,["allow-create","filterable","placeholder","model-value","onChange"])):o.type==="number"?(m(),L(A,{key:5,"controls-position":"right",placeholder:o.placeholder,"model-value":o.value,onInput:W=>r(o,W)},null,8,["placeholder","model-value","onInput"])):(m(),L(n,{key:6,placeholder:o.placeholder,"model-value":o.value,onInput:W=>r(o,W)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(b.value)?(m(),L(p,{key:0,class:"upload-image"},{default:a(()=>[l(n,{modelValue:s.value.config.src,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.config.src=o),placeholder:"请输入图片地址"},null,8,["modelValue"]),l(g,{type:"primary",onClick:e[1]||(e[1]=o=>E(b.value==="image"?"img":"bg","src"))},{default:a(()=>e[25]||(e[25]=[N(" 选择图片 ")])),_:1})]),_:1})):H("",!0),["line","bar","pie","echarts"].includes(b.value)?(m(),L(p,{key:1},{default:a(()=>[l(g,{type:"primary",onClick:e[2]||(e[2]=o=>d("echartsEdit"))},{default:a(()=>e[26]||(e[26]=[N(" 图表编辑 ")])),_:1})]),_:1})):H("",!0),["text","sText","image","background","border","clock"].includes(b.value)?(m(),L(p,{key:2},{default:a(()=>[l(g,{type:"primary",onClick:e[3]||(e[3]=o=>d("style"))},{default:a(()=>e[27]||(e[27]=[N(" 编辑更多内联样式 ")])),_:1})]),_:1})):H("",!0),["table"].includes(b.value)?(m(),L(p,{key:3},{default:a(()=>[l(g,{type:"primary",onClick:e[4]||(e[4]=o=>d("tablePropsEdit"))},{default:a(()=>e[28]||(e[28]=[N(" 表格属性 ")])),_:1})]),_:1})):H("",!0)]),_:1}),["line","bar","pie","echarts","text","sText","table"].includes(b.value)?(m(),L(y,{key:0,size:"small"},{default:a(()=>[l(p,null,{default:a(()=>e[29]||(e[29]=[S("h3",null,"数据",-1)])),_:1}),l(p,{label:"数据类型"},{default:a(()=>[l(P,{modelValue:s.value.config.optionsType,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.config.optionsType=o)},{default:a(()=>[l(R,{value:0,style:{"margin-right":"4px"}},{default:a(()=>e[30]||(e[30]=[N(" 静态/全局 ")])),_:1}),l(R,{value:1},{default:a(()=>e[31]||(e[31]=[N(" 动态 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),s.value.config.optionsType!==1?(m(),L(p,{key:0},{default:a(()=>[l(g,{type:"primary",onClick:e[6]||(e[6]=o=>d("editData"))},{default:a(()=>e[32]||(e[32]=[N(" 编辑数据 ")])),_:1})]),_:1})):H("",!0),s.value.config.optionsType===1?(m(),U(Y,{key:1},[l(p,null,{default:a(()=>[l(n,{modelValue:s.value.config.requestUrl,"onUpdate:modelValue":e[8]||(e[8]=o=>s.value.config.requestUrl=o),placeholder:"接口URL或api中的key"},{prepend:a(()=>[l(D,{modelValue:s.value.config.method,"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.config.method=o),style:{width:"60px"}},{default:a(()=>[l(v,{label:"get",value:"get"}),l(v,{label:"post",value:"post"}),l(v,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"刷新时间"},{default:a(()=>[l(A,{modelValue:s.value.config.loopTime,"onUpdate:modelValue":e[9]||(e[9]=o=>s.value.config.loopTime=o),disabled:""},null,8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>e[33]||(e[33]=[S("h3",null,"接口数据处理事件",-1)])),_:1}),l(p,null,{default:a(()=>[l(g,{type:"primary",onClick:e[10]||(e[10]=o=>d("before"))},{default:a(()=>e[34]||(e[34]=[N(" before事件 ")])),_:1})]),_:1}),l(p,null,{default:a(()=>[l(g,{type:"primary",onClick:e[11]||(e[11]=o=>d("after"))},{default:a(()=>e[35]||(e[35]=[N(" after事件 ")])),_:1})]),_:1})],64)):H("",!0)]),_:1})):H("",!0)]),_:1}),l(O,{label:"大屏配置",name:"screen"},{default:a(()=>[l(y,{size:"small"},{default:a(()=>[l(p,{label:"大屏宽度"},{default:a(()=>[l(n,{placeholder:"请输入大屏宽度","model-value":k.value.width,onInput:e[12]||(e[12]=o=>T("width",o))},null,8,["model-value"])]),_:1}),l(p,{label:"大屏高度"},{default:a(()=>[l(n,{placeholder:"请输入大屏高度","model-value":k.value.height,onInput:e[13]||(e[13]=o=>T("height",o))},null,8,["model-value"])]),_:1}),l(p,{class:"color-picker",label:"主色"},{default:a(()=>[l(c,{"show-alpha":"","model-value":k.value.primary,onChange:e[14]||(e[14]=o=>T("primary",o))},null,8,["model-value"])]),_:1}),l(p,{label:"背景"},{default:a(()=>[l(D,{modelValue:_.bgSelect,"onUpdate:modelValue":e[15]||(e[15]=o=>_.bgSelect=o),onChange:C},{default:a(()=>[l(v,{value:1,label:"背景色"}),l(v,{value:2,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),_.bgSelect===1?(m(),L(p,{key:0,class:"color-picker"},{default:a(()=>[l(c,{modelValue:_.bgColor,"onUpdate:modelValue":e[16]||(e[16]=o=>_.bgColor=o),"show-alpha":"",onChange:C},null,8,["modelValue"])]),_:1})):H("",!0),_.bgSelect===2?(m(),L(p,{key:1,class:"upload-image"},{default:a(()=>[l(n,{modelValue:_.bgUpload,"onUpdate:modelValue":e[17]||(e[17]=o=>_.bgUpload=o),placeholder:"请输入图片地址",onChange:C},null,8,["modelValue"]),l(g,{type:"primary",onClick:e[18]||(e[18]=o=>E("bg","screenBg"))},{default:a(()=>e[36]||(e[36]=[N(" 上传 ")])),_:1})]),_:1})):H("",!0),l(p,null,{default:a(()=>[l(g,{onClick:e[19]||(e[19]=o=>d("editCss"))},{default:a(()=>e[37]||(e[37]=[N(" 编辑样式 ")])),_:1})]),_:1}),l(p,null,{default:a(()=>e[38]||(e[38]=[S("h3",null,"全局数据",-1)])),_:1}),l(p,null,{default:a(()=>[l(n,{"model-value":k.value.requestUrl,placeholder:"接口URL或api中的key",onInput:e[21]||(e[21]=o=>T("requestUrl",o))},{prepend:a(()=>[l(D,{"model-value":k.value.method,style:{width:"60px"},onChange:e[20]||(e[20]=o=>T("method",o))},{default:a(()=>[l(v,{label:"get",value:"get"}),l(v,{label:"post",value:"post"}),l(v,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),k.value.requestUrl?(m(),L(p,{key:2},{default:a(()=>[l(g,{type:"primary",onClick:x},{default:a(()=>e[39]||(e[39]=[N(" 连接测试 ")])),_:1})]),_:1})):H("",!0),l(p,{label:"刷新时间"},{default:a(()=>[l(A,{disabled:"","model-value":k.value.loopTime,onInput:e[22]||(e[22]=o=>T("loopTime",o))},null,8,["model-value"])]),_:1}),l(p,null,{default:a(()=>e[40]||(e[40]=[S("h3",null,"接口数据处理事件",-1)])),_:1}),l(p,null,{default:a(()=>[l(g,{type:"primary",onClick:e[23]||(e[23]=o=>d("before",!0))},{default:a(()=>e[41]||(e[41]=[N(" before事件 ")])),_:1})]),_:1}),l(p,null,{default:a(()=>[l(g,{type:"primary",onClick:e[24]||(e[24]=o=>d("after",!0))},{default:a(()=>e[42]||(e[42]=[N(" after事件 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(je,{ref_key:"uploadImageEl",ref:B,onClick:z},null,512)],2)}}}),lt={class:"main-left"},ot={class:"components-list scroll"},st={class:"title"},at=["title"],nt={class:"scroll layer-list"},it=["onClick"],rt=["onUpdate:modelValue"],ct=["title"],ut={class:"icon-group"},pt=["onClick"],dt=["onClick"],ft=le({__name:"controlLeft",setup(j){const V=se(),h=ne("screenData")||{},$=q(()=>{let b=[];return h.value.list.forEach(_=>{var w;_.id!=="rect"&&(b.push(_),["div","group"].includes(_.type)&&((w=_.list)!=null&&w.length)&&(_.list.forEach(C=>{C.pid=_.id}),b=[...b,..._.list]))}),b}),k={line:"line",bar:"bar",pie:"pie",echarts:"",table:"table",text:"text2",sText:"sText",image:"image",background:"image",border:"border",clock:"time",div:"div",group:"div",component:"component"},f=b=>`icon-${k[b.type]}`,s=(b,_)=>{var w;switch(_){case"display":b.position.display=!b.position.display;break;case"lock":b.config.lock=!b.config.lock,b.type==="div"&&((w=b.list)==null||w.forEach(C=>{C.config.lock=!b.config.lock}));break;case"active":V.setActiveId(b.id),V.setControlAttr(b);break;case"del":h.value.list.forEach((C,T)=>{var u;C.id===b.id?h.value.list.splice(T,1):["div","group"].includes(C.type)&&((u=C.list)!=null&&u.length)&&C.list.forEach((r,E)=>{r.id===b.id&&C.list.splice(E,1)})});break}},F=J([{label:"图表",children:[{type:"line",label:"折线图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:"柱状图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:"饼图",position:{width:300,height:300},option:{grid:{left:0,top:0,right:0,bottom:0},series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:"通用图表",position:{width:400,height:300},option:{grid:{left:0,top:0,right:0,bottom:0}}}]},{label:"表格",children:[{type:"table",label:"表格",position:{width:500,height:300},option:{columns:[],list:[]}}]},{label:"辅助",children:[{type:"text",label:"文本",position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:"滚动文本",position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:"图片",position:{width:100,height:50},config:{src:""}},{type:"background",label:"背景",position:{width:100,height:50},config:{src:""}},{type:"border",label:"边框",position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}},{type:"clock",label:"当前时间",position:{width:150,height:30}}]},{label:"布局",children:[{type:"div",label:"div布局",position:{height:100},list:[]}]},{label:"自定义组件",children:[{type:"component",label:"自定义",position:{width:200,height:200},config:{}}]}]),B=b=>re(b);return(b,_)=>{const w=M("el-tab-pane"),C=M("el-popconfirm"),T=M("el-tabs");return m(),U("div",lt,[l(T,{"model-value":"component",class:"tabs"},{default:a(()=>[l(w,{label:"组件",name:"component"},{default:a(()=>[S("div",ot,[(m(!0),U(Y,null,Z(F.value,(u,r)=>(m(),U("div",{key:r},[S("div",st,te(u.label),1),l(ee(Ie),{modelValue:u.children,"onUpdate:modelValue":E=>u.children=E,"item-key":"label",tag:"ul",group:{name:"screen",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:B},{item:a(({element:E})=>[S("li",{class:X([E.type])},[S("i",{class:X(`icon-${k[E.type]}`)},null,2),S("span",{title:E.label},te(E.label),9,at)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),l(w,{label:"图层",name:"layer"},{default:a(()=>[S("div",nt,[S("ul",null,[(m(!0),U(Y,null,Z($.value,(u,r)=>{var E,z,d,x;return m(),U("li",{key:r,class:X({active:ee(V).activeId===u.id,lock:(E=u.config)==null?void 0:E.lock,display:(z=u.position)==null?void 0:z.display,"text-indent":u.pid})},[S("div",{class:"name",onClick:t=>s(u,"active")},[S("i",{class:X(f(u))},null,2),ee(V).activeId===u.id?ie((m(),U("input",{key:0,"onUpdate:modelValue":t=>u.layerName=t},null,8,rt)),[[$e,u.layerName]]):(m(),U("span",{key:1,title:u.layerName||u.id},te(u.layerName||u.id),9,ct))],8,it),S("div",ut,[S("i",{class:X(["icon",[(d=u.position)!=null&&d.display?"icon-eye-close":"icon-eye"]]),onClick:t=>s(u,"display")},null,10,pt),S("i",{class:X(["icon",[(x=u.config)!=null&&x.lock?"icon-lock":"icon-lock-open"]]),onClick:t=>s(u,"lock")},null,10,dt),l(C,{title:"确认删除",onConfirm:t=>s(u,"del")},{reference:a(()=>_[0]||(_[0]=[S("i",{class:"icon-del"},null,-1)])),_:2},1032,["onConfirm"])])],2)}),128))])])]),_:1})]),_:1})])}}}),vt={class:"ruler-box"},ye=le({__name:"ruler",props:{direction:{default:"h"},scale:{},showRuler:{type:Boolean},size:{}},setup(j){const V=j,h=q(()=>({width:parseInt(V.size)*V.scale/100+"px"})),$=q(()=>{const k=parseInt(V.size)+100,f=[];for(let s=0;s<k;s=s+100)f.push(s);return f});return(k,f)=>ie((m(),U("div",{class:X(["screen-ruler",`ruler-${k.direction}`]),style:oe(h.value)},[S("div",vt,[(m(!0),U(Y,null,Z($.value,s=>(m(),U("span",{key:s,style:oe({width:`${k.scale}px`})},te(s),5))),128))])],6)),[[be,k.showRuler]])}}),gt=["onClick"],yt=le({__name:"rightMenu",setup(j,{expose:V}){const h=ne("screenData"),$=se(),k=J({}),f=J(!1),s=q(()=>{let C=k.value.type;["tempRect","group"].includes(C)||(C="single");const T={tempRect:["merge","left","right","top","bottom","horizontally","verticalCenter","del","lock","display"],group:["copy","split","del","lock","display"],single:["copy","del","lock","display"]};return[{key:"merge",label:"组合"},{key:"split",label:"拆分"},{key:"left",label:"左对齐"},{key:"right",label:"右对齐"},{key:"top",label:"顶部对齐"},{key:"bottom",label:"底部对齐"},{key:"horizontally",label:"水平居中"},{key:"verticalCenter",label:"垂直居中"},{key:"copy",label:"复制"},{key:"del",label:"删除"},{key:"lock",label:"锁定"},{key:"display",label:"隐藏"}].filter(u=>T[C].includes(u.key))}),F=q(()=>({left:`${k.value.x+10}px`,top:`${k.value.y+10}px`})),B=()=>{setTimeout(()=>{_()},1e3)},b=C=>{h.value.list.forEach((r,E)=>{r.id===k.value.id&&u(r,E,h.value.list),r.list&&Array.isArray(r.list)&&r.list.forEach((z,d)=>{z.id===k.value.id&&u(z,d,r.list)}),T(r)});function T(r){if(k.value.type==="tempRect")switch(C){case"display":$.tempActiveId.includes(r.id)&&(r.position.display=!0);break;case"lock":$.tempActiveId.includes(r.id)&&(r.config.lock=!0);break}}function u(r,E,z){const d=k.value.type;switch(C){case"copy":const x=re(r);x.id=x.type+new Date().getTime(),x.layerName="复制"+x.layerName,z.push(x),Q.success("复制成功");break;case"del":d==="tempRect"?(r.position.display=!0,h.value.list=h.value.list.filter(y=>!$.tempActiveId.includes(y.id))):z.splice(E,1),Q.success("删除成功");break;case"lock":d==="tempRect"?r.position.display=!0:r.config.lock=!0,["div","group"].includes(d)&&r.list&&Array.isArray(r.list)&&r.list.forEach(y=>{y.config.lock=!0}),Q.success("锁定成功");break;case"display":r.position.display=!0,Q.success("隐藏成功");break;case"horizontally":case"verticalCenter":const{top:t,height:e,left:i,width:c}=r.position;let n=I(t)+I(e)/2,v="top",D="height";C==="verticalCenter"&&(n=I(i)+I(c)/2,v="left",D="width");let A=0;for(const y in $.tempActiveId){const R=z.filter(P=>P.id===$.tempActiveId[y])[0];R.position[v]=n-I(R.position[D])/2,R.position[D]>A&&(A=I(R.position[D]))}r.position[D]=A+"px",r.position[v]=n-A/2;break;case"left":case"top":const p=C==="left"?"width":"height";if(d==="tempRect"){const y=I(r.position[C]);let R=0;for(const P in $.tempActiveId){const O=z.filter(G=>G.id===$.tempActiveId[P])[0];O.position[C]=y,O.position[p]>R&&(R=I(O.position[p]))}r.position[p]=R+"px"}break;case"bottom":if(d==="tempRect"){const{height:y,top:R}=r.position,P=I(y)+I(R);let O=0;for(const G in $.tempActiveId){const o=z.filter(K=>K.id===$.tempActiveId[G])[0];o.position.top=P-I(o.position.height),o.position.height>O&&(O=I(o.position.height))}r.position.height=O+"px",r.position.top=`${P-O}px`}break;case"right":if(d==="tempRect"){const{width:y,left:R}=r.position,P=I(y)+I(R);let O=0;for(const G in $.tempActiveId){const o=z.filter(K=>K.id===$.tempActiveId[G])[0];o.position.left=P-I(o.position.width),o.position.width>O&&(O=I(o.position.width))}r.position.width=O+"px",r.position.left=`${P-O}px`}break;case"merge":const g=re(r);g.type="group",g.id=g.type+new Date().getTime(),g.layerName="组合层",g.list=[],g.config={},z.forEach(y=>{if($.tempActiveId.includes(y.id)){y.position.left=Math.abs(g.position.left-I(y.position.left)),y.position.top=Math.abs(g.position.top-I(y.position.top));const R=y.position.width;typeof R=="number"||R.indexOf("px")!==-1?y.position.width=I(R)/r.position.width*100+"%":R.indexOf("%"),g.list.push(y)}y.id==="rect"&&(y.position.display=!0)}),z.push(g),h.value.list=h.value.list.filter(y=>!$.tempActiveId.includes(y.id)),$.setActiveId(g.id),$.setControlAttr(g);break;case"split":r.list.forEach(y=>{const{left:R,top:P,width:O}=y.position,{left:G,top:o,width:K}=r.position;delete y.pId,y.position.left=I(G)+R,y.position.top=I(o)+P,O.toString().indexOf("%")!==-1&&(typeof K=="number"||K.toString().indexOf("px")!==-1)&&(y.position.width=I(K)*I(O)/100+"px"),z.push(y)}),h.value.list=h.value.list.filter(y=>y.id!==r.id);break}}_()},_=()=>{f.value=!1};return V({open:C=>{k.value=C,f.value=!0},close:_}),(C,T)=>ie((m(),U("div",{class:"screen-right-menu",style:oe(F.value),onMouseleave:B},[S("ul",null,[(m(!0),U(Y,null,Z(s.value,u=>(m(),U("li",{key:u.key,onClick:r=>b(u.key)},te(u.label),9,gt))),128))])],36)),[[be,f.value]])}}),ht={key:0,class:"no-date"},mt={class:"design-footer"},bt={class:"control-tip"},kt={class:"center"},wt={class:"item"},_t={class:"item slider"},xt={class:"item"},Ct=le({__name:"design",props:{preview:{type:Boolean}},setup(j){const V=ne("screenData"),h=se(),$=J(),k=q(()=>h.controlTip),f=pe({scale:100,autoScale:100,ruler:!0,offset:[0,0],moveFlag:!1,ctrlPress:!1});ce("stateData",f);const s=q(()=>{const{width:t,height:e,background:i,primary:c}=V.value.config,n=f.scale/100;return{width:t,height:e,background:i,transform:`scale(${n})`,color:c}}),F=t=>{_(),f.moveFlag=!0;const e=t.offsetX,i=t.offsetY;let c=0,n=0,v=0,D=0;document.onmousemove=A=>{if(!f.moveFlag)return;const p=(A.pageX-f.offset[0])/(f.scale/100),g=(A.pageY-f.offset[1])/(f.scale/100);v=Math.min(e,p),D=Math.min(i,g),c=Math.abs(e-p),n=Math.abs(i-g);let y=!0;c>10&&n>10&&(y=!1),d({left:v+"px",top:D+"px",width:c+"px",height:n+"px",display:y})},document.onmouseup=function(){var A;if(f.moveFlag){if(c>10&&n>10){w({left:v,top:D,width:c,height:n});const p=(A=h.tempActiveId)==null?void 0:A.length;if(p>1)h.setControlTip(`当前选区选中 ${p} 个组件目标，可使用键盘方向键调整位置`),x(),h.setActiveId("rect");else if(d({display:!0}),p===1){const g=h.tempActiveId[0];h.setActiveId(g);const y=V.value.list.filter(R=>R.id===g);h.setControlAttr(y[0])}}f.moveFlag=!1,document.onmousemove=null}}},B=J();ce("openRightMenu",t=>{B.value.open(t)});const _=()=>{h.setControlAttr({}),h.setActiveId(""),h.setTempActiveId([]),h.setControlTip("可按住Ctrl键选中多个"),d({display:!0}),B.value.close()},w=t=>{h.setTempActiveId([]),V.value.list.forEach(i=>{!Be(i.position)&&e(i.position,t)&&Ne(i)&&h.setTempActiveId(i.id)});function e(i,c){const n=I(i.left),v=I(i.top),D=n+I(i.width),A=v+I(i.height),p=I(c.left),g=I(c.top),y=p+I(c.width),R=g+I(c.height),P=n<y&&p<D,O=v<R&&g<A;return P&&O}},C=J({100:{style:{}}}),T=t=>{const e=h.getScreenConfig(t)||!1;setTimeout(()=>{z()},500),h.setScreenConfig(t,!e)},u=t=>{$.value.scrollTo(0,0),t==="auto"?f.scale=f.autoScale:f.scale=100,h.setScreenConfig("scale",f.scale)},r=t=>{h.setScreenConfig("scale",t)};de(document,"keydown",t=>{t.key==="Control"&&(f.ctrlPress||(h.setTempActiveId([]),h.setActiveId(""),d({display:!0})),f.ctrlPress=!0);const e=["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"];if(h.activeId&&e.includes(t.key)){const i=V.value.list.filter(c=>c.id===h.activeId);i!=null&&i.length&&E(i[0],t.key),h.activeId==="rect"&&V.value.list.forEach(c=>{E(c,t.key)}),t.preventDefault()}});const E=(t,e)=>{const i=t.position,c=I(i.left),n=I(i.top);switch(e){case"ArrowRight":i.left=c+1;break;case"ArrowLeft":i.left=c-1;break;case"ArrowDown":i.top=n+1;break;case"ArrowUp":i.top=n-1;break}};de(document,"keyup",()=>{f.ctrlPress=!1});const z=()=>{me(()=>{var c;const t=$.value.offsetWidth,e=parseInt((c=V.value.config)==null?void 0:c.width);if(t&&e){const n=parseInt(`${t/e*100}`),v=h.getScreenConfig("scale");f.autoScale=n,f.scale=parseInt(v)||n}const i=$.value.getBoundingClientRect();f.offset[0]=i.left+20,f.offset[1]=i.top+20})},d=t=>{const e=V.value.list.filter(i=>i.id==="rect");e[0].position=t},x=()=>{const t={left:0,top:0,ex:0,ey:0,zIndex:1};V.value.list.forEach(i=>{if(h.tempActiveId.includes(i.id)){const{left:c,top:n,width:v,height:D,zIndex:A}=i.position,p=parseInt(c),g=parseInt(n),y=parseInt(v),R=parseInt(D);t.left=e(t.left,p),t.top=e(t.top,g),t.ex=Math.max(t.ex,y+p),t.ey=Math.max(t.ey,R+g),t.zIndex=Math.max(t.zIndex,A||1)}}),d({left:t.left,top:t.top,width:Math.abs(t.ex-t.left),height:Math.abs(t.ey-t.top),display:!1,zIndex:t.zIndex+1});function e(i,c){return i===0?c:Math.min(i,c)}};return ue(()=>{z()}),ke(()=>{}),(t,e)=>{const i=M("el-switch"),c=M("el-slider"),n=M("el-button");return m(),U(Y,null,[S("div",{ref_key:"designBoxEl",ref:$,class:"design-box"},[l(ye,{scale:f.scale,"show-ruler":f.ruler,size:s.value.width},null,8,["scale","show-ruler","size"]),l(ye,{scale:f.scale,"show-ruler":f.ruler,direction:"v",size:s.value.height},null,8,["scale","show-ruler","size"]),S("div",{class:X([{preview:t.preview},"design-canvas"]),style:oe(s.value),onMousedown:Te(F,["left"])},[l(Le,{modelValue:ee(V).list,"onUpdate:modelValue":e[0]||(e[0]=v=>ee(V).list=v),onItemClick:x},null,8,["modelValue"])],38),ee(V).list.length?H("",!0):(m(),U("div",ht," 请从左则组件栏拖动组件到设计区域 "))],512),S("div",mt,[S("i",{class:"icon-menu icon",onClick:e[1]||(e[1]=v=>T("left"))}),S("div",bt,te(k.value),1),S("div",kt,[S("div",wt,[e[7]||(e[7]=S("label",{class:"label"},"标尺",-1)),l(i,{modelValue:f.ruler,"onUpdate:modelValue":e[2]||(e[2]=v=>f.ruler=v),size:"small"},null,8,["modelValue"])]),S("div",_t,[e[8]||(e[8]=S("label",{class:"label"},"缩放比例",-1)),l(c,{modelValue:f.scale,"onUpdate:modelValue":e[3]||(e[3]=v=>f.scale=v),marks:C.value,max:200,min:f.autoScale-30,"show-stops":"",size:"small",onChange:r},null,8,["modelValue","marks","min"])]),S("div",xt,[l(n,{link:"",type:"primary",onClick:e[4]||(e[4]=v=>u("auto"))},{default:a(()=>e[9]||(e[9]=[N(" 自适应 ")])),_:1}),l(n,{link:"",type:"primary",onClick:e[5]||(e[5]=v=>u("100"))},{default:a(()=>e[10]||(e[10]=[N(" 100% ")])),_:1})])]),S("i",{class:"icon-menu icon",onClick:e[6]||(e[6]=v=>T("right"))})]),l(yt,{ref_key:"rightMenuEl",ref:B},null,512)],64)}}}),he=JSON.stringify({list:[{id:"rect",type:"tempRect",position:{width:200,height:200,display:!0}}],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff",method:"get"}}),St={class:"container-screen"},It={class:"main-box"},$t=le({__name:"index",setup(j){const V=Ve(),h=Ae(),$=De(),k=se();$.changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]),$.setCollapseMenu(!0);const f=d=>!k.getScreenConfig(d),s=J(!1),F=J(!1),B=J(),b=J(JSON.parse(he));ce("screenData",b);const _=d=>{switch(k.setControlAttr({}),d){case"del":b.value=JSON.parse(he);break;case"eye":F.value=!0;break;case"json":u({type:"json",content:b.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":B.value.openScreen(b.value);break;case"save":E();break}},w=pe({visible:!1,title:"",direction:"ltr",content:"",codeType:"",callback:""}),C=()=>{r()},T=d=>{try{let x;switch(w.codeType){case"json":x=Ue(d);break;case"css":x=d;break;default:x=fe(d)}switch(typeof w.callback=="function"&&w.callback(x),w.type){case"editCss":b.value.config.style=d,Ee("screenStyle",d,!0);break;case"json":b.value=fe(d);break}r()}catch(x){Q.error(x.message||"未知原因")}},u=d=>{const{type:x="",direction:t,codeType:e,title:i,callback:c,content:n,isGlobal:v}=d;w.direction=t||"ltr",w.type=x,w.codeType=e||"",w.title=i||Je[x],w.visible=!0,w.callback=c;let D=e==="json"?ze(n):ve(n,!0);switch(x){case"editCss":D=b.value.config.style||"";break;case"before":case"after":if(!n){let A=x;x==="after"&&(A=v?"afterScreenGlobal":"afterScreen"),D=He(A)}break}w.content=D},r=()=>{w.visible=!1,w.type="",w.title="",w.codeType="",w.callback="",w.content=""},E=()=>{const d={data:ve(b.value),name:"未命名可视化大屏",type:4};let x="designSave";const t=V.query.id;t&&(Object.assign(d,{id:t}),delete d.name,x="designEdit"),s.value=!0,Me(x,d).then(e=>{Q({message:e.message||"保存成功！",type:"success"}),t||h.push({path:"/design/screen/list"}),s.value=!1}).catch(e=>{Q.error(e.message||"保存异常"),s.value=!1})},z=()=>{s.value=!0,Fe(V.query.id).then(d=>{s.value=!1,b.value=d}).catch(()=>{s.value=!1})};return ue(()=>{z()}),ke(()=>{}),(d,x)=>{const t=Re("loading");return ie((m(),U("div",St,[F.value?(m(),U("i",{key:0,class:"icon-close close-preview",onClick:x[0]||(x[0]=e=>F.value=!1)})):H("",!0),l(ft,{style:oe({width:f("left")?"":"0px"})},null,8,["style"]),S("div",It,[l(qe,{onClick:_}),l(Ct,{preview:F.value},null,8,["preview"])]),l(tt,{style:oe({width:f("right")?"":"0px"}),onOpenDrawer:u},null,8,["style"]),l(Pe,{modelValue:w.visible,"onUpdate:modelValue":x[1]||(x[1]=e=>w.visible=e),"code-type":w.codeType,content:w.content,direction:w.direction,title:w.title,onConfirm:T,onBeforeClose:C},null,8,["modelValue","code-type","content","direction","title"]),l(We,{ref_key:"vueFileEl",ref:B},null,512)])),[[t,s.value]])}}});typeof ge=="function"&&ge($t);export{$t as default};
