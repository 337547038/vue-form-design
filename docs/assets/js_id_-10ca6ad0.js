import{x as I,d as S,A as $,k as A,l as b,L as w,h as B,H as M,G as N,p as W,r as k,B as G,s as H,o as D,c as P,b as q,f as L,w as z,i as J,$ as m,D as _,W as x,q as C}from"./index-792ff79a.js";const K=(f,c,p={})=>new Promise((r,d)=>{const a=Object.assign({},p,{responseType:"blob"});I(f,c,a).then(l=>{const{data:u,headers:g}=l,n=decodeURI(g["content-disposition"].split(";")[1].split("=")[1])||`${f.substr(1).replace(/\//g,"_")}_${new Date().getTime()}.xls`,t=window.URL.createObjectURL(new Blob([u])),i=document.createElement("a");i.style.display="none",i.href=t,i.setAttribute("download",n),document.body.appendChild(i),i.click(),document.body.removeChild(i),r()}).catch(l=>{d(l)})}),X=S({__name:"[id]",setup(f){const c=$(),p=A(),r=b(),d=b(!0),a=w({searchData:[],tableData:[],dict:{},visible:!0,source:""}),l=B(()=>c.params.id),u=()=>{if(!l.value)return m.error("非法操作..."),!1;const e={id:l.value};I("designById",e).then(o=>{const s=o.data;s&&Object.keys(s).length&&(a.searchData=_(s.data),a.tableData=_(s.listData),a.dict=x(s.dict),a.source=s.source,C(()=>{r.value.getListData(),d.value=!1}),E())})};M(()=>{g()});const g=N(()=>c.params.id,()=>{u()},{}),n=b(),t=w({visible:!1,title:"",formType:1,formData:{},width:"",dict:{},editId:""}),i=B(()=>{var e;return a.source&&((e=a.tableData.config)==null?void 0:e.openType)==="dialog"}),E=()=>{var e;i.value&&(t.width=(e=a.tableData.config)==null?void 0:e.dialogWidth,I("designById",{id:a.source}).then(o=>{const s=o.data;s&&Object.keys(s).length&&(t.formData=_(s.data),t.dict=x(s.dict))}).catch(o=>{m.error(o.message||"非法操作.")}))},R=(e,o)=>{var s;if(e.key==="import"){const y=Object.assign({},r.value.getSearchFormValue(),{listId:l.value});K("importExcel",y).then(()=>{m.success("正在导出..")}).catch(v=>{m.error(v.message)})}else(e.key==="add"||e.key==="edit")&&(i.value?(t.visible=!0,t.title=e.key==="add"?"新增":"编辑",t.formType=e.key==="add"?1:2,t.editId=o&&o.id,e.key==="add"&&((s=t.formData.config)!=null&&s.addLoad)&&C(()=>{n.value.getData()}),e.key==="edit"&&C(()=>{n.value.getData()})):p.push({path:"/design/form/form/",query:{form:a.source,id:o==null?void 0:o.id}}))},T=e=>(e.formId=a.source,e),j=e=>{e==="success"&&(h(),r.value.getListData())},O=e=>{(e==="reset"||e==="cancel")&&h()},F=e=>{h(),e&&e()},h=()=>{t.visible=!1,t.editId=""};return W(()=>{u()}),(e,o)=>{const s=k("ak-list"),y=k("ak-form"),v=k("el-dialog"),V=G("loading");return H((D(),P("div",null,[a.visible?(D(),q(s,{key:0,ref_key:"listEl",ref:r,"search-data":a.searchData,data:a.tableData,dict:a.dict,"request-url":"getContentList","delete-url":"delFormContent",query:{formId:a.source},"auto-load":!1,onBtnClick:R},null,8,["search-data","data","dict","query"])):L("",!0),i.value?(D(),q(v,{key:1,"destroy-on-close":"",modelValue:t.visible,"onUpdate:modelValue":o[0]||(o[0]=U=>t.visible=U),title:t.title,width:t.width||"600px","before-close":F},{default:z(()=>[J(y,{ref_key:"formEl",ref:n,data:t.formData,dict:t.dict,type:t.formType,"request-url":"getFormContent","submit-url":"saveFormContent","edit-url":"editFormContent","before-submit":T,"after-submit":j,onBtnClick:O,query:{formId:a.source,id:t.editId}},null,8,["data","dict","type","query"])]),_:1},8,["modelValue","title","width"])):L("",!0)])),[[V,d.value]])}}});export{X as default};
