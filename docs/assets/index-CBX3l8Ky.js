import{d as A,l as r,B as L,h as q,r as p,c as T,o as g,j as u,s as O,w as n,F as S,a as z,b as R,e as M,m as V,v as $,f as B,N as w,y as H,u as J,G as U,p as W,q as X}from"./index-B4_jWQ4O.js";const j={style:{width:"100%"}},G=A({__name:"table",props:{modelValue:{default:()=>[]},type:{default:"add"}},emits:["update:modelValue"],setup(x,{emit:h}){const d=x,k=h,i=r(),a=r(),l=r([]),b=r(d.type);L(()=>d.modelValue,t=>{l.value=t},{deep:!0,immediate:!0});const c=r(!1),_=r({list:[{type:"input",control:{modelValue:"",placeholder:"数据库字段名称"},config:{disabledEdit:!0},name:"name",formItem:{label:"表名字"},customRules:[{type:"required",message:"名字不能为空",trigger:"blur"},{type:"numberLetter",message:"只能为字母数字",trigger:"blur"}]},{type:"select",control:{modelValue:""},options:[{label:"INT",value:"INT"},{label:"VARCHAR",value:"VARCHAR"},{label:"TEXT",value:"TEXT"},{label:"DATETIME",value:"DATETIME"},{label:"FLOAT",value:"FLOAT"},{label:"BOOLEAN",value:"BOOLEAN"}],config:{optionsType:0,disabledEdit:!0},name:"type",formItem:{label:"类型"},customRules:[{type:"required",message:"类型不能为空",trigger:"change"}]},{type:"input",control:{modelValue:""},config:{disabledEdit:!0},name:"length",formItem:{label:"长度/值"}},{type:"input",control:{modelValue:""},config:{disabledEdit:!0},name:"default",formItem:{label:"默认"}},{type:"input",control:{modelValue:"",size:"small"},config:{disabledEdit:!0},name:"remark",formItem:{label:"注释"}},{type:"switch",control:{modelValue:!0},config:{disabledEdit:!0},name:"empty",formItem:{label:"空"}},{type:"input",control:{modelValue:"",placeholder:"中文标题名称"},config:{},name:"label",formItem:{label:"标题"}},{type:"select",control:{modelValue:""},options:[{label:"单行文本",value:"input"},{label:"多行文本",value:"textarea"},{label:"单选框组",value:"radio"},{label:"多选框组",value:"checkbox"},{label:"开关",value:"switch"},{label:"下拉选择框",value:"select"},{label:"日期选择框",value:"datePicker"},{label:"计数器",value:"inputNumber"},{label:"级联选择器",value:"cascader"},{label:"滑块",value:"slider"},{label:"图片/文件",value:"upload"},{label:"富文本",value:"tinymce"}],config:{optionsType:0},name:"filedType",formItem:{label:"组件类型"}},{type:"switch",control:{modelValue:!1},config:{},name:"search",formItem:{label:"模糊搜索"}}],form:{labelWidth:"60px",class:"form-row-3",size:"small",name:"source"},config:{}}),E=q(()=>{const t=[];return _.value.list.forEach(e=>{var o;t.push({label:(o=e.formItem)==null?void 0:o.label,prop:e.name})}),t}),I=(t,e)=>{c.value=!0,i.value.setValue(t),a.value=e,b.value=d.type},C=(t,e)=>{if(c.value=!1,d.type===2&&t.isNew!==1){w.error("新添加的才能删除");return}l.value.splice(e,1)},N=()=>{i.value.resetFields(),c.value=!0,a.value=void 0,b.value=1},y=()=>{if(a.value!==void 0){const t=i.value.getValue();l.value.splice(a.value,1,t),a.value=void 0,c.value=!1}else i.value.validate((t,e)=>{if(t){let o=!1;if(l.value.forEach(s=>{s.name===e.name&&(o=!0)}),["INT","VARCHAR"].includes(e.type)&&!e.length){w.error(`名字列${e.name}的长度值不能为空`);return}if(o){w.error(`数据表名字${e.name}已存在`);return}e.isNew=1,l.value.push(e),c.value=!1}});k("update:modelValue",l.value)};return(t,e)=>{const o=p("el-table-column"),s=p("el-button"),f=p("el-table"),v=p("ak-form");return g(),T("div",j,[u(f,{data:l.value,style:{"margin-bottom":"10px"}},{default:n(()=>[(g(!0),T(S,null,z(E.value,m=>(g(),R(o,{key:m.prop,prop:m.prop,label:m.label},null,8,["prop","label"]))),128)),u(o,{width:"110px"},{default:n(({row:m,$index:D})=>[u(s,{type:"primary",link:"",onClick:F=>I(m,D)},{default:n(()=>e[0]||(e[0]=[V(" 编辑 ")])),_:2},1032,["onClick"]),m.isNew?(g(),R(s,{key:0,type:"primary",link:"",onClick:F=>C(m,D)},{default:n(()=>e[1]||(e[1]=[V(" 删除 ")])),_:2},1032,["onClick"])):M("",!0)]),_:1})]),_:1},8,["data"]),u(s,{size:"small",onClick:N},{default:n(()=>e[2]||(e[2]=[V(" 添加一行 ")])),_:1}),O(B("div",null,[u(v,{ref_key:"formEl",ref:i,data:_.value,"operate-type":b.value},{default:n(()=>[u(s,{type:"primary",onClick:y},{default:n(()=>e[3]||(e[3]=[V(" 保存 ")])),_:1})]),_:1},8,["data","operate-type"])],512),[[$,c.value]])])}}}),K=A({__name:"index",setup(x){const h=H(),d=J(),k=r(),i=r(),a=r([]),l=U({visible:!1,title:"",type:"add",id:""}),b=t=>{l.visible=!0,l.title="修改数据源",l.type="edit",l.id=t,X(()=>{i.value.getData({id:t})})},c=r({columns:[{label:"勾选",type:"selection",prop:"selection"},{prop:"id",label:"编号",width:80},{prop:"name",label:"名称",width:150},{prop:"tableName",label:"数据表名",width:150},{prop:"category",label:"分类",render:"tag",replaceValue:"sys-source",custom:{1:"success",2:"danger"},config:{}},{prop:"status",label:"状态",render:"tag",replaceValue:"sys-status",custom:{0:"info",1:"success"}},{prop:"creatUser",label:"创建人"},{prop:"updateDate",label:"修改时间",render:"datetime",config:{},width:170},{label:"操作",prop:"__control",width:"250px",render:"buttons",buttons:[{type:"primary",label:"编辑",click:t=>{b(t.id)},attr:{text:!0}},{label:"删除",key:"del",type:"danger",attr:{text:!0}},{type:"primary",label:"一键创建表单",click:t=>{d.push({path:"/design/form",query:{source:t.id}})},attr:{text:!0}}]}],controlBtn:[{label:"新增",type:"primary",click:()=>{l.visible=!0,l.title="创建数据源",l.type="add",l.id=""}},{label:"删除",key:"del",type:"danger"}],config:{expand:!0,searchJump:!0}}),_=r({list:[{type:"input",control:{modelValue:"",placeholder:"请输入名称"},name:"name",formItem:{label:"名称"}},{type:"input",control:{modelValue:"",placeholder:"请输入数据库表名"},name:"tableName",formItem:{label:"数据表名"}}],config:{submitCancel:!0},form:{}}),E=r({list:[{type:"input",control:{modelValue:"",placeholder:"请输入数据源名称"},config:{},name:"name",formItem:{label:"名称"},customRules:[{type:"required",message:"请输入数据源名称",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入数据表名"},config:{disabledEdit:!0},name:"tableName",formItem:{label:"数据表名"},customRules:[{type:"required",message:"请输入创建生成的数据表名",trigger:"blur"}]},{type:"select",control:{modelValue:""},options:[],config:{optionsType:2,optionsFun:"sys-source"},name:"category",formItem:{label:"分类"}},{type:"input",control:{modelValue:"",placeholder:"数据库表注释"},config:{disabledEdit:!0},name:"remark",formItem:{label:"表注释"}},{type:"switch",control:{modelValue:1,activeValue:1,inactiveValue:0},config:{},name:"status",formItem:{label:"状态"}},{type:"title",control:{modelValue:"数据库表字段"},config:{span:24},name:"title"}],form:{labelWidth:"100px",class:"form-row-2",size:"default",name:"source"},config:{submitCancel:!0}}),I=(t,e,o)=>{if(o==="fetch"){const s=JSON.parse(t.tableData);return s.forEach(f=>{f.isNew&&delete f.isNew}),a.value=s,t}else e&&(l.visible=!1,k.value.getListData(),y())},C=(t,e)=>{if(e==="submit")return l.type==="add"&&!a.value.length?(w.error("数据库表字段内容不能为空"),!1):(t.tableData=JSON.stringify(a.value),t)},N=t=>{t==="reset"&&(l.visible=!1,y())},y=t=>{a.value=[],t&&t()};return W(()=>{h.query.source&&b(h.query.source)}),(t,e)=>{const o=p("ak-list"),s=p("ak-form"),f=p("el-dialog");return g(),T("div",null,[u(o,{ref_key:"tableListEl",ref:k,"api-key":{list:"sourceList",del:"sourceDelete"},"search-data":_.value,data:c.value},null,8,["search-data","data"]),u(f,{modelValue:l.visible,"onUpdate:modelValue":e[1]||(e[1]=v=>l.visible=v),title:l.title,width:"1000px","destroy-on-close":"","before-close":y},{default:n(()=>[u(s,{ref_key:"formEl",ref:i,data:E.value,"operate-type":l.type,"submit-url":l.type==="add"?"sourceCreat":"sourceEdit","request-url":"sourceById",before:C,after:I,params:{id:l.id},onBtnClick:N},{default:n(()=>[u(G,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=v=>a.value=v),type:l.type},null,8,["modelValue","type"])]),_:1},8,["data","operate-type","submit-url","params"]),e[2]||(e[2]=B("div",{class:"tips"}," 提示：默认会添加id自增主键；其中标题作为表单的label值，组件类型仅用于一健创建表单；模糊搜索用于条件查询时 ",-1))]),_:1},8,["modelValue","title"])])}}});export{K as default};
