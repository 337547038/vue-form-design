import{f as me,z as ge,s as he,r as Be,c as Fe,A as ke,k as Ee,q as P,N as ye,a as c,x as De,n as S,o as s,b as r,j as i,u as q,F as _,e as o,w as u,g as B,h as m,p as T,d as g,t as v,W as w,M as ve,X as Ce,Y as Ve,v as xe,Q as N,P as R,R as Ie,y as A,O as Q,E as C,l as H,Z as Le,$ as Oe}from"./index.fbb3896e.js";import{_ as Te,a as we}from"./vueFile.vue_vue_type_script_setup_true_lang.6bf85f20.js";const Ae={class:"design-container design-table"},Ue={class:"components-list"},je=i("div",{class:"title"},"\u53EF\u9009\u5B57\u6BB5",-1),Ge={class:"content"},$e=i("div",{class:"title"},"\u5176\u4ED6\u5B57\u6BB5",-1),ze={class:"content"},Me=i("div",{class:"title"},"\u64CD\u4F5C\u6309\u94AE",-1),Pe={class:"content"},Se={class:"title"},qe=g("\u7F16\u8F91\u81EA\u5B9A\u4E49\u5B57\u6BB5 "),Ne={class:"main-body"},Re={class:"main-form main-table"},Qe=i("p",{style:{padding:"10px 0"}},"\u63D0\u793A\uFF1A\u70B9\u51FB\u8868\u5934\u53EF\u62D6\u52A8\u6539\u53D8\u987A\u5E8F",-1),He={class:"control-btn"},Ke=["innerHTML"],Je=i("i",{class:"icon-help"},null,-1),We={key:1},Xe=["onClick"],Ye={class:"sidebar-tools"},Ze=["onClick"],el=g("\u65B0\u589ETag\u6807\u7B7E\u663E\u793A"),ll=g("\u7F16\u8F91\u8868\u683C\u5C5E\u6027 "),tl=g("\u8BBE\u7F6E\u6570\u636E\u5B57\u5178 "),al={key:0,id:"editJson"},ol={class:"dialog-footer"},nl=g(" \u786E\u5B9A "),il=me({__name:"table",setup(ul){const K=ge(),U=he(),{proxy:J}=Oe(),j=Be(),F=Fe(()=>U.query.type==="table"),e=ke({direction:"rtl",filedList:[],otherFiled:[{label:"\u52FE\u9009",prop:"__selection",type:"selection"},{label:"\u5E8F\u53F7",prop:"__index",type:"index"},{label:"\u64CD\u4F5C",prop:"__control"}],checkboxGroup:[],controlBtn:[{label:"\u65B0\u589E",key:"add",type:"primary",size:"small",hide:F.value},{label:"\u5220\u9664",key:"del",size:"small"}],controlBtnGroup:[],tableData:{tableProps:{},columns:[],controlBtn:[]},editor:{},visibleDialog:!1,loading:!1,id:U.query.id,selectCheck:"",editIndex:"",dataList:[{}],dataTemp:{},attrObj:{},tagList:[],config:{},name:"",formId:"",dict:{}}),W=["txt","title","table","component","upload"],V=a=>{a==null||a.list.forEach(l=>{var n;l.type==="grid"||l.type==="tabs"?l.columns.forEach(d=>{V(d)}):l.type==="card"?V(l):W.indexOf(l.type)===-1&&e.filedList.push({prop:l.name,label:(n=l.item)==null?void 0:n.label,help:l.config.help||""})})},X=a=>{switch(a){case"del":e.tableData.columns=[],e.checkboxGroup=[];break;case"json":k(e.tableData);break;case"vue":j.value.openTable(e.tableData);break;case"save":Z();break}},G=a=>{e.checkboxGroup.indexOf(a.label)===-1?e.tableData.columns.forEach((n,d)=>{n.label===a.label&&n.prop===a.prop&&e.tableData.columns.splice(d,1)}):e.tableData.columns.push(a)},k=(a,l,n)=>{e.direction=l||"rtl",e.visibleDialog=!0;const d=n==="dict"?N(a,!0):R(a,!0);P(()=>{e.editor=Ie(d)})},Y=()=>{try{const a=A(e.editor.getValue());switch(e.editIndex){case"columns":e.tableData.columns=a;break;case"tableConfig":e.tableData.tableProps=a;break;case"dict":e.dict=Q(e.editor.getValue());break}e.editIndex!==""?e.tableData.columns[e.editIndex]=a:e.tableData=a,e.editIndex="",e.visibleDialog=!1}catch(a){C.error(a.message)}},Z=()=>{const a=e.name||e.dataTemp.name;if(!a){C.error(F.value?"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0":"\u8BF7\u8F93\u5165\u8868\u5355\u540D\u79F0");return}e.loading=!0;const l=Object.assign(e.dataTemp,{tableData:R(e.tableData),id:e.id,name:a,formId:e.formId||e.dataTemp.formId,type:e.dataTemp.type||2,dict:N(e.dict)});H("saveForm",l).then(n=>{console.log(n),C({message:n.data.message||"\u4FDD\u5B58\u6210\u529F\uFF01",type:"success"}),K.push({path:"/designform/formlist"}),e.loading=!1}).catch(n=>{C.error(n.data.message||"\u4FDD\u5B58\u5F02\u5E38"),e.loading=!1})},ee=a=>{e.editIndex="",a()},x=a=>{switch(e.editIndex=a,a){case"dict":k(e.dict||{},"ltr",a);break;case"tableConfig":k(e.tableData.tableProps,"ltr");break;case"columns":k(e.tableData.columns);break}},le=a=>{let l={};e.tableData.columns.forEach((n,d)=>{n.prop===a&&(l=n,e.editIndex=d)}),k(l)},te=a=>{var d;let l=(d=e.tableData)==null?void 0:d.controlBtn,n=-1;l?l.forEach((p,E)=>{(p.key===a.key||p.label===a.label)&&(n=E)}):e.tableData.controlBtn=[],n!==-1?e.tableData.controlBtn.splice(n,1):e.tableData.controlBtn.push(a)},ae=()=>{const a=J.$el.querySelector(".el-table__header-wrapper tr");Le.create(a,{animation:180,delay:0,onEnd:l=>{const n=e.tableData.columns[l.oldIndex];e.tableData.columns.splice(l.oldIndex,1),e.tableData.columns.splice(l.newIndex,0,n)}})},oe=()=>{e.id&&H("getFormById",{id:e.id}).then(a=>{var l;if(a.data.code===200){const n=a.data.data;e.dataTemp=n,V(A(n.formData)),n.tableData&&(e.tableData=A(n.tableData)),F.value&&(e.name=n.name,e.formId=n.formId),e.tableData.columns.forEach(d=>{e.checkboxGroup.push(d.label)}),(l=e.tableData.controlBtn)==null||l.forEach(d=>{e.controlBtnGroup.push(d.key||d.label)}),e.dict=Q(n.dict)}})},ne=a=>{e.attrObj=a,e.config=a.config||{};const l=e.config.tagList;if(e.tagList=[],l)for(const n in l)e.tagList.push({value:n,type:l[n]})},ue=a=>{e.tagList.splice(a,1),I()},se=()=>{e.tagList.push({value:"",type:"default"})},I=()=>{const a={};e.tagList.forEach(l=>{a[l.value]=l.type}),Object.keys(a).length?e.config.tagList=a:delete e.config.tagList,L()},L=()=>{Object.assign(e.attrObj,{config:e.config})};return Ee(()=>{P(()=>{oe(),ae()})}),ye(()=>{Object.keys(e.editor).length!==0&&(e.editor.destroy(),e.editor.container.remove())}),(a,l)=>{var z,M;const n=c("el-checkbox"),d=c("el-checkbox-group"),p=c("el-button"),E=c("el-tooltip"),de=c("el-table-column"),ie=c("el-table"),b=c("el-option"),O=c("el-select"),h=c("el-form-item"),y=c("el-input"),$=c("el-tab-pane"),ce=c("QuestionFilled"),re=c("el-icon"),pe=c("el-tabs"),be=c("el-form"),_e=c("el-drawer"),fe=De("loading");return S((s(),r("div",Ae,[i("div",Ue,[((z=e.filedList)==null?void 0:z.length)&&e.id&&!q(F)?(s(),r(_,{key:0},[je,i("div",Ge,[o(d,{modelValue:e.checkboxGroup,"onUpdate:modelValue":l[0]||(l[0]=t=>e.checkboxGroup=t),size:"small"},{default:u(()=>[(s(!0),r(_,null,B(e.filedList,t=>(s(),m(n,{label:t.label,key:t.prop,onChange:f=>G(t)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])])],64)):T("",!0),$e,i("div",ze,[o(d,{modelValue:e.checkboxGroup,"onUpdate:modelValue":l[1]||(l[1]=t=>e.checkboxGroup=t),size:"small"},{default:u(()=>[(s(!0),r(_,null,B(e.otherFiled,t=>(s(),m(n,{label:t.label,key:t.prop,onChange:f=>G(t)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),Me,i("div",Pe,[o(d,{modelValue:e.controlBtnGroup,"onUpdate:modelValue":l[2]||(l[2]=t=>e.controlBtnGroup=t),size:"small"},{default:u(()=>[(s(!0),r(_,null,B(e.controlBtn.filter(t=>!t.hide),t=>(s(),m(n,{label:t.key,key:t.prop,onChange:f=>te(t)},{default:u(()=>[g(v(t.label),1)]),_:2},1032,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),i("div",Se,[o(p,{size:"small",onClick:l[3]||(l[3]=t=>x("columns"))},{default:u(()=>[qe]),_:1})])]),i("div",Ne,[o(Te,{onClick:X,type:"2"}),i("div",Re,[Qe,i("div",He,[(s(!0),r(_,null,B((M=e.tableData)==null?void 0:M.controlBtn,t=>(s(),m(p,w(t,{key:t.label}),{default:u(()=>[g(v(t.label),1)]),_:2},1040))),128))]),o(ie,w({data:e.dataList},e.tableData.tableProps,{ref:"tableEl"}),{default:u(()=>[(s(!0),r(_,null,B(e.tableData.columns,t=>(s(),m(de,Ve(w({key:t.prop||t.label},t)),ve({_:2},[t.help?{name:"header",fn:u(f=>[g(v(f.column.label)+" ",1),o(E,{placement:"top"},{content:u(()=>[i("span",{innerHTML:t.help},null,8,Ke)]),default:u(()=>[Je]),_:2},1024)])}:void 0,t.type!=="index"?{name:"default",fn:u(()=>[t.type==="selection"?(s(),m(n,{key:0})):t.prop==="__control"?(s(),r("span",We,"\u7F16\u8F91 \u5220\u9664")):(s(),r("span",{key:2,onClick:Ce(f=>ne(t),["stop"])},"\u70B9\u51FB\u4E2A\u6027\u5316\u8BBE\u7F6E",8,Xe))])}:void 0]),1040))),128))]),_:1},16,["data"])])]),i("div",Ye,[o(be,{size:"small"},{default:u(()=>[o(pe,{modelValue:"first"},{default:u(()=>[o($,{label:"\u5B57\u6BB5\u5C5E\u6027",name:"first"},{default:u(()=>[o(h,{label:"\u9009\u62E9\u8868\u5934\u5B57\u6BB5"},{default:u(()=>[o(O,{modelValue:e.selectCheck,"onUpdate:modelValue":l[4]||(l[4]=t=>e.selectCheck=t),onChange:le},{default:u(()=>[(s(!0),r(_,null,B(e.tableData.columns,t=>(s(),m(b,{key:t.prop,value:t.prop,label:t.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(i("div",null,[i("h3",null,v(e.attrObj.label)+"\u4E2A\u6027\u5316\u8BBE\u7F6E",1),o(h,{label:"\u65F6\u95F4\u683C\u5F0F\u5316"},{default:u(()=>[o(O,{modelValue:e.config.formatter,"onUpdate:modelValue":l[5]||(l[5]=t=>e.config.formatter=t),onChange:L},{default:u(()=>[o(b,{label:"{y}-{m}-{d} {h}:{i}:{s}",value:"{y}-{m}-{d} {h}:{i}:{s}"}),o(b,{label:"{y}-{m}-{d}",value:"{y}-{m}-{d}"}),o(b,{label:"{h}:{i}:{s}",value:"{h}:{i}:{s}"})]),_:1},8,["modelValue"])]),_:1}),o(h,{label:"\u503C\u5339\u914D\u5B57\u5178"},{default:u(()=>[o(y,{placeholder:"\u5B57\u5178\u5BF9\u5E94\u7684key",modelValue:e.config.dictKey,"onUpdate:modelValue":l[6]||(l[6]=t=>e.config.dictKey=t),onChange:L},null,8,["modelValue"])]),_:1}),(s(!0),r(_,null,B(e.tagList,(t,f)=>(s(),m(h,{key:f,class:"table-tag"},{default:u(()=>[o(y,{placeholder:"\u503C\u5BF9\u5E94\u7684\u7C7B\u578B",modelValue:t.value,"onUpdate:modelValue":D=>t.value=D,onChange:I},{append:u(()=>[o(O,{style:{width:"80px"},modelValue:t.type,"onUpdate:modelValue":D=>t.type=D,onChange:I},{default:u(()=>[o(b,{label:"default",value:"default"}),o(b,{label:"success",value:"success"}),o(b,{label:"info",value:"info"}),o(b,{label:"warning",value:"warning"}),o(b,{label:"danger",value:"danger"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),i("i",{class:"icon-del",onClick:D=>ue(f)},null,8,Ze)]),_:2},1024))),128)),o(h,null,{default:u(()=>[o(p,{onClick:se},{default:u(()=>[el]),_:1})]),_:1})],512),[[xe,Object.keys(e.attrObj).length]])]),_:1}),o($,{label:"\u6570\u636E\u5217\u8868\u5C5E\u6027",name:"second"},{default:u(()=>[q(F)?(s(),r(_,{key:0},[o(h,{label:"\u6570\u636E\u5217\u8868\u540D\u79F0"},{default:u(()=>[o(y,{modelValue:e.name,"onUpdate:modelValue":l[7]||(l[7]=t=>e.name=t),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(h,{label:"\u6570\u636E\u6E90Id"},{default:u(()=>[o(y,{modelValue:e.formId,"onUpdate:modelValue":l[8]||(l[8]=t=>e.formId=t),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90Id"},null,8,["modelValue"])]),_:1})],64)):T("",!0),o(p,{onClick:l[9]||(l[9]=t=>x("tableConfig"))},{default:u(()=>[ll]),_:1}),o(p,{onClick:l[10]||(l[10]=t=>x("dict"))},{default:u(()=>[tl,o(E,{content:"\u6570\u636E\u5B57\u5178\uFF0C\u7528\u4E8E\u5339\u914D\u591A\u9009\u7EC4\u3001\u4E0B\u62C9\u9009\u62E9\u7B49\uFF0C\u63D0\u4F9B\u52A8\u6001\u83B7\u53D6Options\u63A5\u53E3\u5B57\u5178\u6570\u636E\uFF0C\u4E00\u822C\u4E0D\u8BBE\u7F6E\uFF0C\u4ECE\u63A5\u53E3dict\u83B7\u53D6\u3002\u683C\u5F0F\uFF1A{0:'\u7537',1:'\u5973'}",placement:"top"},{default:u(()=>[o(re,null,{default:u(()=>[o(ce)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o(_e,{modelValue:e.visibleDialog,"onUpdate:modelValue":l[11]||(l[11]=t=>e.visibleDialog=t),size:"60%",direction:e.direction,"custom-class":"json-dialog","append-to-body":!0,"before-close":ee},{default:u(()=>[e.visibleDialog?(s(),r("div",al)):T("",!0),i("div",ol,[o(p,{type:"primary",size:"small",onClick:Y},{default:u(()=>[nl]),_:1})])]),_:1},8,["modelValue","direction"]),o(we,{ref_key:"vueFileEl",ref:j},null,512)])),[[fe,e.loading]])}}});export{il as default};
