import{e as re,y as pe,s as be,r as _e,z as fe,j as me,q as z,L as ge,a as d,x as he,n as $,o as u,c as r,i as c,F as _,b as o,w as s,f as g,g as f,p as j,d as m,t as C,P as x,J as ke,Q as De,R as Be,v as ve,E as V,k as P,S as ye,U as Ce}from"./index.3ab26249.js";import{_ as Ee,a as Fe,b as xe}from"./vueFile.vue_vue_type_script_setup_true_lang.8b04fff5.js";import{o as S,s as L}from"./form.d7b94745.js";const Ve={class:"design-container design-table"},Le={class:"components-list"},we=c("div",{class:"title"},"\u53EF\u9009\u5B57\u6BB5",-1),Oe={class:"content"},Te=c("div",{class:"title"},"\u5176\u4ED6\u5B57\u6BB5",-1),Ie={class:"content"},Ae=c("div",{class:"title"},"\u64CD\u4F5C\u6309\u94AE",-1),Ge={class:"content"},Ue={class:"title"},ze=m("\u7F16\u8F91\u81EA\u5B9A\u4E49\u5B57\u6BB5 "),$e={class:"main-body"},je={class:"main-form main-table"},Pe=c("p",{style:{padding:"10px 0"}},"\u63D0\u793A\uFF1A\u70B9\u51FB\u8868\u5934\u53EF\u62D6\u52A8\u6539\u53D8\u987A\u5E8F\uFF1B",-1),Se={class:"control-btn"},Me=["innerHTML"],qe=c("i",{class:"icon-help"},null,-1),Ne={key:1},Re=["onClick"],Qe={class:"sidebar-tools"},He=["onClick"],Je=m("\u65B0\u589ETag\u6807\u7B7E\u663E\u793A"),Ke=m("\u7F16\u8F91\u8868\u683C\u5C5E\u6027"),We=m("\u8BBE\u7F6E\u5217\u8868\u5B57\u5178 "),Xe={key:0,id:"editJson"},Ye={class:"dialog-footer"},Ze=m(" \u786E\u5B9A "),ot=re({__name:"table",setup(et){const M=pe(),q=be(),{proxy:N}=Ce(),w=_e(),e=fe({direction:"rtl",filedList:[],otherFiled:[{label:"\u52FE\u9009",prop:"__selection",type:"selection"},{label:"\u5E8F\u53F7",prop:"__index",type:"index"},{label:"\u64CD\u4F5C",prop:"__control"}],checkboxGroup:[],controlBtn:[{label:"\u65B0\u589E",key:"add",type:"primary",size:"small"},{label:"\u5220\u9664",key:"del",size:"small"}],controlBtnGroup:[],tableData:{tableProps:{},columns:[],controlBtn:[]},editor:{},visibleDialog:!1,loading:!1,id:q.query.id,selectCheck:"",editIndex:"",dataList:[{}],dataTemp:{},attrObj:{},tagList:[],config:{}}),R=["txt","title","table","component","upload"],E=a=>{a==null||a.list.forEach(t=>{var n;t.type==="grid"||t.type==="tabs"?t.columns.forEach(i=>{E(i)}):t.type==="card"?E(t):R.indexOf(t.type)===-1&&e.filedList.push({prop:t.name,label:(n=t.item)==null?void 0:n.label,help:t.config.help||""})})},Q=a=>{switch(a){case"del":e.tableData.columns=[],e.checkboxGroup=[];break;case"json":h(e.tableData);break;case"vue":w.value.openTable(e.tableData);break;case"import":h({});break;case"save":J();break}},O=a=>{e.checkboxGroup.indexOf(a.label)===-1?e.tableData.columns.forEach((n,i)=>{n.label===a.label&&n.prop===a.prop&&e.tableData.columns.splice(i,1)}):e.tableData.columns.push(a)},h=(a,t)=>{e.direction=t||"rtl",e.visibleDialog=!0;const n=S(a,!0);z(()=>{e.editor=xe(n)})},H=()=>{try{const a=L(e.editor.getValue());e.editIndex==="columns"?e.tableData.columns=a:e.editIndex==="tableConfig"?e.tableData.tableProps=a:e.editIndex==="dict"?e.tableData.dict=a:e.editIndex!==""?e.tableData.columns[e.editIndex]=a:e.tableData=a,e.editIndex="",e.visibleDialog=!1}catch(a){V.error(a.message)}},J=()=>{e.loading=!0;const a={tableData:S(e.tableData),id:e.id,searchData:e.dataTemp.searchData,formData:e.dataTemp.formData,name:e.dataTemp.name};P("saveForm",a).then(t=>{V({message:t.data||"\u4FDD\u5B58\u6210\u529F\uFF01",type:"success"}),M.push({path:"/designform/formlist"}),e.loading=!1}).catch(t=>{V.error(t.data||"\u4FDD\u5B58\u5F02\u5E38"),e.loading=!1})},K=a=>{e.editIndex="",a()},F=a=>{switch(e.editIndex=a,a){case"dict":h(e.tableData.config||{},"ltr");break;case"tableConfig":h(e.tableData.tableProps,"ltr");break;case"columns":h(e.tableData.columns);break}},W=a=>{let t={};e.tableData.columns.forEach((n,i)=>{n.prop===a&&(t=n,e.editIndex=i)}),h(t)},X=a=>{var i;let t=(i=e.tableData)==null?void 0:i.controlBtn,n=-1;t?t.forEach((p,B)=>{(p.key===a.key||p.label===a.label)&&(n=B)}):e.tableData.controlBtn=[],n!==-1?e.tableData.controlBtn.splice(n,1):e.tableData.controlBtn.push(a)},Y=()=>{const a=N.$el.querySelector(".el-table__header-wrapper tr");ye.create(a,{animation:180,delay:0,onEnd:t=>{const n=e.tableData.columns[t.oldIndex];e.tableData.columns.splice(t.oldIndex,1),e.tableData.columns.splice(t.newIndex,0,n)}})},Z=()=>{e.id&&P("getFormById",{id:e.id}).then(a=>{var t;if(a.data.code===200){const n=a.data.data;e.dataTemp=n,E(L(n.formData)),n.tableData&&(e.tableData=L(n.tableData)),e.tableData.columns.forEach(i=>{e.checkboxGroup.push(i.label)}),(t=e.tableData.controlBtn)==null||t.forEach(i=>{e.controlBtnGroup.push(i.key||i.label)})}})},ee=a=>{e.attrObj=a,e.config=a.config||{};const t=e.config.tagList;if(e.tagList=[],t)for(const n in t)e.tagList.push({value:n,type:t[n]})},te=a=>{e.tagList.splice(a,1),D()},le=()=>{e.tagList.push({value:"",type:"default"})},D=()=>{const a={};e.tagList.forEach(t=>{a[t.value]=t.type}),Object.keys(a).length?e.config.tagList=a:delete e.config.tagList,Object.assign(e.attrObj,{config:e.config})};return me(()=>{z(()=>{Z(),Y()})}),ge(()=>{Object.keys(e.editor).length!==0&&(e.editor.destroy(),e.editor.container.remove())}),(a,t)=>{var G,U;const n=d("el-checkbox"),i=d("el-checkbox-group"),p=d("el-button"),B=d("el-tooltip"),ae=d("el-table-column"),oe=d("el-table"),k=d("el-option"),T=d("el-select"),v=d("el-form-item"),I=d("el-input"),A=d("el-tab-pane"),ne=d("QuestionFilled"),se=d("el-icon"),ue=d("el-tabs"),ce=d("el-form"),ie=d("el-drawer"),de=he("loading");return $((u(),r("div",Ve,[c("div",Le,[(G=e.filedList)!=null&&G.length?(u(),r(_,{key:0},[we,c("div",Oe,[o(i,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[0]||(t[0]=l=>e.checkboxGroup=l),size:"small"},{default:s(()=>[(u(!0),r(_,null,g(e.filedList,l=>(u(),f(n,{label:l.label,border:!0,key:l.prop,onChange:b=>O(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])])],64)):j("",!0),Te,c("div",Ie,[o(i,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[1]||(t[1]=l=>e.checkboxGroup=l),size:"small"},{default:s(()=>[(u(!0),r(_,null,g(e.otherFiled,l=>(u(),f(n,{label:l.label,border:!0,key:l.prop,onChange:b=>O(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),Ae,c("div",Ge,[o(i,{modelValue:e.controlBtnGroup,"onUpdate:modelValue":t[2]||(t[2]=l=>e.controlBtnGroup=l),size:"small"},{default:s(()=>[(u(!0),r(_,null,g(e.controlBtn,l=>(u(),f(n,{label:l.key,key:l.prop,onChange:b=>X(l)},{default:s(()=>[m(C(l.label),1)]),_:2},1032,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),c("div",Ue,[o(p,{size:"small",onClick:t[3]||(t[3]=l=>F("columns"))},{default:s(()=>[ze]),_:1})])]),c("div",$e,[o(Ee,{onClick:Q,type:"2"}),c("div",je,[Pe,c("div",Se,[(u(!0),r(_,null,g((U=e.tableData)==null?void 0:U.controlBtn,l=>(u(),f(p,x(l,{key:l.label}),{default:s(()=>[m(C(l.label),1)]),_:2},1040))),128))]),o(oe,x({data:e.dataList},e.tableData.tableProps,{ref:"tableEl"}),{default:s(()=>[(u(!0),r(_,null,g(e.tableData.columns,l=>(u(),f(ae,Be(x({key:l.prop||l.label},l)),ke({_:2},[l.help?{name:"header",fn:s(b=>[m(C(b.column.label)+" ",1),o(B,{placement:"top"},{content:s(()=>[c("span",{innerHTML:l.help},null,8,Me)]),default:s(()=>[qe]),_:2},1024)])}:void 0,l.type!=="index"?{name:"default",fn:s(()=>[l.type==="selection"?(u(),f(n,{key:0})):l.prop==="__control"?(u(),r("span",Ne,"\u7F16\u8F91 \u5220\u9664")):(u(),r("span",{key:2,onClick:De(b=>ee(l),["stop"])},"\u70B9\u51FB\u4E2A\u6027\u5316\u8BBE\u7F6E",8,Re))])}:void 0]),1040))),128))]),_:1},16,["data"])])]),c("div",Qe,[o(ce,{size:"small"},{default:s(()=>[o(ue,{modelValue:"first"},{default:s(()=>[o(A,{label:"\u5B57\u6BB5\u5C5E\u6027",name:"first"},{default:s(()=>[o(v,{label:"\u9009\u62E9\u8868\u5934\u5B57\u6BB5"},{default:s(()=>[o(T,{modelValue:e.selectCheck,"onUpdate:modelValue":t[4]||(t[4]=l=>e.selectCheck=l),onChange:W},{default:s(()=>[(u(!0),r(_,null,g(e.tableData.columns,l=>(u(),f(k,{key:l.prop,value:l.prop,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),$(c("div",null,[c("h3",null,C(e.attrObj.label)+"\u4E2A\u6027\u5316\u8BBE\u7F6E",1),o(v,{label:"\u503C\u5339\u914D\u5B57\u5178"},{default:s(()=>[o(I,{placeholder:"\u5B57\u5178\u5BF9\u5E94\u7684key",modelValue:e.config.dictKey,"onUpdate:modelValue":t[5]||(t[5]=l=>e.config.dictKey=l),onChange:D},null,8,["modelValue"])]),_:1}),(u(!0),r(_,null,g(e.tagList,(l,b)=>(u(),f(v,{key:b,class:"table-tag"},{default:s(()=>[o(I,{placeholder:"\u503C\u5BF9\u5E94\u7684\u7C7B\u578B",modelValue:l.value,"onUpdate:modelValue":y=>l.value=y,onChange:D},{append:s(()=>[o(T,{style:{width:"80px"},modelValue:l.type,"onUpdate:modelValue":y=>l.type=y,onChange:D},{default:s(()=>[o(k,{label:"default",value:"default"}),o(k,{label:"success",value:"success"}),o(k,{label:"info",value:"info"}),o(k,{label:"warning",value:"warning"}),o(k,{label:"danger",value:"danger"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),c("i",{class:"icon-del",onClick:y=>te(b)},null,8,He)]),_:2},1024))),128)),o(v,null,{default:s(()=>[o(p,{onClick:le},{default:s(()=>[Je]),_:1})]),_:1})],512),[[ve,Object.keys(e.attrObj).length]])]),_:1}),o(A,{label:"\u8868\u683C\u5C5E\u6027",name:"second"},{default:s(()=>[o(p,{onClick:t[6]||(t[6]=l=>F("tableConfig"))},{default:s(()=>[Ke]),_:1}),o(p,{onClick:t[7]||(t[7]=l=>F("dict"))},{default:s(()=>[We,o(B,{content:"\u8868\u683C\u5217\u8868\u6570\u636E\u5B57\u5178\uFF0C\u4E0D\u822C\u4E0D\u8BBE\u7F6E\uFF0C\u4ECE\u63A5\u53E3dict\u5339\u914D\u3002\u683C\u5F0F\uFF1A{0:'\u7537',1:'\u5973'}",placement:"top"},{default:s(()=>[o(se,null,{default:s(()=>[o(ne)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o(ie,{modelValue:e.visibleDialog,"onUpdate:modelValue":t[8]||(t[8]=l=>e.visibleDialog=l),size:"60%",direction:e.direction,"custom-class":"json-dialog","append-to-body":!0,"before-close":K},{default:s(()=>[e.visibleDialog?(u(),r("div",Xe)):j("",!0),c("div",Ye,[o(p,{type:"primary",size:"small",onClick:H},{default:s(()=>[Ze]),_:1})])]),_:1},8,["modelValue","direction"]),o(Fe,{ref_key:"vueFileEl",ref:w},null,512)])),[[de,e.loading]])}}});export{ot as default};
