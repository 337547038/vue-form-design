import{d as be,z as _e,s as fe,r as me,k as he,A as ge,i as De,q as P,N as ke,a as c,x as ye,n as S,o as s,c as r,h as d,m as q,F as b,b as o,w as u,e as h,f,p as L,l as m,t as C,U as T,L as Be,V as ve,W as Ee,v as Fe,O as M,P as Ce,y as w,E as x,j as N,X as xe,Y as Ve}from"./index.ca33bca9.js";import{_ as Ie,a as Le}from"./vueFile.vue_vue_type_script_setup_true_lang.3ff3dfd3.js";const Te={class:"design-container design-table"},we={class:"components-list"},Oe=d("div",{class:"title"},"\u53EF\u9009\u5B57\u6BB5",-1),Ae={class:"content"},Ue=d("div",{class:"title"},"\u5176\u4ED6\u5B57\u6BB5",-1),Ge={class:"content"},ze=d("div",{class:"title"},"\u64CD\u4F5C\u6309\u94AE",-1),$e={class:"content"},je={class:"title"},Pe=m("\u7F16\u8F91\u81EA\u5B9A\u4E49\u5B57\u6BB5 "),Se={class:"main-body"},qe={class:"main-form main-table"},Me=d("p",{style:{padding:"10px 0"}},"\u63D0\u793A\uFF1A\u70B9\u51FB\u8868\u5934\u53EF\u62D6\u52A8\u6539\u53D8\u987A\u5E8F",-1),Ne={class:"control-btn"},Re=["innerHTML"],He=d("i",{class:"icon-help"},null,-1),Ke={key:1},Qe=["onClick"],Je={class:"sidebar-tools"},We=["onClick"],Xe=m("\u65B0\u589ETag\u6807\u7B7E\u663E\u793A"),Ye=m("\u7F16\u8F91\u8868\u683C\u5C5E\u6027 "),Ze=m("\u8BBE\u7F6E\u5217\u8868\u5B57\u5178 "),et={key:0,id:"editJson"},tt={class:"dialog-footer"},lt=m(" \u786E\u5B9A "),ut=be({__name:"table",setup(at){const R=_e(),O=fe(),{proxy:H}=Ve(),A=me(),y=he(()=>O.query.type==="table"),e=ge({direction:"rtl",filedList:[],otherFiled:[{label:"\u52FE\u9009",prop:"__selection",type:"selection"},{label:"\u5E8F\u53F7",prop:"__index",type:"index"},{label:"\u64CD\u4F5C",prop:"__control"}],checkboxGroup:[],controlBtn:[{label:"\u65B0\u589E",key:"add",type:"primary",size:"small",hide:y.value},{label:"\u5220\u9664",key:"del",size:"small"}],controlBtnGroup:[],tableData:{tableProps:{},columns:[],controlBtn:[]},editor:{},visibleDialog:!1,loading:!1,id:O.query.id,selectCheck:"",editIndex:"",dataList:[{}],dataTemp:{},attrObj:{},tagList:[],config:{},name:"",formId:""}),K=["txt","title","table","component","upload"],V=a=>{a==null||a.list.forEach(t=>{var n;t.type==="grid"||t.type==="tabs"?t.columns.forEach(i=>{V(i)}):t.type==="card"?V(t):K.indexOf(t.type)===-1&&e.filedList.push({prop:t.name,label:(n=t.item)==null?void 0:n.label,help:t.config.help||""})})},Q=a=>{switch(a){case"del":e.tableData.columns=[],e.checkboxGroup=[];break;case"json":g(e.tableData);break;case"vue":A.value.openTable(e.tableData);break;case"import":g({});break;case"save":W();break}},U=a=>{e.checkboxGroup.indexOf(a.label)===-1?e.tableData.columns.forEach((n,i)=>{n.label===a.label&&n.prop===a.prop&&e.tableData.columns.splice(i,1)}):e.tableData.columns.push(a)},g=(a,t)=>{e.direction=t||"rtl",e.visibleDialog=!0;const n=M(a,!0);P(()=>{e.editor=Ce(n)})},J=()=>{try{const a=w(e.editor.getValue());e.editIndex==="columns"?e.tableData.columns=a:e.editIndex==="tableConfig"?e.tableData.tableProps=a:e.editIndex==="dict"?e.tableData.dict=a:e.editIndex!==""?e.tableData.columns[e.editIndex]=a:e.tableData=a,e.editIndex="",e.visibleDialog=!1}catch(a){x.error(a.message)}},W=()=>{const a=e.name||e.dataTemp.name;if(!a){x.error(y.value?"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0":"\u8BF7\u8F93\u5165\u8868\u5355\u540D\u79F0");return}e.loading=!0;const t={tableData:M(e.tableData),id:e.id,searchData:e.dataTemp.searchData,formData:e.dataTemp.formData,name:a,formId:e.formId||e.dataTemp.formId,type:e.dataTemp.type||2};N("saveForm",t).then(n=>{x({message:n.data||"\u4FDD\u5B58\u6210\u529F\uFF01",type:"success"}),R.push({path:"/designform/formlist"}),e.loading=!1}).catch(n=>{x.error(n.data||"\u4FDD\u5B58\u5F02\u5E38"),e.loading=!1})},X=a=>{e.editIndex="",a()},I=a=>{switch(e.editIndex=a,a){case"dict":g(e.tableData.config||{},"ltr");break;case"tableConfig":g(e.tableData.tableProps,"ltr");break;case"columns":g(e.tableData.columns);break}},Y=a=>{let t={};e.tableData.columns.forEach((n,i)=>{n.prop===a&&(t=n,e.editIndex=i)}),g(t)},Z=a=>{var i;let t=(i=e.tableData)==null?void 0:i.controlBtn,n=-1;t?t.forEach((p,v)=>{(p.key===a.key||p.label===a.label)&&(n=v)}):e.tableData.controlBtn=[],n!==-1?e.tableData.controlBtn.splice(n,1):e.tableData.controlBtn.push(a)},ee=()=>{const a=H.$el.querySelector(".el-table__header-wrapper tr");xe.create(a,{animation:180,delay:0,onEnd:t=>{const n=e.tableData.columns[t.oldIndex];e.tableData.columns.splice(t.oldIndex,1),e.tableData.columns.splice(t.newIndex,0,n)}})},te=()=>{e.id&&N("getFormById",{id:e.id}).then(a=>{var t;if(a.data.code===200){const n=a.data.data;e.dataTemp=n,V(w(n.formData)),n.tableData&&(e.tableData=w(n.tableData)),y.value&&(e.name=n.name,e.formId=n.formId),e.tableData.columns.forEach(i=>{e.checkboxGroup.push(i.label)}),(t=e.tableData.controlBtn)==null||t.forEach(i=>{e.controlBtnGroup.push(i.key||i.label)})}})},le=a=>{e.attrObj=a,e.config=a.config||{};const t=e.config.tagList;if(e.tagList=[],t)for(const n in t)e.tagList.push({value:n,type:t[n]})},ae=a=>{e.tagList.splice(a,1),B()},oe=()=>{e.tagList.push({value:"",type:"default"})},B=()=>{const a={};e.tagList.forEach(t=>{a[t.value]=t.type}),Object.keys(a).length?e.config.tagList=a:delete e.config.tagList,Object.assign(e.attrObj,{config:e.config})};return De(()=>{P(()=>{te(),ee()})}),ke(()=>{Object.keys(e.editor).length!==0&&(e.editor.destroy(),e.editor.container.remove())}),(a,t)=>{var $,j;const n=c("el-checkbox"),i=c("el-checkbox-group"),p=c("el-button"),v=c("el-tooltip"),ne=c("el-table-column"),ue=c("el-table"),D=c("el-option"),G=c("el-select"),k=c("el-form-item"),E=c("el-input"),z=c("el-tab-pane"),se=c("QuestionFilled"),de=c("el-icon"),ie=c("el-tabs"),ce=c("el-form"),re=c("el-drawer"),pe=ye("loading");return S((s(),r("div",Te,[d("div",we,[(($=e.filedList)==null?void 0:$.length)&&e.id&&!q(y)?(s(),r(b,{key:0},[Oe,d("div",Ae,[o(i,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[0]||(t[0]=l=>e.checkboxGroup=l),size:"small"},{default:u(()=>[(s(!0),r(b,null,h(e.filedList,l=>(s(),f(n,{label:l.label,key:l.prop,onChange:_=>U(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])])],64)):L("",!0),Ue,d("div",Ge,[o(i,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[1]||(t[1]=l=>e.checkboxGroup=l),size:"small"},{default:u(()=>[(s(!0),r(b,null,h(e.otherFiled,l=>(s(),f(n,{label:l.label,key:l.prop,onChange:_=>U(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),ze,d("div",$e,[o(i,{modelValue:e.controlBtnGroup,"onUpdate:modelValue":t[2]||(t[2]=l=>e.controlBtnGroup=l),size:"small"},{default:u(()=>[(s(!0),r(b,null,h(e.controlBtn.filter(l=>!l.hide),l=>(s(),f(n,{label:l.key,key:l.prop,onChange:_=>Z(l)},{default:u(()=>[m(C(l.label),1)]),_:2},1032,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),d("div",je,[o(p,{size:"small",onClick:t[3]||(t[3]=l=>I("columns"))},{default:u(()=>[Pe]),_:1})])]),d("div",Se,[o(Ie,{onClick:Q,type:"2"}),d("div",qe,[Me,d("div",Ne,[(s(!0),r(b,null,h((j=e.tableData)==null?void 0:j.controlBtn,l=>(s(),f(p,T(l,{key:l.label}),{default:u(()=>[m(C(l.label),1)]),_:2},1040))),128))]),o(ue,T({data:e.dataList},e.tableData.tableProps,{ref:"tableEl"}),{default:u(()=>[(s(!0),r(b,null,h(e.tableData.columns,l=>(s(),f(ne,Ee(T({key:l.prop||l.label},l)),Be({_:2},[l.help?{name:"header",fn:u(_=>[m(C(_.column.label)+" ",1),o(v,{placement:"top"},{content:u(()=>[d("span",{innerHTML:l.help},null,8,Re)]),default:u(()=>[He]),_:2},1024)])}:void 0,l.type!=="index"?{name:"default",fn:u(()=>[l.type==="selection"?(s(),f(n,{key:0})):l.prop==="__control"?(s(),r("span",Ke,"\u7F16\u8F91 \u5220\u9664")):(s(),r("span",{key:2,onClick:ve(_=>le(l),["stop"])},"\u70B9\u51FB\u4E2A\u6027\u5316\u8BBE\u7F6E",8,Qe))])}:void 0]),1040))),128))]),_:1},16,["data"])])]),d("div",Je,[o(ce,{size:"small"},{default:u(()=>[o(ie,{modelValue:"first"},{default:u(()=>[o(z,{label:"\u5B57\u6BB5\u5C5E\u6027",name:"first"},{default:u(()=>[o(k,{label:"\u9009\u62E9\u8868\u5934\u5B57\u6BB5"},{default:u(()=>[o(G,{modelValue:e.selectCheck,"onUpdate:modelValue":t[4]||(t[4]=l=>e.selectCheck=l),onChange:Y},{default:u(()=>[(s(!0),r(b,null,h(e.tableData.columns,l=>(s(),f(D,{key:l.prop,value:l.prop,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(d("div",null,[d("h3",null,C(e.attrObj.label)+"\u4E2A\u6027\u5316\u8BBE\u7F6E",1),o(k,{label:"\u503C\u5339\u914D\u5B57\u5178"},{default:u(()=>[o(E,{placeholder:"\u5B57\u5178\u5BF9\u5E94\u7684key",modelValue:e.config.dictKey,"onUpdate:modelValue":t[5]||(t[5]=l=>e.config.dictKey=l),onChange:B},null,8,["modelValue"])]),_:1}),(s(!0),r(b,null,h(e.tagList,(l,_)=>(s(),f(k,{key:_,class:"table-tag"},{default:u(()=>[o(E,{placeholder:"\u503C\u5BF9\u5E94\u7684\u7C7B\u578B",modelValue:l.value,"onUpdate:modelValue":F=>l.value=F,onChange:B},{append:u(()=>[o(G,{style:{width:"80px"},modelValue:l.type,"onUpdate:modelValue":F=>l.type=F,onChange:B},{default:u(()=>[o(D,{label:"default",value:"default"}),o(D,{label:"success",value:"success"}),o(D,{label:"info",value:"info"}),o(D,{label:"warning",value:"warning"}),o(D,{label:"danger",value:"danger"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),d("i",{class:"icon-del",onClick:F=>ae(_)},null,8,We)]),_:2},1024))),128)),o(k,null,{default:u(()=>[o(p,{onClick:oe},{default:u(()=>[Xe]),_:1})]),_:1})],512),[[Fe,Object.keys(e.attrObj).length]])]),_:1}),o(z,{label:"\u6570\u636E\u5217\u8868\u5C5E\u6027",name:"second"},{default:u(()=>[q(y)?(s(),r(b,{key:0},[o(k,{label:"\u6570\u636E\u5217\u8868\u540D\u79F0"},{default:u(()=>[o(E,{modelValue:e.name,"onUpdate:modelValue":t[6]||(t[6]=l=>e.name=l),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(k,{label:"\u6570\u636E\u6E90Id"},{default:u(()=>[o(E,{modelValue:e.formId,"onUpdate:modelValue":t[7]||(t[7]=l=>e.formId=l),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90Id"},null,8,["modelValue"])]),_:1})],64)):L("",!0),o(p,{onClick:t[8]||(t[8]=l=>I("tableConfig"))},{default:u(()=>[Ye]),_:1}),o(p,{onClick:t[9]||(t[9]=l=>I("dict"))},{default:u(()=>[Ze,o(v,{content:"\u8868\u683C\u5217\u8868\u6570\u636E\u5B57\u5178\uFF0C\u4E00\u822C\u4E0D\u8BBE\u7F6E\uFF0C\u4ECE\u63A5\u53E3dict\u5339\u914D\u3002\u683C\u5F0F\uFF1A{0:'\u7537',1:'\u5973'}",placement:"top"},{default:u(()=>[o(de,null,{default:u(()=>[o(se)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o(re,{modelValue:e.visibleDialog,"onUpdate:modelValue":t[10]||(t[10]=l=>e.visibleDialog=l),size:"60%",direction:e.direction,"custom-class":"json-dialog","append-to-body":!0,"before-close":X},{default:u(()=>[e.visibleDialog?(s(),r("div",et)):L("",!0),d("div",tt,[o(p,{type:"primary",size:"small",onClick:J},{default:u(()=>[lt]),_:1})])]),_:1},8,["modelValue","direction"]),o(Le,{ref_key:"vueFileEl",ref:A},null,512)])),[[pe,e.loading]])}}});export{ut as default};
