import{ae as Me,j as Ne,y as xe,d as K,l as Y,G as be,p as ie,o as f,c as T,t as ee,af as ue,h as D,L as ke,g as z,z as x,ac as de,n as te,S as Ie,O as oe,H as Fe,W as Re,r as pe,X as ne,F as fe,a as he,s as ge,v as me,f as S,i as se,w as ae,m as _e,b as X,a1 as J,e as Oe,a9 as Ee,ag as Ce,a0 as qe,D as Te,q as Ve,ah as ve,ai as Xe,C as ye,R as Ye,x as ze,Z as Be}from"./index-CCCDlvQG.js";const De=Me("screen",{state:()=>({controlAttr:{},activeId:"",screenConfig:Ne("screenConfig",!0)||{},controlTip:"",tempActiveId:[]}),actions:{setTempActiveId(t){if(typeof t=="string"&&t){const s=this.tempActiveId.indexOf(t);s!==-1?this.tempActiveId.splice(s,1):this.tempActiveId.push(t)}else this.tempActiveId=t},setControlTip(t){this.controlTip=t},setControlAttr(t){this.controlAttr=t},setScreenConfig(t,s){this.screenConfig[t]=s,xe("screenConfig",this.screenConfig,0)},getScreenConfig(t){return this.screenConfig[t]},setActiveId(t){this.activeId=t}}}),He=K({__name:"nowTime",props:{config:{}},setup(t){const s=t,a=Y(),o=Y(),d=()=>{const p=s.config.dateTime;!p||p&&p.indexOf("{i}")!==-1?a.value=setInterval(()=>{o.value=ue(new Date,p)},1e3):o.value=ue(new Date,p)};return be(()=>s.config.dateTime,()=>{clearInterval(a.value),d()},{immediate:!0}),ie(()=>{}),(p,i)=>(f(),T("div",null,ee(o.value),1))}}),Le=K({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(t){const s=t,a=D(()=>({width:s.width,height:s.height,overflow:"hidden"})),o=ke({left:0,top:0,duration:0}),d=D(()=>["left","right"].includes(s.direction)),p=D(()=>{const g=s.step>1?`transform ${o.duration}s`:"";return d.value?{display:"flex",width:parseInt(s.width)*2+"px",transform:`translateX(${o.left}px)`,transition:g}:{transform:`translateY(${o.top}px)`,transition:g}}),i=Y(),n=Y(),v=()=>{const g=i.value,F=n.value,A=()=>{const l=F.offsetWidth,c=F.offsetHeight;switch(s.direction){case"left":o.left+l<=0?(o.left=0,o.duration=0):(o.left=o.left-s.step,o.duration=.3);break;case"right":o.left>=0?(o.left=-l,o.duration=0):(o.left=o.left+s.step,o.duration=.3);break;case"bottom":o.top>=0?(o.top=-c,o.duration=0):(o.top=o.top+s.step,o.duration=.3);break;default:o.top+c<=0?(o.top=0,o.duration=0):(o.top=o.top-s.step,o.duration=.3)}};let $=setInterval(A,s.speed);g.onmouseenter=function(){clearInterval($)},g.onmouseleave=function(){$=setInterval(A,s.speed)}};return ie(()=>{v()}),(g,F)=>(f(),T("div",{ref_key:"container",ref:i,class:te([`marquess-${g.direction}`,"marquee-container"]),style:x(a.value)},[z("div",{style:x(p.value),class:"inner-container"},[z("div",{ref_key:"container1",ref:n,style:x({display:d.value?"flex":""})},[de(g.$slots,"default")],4),z("div",{style:x({display:d.value?"flex":""})},[de(g.$slots,"default")],4)],4)],6))}}),Pe=(t,s,a,o)=>(console.log(t,s,a,o),a),Se=t=>{try{return/^-?\d+(\.\d+)?$/.test(t.toString())}catch{return!1}},N=t=>{if(Number.isFinite(t))return Math.round(t);if(!t)return t;const s=t.match(/^(-?\d+(\.\d+)?)(px|em|rem|%|vh|vw)?$/);return s?Math.round(s[1]):0},V=t=>t===0||t==="0"?0:Se(t)?Math.round(t)+"px":t,G=t=>Se(t)?!0:t&&typeof t=="string"?t.indexOf("px")!==-1:!1,we=(t,s)=>{const a=t.bottom||t.bottom===0,o=t.right||t.right===0,d=!G(t.left),p=!G(t.top),i=!G(t.width),n=!G(t.height),v=a||o||p||i||n||d||p;return s&&v&&Ie.error("仅支持使用了left和top的px单位允许操作!"),v},je=t=>{const{type:s,config:a={},position:o={}}=t;return!(s==="div"||s==="group"||s==="tempRect"||a.lock||o.display)},Ue=["onMousedown"],We=["innerHTML"],Ge=["src"],Je={key:0},Ke=K({__name:"screen",props:{data:{default:()=>({})},type:{default:1},scale:{default:100}},emits:["changeEvent"],setup(t,{emit:s}){const a=t,o=s,d=De(),p=D(()=>d.activeId),i=ke({left:0,top:0,width:0,height:0,moveFlag:!1}),n=D(()=>a.data.config||{}),v=D(()=>Object.assign({},{width:"100%",height:"100%"},n.value.style||{})),g=D(()=>{let e={};return n.value.src&&(e={backgroundImage:`url(${n.value.src})`}),Object.assign(n.value.style||{},e)}),F=D(()=>{if(!a.data.position)return{};const{left:e,top:u,height:m,width:y,zIndex:k,display:w,right:b,bottom:h}=a.data.position,I=V(b),C=V(h);return{left:V(i.left)||(b?"":V(e)),right:I,bottom:C,top:V(i.top)||(h?"":V(u)),width:V(i.width||y),height:V(i.height||m),zIndex:k||1,display:w?"none":""}}),A=e=>e.toString().indexOf("%")!==-1?"100%":e,$=e=>{n.value.lock||(e.preventDefault(),e.stopPropagation())},l=(e,u)=>{if(a.data.type==="group")return;let m=!0;const y=e.pageX,k=e.pageY,{width:w,height:b,left:h,top:I}=a.data.position;if(we(a.data.position,!0))return;const C=N(w),M=N(b),L=N(h),P=N(I);document.onmousemove=ce=>{if(!m)return;const _=ce.pageX-y,O=ce.pageY-k;let E=C,q=M,U=L,W=P;switch(u){case 1:E=C-_,q=M-O,W=P+O,U=L+_;break;case 4:E=C-_,U=L+_;break;case 6:E=C-_,U=L+_,q=M+O;break;case 2:q=M-O,W=P+O;break;case 7:q=M+O;break;case 3:E=C+_,q=M-O,W=P+O;break;case 5:E=C+_;break;case 8:E=C+_,q=M+O;break}E<50||q<30||o("changeEvent",{type:"resize",width:E,height:q,left:U,top:W})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,m=!1},e.stopPropagation()},c=e=>{const{left:u,top:m}=a.data.position;i.moveFlag=!0;const y=e.pageX,k=e.pageY,w=N(u),b=N(m);let h=0,I=0;we(a.data.position,!0)?(console.log("不能拖动"),i.moveFlag=!1):(i.left=w,i.top=b),document.onmousemove=C=>{if(!i.moveFlag)return;const M=a.scale/100;h=N((C.pageX-y)/M),I=N((C.pageY-k)/M),i.left=N(h+w),i.top=N(I+b),o("changeEvent",{type:"moveTip",left:i.left,top:i.top})},document.onmouseup=function(){i.moveFlag&&(o("changeEvent",{type:"move",moveX:h,moveY:I,left:i.left,top:i.top}),i.left=0,i.top=0,i.moveFlag=!1,document.onmousemove=null)}},r=D(()=>{var u;const e=H.value||((u=a.data.option)==null?void 0:u.list);return n.value.carousel?[...e,...e]:e}),R=Y(),Z=()=>{if(!n.value.carousel||!R.value||a.data.type!=="table")return;const e=R.value.querySelector(".el-scrollbar__wrap");function u(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let m=setInterval(u,n.value.speed||30);R.value.onmouseenter=function(){clearInterval(m)},R.value.onmouseleave=function(){m=setInterval(u,n.value.speed||30)}},Q=be(()=>{var e;return(e=a.data.option)==null?void 0:e.list},()=>{Ve(()=>{Z()})},{immediate:!0}),re=D(()=>{switch(a.data.type){case"text":case"sText":return n.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return a.data.option}return""}),B=Y(),H=D(()=>n.value.optionsType===1&&B.value?B.value:!1),Ae=()=>{if(["image","background","border","clock"].includes(a.data.type))return;const{optionsType:e,requestUrl:u,method:m="post"}=n.value,{beforeFetch:y,afterFetch:k}=a.data.events||{};e===1&&u&&Ce({requestUrl:u,params:{},beforeFetch:y,options:{method:m}}).then(w=>{const b=w.data;typeof k=="function"?B.value=k(b,re.value):B.value=Pe(k,b,re.value)}).catch(w=>{console.log(w)})},j=e=>{if(!e)return e;const u=typeof e=="object"?qe(e):e;if(u.indexOf("{{")!==-1&&u.indexOf("}}")!==-1){const m=u.replace(/"{{.*?}}"/g,function(y){return y.slice(3,-3)}).replace(/{{.*?}}/g,function(y){return new Function("return "+y.slice(2,-2))()});return Te(m)}return e},le=oe("openRightMenu",null),$e=e=>{typeof le=="function"&&le({x:e.pageX,y:e.pageY,type:a.data.type,id:a.data.id}),e.preventDefault()};return Fe(()=>{Q()}),ie(()=>{Ae()}),Re(()=>{}),(e,u)=>{var k,w,b;const m=pe("el-table-column"),y=pe("el-table");return f(),T("div",{class:te([{["group-"+e.data.type]:!0,[(k=e.data.config)==null?void 0:k.class]:(w=e.data.config)==null?void 0:w.class},"group"]),style:x(F.value),onMousedown:$},[e.type===0&&!((b=e.data.config)!=null&&b.lock)?(f(),T("div",{key:0,class:"resize-box",onContextmenu:$e,onMousedown:ne(c,["left","stop"])},[(f(),T(fe,null,he(8,h=>ge(z("span",{key:h,class:te(`rs${h}`),onMousedown:ne(I=>l(I,h),["stop"])},null,42,Ue),[[me,p.value===e.data.id&&e.data.type!=="tempRect"]])),64)),ge(z("div",{class:"position"},ee(JSON.stringify(e.data.position)),513),[[me,p.value===e.data.id]])],32)):S("",!0),["text","border"].includes(e.data.type)?(f(),T("div",{key:1,style:x(v.value),innerHTML:j(H.value||n.value.text)},null,12,We)):S("",!0),e.data.type==="sText"?(f(),T("div",{key:2,style:x(v.value)},[se(Le,{direction:n.value.direction,height:`${e.data.position.height}px`,speed:n.value.speed,step:n.value.step,width:`${e.data.position.width}px`},{default:ae(()=>[_e(ee(j(H.value||n.value.text)),1)]),_:1},8,["direction","height","speed","step","width"])],4)):S("",!0),e.data.type==="image"?(f(),T("img",{key:3,src:n.value.src,style:x(v.value),alt:"请选择或上传图片",class:"default-img"},null,12,Ge)):S("",!0),e.data.type==="background"?(f(),T("div",{key:4,style:x(g.value),class:"default-bg"},[n.value.src?S("",!0):(f(),T("span",Je,"请选择或上传图片"))],4)):S("",!0),e.data.type==="table"?(f(),T("div",{key:5,ref_key:"tableEl",ref:R,class:"screen-table"},[se(y,J(n.value.props,{data:r.value,height:`${a.data.position.height}`,style:{width:"100%"}}),{default:ae(()=>{var h;return[(f(!0),T(fe,null,he((h=e.data.option)==null?void 0:h.columns,I=>(f(),X(m,J({ref_for:!0},I,{key:I.prop}),null,16))),128))]}),_:1},16,["data","height"])],512)):S("",!0),e.data.type==="clock"?(f(),X(He,{key:6,config:n.value,style:x(v.value)},null,8,["config","style"])):S("",!0),["component"].includes(e.data.type)?(f(),X(Oe(n.value.component),J({key:7},n.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):S("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(f(),X(Ee,{key:8,height:A(e.data.position.height),option:j(H.value||e.data.option),width:A(e.data.position.width)||"100%"},null,8,["height","option","width"])):S("",!0),["div","group"].includes(e.data.type)?(f(),X(Ze,{key:9,modelValue:e.data.list,"onUpdate:modelValue":u[0]||(u[0]=h=>e.data.list=h),"data-type":"div",pId:e.data.id},null,8,["modelValue","pId"])):S("",!0)],38)}}}),Ze=K({__name:"screenGroup",props:ve({pId:{}},{modelValue:{},modelModifiers:{}}),emits:ve(["itemClick"],["update:modelValue"]),setup(t,{emit:s}){const a=t,o=s,d=Xe(t,"modelValue"),p=oe("screenData")||{},i=oe("stateData")||{},n=De(),v=D(()=>{const{width:l}=p.value.config;return l}),g=l=>{var c;if(i.ctrlPress){if(a.pId)return;n.setTempActiveId(l.id),n.setActiveId(l.id),n.setControlAttr(l);const r=(c=n.tempActiveId)==null?void 0:c.length;n.setControlTip(`当前选中${r}个`),r>1&&(n.setActiveId("rect"),o("itemClick"))}else $(l),n.setControlTip("可使用键盘方向键调整位置")},F=(l,c)=>{c.type==="moveTip"&&n.setControlTip(`当前位置：${c.left}:${c.top}`),l.position.left=c.left,l.position.top=c.top,c.width&&(l.position.width=c.width),c.height&&(l.position.height=c.height),l.type==="tempRect"&&c.type==="move"&&d.value.forEach(r=>{n.tempActiveId.includes(r.id)&&(r.position.left=parseInt(r.position.left)+c.moveX,r.position.top=parseInt(r.position.top)+c.moveY)})},A=l=>{const c=l.newIndex,r=d.value[c];if((l.target&&l.target.getAttribute("data-type"))==="div"&&r.type==="div"){d.value.splice(c,1);return}delete r.label,delete r.icon;const{offsetX:Z,offsetY:Q}=l.originalEvent;r.position||(r.position={}),r.config||(r.config={}),r.id=r.type+new Date().getTime(),r.layerName=r.id,r.type==="div"&&(r.position.width=v.value),r.position.left=Z,r.position.top=Q,$(r)},$=l=>{n.setActiveId(l.id),n.setControlAttr(l)};return(l,c)=>(f(),X(ye(Ye),J({group:"screen",animation:200,handle:".none"},{list:d.value,class:"drag",itemKey:"id",name:"fade",ghostClass:"ghost",onAdd:A}),{item:ae(({element:r})=>[se(Ke,{data:r,scale:ye(i).scale,type:0,onChangeEvent:R=>F(r,R),onClick:ne(R=>g(r),["stop"])},null,8,["data","scale","onChangeEvent","onClick"])]),_:1},16,["list"]))}}),et=(t,s)=>new Promise((a,o)=>{if(!t)return o();ze("designById",{id:t}).then(d=>{var A;const p=d.data,i=Te(p.data);(A=i.config)!=null&&A.style&&Be("screenStyle",i.config.style,!0);const{requestUrl:n,beforeFetch:v,afterFetch:g,method:F}=i.config;n?Ce({requestUrl:n,beforeFetch:v,afterFetch:g,route:s,params:{},options:{method:F}}).then($=>{window.getScreenGlobal=$.data,a({screenData:i,globalData:$.data})}).catch(()=>{o({screenData:i})}):a({screenData:i})}).catch(d=>{console.log("catch",d),Ie.error(d.message||"加载异常"),o()})});export{Ze as _,je as a,Ke as b,we as c,et as g,N as r,De as u};
