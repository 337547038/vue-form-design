import{d as C,k as E,l as c,y as N,u as S,h as g,p as B,r as i,c as L,o as D,f as F,j as n,w as f,m as j,N as v,a0 as R,X as z,q as M,z as _}from"./index-BMqeUH7Y.js";const O={class:"design-flow-container"},P={class:"tools"},Q=C({__name:"index",setup(U){E().changeBreadcrumb([{label:"系统工具"},{label:"流程设计"}]);const m=c(),s=c(),d=N(),p=S(),r=c(d.query.tabs||"info"),k=c({list:[{type:"input",control:{modelValue:"",placeholder:"请输入流程名称"},config:{},name:"name",formItem:{label:"流程名称"},customRules:[{type:"required",message:"请输入流程名称",trigger:"blur"}]},{type:"select",control:{modelValue:""},options:[],config:{optionsType:1,optionsFun:"designList",method:"post",debug:!0,label:"name",value:"id",before:e=>(e.query={},e.query.type=1,e.query.status=1,e.query.category=2,e)},name:"source",formItem:{label:"流程表单",rules:[{required:!0,message:"请选择流程表单",trigger:"blur"}]}},{type:"switch",control:{modelValue:1,activeValue:1,inactiveValue:0},options:[],config:{optionsType:2},name:"status",formItem:{label:"状态"}},{type:"component",control:{modelValue:"",colorPicker:!0},config:{componentName:"DiyIconfont"},name:"icon",formItem:{label:"流程图标"}},{type:"select",control:{modelValue:""},options:[],config:{optionsType:2,optionsFun:"sys-flow"},name:"category",formItem:{label:"所在分组"}},{type:"select",control:{modelValue:""},options:[],config:{optionsType:1,optionsFun:"roleList",label:"name",value:"id"},name:"roleId",formItem:{label:"角色权限",hideLabel:!1}},{type:"textarea",control:{modelValue:""},config:{span:24},name:"remark",formItem:{label:"备注说明",hideLabel:!1}}],form:{class:"form-row-2",labelWidth:"110px",size:"default"},config:{}}),l=g(()=>d.query.id),b=g(()=>l.value?"edit":"add"),V=e=>{e.paneName},w=()=>{s.value.flowValidate(0)?m.value.submit():v.error("请为审批和抄送节点设置审批人")},h=(e,a)=>{var o,t;return a==="submit"&&(l.value&&(e.id=l.value),e.type=3,(o=s.value)!=null&&o.getValue&&(e.data=R((t=s.value)==null?void 0:t.getValue()))),e},q=(e,a,o)=>{if(o==="fetch")s.value.setValue(z(e.data));else if(o==="submit")r.value==="info"?(r.value="flow",l.value||(p.push({path:"/design/flow",query:{id:e,tabs:"flow"}}),M(()=>{y()}))):p.push({path:"/design/flow/list"});else if(o==="validate"&&r.value==="flow"){let t;try{for(const u in e)if(!t){t=e[u][0].message;break}v.error(t)}catch{}}return e},y=()=>{l.value&&m.value.getData({id:l.value})};return B(()=>{y()}),(e,a)=>{const o=i("el-button"),t=i("ak-form"),u=i("el-tab-pane"),I=i("ak-flow"),T=i("el-tabs");return D(),L("div",O,[F("div",P,[n(o,{type:"primary",onClick:w},{default:f(()=>a[1]||(a[1]=[j(" 保存 ")])),_:1})]),n(T,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=x=>r.value=x),class:"flow-tabs",onTabClick:V},{default:f(()=>[n(u,{label:"基础信息",name:"info",class:"tabs-info"},{default:f(()=>[n(t,{ref_key:"formEl",ref:m,data:k.value,"operate-type":b.value,"submit-url":b.value==="add"?"designSave":"designEdit","request-url":"designById",before:h,after:q},null,8,["data","operate-type","submit-url"])]),_:1}),n(u,{label:"审批流程",name:"flow"},{default:f(()=>[n(I,{ref_key:"flowEl",ref:s},null,512)]),_:1})]),_:1},8,["modelValue"])])}}});typeof _=="function"&&_(Q);export{Q as default};
