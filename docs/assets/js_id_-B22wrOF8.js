import{A as I,d as N,l as _,G as w,h as x,y as A,C as M,B as S,p as W,s as $,W as G,o as y,c as P,b as L,e as T,w as X,j as Y,r as C,N as m,X as k,Y as j,q as B,u as z}from"./index-CbbnYBXf.js";const H=(p,c,b={})=>new Promise((l,f)=>{const a=Object.assign({},b,{responseType:"blob"});I(p,c,a).then(r=>{const{data:d,headers:g}=r,v=decodeURI(g["content-disposition"].split(";")[1].split("=")[1])||`${p.substr(1).replace(/\//g,"_")}_${new Date().getTime()}.xls`,u=window.URL.createObjectURL(new Blob([d],{type:d.type})),t=document.createElement("a");t.style.display="none",t.href=u,t.setAttribute("download",v),document.body.appendChild(t),t.click(),document.body.removeChild(t),l(r)}).catch(r=>{f(r)})}),K=N({__name:"[id]",setup(p){const c=A(),b=z(),l=_(),f=_(!0),a=w({searchData:[],tableData:[],dict:{},visible:!0,source:""}),r=x(()=>c.params.id),d=()=>{if(a.tableData=[],l.value.resetList(),!r.value)return m.error("非法操作..."),!1;const e={id:r.value};I("designById",e).then(s=>{const o=s.data;o&&Object.keys(o).length&&(a.searchData=k(o.data),a.tableData=k(o.listData),a.dict=j(o.dict),a.source=o.source,B(()=>{l.value.getListData(),f.value=!1}),E())})};M(()=>{g()});const g=S(()=>c.params.id,()=>{d()},{}),v=(e,s)=>{var o,n;if(s==="fetch"){e.extend.formId=a.source;const i=(o=a.tableData.events)==null?void 0:o.before;if(typeof i=="function")return i(e,c)}else if(s==="del"){e.formId=a.source;const i=(n=a.tableData.events)==null?void 0:n.before;if(typeof i=="function")return i(e,c)}else s==="submit"&&(e.formId=a.source);return e},u=_(),t=w({visible:!1,title:"",formType:"add",formData:{},width:"",dict:{},editId:""}),h=x(()=>{var e;return a.source&&((e=a.tableData.config)==null?void 0:e.openType)==="dialog"}),E=()=>{var e;h.value&&(t.width=(e=a.tableData.config)==null?void 0:e.dialogWidth,I("designById",{id:a.source}).then(s=>{const o=s.data;o&&Object.keys(o).length&&(t.formData=k(o.data),t.dict=j(o.dict))}).catch(s=>{m.error(s.message||"非法操作.")}))},F=(e,s)=>{var o;if(e==="export"){const n=Object.assign({},l.value.getSearchFormValue(),{listId:r.value});H("importExcel",n).then(()=>{m.success("正在导出..")}).catch(i=>{m.error(i.message)})}else(e==="add"||e==="edit")&&(h.value?(t.visible=!0,t.title=e==="add"?"新增":"编辑",t.formType=e,t.editId=s&&s.id,e==="add"&&((o=t.formData.config)!=null&&o.addLoad)&&B(()=>{u.value.getData()}),e==="edit"&&B(()=>{u.value.getData()})):b.push({path:"/design/form/form/",query:{form:a.source,id:s==null?void 0:s.id}}))},R=(e,s,o)=>{var n;if(o==="submit"){s&&(D(),l.value.getListData());const i=(n=t.formData.events)==null?void 0:n.after;if(typeof i=="function")return i(o)}},O=e=>{(e==="reset"||e==="cancel")&&D()},q=e=>{D(),e&&e()},D=()=>{t.visible=!1,t.editId=""};return W(()=>{d()}),(e,s)=>{const o=C("ak-list"),n=C("ak-form"),i=C("el-dialog"),V=G("loading");return $((y(),P("div",null,[a.visible?(y(),L(o,{key:0,ref_key:"listEl",ref:l,"search-data":a.searchData,data:a.tableData,dict:a.dict,"api-key":{list:"getContentList",del:"delFormContent",export:"exportContent",edit:"editFormContent"},before:v,"auto-load":!1,onBtnClick:F},null,8,["search-data","data","dict"])):T("",!0),h.value?(y(),L(i,{key:1,modelValue:t.visible,"onUpdate:modelValue":s[0]||(s[0]=U=>t.visible=U),"destroy-on-close":"",title:t.title,width:t.width||"600px","before-close":q},{default:X(()=>[Y(n,{ref_key:"formEl",ref:u,data:t.formData,dict:t.dict,"operate-type":t.formType,"request-url":"getFormContent","submit-url":t.formType==="add"?"saveFormContent":"editFormContent",after:R,params:{formId:a.source},query:{formId:a.source,id:t.editId},onBtnClick:O},null,8,["data","dict","operate-type","submit-url","params","query"])]),_:1},8,["modelValue","title","width"])):T("",!0)])),[[V,f.value]])}}});export{K as default};
