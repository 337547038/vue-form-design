import{d as fe,z as me,s as ge,r as he,k as Be,A as ke,i as Ee,q as P,N as De,a as c,x as Fe,n as S,o as s,c as r,h as i,m as q,F as b,b as n,w as u,e as g,f,p as L,l as m,t as C,W as O,L as ye,X as ve,Y as Ce,v as xe,Q as M,P as N,R as Ve,y as T,O as R,E as x,j as Q,Z as Ie,$ as Le}from"./index.c5c10742.js";import{_ as Oe,a as Te}from"./vueFile.vue_vue_type_script_setup_true_lang.9d62c0f6.js";const we={class:"design-container design-table"},Ae={class:"components-list"},Ue=i("div",{class:"title"},"\u53EF\u9009\u5B57\u6BB5",-1),Ge={class:"content"},$e=i("div",{class:"title"},"\u5176\u4ED6\u5B57\u6BB5",-1),je={class:"content"},ze=i("div",{class:"title"},"\u64CD\u4F5C\u6309\u94AE",-1),Pe={class:"content"},Se={class:"title"},qe=m("\u7F16\u8F91\u81EA\u5B9A\u4E49\u5B57\u6BB5 "),Me={class:"main-body"},Ne={class:"main-form main-table"},Re=i("p",{style:{padding:"10px 0"}},"\u63D0\u793A\uFF1A\u70B9\u51FB\u8868\u5934\u53EF\u62D6\u52A8\u6539\u53D8\u987A\u5E8F",-1),Qe={class:"control-btn"},He=["innerHTML"],Ke=i("i",{class:"icon-help"},null,-1),Je={key:1},We=["onClick"],Xe={class:"sidebar-tools"},Ye=["onClick"],Ze=m("\u65B0\u589ETag\u6807\u7B7E\u663E\u793A"),et=m("\u7F16\u8F91\u8868\u683C\u5C5E\u6027 "),tt=m("\u8BBE\u7F6E\u6570\u636E\u5B57\u5178 "),lt={key:0,id:"editJson"},at={class:"dialog-footer"},ot=m(" \u786E\u5B9A "),dt=fe({__name:"table",setup(nt){const H=me(),w=ge(),{proxy:K}=Le(),A=he(),k=Be(()=>w.query.type==="table"),e=ke({direction:"rtl",filedList:[],otherFiled:[{label:"\u52FE\u9009",prop:"__selection",type:"selection"},{label:"\u5E8F\u53F7",prop:"__index",type:"index"},{label:"\u64CD\u4F5C",prop:"__control"}],checkboxGroup:[],controlBtn:[{label:"\u65B0\u589E",key:"add",type:"primary",size:"small",hide:k.value},{label:"\u5220\u9664",key:"del",size:"small"}],controlBtnGroup:[],tableData:{tableProps:{},columns:[],controlBtn:[]},editor:{},visibleDialog:!1,loading:!1,id:w.query.id,selectCheck:"",editIndex:"",dataList:[{}],dataTemp:{},attrObj:{},tagList:[],config:{},name:"",formId:"",dict:{}}),J=["txt","title","table","component","upload"],V=a=>{a==null||a.list.forEach(t=>{var o;t.type==="grid"||t.type==="tabs"?t.columns.forEach(d=>{V(d)}):t.type==="card"?V(t):J.indexOf(t.type)===-1&&e.filedList.push({prop:t.name,label:(o=t.item)==null?void 0:o.label,help:t.config.help||""})})},W=a=>{switch(a){case"del":e.tableData.columns=[],e.checkboxGroup=[];break;case"json":E(e.tableData);break;case"vue":A.value.openTable(e.tableData);break;case"save":Y();break}},U=a=>{e.checkboxGroup.indexOf(a.label)===-1?e.tableData.columns.forEach((o,d)=>{o.label===a.label&&o.prop===a.prop&&e.tableData.columns.splice(d,1)}):e.tableData.columns.push(a)},E=(a,t,o)=>{e.direction=t||"rtl",e.visibleDialog=!0;const d=o==="dict"?M(a,!0):N(a,!0);P(()=>{e.editor=Ve(d)})},X=()=>{try{const a=T(e.editor.getValue());switch(e.editIndex){case"columns":e.tableData.columns=a;break;case"tableConfig":e.tableData.tableProps=a;break;case"dict":e.dict=R(e.editor.getValue());break}e.editIndex!==""?e.tableData.columns[e.editIndex]=a:e.tableData=a,e.editIndex="",e.visibleDialog=!1}catch(a){x.error(a.message)}},Y=()=>{const a=e.name||e.dataTemp.name;if(!a){x.error(k.value?"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0":"\u8BF7\u8F93\u5165\u8868\u5355\u540D\u79F0");return}e.loading=!0;const t=Object.assign(e.dataTemp,{tableData:N(e.tableData),id:e.id,name:a,formId:e.formId||e.dataTemp.formId,type:e.dataTemp.type||2,dict:M(e.dict)});Q("saveForm",t).then(o=>{x({message:o.data||"\u4FDD\u5B58\u6210\u529F\uFF01",type:"success"}),H.push({path:"/designform/formlist"}),e.loading=!1}).catch(o=>{x.error(o.data||"\u4FDD\u5B58\u5F02\u5E38"),e.loading=!1})},Z=a=>{e.editIndex="",a()},I=a=>{switch(e.editIndex=a,a){case"dict":E(e.dict||{},"ltr",a);break;case"tableConfig":E(e.tableData.tableProps,"ltr");break;case"columns":E(e.tableData.columns);break}},ee=a=>{let t={};e.tableData.columns.forEach((o,d)=>{o.prop===a&&(t=o,e.editIndex=d)}),E(t)},te=a=>{var d;let t=(d=e.tableData)==null?void 0:d.controlBtn,o=-1;t?t.forEach((p,F)=>{(p.key===a.key||p.label===a.label)&&(o=F)}):e.tableData.controlBtn=[],o!==-1?e.tableData.controlBtn.splice(o,1):e.tableData.controlBtn.push(a)},le=()=>{const a=K.$el.querySelector(".el-table__header-wrapper tr");Ie.create(a,{animation:180,delay:0,onEnd:t=>{const o=e.tableData.columns[t.oldIndex];e.tableData.columns.splice(t.oldIndex,1),e.tableData.columns.splice(t.newIndex,0,o)}})},ae=()=>{e.id&&Q("getFormById",{id:e.id}).then(a=>{var t;if(a.data.code===200){const o=a.data.data;e.dataTemp=o,V(T(o.formData)),o.tableData&&(e.tableData=T(o.tableData)),k.value&&(e.name=o.name,e.formId=o.formId),e.tableData.columns.forEach(d=>{e.checkboxGroup.push(d.label)}),(t=e.tableData.controlBtn)==null||t.forEach(d=>{e.controlBtnGroup.push(d.key||d.label)}),e.dict=R(o.dict)}})},oe=a=>{e.attrObj=a,e.config=a.config||{};const t=e.config.tagList;if(e.tagList=[],t)for(const o in t)e.tagList.push({value:o,type:t[o]})},ne=a=>{e.tagList.splice(a,1),D()},ue=()=>{e.tagList.push({value:"",type:"default"})},D=()=>{const a={};e.tagList.forEach(t=>{a[t.value]=t.type}),Object.keys(a).length?e.config.tagList=a:delete e.config.tagList,Object.assign(e.attrObj,{config:e.config})};return Ee(()=>{P(()=>{ae(),le()})}),De(()=>{Object.keys(e.editor).length!==0&&(e.editor.destroy(),e.editor.container.remove())}),(a,t)=>{var j,z;const o=c("el-checkbox"),d=c("el-checkbox-group"),p=c("el-button"),F=c("el-tooltip"),se=c("el-table-column"),de=c("el-table"),h=c("el-option"),G=c("el-select"),B=c("el-form-item"),y=c("el-input"),$=c("el-tab-pane"),ie=c("QuestionFilled"),ce=c("el-icon"),re=c("el-tabs"),pe=c("el-form"),be=c("el-drawer"),_e=Fe("loading");return S((s(),r("div",we,[i("div",Ae,[((j=e.filedList)==null?void 0:j.length)&&e.id&&!q(k)?(s(),r(b,{key:0},[Ue,i("div",Ge,[n(d,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[0]||(t[0]=l=>e.checkboxGroup=l),size:"small"},{default:u(()=>[(s(!0),r(b,null,g(e.filedList,l=>(s(),f(o,{label:l.label,key:l.prop,onChange:_=>U(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])])],64)):L("",!0),$e,i("div",je,[n(d,{modelValue:e.checkboxGroup,"onUpdate:modelValue":t[1]||(t[1]=l=>e.checkboxGroup=l),size:"small"},{default:u(()=>[(s(!0),r(b,null,g(e.otherFiled,l=>(s(),f(o,{label:l.label,key:l.prop,onChange:_=>U(l)},null,8,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),ze,i("div",Pe,[n(d,{modelValue:e.controlBtnGroup,"onUpdate:modelValue":t[2]||(t[2]=l=>e.controlBtnGroup=l),size:"small"},{default:u(()=>[(s(!0),r(b,null,g(e.controlBtn.filter(l=>!l.hide),l=>(s(),f(o,{label:l.key,key:l.prop,onChange:_=>te(l)},{default:u(()=>[m(C(l.label),1)]),_:2},1032,["label","onChange"]))),128))]),_:1},8,["modelValue"])]),i("div",Se,[n(p,{size:"small",onClick:t[3]||(t[3]=l=>I("columns"))},{default:u(()=>[qe]),_:1})])]),i("div",Me,[n(Oe,{onClick:W,type:"2"}),i("div",Ne,[Re,i("div",Qe,[(s(!0),r(b,null,g((z=e.tableData)==null?void 0:z.controlBtn,l=>(s(),f(p,O(l,{key:l.label}),{default:u(()=>[m(C(l.label),1)]),_:2},1040))),128))]),n(de,O({data:e.dataList},e.tableData.tableProps,{ref:"tableEl"}),{default:u(()=>[(s(!0),r(b,null,g(e.tableData.columns,l=>(s(),f(se,Ce(O({key:l.prop||l.label},l)),ye({_:2},[l.help?{name:"header",fn:u(_=>[m(C(_.column.label)+" ",1),n(F,{placement:"top"},{content:u(()=>[i("span",{innerHTML:l.help},null,8,He)]),default:u(()=>[Ke]),_:2},1024)])}:void 0,l.type!=="index"?{name:"default",fn:u(()=>[l.type==="selection"?(s(),f(o,{key:0})):l.prop==="__control"?(s(),r("span",Je,"\u7F16\u8F91 \u5220\u9664")):(s(),r("span",{key:2,onClick:ve(_=>oe(l),["stop"])},"\u70B9\u51FB\u4E2A\u6027\u5316\u8BBE\u7F6E",8,We))])}:void 0]),1040))),128))]),_:1},16,["data"])])]),i("div",Xe,[n(pe,{size:"small"},{default:u(()=>[n(re,{modelValue:"first"},{default:u(()=>[n($,{label:"\u5B57\u6BB5\u5C5E\u6027",name:"first"},{default:u(()=>[n(B,{label:"\u9009\u62E9\u8868\u5934\u5B57\u6BB5"},{default:u(()=>[n(G,{modelValue:e.selectCheck,"onUpdate:modelValue":t[4]||(t[4]=l=>e.selectCheck=l),onChange:ee},{default:u(()=>[(s(!0),r(b,null,g(e.tableData.columns,l=>(s(),f(h,{key:l.prop,value:l.prop,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(i("div",null,[i("h3",null,C(e.attrObj.label)+"\u4E2A\u6027\u5316\u8BBE\u7F6E",1),n(B,{label:"\u503C\u5339\u914D\u5B57\u5178"},{default:u(()=>[n(y,{placeholder:"\u5B57\u5178\u5BF9\u5E94\u7684key",modelValue:e.config.dictKey,"onUpdate:modelValue":t[5]||(t[5]=l=>e.config.dictKey=l),onChange:D},null,8,["modelValue"])]),_:1}),(s(!0),r(b,null,g(e.tagList,(l,_)=>(s(),f(B,{key:_,class:"table-tag"},{default:u(()=>[n(y,{placeholder:"\u503C\u5BF9\u5E94\u7684\u7C7B\u578B",modelValue:l.value,"onUpdate:modelValue":v=>l.value=v,onChange:D},{append:u(()=>[n(G,{style:{width:"80px"},modelValue:l.type,"onUpdate:modelValue":v=>l.type=v,onChange:D},{default:u(()=>[n(h,{label:"default",value:"default"}),n(h,{label:"success",value:"success"}),n(h,{label:"info",value:"info"}),n(h,{label:"warning",value:"warning"}),n(h,{label:"danger",value:"danger"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),i("i",{class:"icon-del",onClick:v=>ne(_)},null,8,Ye)]),_:2},1024))),128)),n(B,null,{default:u(()=>[n(p,{onClick:ue},{default:u(()=>[Ze]),_:1})]),_:1})],512),[[xe,Object.keys(e.attrObj).length]])]),_:1}),n($,{label:"\u6570\u636E\u5217\u8868\u5C5E\u6027",name:"second"},{default:u(()=>[q(k)?(s(),r(b,{key:0},[n(B,{label:"\u6570\u636E\u5217\u8868\u540D\u79F0"},{default:u(()=>[n(y,{modelValue:e.name,"onUpdate:modelValue":t[6]||(t[6]=l=>e.name=l),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5217\u8868\u540D\u79F0"},null,8,["modelValue"])]),_:1}),n(B,{label:"\u6570\u636E\u6E90Id"},{default:u(()=>[n(y,{modelValue:e.formId,"onUpdate:modelValue":t[7]||(t[7]=l=>e.formId=l),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90Id"},null,8,["modelValue"])]),_:1})],64)):L("",!0),n(p,{onClick:t[8]||(t[8]=l=>I("tableConfig"))},{default:u(()=>[et]),_:1}),n(p,{onClick:t[9]||(t[9]=l=>I("dict"))},{default:u(()=>[tt,n(F,{content:"\u6570\u636E\u5B57\u5178\uFF0C\u7528\u4E8E\u5339\u914D\u591A\u9009\u7EC4\u3001\u4E0B\u62C9\u9009\u62E9\u7B49\uFF0C\u63D0\u4F9B\u52A8\u6001\u83B7\u53D6Options\u63A5\u53E3\u5B57\u5178\u6570\u636E\uFF0C\u4E00\u822C\u4E0D\u8BBE\u7F6E\uFF0C\u4ECE\u63A5\u53E3dict\u83B7\u53D6\u3002\u683C\u5F0F\uFF1A{0:'\u7537',1:'\u5973'}",placement:"top"},{default:u(()=>[n(ce,null,{default:u(()=>[n(ie)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),n(be,{modelValue:e.visibleDialog,"onUpdate:modelValue":t[10]||(t[10]=l=>e.visibleDialog=l),size:"60%",direction:e.direction,"custom-class":"json-dialog","append-to-body":!0,"before-close":Z},{default:u(()=>[e.visibleDialog?(s(),r("div",lt)):L("",!0),i("div",at,[n(p,{type:"primary",size:"small",onClick:X},{default:u(()=>[ot]),_:1})])]),_:1},8,["modelValue","direction"]),n(Te,{ref_key:"vueFileEl",ref:A},null,512)])),[[_e,e.loading]])}}});export{dt as default};
