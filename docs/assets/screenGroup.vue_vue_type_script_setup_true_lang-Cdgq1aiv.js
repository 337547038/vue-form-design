import{aj as Me,j as Ne,y as xe,x as _e,D as we,Z as Oe,P as be,ak as ke,d as K,l as Y,G as Ie,p as ie,o as f,c as C,t as ee,al as ce,h as T,L as Ce,g as z,z as M,af as ue,n as te,O as oe,H as Ee,W as Re,r as pe,X as ne,F as de,a as fe,s as ge,v as he,f as D,i as se,w as ae,m as qe,b as X,a3 as G,e as Fe,ac as Ve,a0 as Xe,q as Ye,a1 as me,a2 as ze,C as ve,Q as Be}from"./index-CDYjrzCG.js";const Te=Me("screen",{state:()=>({controlAttr:{},activeId:"",screenConfig:Ne("screenConfig",!0)||{},controlTip:"",tempActiveId:[]}),actions:{setTempActiveId(t){if(typeof t=="string"&&t){const s=this.tempActiveId.indexOf(t);s!==-1?this.tempActiveId.splice(s,1):this.tempActiveId.push(t)}else this.tempActiveId=t},setControlTip(t){this.controlTip=t},setControlAttr(t){this.controlAttr=t},setScreenConfig(t,s){this.screenConfig[t]=s,xe("screenConfig",this.screenConfig,0)},getScreenConfig(t){return this.screenConfig[t]},setActiveId(t){this.activeId=t}}}),je=(t,s)=>new Promise((i,o)=>{if(!t)return o();_e("designById",{id:t}).then(u=>{var n;const d=u.data,a=we(d.data);(n=a.config)!=null&&n.style&&Oe("screenStyle",a.config.style,!0),He(a.config,s).then(),i(a)}).catch(u=>{console.log("catch",u),be.error(u.message||"加载异常"),o()})}),He=(t,s)=>new Promise((i,o)=>{const{requestUrl:u,before:d,after:a,method:n}=t;u&&ke({apiKey:u,before:d,after:a,route:s,params:{},options:{method:n},type:"get"}).then(h=>{window.getScreenGlobal=h.data,i(h.data)}).catch(h=>{o(h)})}),Pe=K({__name:"nowTime",props:{config:{}},setup(t){const s=t,i=Y(),o=Y(),u=()=>{const d=s.config.dateTime;!d||d&&d.indexOf("{i}")!==-1?i.value=setInterval(()=>{o.value=ce(new Date,d)},1e3):o.value=ce(new Date,d)};return Ie(()=>s.config.dateTime,()=>{clearInterval(i.value),u()},{immediate:!0}),ie(()=>{}),(d,a)=>(f(),C("div",null,ee(o.value),1))}}),Le=K({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(t){const s=t,i=T(()=>({width:s.width,height:s.height,overflow:"hidden"})),o=Ce({left:0,top:0,duration:0}),u=T(()=>["left","right"].includes(s.direction)),d=T(()=>{const v=s.step>1?`transform ${o.duration}s`:"";return u.value?{display:"flex",width:parseInt(s.width)*2+"px",transform:`translateX(${o.left}px)`,transition:v}:{transform:`translateY(${o.top}px)`,transition:v}}),a=Y(),n=Y(),h=()=>{const v=a.value,q=n.value,F=()=>{const l=q.offsetWidth,c=q.offsetHeight;switch(s.direction){case"left":o.left+l<=0?(o.left=0,o.duration=0):(o.left=o.left-s.step,o.duration=.3);break;case"right":o.left>=0?(o.left=-l,o.duration=0):(o.left=o.left+s.step,o.duration=.3);break;case"bottom":o.top>=0?(o.top=-c,o.duration=0):(o.top=o.top+s.step,o.duration=.3);break;default:o.top+c<=0?(o.top=0,o.duration=0):(o.top=o.top-s.step,o.duration=.3)}};let V=setInterval(F,s.speed);v.onmouseenter=function(){clearInterval(V)},v.onmouseleave=function(){V=setInterval(F,s.speed)}};return ie(()=>{h()}),(v,q)=>(f(),C("div",{ref_key:"container",ref:a,class:te([`marquess-${v.direction}`,"marquee-container"]),style:M(i.value)},[z("div",{style:M(d.value),class:"inner-container"},[z("div",{ref_key:"container1",ref:n,style:M({display:u.value?"flex":""})},[ue(v.$slots,"default")],4),z("div",{style:M({display:u.value?"flex":""})},[ue(v.$slots,"default")],4)],4)],6))}}),Se=t=>{try{return/^-?\d+(\.\d+)?$/.test(t.toString())}catch{return!1}},$=t=>{if(Number.isFinite(t))return Math.round(t);if(!t)return t;const s=t.match(/^(-?\d+(\.\d+)?)(px|em|rem|%|vh|vw)?$/);return s?Math.round(s[1]):0},R=t=>t===0||t==="0"?0:Se(t)?Math.round(t)+"px":t,W=t=>Se(t)?!0:t&&typeof t=="string"?t.indexOf("px")!==-1:!1,ye=(t,s)=>{const i=t.bottom||t.bottom===0,o=t.right||t.right===0,u=!W(t.left),d=!W(t.top),a=!W(t.width),n=!W(t.height),h=i||o||d||a||n||u||d;return s&&h&&be.error("仅支持使用了left和top的px单位允许操作!"),h},et=t=>{const{type:s,config:i={},position:o={}}=t;return!(s==="div"||s==="group"||s==="tempRect"||i.lock||o.display)},Ue=["onMousedown"],We=["innerHTML"],Ge=["src"],Ke={key:0},Je=K({__name:"screen",props:{data:{default:()=>({})},type:{default:1},scale:{default:100}},emits:["changeEvent"],setup(t,{emit:s}){const i=t,o=s,u=Te(),d=T(()=>u.activeId),a=Ce({left:0,top:0,width:0,height:0,moveFlag:!1}),n=T(()=>i.data.config||{}),h=T(()=>Object.assign({},{width:"100%",height:"100%"},n.value.style||{})),v=T(()=>{let e={};return n.value.src&&(e={backgroundImage:`url(${n.value.src})`}),Object.assign(n.value.style||{},e)}),q=T(()=>{if(!i.data.position)return{};const{left:e,top:p,height:m,width:y,zIndex:S,display:w,right:b,bottom:g}=i.data.position,k=R(b),I=R(g);return{left:R(a.left)||(b?"":R(e)),right:k,bottom:I,top:R(a.top)||(g?"":R(p)),width:R(a.width||y),height:R(a.height||m),zIndex:S||1,display:w?"none":""}}),F=e=>e.toString().indexOf("%")!==-1?"100%":e,V=e=>{n.value.lock||(e.preventDefault(),e.stopPropagation())},l=(e,p)=>{if(i.data.type==="group")return;let m=!0;const y=e.pageX,S=e.pageY,{width:w,height:b,left:g,top:k}=i.data.position;if(ye(i.data.position,!0))return;const I=$(w),A=$(b),H=$(g),P=$(k);document.onmousemove=le=>{if(!m)return;const x=le.pageX-y,_=le.pageY-S;let O=I,E=A,L=H,U=P;switch(p){case 1:O=I-x,E=A-_,U=P+_,L=H+x;break;case 4:O=I-x,L=H+x;break;case 6:O=I-x,L=H+x,E=A+_;break;case 2:E=A-_,U=P+_;break;case 7:E=A+_;break;case 3:O=I+x,E=A-_,U=P+_;break;case 5:O=I+x;break;case 8:O=I+x,E=A+_;break}O<50||E<30||o("changeEvent",{type:"resize",width:O,height:E,left:L,top:U})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,m=!1},e.stopPropagation()},c=e=>{const{left:p,top:m}=i.data.position;a.moveFlag=!0;const y=e.pageX,S=e.pageY,w=$(p),b=$(m);let g=0,k=0;ye(i.data.position,!0)?(console.log("不能拖动"),a.moveFlag=!1):(a.left=w,a.top=b),document.onmousemove=I=>{if(!a.moveFlag)return;const A=i.scale/100;g=$((I.pageX-y)/A),k=$((I.pageY-S)/A),a.left=$(g+w),a.top=$(k+b),o("changeEvent",{type:"moveTip",left:a.left,top:a.top})},document.onmouseup=function(){a.moveFlag&&(o("changeEvent",{type:"move",moveX:g,moveY:k,left:a.left,top:a.top}),a.left=0,a.top=0,a.moveFlag=!1,document.onmousemove=null)}},r=T(()=>{var p;const e=B.value||((p=i.data.option)==null?void 0:p.list);return n.value.carousel?[...e,...e]:e}),N=Y(),J=()=>{if(!n.value.carousel||!N.value||i.data.type!=="table")return;const e=N.value.querySelector(".el-scrollbar__wrap");function p(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let m=setInterval(p,n.value.speed||30);N.value.onmouseenter=function(){clearInterval(m)},N.value.onmouseleave=function(){m=setInterval(p,n.value.speed||30)}},Q=Ie(()=>{var e;return(e=i.data.option)==null?void 0:e.list},()=>{Ye(()=>{J()})},{immediate:!0}),De=T(()=>{switch(i.data.type){case"text":case"sText":return n.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return i.data.option}return""}),Z=Y(),B=T(()=>n.value.optionsType===1&&Z.value?Z.value:!1),Ae=()=>{if(["image","background","border","clock"].includes(i.data.type))return;const{optionsType:e,requestUrl:p,method:m="post",before:y,after:S}=n.value;e===1&&p&&ke({apiKey:p,params:{},before:y,options:{method:m},type:"get"}).then(w=>{const b=w.data;typeof S=="function"&&(Z.value=S(b,De.value))}).catch(w=>{console.log(w)})},j=e=>{if(!e)return e;const p=typeof e=="object"?Xe(e):e;if(p.indexOf("{{")!==-1&&p.indexOf("}}")!==-1){const m=p.replace(/"{{.*?}}"/g,function(y){return y.slice(3,-3)}).replace(/{{.*?}}/g,function(y){return new Function("return "+y.slice(2,-2))()});return we(m)}return e},re=oe("openRightMenu",null),$e=e=>{typeof re=="function"&&re({x:e.pageX,y:e.pageY,type:i.data.type,id:i.data.id}),e.preventDefault()};return Ee(()=>{Q()}),ie(()=>{Ae()}),Re(()=>{}),(e,p)=>{var S,w,b;const m=pe("el-table-column"),y=pe("el-table");return f(),C("div",{class:te([{["group-"+e.data.type]:!0,[(S=e.data.config)==null?void 0:S.class]:(w=e.data.config)==null?void 0:w.class},"group"]),style:M(q.value),onMousedown:V},[e.type===0&&!((b=e.data.config)!=null&&b.lock)?(f(),C("div",{key:0,class:"resize-box",onContextmenu:$e,onMousedown:ne(c,["left","stop"])},[(f(),C(de,null,fe(8,g=>ge(z("span",{key:g,class:te(`rs${g}`),onMousedown:ne(k=>l(k,g),["stop"])},null,42,Ue),[[he,d.value===e.data.id&&e.data.type!=="tempRect"]])),64)),ge(z("div",{class:"position"},ee(JSON.stringify(e.data.position)),513),[[he,d.value===e.data.id]])],32)):D("",!0),["text","border"].includes(e.data.type)?(f(),C("div",{key:1,style:M(h.value),innerHTML:j(B.value||n.value.text)},null,12,We)):D("",!0),e.data.type==="sText"?(f(),C("div",{key:2,style:M(h.value)},[se(Le,{direction:n.value.direction,height:`${e.data.position.height}px`,speed:n.value.speed,step:n.value.step,width:`${e.data.position.width}px`},{default:ae(()=>[qe(ee(j(B.value||n.value.text)),1)]),_:1},8,["direction","height","speed","step","width"])],4)):D("",!0),e.data.type==="image"?(f(),C("img",{key:3,src:n.value.src,style:M(h.value),alt:"请选择或上传图片",class:"default-img"},null,12,Ge)):D("",!0),e.data.type==="background"?(f(),C("div",{key:4,style:M(v.value),class:"default-bg"},[n.value.src?D("",!0):(f(),C("span",Ke,"请选择或上传图片"))],4)):D("",!0),e.data.type==="table"?(f(),C("div",{key:5,ref_key:"tableEl",ref:N,class:"screen-table"},[se(y,G(n.value.props,{data:r.value,height:`${i.data.position.height}`,style:{width:"100%"}}),{default:ae(()=>{var g;return[(f(!0),C(de,null,fe((g=e.data.option)==null?void 0:g.columns,k=>(f(),X(m,G({ref_for:!0},k,{key:k.prop}),null,16))),128))]}),_:1},16,["data","height"])],512)):D("",!0),e.data.type==="clock"?(f(),X(Pe,{key:6,config:n.value,style:M(h.value)},null,8,["config","style"])):D("",!0),["component"].includes(e.data.type)?(f(),X(Fe(n.value.component),G({key:7},n.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):D("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(f(),X(Ve,{key:8,height:F(e.data.position.height),option:j(B.value||e.data.option),width:F(e.data.position.width)||"100%"},null,8,["height","option","width"])):D("",!0),["div","group"].includes(e.data.type)?(f(),X(Qe,{key:9,modelValue:e.data.list,"onUpdate:modelValue":p[0]||(p[0]=g=>e.data.list=g),"data-type":"div",pId:e.data.id},null,8,["modelValue","pId"])):D("",!0)],38)}}}),Qe=K({__name:"screenGroup",props:me({pId:{}},{modelValue:{},modelModifiers:{}}),emits:me(["itemClick"],["update:modelValue"]),setup(t,{emit:s}){const i=t,o=s,u=ze(t,"modelValue"),d=oe("screenData")||{},a=oe("stateData")||{},n=Te(),h=T(()=>{const{width:l}=d.value.config;return l}),v=l=>{var c;if(a.ctrlPress){if(i.pId)return;n.setTempActiveId(l.id),n.setActiveId(l.id),n.setControlAttr(l);const r=(c=n.tempActiveId)==null?void 0:c.length;n.setControlTip(`当前选中${r}个`),r>1&&(n.setActiveId("rect"),o("itemClick"))}else V(l),n.setControlTip("可使用键盘方向键调整位置")},q=(l,c)=>{c.type==="moveTip"&&n.setControlTip(`当前位置：${c.left}:${c.top}`),l.position.left=c.left,l.position.top=c.top,c.width&&(l.position.width=c.width),c.height&&(l.position.height=c.height),l.type==="tempRect"&&c.type==="move"&&u.value.forEach(r=>{n.tempActiveId.includes(r.id)&&(r.position.left=parseInt(r.position.left)+c.moveX,r.position.top=parseInt(r.position.top)+c.moveY)})},F=l=>{const c=l.newIndex,r=u.value[c];if((l.target&&l.target.getAttribute("data-type"))==="div"&&r.type==="div"){u.value.splice(c,1);return}delete r.label,delete r.icon;const{offsetX:J,offsetY:Q}=l.originalEvent;r.position||(r.position={}),r.config||(r.config={}),r.id=r.type+new Date().getTime(),r.layerName=r.id,r.type==="div"&&(r.position.width=h.value),r.position.left=J,r.position.top=Q,V(r)},V=l=>{n.setActiveId(l.id),n.setControlAttr(l)};return(l,c)=>(f(),X(ve(Be),G({group:"screen",animation:200,handle:".none"},{list:u.value,class:"drag",itemKey:"id",name:"fade",ghostClass:"ghost",onAdd:F}),{item:ae(({element:r})=>[se(Je,{data:r,scale:ve(a).scale,type:0,onChangeEvent:N=>q(r,N),onClick:ne(N=>v(r),["stop"])},null,8,["data","scale","onChangeEvent","onClick"])]),_:1},16,["list"]))}});export{Qe as _,et as a,je as b,ye as c,Je as d,He as g,$ as r,Te as u};
