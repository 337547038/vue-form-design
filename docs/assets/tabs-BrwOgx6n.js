import{d as L,l as f,G as T,h as b,i as q,r as i,W as x,b as y,o as _,w as m,j as c,e as A,s as $,c as R,ae as G,f as r,A as M,X as I,N as O,L as P}from"./index-BMqeUH7Y.js";const W={class:"form-info"},X=L({__name:"tabs",props:{pane:{default:""}},setup(E,{expose:N}){const n=E,v=f(),w=f(),u=f(),a=T({loading:!0,obj:{},flowName:"",formId:"",callback:""}),p=f({list:[],form:{},config:{}}),g=b(()=>q("userInfo",!0)),k=b(()=>n.pane==="start"?"add":"edit"),C=b(()=>!(n.pane==="start"||n.pane==="applyed"&&a.obj.status===0)),D=e=>{e==="record"&&v.value.getListData()},F=f({columns:[{label:"处理人",prop:"name",render:"text",renderFormatter:e=>e||"系统"},{label:"状态",prop:"status",render:"tag",replaceValue:{0:"拒绝",1:"同意",2:"流转",3:"撤回"},custom:{0:"danger",1:"success",2:"primary",3:"info"}},{label:"处理时间",prop:"datetime",render:"datetime"},{label:"审批意见",prop:"content"}],config:{columnsSetting:!1}}),S=(e,o)=>{a.obj=e,a.callback=o;const s={id:e.flowId};M("flowFrom",s).then(t=>{const{flow:l,form:d}=t.data;u.value.setValue(I(l.data),e),p.value=I(d.data),a.loading=!1,a.flowName=l.name,a.formId=d.id,n.pane!=="start"&&w.value.getData({formId:d.id,id:e.formId})})},V=(e,o)=>{var s;if(o==="submit"){if(!u.value.flowValidate(1))return O({type:"error",message:"请选择节点自选审批人"}),!1;let t={form:e,flow:{flowId:a.obj.flowId,formId:a.formId,userId:g.value.id,title:`${g.value.userName}提交的${a.flowName}申请审批`,creatTime:new Date,status:0,nodeApprover:u.value.getDiyNodeApprover()}};n.pane==="applyed"&&a.obj.status===0&&(t=e,t.formId=a.formId);const l=(s=p.value.events)==null?void 0:s.before;return typeof l=="function"?l(t):t}},h=(e,o,s)=>{s==="submit"&&o&&a.callback&&a.callback()};return N({initFlowForm:S}),(e,o)=>{const s=i("ak-form"),t=i("el-tab-pane"),l=i("ak-flow"),d=i("ak-list"),j=i("el-tabs"),B=x("loading");return _(),y(j,{onTabChange:D},{default:m(()=>[c(t,{label:"表单信息"},{default:m(()=>[$((_(),R("div",W,[G(e.$slots,"default",{},void 0,!0),c(s,{ref_key:"formEl",ref:w,data:p.value,before:V,after:h,disabled:C.value,"operate-type":k.value,"submit-url":k.value==="add"?"flowSave":"editFormContent","request-url":"getFormContent"},null,8,["data","disabled","operate-type","submit-url"])])),[[B,a.loading]])]),_:3}),c(t,{label:"流程图",name:"flow",class:"flow-box"},{default:m(()=>[o[0]||(o[0]=r("div",{class:"status"},[r("ul",null,[r("li",{class:"s1"}," ● 已通过 "),r("li",{class:"s4"}," ● 已拒绝 "),r("li",{class:"s2"}," ● 进行中 "),r("li",{class:"s3"}," ● 未进行 ")])],-1)),c(l,{ref_key:"flowEl",ref:u,type:e.pane==="start"?2:1},null,8,["type"])]),_:1}),e.pane!=="start"?(_(),y(t,{key:0,label:"流转记录",name:"record"},{default:m(()=>[c(d,{ref_key:"tableListEl",ref:v,"auto-load":!1,"api-key":{list:"flowRecordList"},data:F.value,query:{flowId:a.obj.id}},null,8,["data","query"])]),_:1})):A("",!0)]),_:3})}}}),H=P(X,[["__scopeId","data-v-08df038a"]]);export{H as F};
