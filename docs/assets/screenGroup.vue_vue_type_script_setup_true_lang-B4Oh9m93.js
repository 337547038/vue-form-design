import{ag as $e,ah as Ne,i as _e,A as xe,X as we,Z as Oe,N as be,ai as ke,d as J,l as Y,B as Ie,p as ie,c as b,o as d,t as ee,aj as ce,h as k,G as Ce,x as D,n as te,f as z,ae as ue,q as Ee,M as oe,C as Re,S as qe,r as pe,e as C,b as B,U as ne,s as de,F as fe,a as ge,v as he,j as se,w as ae,m as Fe,a3 as K,g as Xe,ac as Be,a0 as Ye,a1 as me,a2 as ze,I as ve,O as He}from"./index-CYQNA_yI.js";const Te=$e("screen",{state:()=>({controlAttr:{},activeId:"",screenConfig:_e("screenConfig",!0)||{},controlTip:"",tempActiveId:[]}),actions:{setTempActiveId(t){if(typeof t=="string"&&t){const s=this.tempActiveId.indexOf(t);s!==-1?this.tempActiveId.splice(s,1):this.tempActiveId.push(t)}else this.tempActiveId=t},setControlTip(t){this.controlTip=t},setControlAttr(t){this.controlAttr=t},setScreenConfig(t,s){this.screenConfig[t]=s,Ne("screenConfig",this.screenConfig,0)},getScreenConfig(t){return this.screenConfig[t]},setActiveId(t){this.activeId=t}}}),je=t=>new Promise((s,a)=>{if(!t)return a();xe("designById",{id:t}).then(async o=>{const p=o.data,u=we(p.data);u.config?.style&&Oe("screenStyle",u.config.style,!0),window.getScreenGlobal={},await Pe(u.config),s(u)}).catch(o=>{console.log("catch",o),be.error(o.message||"加载异常"),a()})}),Pe=t=>new Promise((s,a)=>{const{requestUrl:o,before:p,after:u,method:i}=t;o?ke({apiKey:o,before:p,after:u,params:{},options:{method:i},type:"none"}).then(n=>{window.getScreenGlobal=n.data,s(n.data)}).catch(n=>{a(n)}):s({})}),Ve=J({__name:"nowTime",props:{config:{}},setup(t){const s=t,a=Y(),o=Y(),p=()=>{const u=s.config.dateTime;!u||u&&u.indexOf("{i}")!==-1?a.value=setInterval(()=>{o.value=ce(new Date,u)},1e3):o.value=ce(new Date,u)};return Ie(()=>s.config.dateTime,()=>{clearInterval(a.value),p()},{immediate:!0}),ie(()=>{}),(u,i)=>(d(),b("div",null,ee(o.value),1))}}),Ue=J({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(t){const s=t,a=k(()=>({width:s.width,height:s.height,overflow:"hidden"})),o=Ce({left:0,top:0,duration:0}),p=k(()=>["left","right"].includes(s.direction)),u=k(()=>{const m=s.step>1?`transform ${o.duration}s`:"";return p.value?{display:"flex",width:parseInt(s.width)*2+"px",transform:`translateX(${o.left}px)`,transition:m}:{transform:`translateY(${o.top}px)`,transition:m}}),i=Y(),n=Y(),I=()=>{const m=i.value,R=n.value,q=()=>{const l=R.offsetWidth,c=R.offsetHeight;switch(s.direction){case"left":o.left+l<=0?(o.left=0,o.duration=0):(o.left=o.left-s.step,o.duration=.3);break;case"right":o.left>=0?(o.left=-l,o.duration=0):(o.left=o.left+s.step,o.duration=.3);break;case"bottom":o.top>=0?(o.top=-c,o.duration=0):(o.top=o.top+s.step,o.duration=.3);break;default:o.top+c<=0?(o.top=0,o.duration=0):(o.top=o.top-s.step,o.duration=.3)}};let F=setInterval(q,s.speed);m.onmouseenter=function(){clearInterval(F)},m.onmouseleave=function(){F=setInterval(q,s.speed)}};return ie(()=>{I()}),(m,R)=>(d(),b("div",{ref_key:"container",ref:i,class:te([`marquess-${m.direction}`,"marquee-container"]),style:D(a.value)},[z("div",{style:D(u.value),class:"inner-container"},[z("div",{ref_key:"container1",ref:n,style:D({display:p.value?"flex":""})},[ue(m.$slots,"default")],4),z("div",{style:D({display:p.value?"flex":""})},[ue(m.$slots,"default")],4)],4)],6))}}),Se=t=>{try{return/^-?\d+(\.\d+)?$/.test(t.toString())}catch{return!1}},S=t=>{if(Number.isFinite(t))return Math.round(t);if(!t)return t;const s=t.match(/^(-?\d+(\.\d+)?)(px|em|rem|%|vh|vw)?$/);return s?Math.round(s[1]):0},E=t=>t===0||t==="0"?0:Se(t)?Math.round(t)+"px":t,W=t=>Se(t)?!0:t&&typeof t=="string"?t.indexOf("px")!==-1:!1,ye=(t,s)=>{const a=t.bottom||t.bottom===0,o=t.right||t.right===0,p=!W(t.left),u=!W(t.top),i=!W(t.width),n=!W(t.height),I=a||o||u||i||n||p||u;return s&&I&&be.error("仅支持使用了left和top的px单位允许操作!"),I},et=t=>{const{type:s,config:a={},position:o={}}=t;return!(s==="div"||s==="group"||s==="tempRect"||a.lock||o.display)},Ge=["onMousedown"],Le=["innerHTML"],We=["src"],Ke={key:0},Je=J({__name:"screen",props:{data:{},type:{default:1},scale:{default:100}},emits:["changeEvent"],setup(t,{emit:s}){const a=t,o=s,p=Te(),u=k(()=>p.activeId),i=Ce({left:0,top:0,width:0,height:0,moveFlag:!1}),n=k(()=>a.data.config||{}),I=k(()=>Object.assign({},{width:"100%",height:"100%"},n.value.style||{})),m=k(()=>{let e={};return n.value.src&&(e={backgroundImage:`url(${n.value.src})`}),Object.assign(n.value.style||{},e)}),R=k(()=>{if(!a.data.position)return{};const{left:e,top:f,height:g,width:v,zIndex:h,display:y,right:M,bottom:_}=a.data.position,X=E(M),w=E(_);return{left:E(i.left)||(M?"":E(e)),right:X,bottom:w,top:E(i.top)||(_?"":E(f)),width:E(i.width||v),height:E(i.height||g),zIndex:h||1,display:y?"none":""}}),q=e=>e.toString().indexOf("%")!==-1?"100%":e,F=e=>{n.value.lock||(e.preventDefault(),e.stopPropagation())},l=(e,f)=>{if(a.data.type==="group")return;let g=!0;const v=e.pageX,h=e.pageY,{width:y,height:M,left:_,top:X}=a.data.position;if(ye(a.data.position,!0))return;const w=S(y),T=S(M),V=S(_),U=S(X);document.onmousemove=le=>{if(!g)return;const $=le.pageX-v,N=le.pageY-h;let x=w,O=T,G=V,L=U;switch(f){case 1:x=w-$,O=T-N,L=U+N,G=V+$;break;case 4:x=w-$,G=V+$;break;case 6:x=w-$,G=V+$,O=T+N;break;case 2:O=T-N,L=U+N;break;case 7:O=T+N;break;case 3:x=w+$,O=T-N,L=U+N;break;case 5:x=w+$;break;case 8:x=w+$,O=T+N;break}x<50||O<30||o("changeEvent",{type:"resize",width:x,height:O,left:G,top:L})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,g=!1},e.stopPropagation()},c=e=>{const{left:f,top:g}=a.data.position;i.moveFlag=!0;const v=e.pageX,h=e.pageY,y=S(f),M=S(g);let _=0,X=0;ye(a.data.position,!0)?(console.log("不能拖动"),i.moveFlag=!1):(i.left=y,i.top=M),document.onmousemove=w=>{if(!i.moveFlag)return;const T=a.scale/100;_=S((w.pageX-v)/T),X=S((w.pageY-h)/T),i.left=S(_+y),i.top=S(X+M),o("changeEvent",{type:"moveTip",left:i.left,top:i.top})},document.onmouseup=function(){i.moveFlag&&(o("changeEvent",{type:"move",moveX:_,moveY:X,left:i.left,top:i.top}),i.left=0,i.top=0,i.moveFlag=!1,document.onmousemove=null)}},r=k(()=>{const e=P.value||a.data.option?.list;return n.value.carousel?[...e,...e]:e}),A=Y(),H=()=>{if(!n.value.carousel||!A.value||a.data.type!=="table")return;const e=A.value.querySelector(".el-scrollbar__wrap");function f(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let g=setInterval(f,n.value.speed||30);A.value.onmouseenter=function(){clearInterval(g)},A.value.onmouseleave=function(){g=setInterval(f,n.value.speed||30)}},Z=Ie(()=>a.data.option?.list,()=>{Ee(()=>{H()})},{immediate:!0}),De=k(()=>{switch(a.data.type){case"text":case"sText":return n.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return a.data.option}return""}),Q=Y(),P=k(()=>n.value.optionsType===1&&Q.value?Q.value:!1),Ae=()=>{if(["image","background","border","clock"].includes(a.data.type))return;const{optionsType:e,requestUrl:f,method:g="post",before:v,after:h}=n.value;e===1&&f&&ke({apiKey:f,params:{},before:v,options:{method:g},type:"none"}).then(y=>{const M=y.data;typeof h=="function"&&(Q.value=h(M,De.value))}).catch(y=>{console.log(y)})},j=e=>{if(!e)return e;const f=typeof e=="object"?Ye(e):e;if(f.indexOf("{{")!==-1&&f.indexOf("}}")!==-1){const g=f.replace(/"{{.*?}}"/g,function(v){return v.slice(3,-3)}).replace(/{{.*?}}/g,function(v){return new Function("return "+v.slice(2,-2))()});return we(g)}return e},re=oe("openRightMenu",null),Me=e=>{typeof re=="function"&&re({x:e.pageX,y:e.pageY,type:a.data.type,id:a.data.id}),e.preventDefault()};return Re(()=>{Z()}),ie(()=>{Ae()}),qe(()=>{}),(e,f)=>{const g=pe("el-table-column"),v=pe("el-table");return d(),b("div",{class:te([{["group-"+e.data.type]:!0,[e.data.config?.class]:e.data.config?.class},"group"]),style:D(R.value),onMousedown:F},[e.type===0&&!e.data.config?.lock?(d(),b("div",{key:0,class:"resize-box",onContextmenu:Me,onMousedown:ne(c,["left","stop"])},[(d(),b(fe,null,ge(8,h=>de(z("span",{key:h,class:te(`rs${h}`),onMousedown:ne(y=>l(y,h),["stop"])},null,42,Ge),[[he,u.value===e.data.id&&e.data.type!=="tempRect"]])),64)),de(z("div",{class:"position"},ee(JSON.stringify(e.data.position)),513),[[he,u.value===e.data.id]])],32)):C("",!0),["text","border"].includes(e.data.type)?(d(),b("div",{key:1,style:D(I.value),innerHTML:j(P.value||n.value.text)},null,12,Le)):C("",!0),e.data.type==="sText"?(d(),b("div",{key:2,style:D(I.value)},[se(Ue,{direction:n.value.direction,height:`${e.data.position.height}px`,speed:n.value.speed,step:n.value.step,width:`${e.data.position.width}px`},{default:ae(()=>[Fe(ee(j(P.value||n.value.text)),1)]),_:1},8,["direction","height","speed","step","width"])],4)):C("",!0),e.data.type==="image"?(d(),b("img",{key:3,src:n.value.src,style:D(I.value),alt:"请选择或上传图片",class:"default-img"},null,12,We)):C("",!0),e.data.type==="background"?(d(),b("div",{key:4,style:D(m.value),class:"default-bg"},[n.value.src?C("",!0):(d(),b("span",Ke,"请选择或上传图片"))],4)):C("",!0),e.data.type==="table"?(d(),b("div",{key:5,ref_key:"tableEl",ref:A,class:"screen-table"},[se(v,K(n.value.props,{data:r.value,height:`${a.data.position.height}`,style:{width:"100%"}}),{default:ae(()=>[(d(!0),b(fe,null,ge(e.data.option?.columns,h=>(d(),B(g,K({ref_for:!0},h,{key:h.prop}),null,16))),128))]),_:1},16,["data","height"])],512)):C("",!0),e.data.type==="clock"?(d(),B(Ve,{key:6,config:n.value,style:D(I.value)},null,8,["config","style"])):C("",!0),["component"].includes(e.data.type)?(d(),B(Xe(n.value.component),K({key:7},n.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):C("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(d(),B(Be,{key:8,height:q(e.data.position.height),option:j(P.value||e.data.option),width:q(e.data.position.width)||"100%"},null,8,["height","option","width"])):C("",!0),["div","group"].includes(e.data.type)?(d(),B(Ze,{key:9,"model-value":e.data.list,"data-type":"div","p-id":e.data.id},null,8,["model-value","p-id"])):C("",!0)],38)}}}),Ze=J({__name:"screenGroup",props:me({pId:{default:""}},{modelValue:{default:()=>{}},modelModifiers:{}}),emits:me(["itemClick"],["update:modelValue"]),setup(t,{emit:s}){const a=t,o=s,p=ze(t,"modelValue"),u=oe("screenData")||{},i=oe("stateData")||{},n=Te(),I=k(()=>{const{width:l}=u.value.config;return l}),m=l=>{if(i.ctrlPress){if(a.pId)return;n.setTempActiveId(l.id),n.setActiveId(l.id),n.setControlAttr(l);const c=n.tempActiveId?.length;n.setControlTip(`当前选中${c}个`),c>1&&(n.setActiveId("rect"),o("itemClick",[]))}else F(l),n.setControlTip("可使用键盘方向键调整位置")},R=(l,c)=>{c.type==="moveTip"&&n.setControlTip(`当前位置：${c.left}:${c.top}`),l.position.left=c.left,l.position.top=c.top,c.width&&(l.position.width=c.width),c.height&&(l.position.height=c.height),l.type==="tempRect"&&c.type==="move"&&p.value.forEach(r=>{n.tempActiveId.includes(r.id)&&(r.position.left=parseInt(r.position.left+"")+c.moveX,r.position.top=parseInt(r.position.top+"")+c.moveY)})},q=l=>{const c=l.newIndex,r=p.value[c];if((l.target&&l.target.getAttribute("data-type"))==="div"&&r.type==="div"){p.value.splice(c,1);return}delete r.label,delete r.icon;const{offsetX:H,offsetY:Z}=l.originalEvent;r.position||(r.position={}),r.config||(r.config={}),r.id=r.type+new Date().getTime(),r.layerName=r.id,r.type==="div"&&(r.position.width=parseInt(I.value)-H),r.position.left=H,r.position.top=Z,F(r)},F=l=>{n.setActiveId(l.id),n.setControlAttr(l)};return(l,c)=>(d(),B(ve(He),K({group:"screen",animation:200,handle:".none"},{list:p.value,class:"drag","item-key":"id",name:"fade","ghost-class":"ghost",onAdd:q}),{item:ae(({element:r})=>[se(Je,{data:r,scale:ve(i).scale,type:0,onChangeEvent:A=>R(r,A),onClick:ne(A=>m(r),["stop"])},null,8,["data","scale","onChangeEvent","onClick"])]),_:1},16,["list"]))}});export{Ze as _,et as a,je as b,ye as c,Je as d,Pe as g,S as r,Te as u};
