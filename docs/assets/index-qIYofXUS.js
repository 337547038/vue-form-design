import{_ as Ne,g as Ve,b as we,a as Te}from"./aceTooptip-LKdKHUVY.js";import{d as ve,G as pe,c as f,e as x,o as r,n as be,f as w,F as $,a as J,m as N,t as ue,y as ye,l as ae,h as Z,p as ge,r as A,b as V,A as ce,X as ie,w as n,j as a,I as se,O as $e,Q as he,M as Ie,a8 as xe,a4 as me,a9 as Se,B as De,q as Pe,a6 as Fe,N as te,k as Oe,u as Ee,W as Ae,s as Be,a0 as le,Y as qe,V as Le,z as Ce}from"./index-CuNR3IJH.js";import{_ as Re}from"./aceDrawer.vue_vue_type_script_setup_true_lang-C6ApDvEr.js";const fe=[],de={optionsType:0},_e=[{title:"基础字段",children:[{type:"input",label:"单行文本",icon:"input",control:{modelValue:""},config:{}},{type:"textarea",label:"多行文本",icon:"textarea",control:{modelValue:""},config:{}},{type:"radio",label:"单选框组",icon:"radio",control:{modelValue:""},options:fe,config:de},{type:"checkbox",label:"多选框组",icon:"checkbox",control:{modelValue:[]},options:fe,config:de},{type:"select",label:"下拉选择框",icon:"select",control:{modelValue:"",teleported:!0},options:fe,config:de},{type:"datePicker",label:"日期选择器",icon:"date",control:{modelValue:"",type:"date"},config:{}},{type:"timePicker",label:"时间选择器",icon:"time",control:{modelValue:""},config:{}},{type:"colorPicker",label:"取色器",icon:"color",control:{modelValue:""},config:{}},{type:"switch",label:"开关",icon:"switch",control:{modelValue:!1},config:{}},{type:"inputNumber",label:"计数器",icon:"number",control:{modelValue:0},config:{}},{type:"cascader",label:"级联选择器",icon:"cascader",control:{modelValue:[]},options:[],config:de},{type:"rate",label:"评分",icon:"rate",control:{modelValue:0},config:{}},{type:"slider",label:"滑块",icon:"slider",control:{modelValue:0},config:{}},{type:"treeSelect",label:"树形控件",icon:"tree2",control:{modelValue:"",data:[],renderAfterExpand:!1},config:{optionsType:0}},{type:"txt",label:"文字",icon:"text",control:{modelValue:""},config:{}},{type:"title",label:"标题",icon:"title",control:{modelValue:"标题"},config:{}},{type:"button",label:"按钮",icon:"button",control:{label:"保存"},config:{}}]},{title:"高级字段",children:[{type:"table",label:"子表",icon:"table",list:[],tableData:[],control:{border:!0},config:{addBtnText:"添加一行"}},{type:"component",label:"自定义组件",icon:"component",control:{modelValue:""},config:{}},{type:"upload",label:"图片/文件",icon:"image",control:{modelValue:""},config:{}},{type:"chunkUpload",label:"选择上传",icon:"upload",control:{modelValue:""},config:{}},{type:"tinymce",label:"tinymce富文本",icon:"tinymce",control:{modelValue:""},config:{}}]},{title:"布局字段",children:[{type:"grid",label:"格栅布局",icon:"grid",columns:[{attr:{span:12},list:[]},{attr:{span:12},list:[]}],control:{},config:{}},{type:"tabs",label:"标签页",icon:"tabs",columns:[{label:"Tab1",list:[]}],control:{},config:{}},{type:"card",label:"卡片布局",icon:"card",list:[],control:{},config:{}},{type:"flex",label:"弹性字段",icon:"flex",list:[],tableData:[],control:{},config:{addBtnText:"添加一行"}},{type:"divider",label:"分割线",icon:"divider",control:{},config:{}},{type:"div",label:"div容器",icon:"div",control:{},config:{},list:[]}]},{title:"扩展组件",children:[{type:"expand-user",label:"选择用户",icon:"user",control:{modelValue:""},config:{}}]}],ze={key:0,class:"no-date"},He={key:1,class:"list"},je=["onClick"],Ke=["src"],Je=ve({__name:"template",emits:["click"],setup(Q,{expose:X,emit:P}){const M=P,p=pe({visible:!1,list:[]}),d=()=>{p.visible=!0,O()},O=()=>{const v=import.meta.globEager("./template/*.ts");p.list=[],Object.keys(v).forEach(t=>{const b=v[t];p.list.push({imgPath:b.imgPath,title:b.title,formData:b.formData})})},y=v=>{M("click",v.formData),p.visible=!1};return X({open:d}),(v,t)=>p.visible?(r(),f("div",{key:0,class:be(["use-template",{active:p.visible}])},[w("span",{class:"close icon-close",onClick:t[0]||(t[0]=b=>p.visible=!1)}),p.list.length===0?(r(),f("div",ze," 暂无可用模板 ")):(r(),f("div",He,[(r(!0),f($,null,J(p.list,(b,Y)=>(r(),f("div",{key:Y,class:"item",onClick:oe=>y(b)},[w("img",{src:b.imgPath,alt:""},null,8,Ke),N(ue(b.title),1)],8,je))),128))]))],2)):x("",!0)}}),Me={class:"components-list"},We={key:0},Ge={class:"content"},Qe={class:"title"},Xe=["title"],Ye=ve({__name:"dragControl",emits:["clickCheck","click"],setup(Q,{emit:X}){const P=ye(),M=X,p=ae([]),d=["input","radio","checkbox","select","datePicker","timePicker","inputNumber","cascader","component","button"],O=Z(()=>P.query.type==="search"),y=Z(()=>{if(O.value){const S=[];return _e.forEach(k=>{if(k.children){const C=k.children.filter(W=>d.includes(W.type));C&&C.length&&S.push({title:k.title,children:C})}}),S}else return _e}),v=S=>he(S),t=S=>{ce("designById",{id:S}).then(k=>{const C=ie(k.data.data);C&&C.list&&b(C.list)})},b=S=>{S.forEach(k=>{k.type==="grid"||k.type==="tabs"?k.columns.forEach(C=>{b(C.list)}):k.type==="card"?b(k.list):d.includes(k.type)&&k.type!=="button"&&p.value.push(k)})},Y=(S,k)=>{if(k){const C=he(S);delete C.rules,delete C.customRules,M("clickCheck",C)}},oe=ae(),re=()=>{oe.value.open()},E=S=>{M("click",S)};return ge(()=>{const{type:S,id:k}=P.query;S==="search"&&k&&t(k)}),(S,k)=>{var W;const C=A("el-checkbox");return r(),f("div",Me,[O.value&&((W=p.value)!=null&&W.length)?(r(),f("div",We,[k[0]||(k[0]=w("div",{class:"title"}," 快速选择表单字段 ",-1)),w("div",Ge,[(r(!0),f($,null,J(p.value,U=>(r(),V(C,{key:U.name,onChange:H=>Y(U,H)},{default:n(()=>{var H;return[N(ue((H=U.formItem)==null?void 0:H.label),1)]}),_:2},1032,["onChange"]))),128))])])):x("",!0),(r(!0),f($,null,J(y.value,(U,H)=>(r(),f("div",{key:H},[w("div",Qe,[N(ue(U.title)+" ",1),H===0&&!O.value?(r(),f("div",{key:0,class:"template",onClick:re}," 使用模板 ")):x("",!0)]),a(se($e),{modelValue:U.children,"onUpdate:modelValue":F=>U.children=F,"item-key":"key123",tag:"ul",group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:v},{item:n(({element:F})=>[w("li",{class:be([F.type])},[w("i",{class:be(`icon-${F.icon}`)},null,2),w("span",{title:F.label},ue(F.label),9,Xe)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),O.value?x("",!0):(r(),V(Je,{key:1,ref_key:"useTemplateEl",ref:oe,onClick:E},null,512))])}}}),Ze={class:"sidebar-tools"},el=["onClick"],ll={key:1},tl={key:0},al=["onClick"],ol={key:0},nl=["onClick"],sl={key:3},rl=ve({__name:"formControlAttr",emits:["openDialog"],setup(Q,{expose:X,emit:P}){const M=P,p=Ie("formData"),d=Z(()=>p.value.config),O=Z(()=>p.value.form),y=xe(),v=ye(),t=Z(()=>y.controlAttr),b=Z(()=>v.query.type==="search"),Y=ae([]),oe=Z(()=>{var s;return[{label:"表单名称",placeholder:"用于保存的表单名称",value:d.value.name,key:"name",path:"config",hide:b.value},{label:"数据源",placeholder:"请选择数据源",value:me(d.value.sourceId),type:"select",options:Y.value,key:"sourceId",path:"config",hide:b.value||!((s=Y.value)!=null&&s.length),clearable:!0},{label:"表单标识",value:O.value.name,placeholder:"表单唯一标识，可为空",key:"name",hide:b.value},{label:"表单标签宽度",value:O.value.labelWidth,placeholder:"表单label宽，如180px",key:"labelWidth"},{label:"表单样式名称",value:O.value.class,placeholder:"额外添加的表单class类名",key:"class",type:"select",options:[{label:"无样式",value:"none"},{label:"每行两列",value:"form-row-2"},{label:"每行三列",value:"form-row-3"},{label:"每行四列",value:"form-row-4"}],hide:b.value,clearable:!0},{label:"字段名后添加冒号",value:O.value.showColon,key:"showColon",type:"switch"},{label:"组件尺寸",value:O.value.size,type:"select",key:"size",options:[{label:"large",value:"large"},{label:"default",value:"default"},{label:"small",value:"small"}]},{label:"快速添加确定取消按钮",value:d.value.submitCancel,type:"switch",path:"config",key:"submitCancel"},{label:"将object转string提交",value:d.value.transformData,type:"switch",path:"config",key:"transformData",hide:b.value}]}),re=Z(()=>{var s,e;if(Object.keys(t.value).length){const{control:o={},type:h,name:D,config:u={},formItem:m={},attr:L={}}=t.value;let _=!1;if(h==="table"){const z=(s=t.value)==null?void 0:s.list;z&&z.length>0&&(_=z[0].type==="index")}return[{label:"自定义Class",value:u.className,placeholder:"样式类名",path:"config.className"},{label:"字段标识",value:D,type:(e=E.dataSourceFiledList)!=null&&e.length?"select":"text",placeholder:"字段唯一标识，对应数据库",dict:E.dataSourceFiledList,path:"name",vHide:["grid","tabs","card","title","gridChild","tableColumn","divider","txt","div","button"],eventName:"filedNameKey"},{label:"占位内容",value:o.placeholder,placeholder:"placeholder",path:"control.placeholder",vShow:["password","input","textarea","select","date","number","datePicker","tinymce","timePicker","treeSelect"]},{label:"按钮类型",value:o.type,path:"control.type",type:"select",dict:{primary:"primary",success:"success",info:"info",warning:"warning",danger:"danger"},vShow:["button"],clearable:!0},{label:"按钮名称",value:o.label,path:"control.label",vShow:["button"]},{label:"按钮事件",value:o.key,path:"control.key",type:"select",dict:{submit:"提交表单",reset:"重置表单",cancel:"取消返回",none:"无动作(自定义)"},vShow:["button"]},{label:"label值",value:m.label,path:"formItem.label",vHide:["table","grid","tabs","title","gridChild","div","inputSlot","flex","button","txt"]},{label:"隐藏label",value:m.hideLabel,path:"formItem.hideLabel",type:"switch",vHide:["table","grid","tabs","title","gridChild","divider","card","div","inputSlot","flex","button","txt"]},{label:"显示类型",value:u.showType,path:"config.showType",type:"select",dict:{input:"文本选择框",img:"图片",btn:"上传按钮"},vShow:["chunkUpload"]},{label:"按钮文本",value:u.btnText,placeholder:"按钮文本，默认为选择文件",path:"config.btnText",vShow:["chunkUpload"],vIf:u.showType==="img"},{label:"可选数量",value:u.limit,placeholder:"可选择的个数，默认1个",path:"config.limit",vShow:["chunkUpload"]},{label:"接受的文件类型",value:u.accept,placeholder:"接受的文件类型，input原生属性",path:"config.accept",vShow:["chunkUpload"]},{label:"是否自动上传",value:u.auto,path:"config.auto",type:"switch",vShow:["chunkUpload"]},{label:"帮助信息",value:u.help,path:"config.help",vHide:["table","grid","tabs","gridChild","divider","div","inputSlot","flex","button","txt"]},{label:"表单栅格",value:u.span,placeholder:"表单区域栅格宽，0为自动宽",path:"config.span",vHide:["gridChild"],isNum:!0},{label:"文本值",value:o.modelValue,placeholder:"支持html",path:"control.modelValue",vShow:["txt"],inputStyle:"textarea"},{label:"设为密码",value:h,type:"select",dict:{input:"文本",password:"密码"},path:"type",vShow:["input","password"],vIf:b.value},{label:"文本域高度",value:o.rows,placeholder:"输入框行数",path:"control.rows",vShow:["textarea"],isNum:!0},{label:"前缀",value:u.prepend,placeholder:"文本前缀",path:"config.prepend",vShow:["input","password"]},{label:"后缀",value:u.append,placeholder:"文本后缀",path:"config.append",vShow:["input","password"]},{label:"状态打开时的值",value:o.activeValue,placeholder:"状态打开时的值",path:"control.activeValue",vShow:["switch"],isNum:!0},{label:"状态关闭时的值",value:o.inactiveValue,placeholder:"状态关闭时的值",path:"control.inactiveValue",vShow:["switch"],isNum:!0},{label:"增加按钮文案",value:u.addBtnText,path:"config.addBtnText",type:"text",vShow:["flex","table"]},{label:"删除按钮文案",value:u.delBtnText,path:"config.delBtnText",type:"text",vShow:["flex","table"]},{label:"是否多选",value:o.multiple,path:"control.multiple",type:"switch",vShow:["select","treeSelect"],eventName:"selectMultiple"},{label:"可清空",value:o.clearable,path:"control.clearable",type:"switch",vShow:["select"]},{label:"是否禁用",value:o.disabled,path:"control.disabled",type:"switch",vShow:["input","password","textarea","radio","checkbox","select","date","switch","number","cascader","upload","rate","tinymce","treeSelect","datePicker","timePicker"],vIf:b.value},{label:"是否禁用编辑",value:u.disabledEdit,path:"config.disabledEdit",type:"switch",vShow:["input","password","textarea","radio","checkbox","select","date","switch","number","cascader","upload","treeSelect","table","flex","datePicker","timePicker"],vIf:b.value},{label:"添加页隐藏",value:u.displayAdd,path:"config.displayAdd",type:"switch",vIf:b.value,vHide:["inputSlot"]},{label:"编辑页隐藏",value:u.displayEdit,path:"config.displayEdit",type:"switch",vIf:b.value,vHide:["inputSlot"]},{label:"详情页隐藏",value:u.displayDetail,path:"config.displayDetail",type:"switch",vIf:b.value,vHide:["inputSlot"]},{label:"设为Input输入框的前/后缀",value:h==="inputSlot",path:"",type:"switch",vShow:["select","inputSlot"],eventName:"setInputSlot"},{label:"标题",value:o.modelValue,path:"control.modelValue",vShow:["title"]},{label:"占据的列数span",value:L.span,path:"attr.span",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"左侧的间隔格数offset",value:L.offset,path:"attr.offset",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"向右移动格数push",value:L.push,path:"attr.push",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"向左移动格数pull",value:L.pull,path:"attr.pull",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"序号列",value:_,type:"switch",vShow:["table"],eventName:"tableColumn1"},{label:"组件名",value:u.componentName,placeholder:"全局注册的组件名称",path:"config.componentName",vShow:["component"]},{label:"上传地址",value:o.action,placeholder:"图片/文件上传地址,可不填有默认值",path:"control.action",vShow:["upload"]},{label:"文件字段名",value:o.name,placeholder:"上传的文件字段名,默认file",path:"control.name",vShow:["upload"]},{label:"提示文字",value:u.tip,placeholder:"提示说明文字",path:"config.tip",vShow:["upload"]},{label:"按钮文本",value:u.btnText,placeholder:"上传按钮文本",path:"config.btnText",vShow:["upload"]},{label:"direction",type:"select",dict:{horizontal:"horizontal",vertical:"vertical"},placeholder:"分割线方向，默认horizontal",value:o.direction,path:"control.direction",vShow:["divider"]},{label:"border-style",placeholder:"分隔符样式，默认solid",value:o.borderStyle,path:"control.borderStyle",vShow:["divider"]},{label:"content-position",type:"select",dict:{left:"left",right:"right",center:"center"},value:o.contentPosition,path:"control.contentPosition",vShow:["divider"]},{label:"最小值",value:o.min,path:"control.min",vShow:["slider"],eventName:"formatNumber",isNum:!0},{label:"最大值",value:o.max,path:"control.max",vShow:["rate","slider"],eventName:"formatNumber",isNum:!0},{label:"步长",value:o.step,path:"control.step",vShow:["slider"],eventName:"formatNumber",isNum:!0},{label:"type",value:o.type,path:"control.type",vShow:["datePicker"],type:"select",placeholder:"显示类型",dict:{year:"year",month:"month",date:"date",datetime:"datetime",week:"week",datetimerange:"datetimerange",daterange:"daterange",monthrange:"monthrange"}},{label:"format",value:o.format,path:"control.format",vShow:["datePicker","timePicker"],placeholder:"显示在输入框中的格式"},{label:"value-format",value:o.valueFormat,path:"control.valueFormat",vShow:["datePicker","timePicker"],placeholder:"绑定的值"},{label:"color-format",value:o.colorFormat,path:"control.colorFormat",type:"select",placeholder:"写入 v-model 的颜色的格式",dict:{hsl:"hsl",hsv:"hsv",hex:"hex",rgb:"rgb"},vShow:["colorPicker"]},{label:"文本高度",value:o.height,path:"control.height",placeholder:"文本高度(预览查看效果)",vShow:["tinymce"]},{label:"文本宽度",value:o.width,path:"control.width",placeholder:"文本宽度(预览查看效果)",vShow:["tinymce"]},{label:"图片上传地址",value:o.imgUrl,path:"control.imgUrl",placeholder:"图片上传地址",vShow:["tinymce"]},{label:"附件上传地址",value:o.blobUrl,path:"control.blobUrl",placeholder:"附件上传地址",vShow:["tinymce"]},{label:"显示模式",value:u.style,path:"config.style",placeholder:"显示风格(预览查看效果)",type:"select",dict:{default:"default",simple:"simple"},vShow:["tinymce"]},{label:"隐藏显示",value:u.hidden,path:"config.hidden",placeholder:"条件表达式，如$.name===1"},{label:"禁用显示",value:u.disabled,path:"config.disabled",placeholder:"条件表达式，如$.name===1",vHide:["txt","title","table","grid","tabs","card","flex","divider","div"]}].filter(z=>{let ne=!0;return z.vShow&&(ne=z.vShow.includes(h)),z.vHide&&(ne=!z.vHide.includes(h)),z.vIf&&(ne=!1),ne})}else return[]}),E=pe({dataSourceFiledList:[],customRulesList:[...Se,{type:"rules",label:"自定义正则"}],tabsName:"second"});De(()=>y.activeKey,s=>{s&&(E.tabsName="first")});const S=(s,e)=>{switch(s.eventName){case"selectMultiple":t.value.control.modelValue=e?[]:"";break;case"tableColumn1":g(e);break;case"formatNumber":break;case"filedNameKey":s.type==="select"&&E.dataSourceFiledList.forEach(o=>{o.name===e&&(t.value.formItem&&(t.value.formItem.label=o.label),t.value.name=o.label)});break;case"setInputSlot":e?(t.value.type="inputSlot",te.success(`请在对应的Input输入框属性前后缀设置key:${t.value.name}`)):t.value.type="select";break}if(s.path){const o=s.isNum?me(e):e;k(t.value,s.path,o)}},k=(s,e,o)=>{let h=s;const D=e.split(".");let u=0;for(u;u<D.length-1;u++){const _=D[u];if(_ in h)h=h[_];else throw new Error(`${_} is undefined`)}const m=D[u],L=h[D[u]];return o!==void 0&&(h[m]=o),{obj:h,key:m,value:L}},C=(s,e)=>{e==="tabs"?t.value.columns.splice(s,1):t.value.options.splice(s,1)},W=s=>{const e=t.value.type;e==="cascader"?U("cascader"):e==="treeSelect"?U("treeSelect"):s==="tabs"?t.value.columns.push({label:"标签名称",list:[]}):t.value.options.push({label:"",value:""})},U=s=>{var _;let e=t.value.control;const{type:o,config:h,options:D,control:u}=t.value;let m="";switch(o==="button"&&(e=h,s="button"),s){case"editCss":m="css";break;case"editRules":e=((_=t.value.formItem)==null?void 0:_.rules)||[];break;case"treeSelect":e=u.data;break;case"cascader":e=D;break;case"beforeOption":e=h.before;break;case"afterOption":e=h.after;break}M("openDialog",{content:e,codeType:m,type:s,callback:G=>{switch(s){case"editRules":t.value.formItem||(t.value.formItem={}),t.value.formItem.rules=G;break;case"editProps":t.value.control={},Object.assign(t.value.control,G);break;case"treeSelect":t.value.control.data=G;break;case"cascader":t.value.options=G;break;case"beforeOption":t.value.config.before=G;break;case"afterOption":t.value.config.after=G;break;case"button":t.value.config=G;break}}})},H=s=>{var e;(e=t.value.formItem)!=null&&e.rules||(t.value.formItem.rules=[]),s?t.value.formItem.rules.push({required:!0,message:"必填项",trigger:"change"}):t.value.formItem.rules.splice(0,1)},F=(s,e)=>{if(s&&s.length===0||Object.keys(t.value).length===0)return!1;const o=s.indexOf(t.value.type);return e?o!==-1:o===-1},g=s=>{const e={name:"index",type:"index",item:{label:"序号"},control:{},config:{}};s?t.value.list.unshift(e):t.value.list.splice(0,1)},c=Z(()=>{var e,o;const s=(o=(e=t.value)==null?void 0:e.formItem)==null?void 0:o.rules;return!!(s&&s.length>0)}),T=()=>{t.value.customRules||(t.value.customRules=[]),t.value.customRules.push({type:"required",message:"必填项",trigger:"blur"})},B=s=>{var e;(e=t.value.customRules)==null||e.splice(s,1)},R=s=>{s.key==="sourceId"&&(ee(s.value),y.setActiveKey(""),y.setControlAttr({})),s.path==="config"?p.value.config[s.key]=s.value:p.value.form[s.key]=s.value},j=s=>{switch(s){case 1:return"数据源接口URL或api的key";case 2:return"字典key，默认为字段标识"}return""},I=(s,e)=>{const o=Se.filter(h=>h.type===e);o&&o.length&&(s.message=o[0].message)},K=()=>{b.value||ce("sourceList").then(s=>{Y.value=s.data.list})},ee=(s,e)=>{b.value||!s||ce("sourceById",{id:s}).then(o=>{var D;const h=(D=o.data)==null?void 0:D.tableData;try{E.dataSourceFiledList=JSON.parse(h)}catch{E.dataSourceFiledList=[]}e&&e(E.dataSourceFiledList)}).catch(o=>{console.log(o)})};return ge(()=>{Pe(()=>{K()})}),X({getFormFieldBySource:ee}),(s,e)=>{const o=A("el-option"),h=A("el-select"),D=A("el-switch"),u=A("el-input"),m=A("el-form-item"),L=A("el-col"),_=A("el-button"),G=A("el-checkbox"),z=A("el-form"),ne=A("el-tab-pane"),Ue=A("el-tabs");return r(),f("div",Ze,[a(Ue,{modelValue:E.tabsName,"onUpdate:modelValue":e[25]||(e[25]=l=>E.tabsName=l)},{default:n(()=>[a(ne,{label:"字段配置",name:"first"},{default:n(()=>[a(z,{size:"small",class:"form"},{default:n(()=>[e[40]||(e[40]=w("div",{class:"h3"},[w("h3",null,"通用属性")],-1)),(r(!0),f($,null,J(re.value,(l,q)=>(r(),V(m,{key:q,label:l.label},{default:n(()=>[l.type==="select"?(r(),V(h,{key:0,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:l.placeholder,filterable:l.path==="name","allow-create":l.path==="name",clearable:l.clearable,onChange:i=>S(l,i)},{default:n(()=>[(r(!0),f($,null,J(l.dict,(i,ke)=>(r(),V(o,{key:ke,value:l.path==="name"?i.name:ke,label:l.path==="name"?`${i.label}(${i.name})`:i},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","filterable","allow-create","clearable","onChange"])):l.type==="switch"?(r(),V(D,{key:1,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,onChange:i=>S(l,i)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(r(),V(u,{key:2,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,type:l.inputStyle,placeholder:l.placeholder,onInput:i=>S(l,i)},null,8,["modelValue","onUpdate:modelValue","type","placeholder","onInput"]))]),_:2},1032,["label"]))),128)),F(["tabs"],!0)?(r(),f($,{key:0},[e[27]||(e[27]=w("div",{class:"h3"},[w("h3",null,"标签配置项")],-1)),(r(!0),f($,null,J(t.value.columns,(l,q)=>(r(),V(m,{key:q},{default:n(()=>[a(L,{span:12},{default:n(()=>[a(u,{modelValue:l.label,"onUpdate:modelValue":i=>l.label=i,placeholder:"标签配置项"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(L,{span:2,offset:1},{default:n(()=>[w("i",{class:"icon-del",onClick:i=>C(q,"tabs")},null,8,el)]),_:2},1024)]),_:2},1024))),128)),a(m,null,{default:n(()=>[a(_,{onClick:e[0]||(e[0]=l=>W("tabs"))},{default:n(()=>e[26]||(e[26]=[N(" 增加标签 ")])),_:1})]),_:1})],64)):x("",!0),F(["radio","select","checkbox","cascader","inputSlot","treeSelect"],!0)?(r(),f("div",ll,[e[33]||(e[33]=w("div",{class:"h3"},[w("h3",null,"选项配置")],-1)),F(["select"],!0)?(r(),V(m,{key:0,label:"添加全部项"},{default:n(()=>[a(u,{modelValue:t.value.config.addAll,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.config.addAll=l),placeholder:"请输入全部项文案"},null,8,["modelValue"])]),_:1})):x("",!0),a(m,{label:"选项数据源"},{default:n(()=>[a(h,{modelValue:t.value.config.optionsType,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.config.optionsType=l),onChange:e[3]||(e[3]=l=>t.value.config.optionsFun="")},{default:n(()=>[a(o,{value:0,label:"固定选项"}),a(o,{value:1,label:"数据源"}),a(o,{value:2,label:"接口字典"})]),_:1},8,["modelValue"])]),_:1}),t.value.config.optionsType===0?(r(),f($,{key:1},[t.value.type!=="cascader"?(r(),f("div",tl,[(r(!0),f($,null,J(t.value.options,(l,q)=>(r(),V(m,{key:q},{default:n(()=>[a(L,{span:10},{default:n(()=>[a(u,{modelValue:l.label,"onUpdate:modelValue":i=>l.label=i,placeholder:"选项标签"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(L,{span:10,offset:1},{default:n(()=>[a(u,{modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:"选项值"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(L,{span:2,offset:1},{default:n(()=>[w("i",{class:"icon-del",onClick:i=>C(q)},null,8,al)]),_:2},1024)]),_:2},1024))),128))])):x("",!0),a(m,null,{default:n(()=>[a(_,{onClick:W},{default:n(()=>[N(ue(t.value.type==="cascader"?"编辑":"新增"),1)]),_:1})]),_:1})],64)):(r(),f($,{key:2},[a(m,null,{default:n(()=>[a(u,{modelValue:t.value.config.optionsFun,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.config.optionsFun=l),placeholder:j(t.value.config.optionsType)},Fe({_:2},[t.value.config.optionsType===1?{name:"prepend",fn:n(()=>[a(h,{modelValue:t.value.config.method,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.config.method=l),style:{width:"80px"}},{default:n(()=>[a(o,{label:"get",value:"get"}),a(o,{label:"post",value:"post"})]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),t.value.config.optionsType===1?(r(),f($,{key:0},[a(m,{label:"指定label属性值"},{default:n(()=>[a(u,{modelValue:t.value.config.label,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.config.label=l),placeholder:"指定选项标签为选项对象的某个属性值"},null,8,["modelValue"])]),_:1}),a(m,{label:"指定value属性值"},{default:n(()=>[a(u,{modelValue:t.value.config.value,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.config.value=l),placeholder:"指定选项的值为选项对象的某个属性值"},null,8,["modelValue"])]),_:1}),a(m,{label:"是否可筛选"},{default:n(()=>[a(D,{modelValue:t.value.control.filterable,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.control.filterable=l)},null,8,["modelValue"])]),_:1}),F(["select"],!0)?(r(),f($,{key:0},[a(m,{label:"开启远程数据Remote"},{default:n(()=>[a(D,{modelValue:t.value.control.remote,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.control.remote=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"缓存数据结果"},{default:n(()=>[a(D,{modelValue:t.value.config.cache,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.config.cache=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"联动关联设置"},{default:n(()=>[a(u,{modelValue:t.value.config.linkage,"onUpdate:modelValue":e[11]||(e[11]=l=>t.value.config.linkage=l),placeholder:"请输入关联的组件name"},null,8,["modelValue"])]),_:1}),t.value.config.remote||t.value.config.linkage?(r(),V(m,{key:0,label:"远程数据参数字段名"},{default:n(()=>[a(u,{modelValue:t.value.config.queryName,"onUpdate:modelValue":e[12]||(e[12]=l=>t.value.config.queryName=l),placeholder:"远程数据参数字段名"},null,8,["modelValue"])]),_:1})):x("",!0)],64)):x("",!0)],64)):x("",!0),t.value.config.optionsType===1?(r(),V(m,{key:1},{default:n(()=>[a(_,{onClick:e[13]||(e[13]=l=>U("beforeOption"))},{default:n(()=>e[28]||(e[28]=[N(" before事件 ")])),_:1}),a(_,{onClick:e[14]||(e[14]=l=>U("afterOption"))},{default:n(()=>e[29]||(e[29]=[N(" after事件 ")])),_:1})]),_:1})):x("",!0)],64)),a(m,{label:"尝试转换value值为"},{default:n(()=>[a(h,{modelValue:t.value.config.transformData,"onUpdate:modelValue":e[15]||(e[15]=l=>t.value.config.transformData=l),placeholder:"默认为number"},{default:n(()=>[a(o,{value:"none"},{default:n(()=>e[30]||(e[30]=[N(" 不转换 ")])),_:1}),a(o,{value:"number"},{default:n(()=>e[31]||(e[31]=[N(" number ")])),_:1}),a(o,{value:"string"},{default:n(()=>e[32]||(e[32]=[N(" string ")])),_:1})]),_:1},8,["modelValue"])]),_:1})])):x("",!0),!b.value&&F(["txt","title","table","grid","tabs","card","switch","gridChild","tableColumn","divider","div","button"])?(r(),f($,{key:2},[e[37]||(e[37]=w("div",{class:"h3"},[w("h3",null,"校验设置")],-1)),F(["input","password","component"],!0)?(r(),f("div",ol,[(r(!0),f($,null,J(t.value.customRules,(l,q)=>(r(),V(m,{key:l.type},{default:n(()=>[a(u,{modelValue:l.message,"onUpdate:modelValue":i=>l.message=i,placeholder:"校验提示信息"},{prepend:n(()=>[a(h,{modelValue:l.type,"onUpdate:modelValue":i=>l.type=i,style:{width:"80px"},onChange:i=>I(l,i)},{default:n(()=>[(r(!0),f($,null,J(E.customRulesList,i=>(r(),V(o,{key:i.type,label:i.label,value:i.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),append:n(()=>[w("i",{class:"icon-del",onClick:i=>B(q)},null,8,nl)]),_:2},1032,["modelValue","onUpdate:modelValue"]),l.type==="rules"?(r(),V(u,{key:0,modelValue:l.rules,"onUpdate:modelValue":i=>l.rules=i,placeholder:"正则表达式"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),l.type==="methods"?(r(),V(u,{key:1,modelValue:l.methods,"onUpdate:modelValue":i=>l.methods=i,placeholder:"方法名称，此方法仅适用于导出vue文件"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)]),_:2},1024))),128)),a(m,null,{default:n(()=>[a(_,{onClick:T},{default:n(()=>e[34]||(e[34]=[N(" 快速添加 ")])),_:1}),a(_,{onClick:e[16]||(e[16]=l=>U("editRules"))},{default:n(()=>e[35]||(e[35]=[N(" 编写校验规则 ")])),_:1})]),_:1})])):(r(),V(m,{key:1},{default:n(()=>{var l,q;return[a(G,{"model-value":c.value,onChange:H},{default:n(()=>e[36]||(e[36]=[N(" 必填 ")])),_:1},8,["model-value"]),(l=t.value.item)!=null&&l.rules&&((q=t.value.item)!=null&&q.rules[0])?(r(),V(u,{key:0,modelValue:t.value.item.rules[0].message,"onUpdate:modelValue":e[17]||(e[17]=i=>t.value.item.rules[0].message=i),placeholder:"自定义必填错误提示"},null,8,["modelValue"])):x("",!0)]}),_:1}))],64)):x("",!0),F(["grid","card","gridChild","divider","div"])?(r(),f("div",sl,[e[39]||(e[39]=w("div",{class:"h3"},[w("h3",null,"其他属性")],-1)),a(_,{size:"small",onClick:e[18]||(e[18]=l=>U("editProps"))},{default:n(()=>e[38]||(e[38]=[N(" 编辑属性 ")])),_:1})])):x("",!0)]),_:1})]),_:1}),a(ne,{label:"表单配置",name:"second"},{default:n(()=>[a(z,{size:"small",class:"form"},{default:n(()=>[(r(!0),f($,null,J(oe.value.filter(l=>!l.hide),(l,q)=>(r(),V(m,{key:q,label:l.label},{default:n(()=>[l.type==="select"?(r(),V(h,{key:0,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,filterable:l.key==="class","allow-create":l.key==="class",placeholder:l.placeholder,clearable:l.clearable,onChange:i=>R(l)},{default:n(()=>[(r(!0),f($,null,J(l.options,i=>(r(),V(o,{key:i.label||i.name,label:i.label||i.name,value:se(me)(i.value??i.id)},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","filterable","allow-create","placeholder","clearable","onChange"])):l.type==="switch"?(r(),V(D,{key:1,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,onChange:i=>R(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(r(),V(u,{key:2,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:l.placeholder,onInput:i=>R(l)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"]))]),_:2},1032,["label"]))),128)),a(m,null,{default:n(()=>[a(_,{type:"primary",onClick:e[19]||(e[19]=l=>U("editCss"))},{default:n(()=>e[41]||(e[41]=[N(" 编辑表单样式 ")])),_:1})]),_:1}),b.value?x("",!0):(r(),f($,{key:0},[e[45]||(e[45]=w("div",{class:"h3"},[w("h3",null,"接口数据事件")],-1)),a(m,{label:"提交保存url"},{default:n(()=>[a(u,{modelValue:se(p).config.submitUrl,"onUpdate:modelValue":e[20]||(e[20]=l=>se(p).config.submitUrl=l),placeholder:"表单提交的url，通用提交时可不设置"},null,8,["modelValue"])]),_:1}),a(m,{label:"获取表单数据url"},{default:n(()=>[a(u,{modelValue:se(p).config.requestUrl,"onUpdate:modelValue":e[21]||(e[21]=l=>se(p).config.requestUrl=l),placeholder:"获取表单数据url，通用提交时可不设置"},null,8,["modelValue"])]),_:1}),a(m,{class:"event-btn"},{default:n(()=>[a(_,{type:"primary",onClick:e[22]||(e[22]=l=>U("before"))},{default:n(()=>e[42]||(e[42]=[N(" before事件 ")])),_:1}),a(_,{type:"primary",onClick:e[23]||(e[23]=l=>U("after"))},{default:n(()=>e[43]||(e[43]=[N(" after事件 ")])),_:1}),a(_,{type:"primary",onClick:e[24]||(e[24]=l=>U("change"))},{default:n(()=>e[44]||(e[44]=[N(" change改变事件 ")])),_:1})]),_:1})],64))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),il=Q=>{const X=[];return Q.forEach(P=>{const M=ul(P);let p={};switch(P.filedType){case"select":p={control:{},options:[],config:{optionsType:0}};break;case"radio":p={options:[],config:{optionsType:0}};break;case"checkbox":case"cascader":p={control:{modelValue:[]},options:[],config:{optionsType:0}};break;case"switch":p={control:{modelValue:!1},options:[]};break;case"datePicker":p={control:{type:"date"}};break;case"inputNumber":case"slider":p={control:{modelValue:0}};break}X.push(Object.assign({},M,p))}),X},ul=Q=>he({type:Q.filedType,control:{modelValue:""},config:{},name:Q.name,formItem:{label:Q.label}}),cl={class:"design-container"},dl={class:"main-body"},pl={class:"main-form"},vl={key:0,class:"empty-tips"},ml={class:"dialog-footer"},fl=ve({name:"DesignFormIndex",__name:"index",setup(Q){Oe().changeBreadcrumb([{label:"系统工具"},{label:"表单设计"}]);const P=xe(),M=Ee(),p=ye(),d=ae({list:[],form:{size:"default"},config:{submitCancel:!0}}),O=ae();Le("formData",d);const y=pe({editor:{},loading:!1,formDataPreview:{},previewVisible:!1,operateType:p.query.type}),v=pe({visible:!1,type:"",title:"",codeType:"",direction:void 0,callback:""}),t=ae(),b=ae(),Y=()=>{const g=p.query.id;g&&(y.loading=!0,ce("designById",{id:g}).then(c=>{const T=c.data;if(T.data){const B=ie(T.data);B&&Object.keys(B).length&&(d.value=B)}d.value.config.sourceId=T.source,d.value.config.name=T.name,T.source&&y.operateType!=="search"&&b.value.getFormFieldBySource(T.source),y.loading=!1}).catch(c=>{te.error(c.message||"加载异常"),y.loading=!1}))},oe=()=>{const{id:g,redirect:c}=p.query,{submitUrl:T,requestUrl:B}=d.value.config;if(!d.value.config.sourceId&&(!T||!B)&&y.operateType!=="search"){te.error("请选择数据源或配置接口url地址，否则表单无法提交保存");return}let R={data:le(d.value),source:d.value.config.sourceId,name:d.value.config.name||"未命名",type:1},j="designSave";g?(Object.assign(R,{id:g}),j="designEdit"):R.status=1,y.operateType==="search"&&(R={data:le(d.value),id:g}),y.loading=!0,ce(j,R).then(I=>{te({message:I.message||"保存成功！",type:"success"});const K=c||"/design/form/list",ee={};c&&c.indexOf("?")!==-1&&c.split("?")[1].split("&").forEach(o=>{const h=o.split("=");ee[h[0]]=h[1]}),M.push({path:K,query:ee}),y.loading=!1}).catch(I=>{te.error(I.message||"保存异常"),y.loading=!1}),P.setActiveKey(""),P.setControlAttr({})},re=g=>{switch(g){case"del":d.value=JSON.parse(O.value),P.setActiveKey(""),P.setControlAttr({});break;case"eye":P.setActiveKey(""),P.setControlAttr({}),y.previewVisible=!0;let c=le(d.value);const T=d.value.form.name,B=new RegExp(`get${T}ControlByName`,"g");c=c.replace(B,`getPreview${T}ControlByName`),y.formDataPreview=ie(c),y.formDataPreview.form.name=`Preview${T}`;break;case"json":E({type:"creatJson",content:d.value});break;case"save":oe();break;case"vue":t.value.open(d.value);break}},E=g=>{var K;const{type:c,direction:T,codeType:B,callback:R,content:j}=g;v.direction=T||"ltr",v.type=c,v.codeType=B||"",v.title=Ve[c],v.visible=!0,v.callback=R;let I;switch(c){case"editCss":I=((K=d.value.config)==null?void 0:K.style)||"";break;case"before":case"after":case"change":const ee=d.value.events||{};if(ee[c])I=le(ee[c],!0);else{let e=c;c!=="change"&&(e=c+"Type"),I=we(e,"form")}break;case"beforeOption":case"afterOption":const s=c.replace("Option","");j?I=le(j,!0):I=we(s),v.title=Ve[s];break;case"creatJson":I=le(j,!0);break;default:I=le(j,!0)}v.content=I},S=g=>{try{let c;switch(v.codeType){case"json":c=qe(g);break;case"css":c=g;break;default:c=ie(g)}switch(typeof v.callback=="function"&&v.callback(c),v.type){case"editCss":d.value.config||(d.value.config={}),d.value.config.style=c;break;case"before":case"after":case"change":d.value.events||(d.value.events={}),d.value.events[v.type]=c;break;case"creatJson":d.value=c;break}C()}catch(c){te.error(c.message||"未知原因")}},k=()=>{C()},C=()=>{v.visible=!1,v.type="",v.title="",v.codeType="",v.callback="",v.content=""},W=ae(),U=()=>{W.value.validate((g,c)=>{if(g)te.success("校验通过"),console.log(c);else return te.error("校验不通过"),!1})},H=g=>{d.value=ie(le(g))},F=g=>{d.value.list.push(g)};return ge(()=>{Y(),O.value=JSON.stringify(d.value);const g=p.query.source;g&&(d.value.config.sourceId=g,b.value.getFormFieldBySource(g,c=>{d.value.list=il(c)}))}),(g,c)=>{var I;const T=A("ak-form"),B=A("el-button"),R=A("el-dialog"),j=Ae("loading");return r(),f("div",cl,[a(Ye,{onClickCheck:F,onClick:H},null,8,["onClickCheck"]),w("div",dl,[a(Ne,{onClick:re}),Be((r(),f("div",pl,[((I=d.value.list)==null?void 0:I.length)===0?(r(),f("div",vl," 从左侧拖拽来添加字段 ")):x("",!0),a(T,{data:d.value,"operate-type":g.$route.query.type==="search"?"designSearch":"design"},null,8,["data","operate-type"])])),[[j,y.loading]])]),a(rl,{ref_key:"formControlAttrEl",ref:b,onOpenDialog:E},null,512),a(Re,{modelValue:v.visible,"onUpdate:modelValue":c[0]||(c[0]=K=>v.visible=K),title:v.title,direction:v.direction,content:v.content,"code-type":v.codeType,onBeforeClose:k,onConfirm:S},null,8,["modelValue","title","direction","content","code-type"]),["search"].includes(y.operateType)?x("",!0):(r(),V(Te,{key:0,ref_key:"vueFileEl",ref:t},null,512)),a(R,{modelValue:y.previewVisible,"onUpdate:modelValue":c[2]||(c[2]=K=>y.previewVisible=K),title:"预览",fullscreen:!0},{footer:n(()=>[w("div",ml,[a(B,{size:"small",type:"primary",onClick:U},{default:n(()=>c[3]||(c[3]=[N(" 提交 ")])),_:1}),a(B,{size:"small",onClick:c[1]||(c[1]=K=>y.previewVisible=!1)},{default:n(()=>c[4]||(c[4]=[N(" 取消 ")])),_:1})])]),default:n(()=>[y.previewVisible?(r(),V(T,{key:0,ref_key:"previewForm",ref:W,data:y.formDataPreview},null,8,["data"])):x("",!0)]),_:1},8,["modelValue"])])}}});typeof Ce=="function"&&Ce(fl);export{fl as default};
