import{A as k,d as N,y as A,u as M,l as D,G as B,h as I,C as S,B as W,p as $,r as _,W as G,s as P,o as y,c as X,b as x,e as L,w as Y,j as z,N as f,X as C,Y as T,q as w}from"./index-D9mad5Az.js";const H=(m,r,p={})=>new Promise((n,u)=>{const a=Object.assign({},p,{responseType:"blob"});k(m,r,a).then(i=>{const{data:c,headers:b}=i,g=decodeURI(b["content-disposition"].split(";")[1].split("=")[1])||`${m.substr(1).replace(/\//g,"_")}_${new Date().getTime()}.xls`,d=window.URL.createObjectURL(new Blob([c],{type:c.type})),t=document.createElement("a");t.style.display="none",t.href=d,t.setAttribute("download",g),document.body.appendChild(t),t.click(),document.body.removeChild(t),n(i)}).catch(i=>{u(i)})}),K=N({__name:"[id]",setup(m){const r=A(),p=M(),n=D(),u=D(!0),a=B({searchData:[],tableData:[],dict:{},visible:!0,source:""}),i=I(()=>r.params.id),c=()=>{if(a.tableData=[],n.value.resetList(),!i.value)return f.error("非法操作..."),!1;const e={id:i.value};k("designById",e).then(o=>{const s=o.data;s&&Object.keys(s).length&&(a.searchData=C(s.data),a.tableData=C(s.listData),a.dict=T(s.dict),a.source=s.source,w(()=>{n.value.getListData(),u.value=!1}),j())})};S(()=>{b()});const b=W(()=>r.params.id,()=>{c()},{}),g=(e,o)=>{if(o==="fetch"){e.extend.formId=a.source;const s=a.tableData.events?.before;if(typeof s=="function")return s(e,r)}else if(o==="del"){e.formId=a.source;const s=a.tableData.events?.before;if(typeof s=="function")return s(e,r)}else o==="submit"&&(e.formId=a.source);return e},d=D(),t=B({visible:!1,title:"",formType:"add",formData:{},width:"",dict:{},editId:""}),v=I(()=>a.source&&a.tableData.config?.openType==="dialog"),j=()=>{v.value&&(t.width=a.tableData.config?.dialogWidth,k("designById",{id:a.source}).then(e=>{const o=e.data;o&&Object.keys(o).length&&(t.formData=C(o.data),t.dict=T(o.dict))}).catch(e=>{f.error(e.message||"非法操作.")}))},E=(e,o)=>{if(e==="export"){const s=Object.assign({},n.value.getSearchFormValue(),{listId:i.value});H("importExcel",s).then(()=>{f.success("正在导出..")}).catch(l=>{f.error(l.message)})}else(e==="add"||e==="edit")&&(v.value?(t.visible=!0,t.title=e==="add"?"新增":"编辑",t.formType=e,t.editId=o&&o.id,e==="add"&&t.formData.config?.addLoad&&w(()=>{d.value.getData()}),e==="edit"&&w(()=>{d.value.getData()})):p.push({path:"/design/form/form/",query:{form:a.source,id:o?.id}}))},F=(e,o,s)=>{if(s==="submit"){o&&(h(),n.value.getListData());const l=t.formData.events?.after;if(typeof l=="function")return l(s)}},R=e=>{(e==="reset"||e==="cancel")&&h()},O=e=>{h(),e&&e()},h=()=>{t.visible=!1,t.editId=""};return $(()=>{c()}),(e,o)=>{const s=_("ak-list"),l=_("ak-form"),q=_("el-dialog"),V=G("loading");return P((y(),X("div",null,[a.visible?(y(),x(s,{key:0,ref_key:"listEl",ref:n,"search-data":a.searchData,data:a.tableData,dict:a.dict,"api-key":{list:"getContentList",del:"delFormContent",export:"exportContent",edit:"editFormContent"},before:g,"auto-load":!1,onBtnClick:E},null,8,["search-data","data","dict"])):L("",!0),v.value?(y(),x(q,{key:1,modelValue:t.visible,"onUpdate:modelValue":o[0]||(o[0]=U=>t.visible=U),"destroy-on-close":"",title:t.title,width:t.width||"600px","before-close":O},{default:Y(()=>[z(l,{ref_key:"formEl",ref:d,data:t.formData,dict:t.dict,"operate-type":t.formType,"request-url":"getFormContent","submit-url":t.formType==="add"?"saveFormContent":"editFormContent",after:F,params:{formId:a.source},query:{formId:a.source,id:t.editId},onBtnClick:R},null,8,["data","dict","operate-type","submit-url","params","query"])]),_:1},8,["modelValue","title","width"])):L("",!0)])),[[V,u.value]])}}});export{K as default};
