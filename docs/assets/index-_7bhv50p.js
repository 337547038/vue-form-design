import{d as M,l as v,B as j,b as G,o as b,w as m,f as r,U as F,n as x,j as o,c as V,e as $,ac as K,t as N,a3 as P,I as z,O as J,u as X,y as Q,G as Y,p as Z,aa as ee,r as g,W as te,s as ae,F as oe,m as se,a0 as C,q as le,ab as ie,X as ne,N as y,A,z as L}from"./index-DJZwJYaM.js";import{_ as re,a as ce,b as U}from"./aceTooptip-E4T9mKuO.js";const de=["onClick"],ue={key:0,class:"drag-control"},me={class:"item-control"},pe=["onClick"],ge=["onClick"],fe={class:"tooltip"},ve=M({__name:"echarts",props:{data:{},type:{default:2}},emits:["controlBtnClick"],setup(S,{expose:w,emit:D}){const f=S,d=D,_=v(),c=v({list:[],config:{}});j(()=>f.data,s=>{s&&(c.value=s)},{immediate:!0});const T=s=>{if(f.type!==1)return;const p=s.newIndex,l=new Date().getTime().toString(),t=c.value.list[p];t&&(delete t.label,delete t.icon,Object.assign(t,{name:t.type+l}),a(t))},a=s=>{console.log("groupClick",s),_.value=s.name,d("controlBtnClick",s)},k=(s,p,l)=>{if(f.type!==2){if(s==="clone"){const t=l.type+new Date().getTime().toString(),e=JSON.parse(JSON.stringify(l));c.value.list.splice(p,0,Object.assign(e,{name:t}))}else s==="del"&&c.value.list.splice(p,1);d("controlBtnClick","")}};return w({getData:()=>c.value,setDataList:s=>{c.value=s},setData:s=>{console.log(s)}}),(s,p)=>(b(),G(z(J),P({"item-key":"id",list:c.value.list,name:"fade",class:"drag"},{group:"form",ghostClass:"ghost",animation:200,handle:".drag-move"},{onAdd:T}),{item:m(({element:l,index:t})=>[r("div",{class:x(["group",{["group-"+l.type]:!0,[l.class]:l.class,active:_.value===l.name}]),onClick:F(e=>a(l),["stop"])},[o(K,{option:l.option,width:l.width,height:l.height},null,8,["option","width","height"]),s.type===1?(b(),V("div",ue,[r("div",me,[r("i",{class:"icon-clone",title:"克隆",onClick:F(e=>k("clone",t,l),["stop"])},null,8,pe),r("i",{class:"icon-del",onClick:F(e=>k("del",t,l),["stop"])},null,8,ge)]),p[0]||(p[0]=r("div",{class:"drag-move icon-move"},null,-1))])):$("",!0),r("div",fe,N(l.name),1)],10,de)]),_:1},16,["list"]))}}),_e={class:"design-container design-chart"},he={class:"components-list"},ye=["title"],be={class:"main-body"},ke={class:"main-form design-form"},Ce={class:"sidebar-tools"},Ve=["innerHTML"],we={key:0,id:"editJson"},De={class:"dialog-footer"},Te=M({__name:"index",setup(S){const w=X(),D=Q(),f=v(),d=v({}),_=v([{icon:"line",label:"折线图",type:"line",option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{icon:"bar",label:"柱状图",type:"bar",option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{icon:"pie",label:"饼图",type:"pie",option:{series:[{name:"Access From",type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}}]),c=v(),T=t=>JSON.parse(JSON.stringify(t)),a=Y({editor:{},loading:!1,id:D.query.id,direction:"rtl",dialogTitle:"",visible:!1,dialogType:"",name:""}),k=t=>{d.value=t},B=t=>{const e=c.value.getData();switch(t){case"del":c.value.setDataList([]),d.value="";break;case"json":E(e,{type:"export"});break;case"vue":f.value.openEcharts(e);break;case"save":s(e);break}},E=(t,e={})=>{var u,h;a.direction=e.direction||"rtl",a.visible=!0,a.dialogTitle=e.title,a.dialogType=e.type,t||(t=c.value.getData());let n=C(t,!0);switch(e.type){case"beforeFetch":(u=t.config)!=null&&u.beforeFetch?n=C(t.config.beforeFetch,!0):n=U("beforeFetch");break;case"afterFetch":(h=t.config)!=null&&h.afterFetch?n=C(t.config.afterFetch,!0):n=U("afterFetch");break}le(()=>{a.editor=ie(n)})},O=()=>{try{const t=ne(a.editor.getValue());switch(a.dialogType){case"export":c.value.setDataList(t);break;case"beforeFetch":case"afterFetch":const e=c.value.getData();e.config[a.dialogType]=t;break}a.visible=!1}catch(t){y.error(t.message)}},s=t=>{if(!a.name){y.error("请输入图表保存的名称");return}a.loading=!0;const e={data:C(t),id:a.id,name:a.name};A("saveEcharts",e).then(n=>{var u;console.log(n),y({message:((u=n.data)==null?void 0:u.message)||"保存成功！",type:"success"}),w.push({path:"/echarts/list"}),a.loading=!1}).catch(n=>{var u;y.error(((u=n.data)==null?void 0:u.message)||"保存异常"),a.loading=!1})},p=t=>{t()},l=()=>{a.id&&(a.loading=!0,A("echartsList",{id:a.id}).then(t=>{a.loading=!1;const e=t.data;a.name=e.name,c.value.setDataList(e.list)}).catch(t=>{var e;y.error(((e=t.data)==null?void 0:e.message)||"操作异常"),a.loading=!1}))};return Z(()=>{l()}),ee(()=>{Object.keys(a.editor).length!==0&&(a.editor.destroy(),a.editor.container.remove())}),(t,e)=>{const n=g("el-input"),u=g("el-form-item"),h=g("el-tab-pane"),I=g("el-tabs"),q=g("el-form"),R=g("el-button"),W=g("el-drawer"),H=te("loading");return ae((b(),V("div",_e,[r("div",he,[e[7]||(e[7]=r("div",{class:"title"}," 图表类型 ",-1)),o(z(J),{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=i=>_.value=i),"item-key":"key",tag:"ul",group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:T},{item:m(({element:i})=>[r("li",{class:x([i.type])},[r("i",{class:x(`icon-${i.icon}`)},null,2),r("span",{title:i.label},N(i.label),9,ye)],2)]),_:1},8,["modelValue"])]),r("div",be,[o(re,{type:"2",onClick:B}),r("div",ke,[o(ve,{ref_key:"echartsEl",ref:c,type:1,onControlBtnClick:k},null,512)])]),r("div",Ce,[o(q,{size:"small"},{default:m(()=>[o(I,{"model-value":"first"},{default:m(()=>[o(h,{label:"图表属性",name:"first"},{default:m(()=>[Object.keys(d.value).length?(b(),V(oe,{key:0},[o(u,{label:"自定义Class"},{default:m(()=>[o(n,{modelValue:d.value.class,"onUpdate:modelValue":e[1]||(e[1]=i=>d.value.class=i),placeholder:"自定义Class"},null,8,["modelValue"])]),_:1}),o(u,{label:"字段标识"},{default:m(()=>[o(n,{modelValue:d.value.name,"onUpdate:modelValue":e[2]||(e[2]=i=>d.value.name=i),placeholder:"字段标识"},null,8,["modelValue"])]),_:1}),o(u,{label:"图表宽度"},{default:m(()=>[o(n,{modelValue:d.value.width,"onUpdate:modelValue":e[3]||(e[3]=i=>d.value.width=i),modelModifiers:{number:!0},placeholder:"图表宽度，数字类型"},null,8,["modelValue"])]),_:1}),o(u,{label:"图表高度"},{default:m(()=>[o(n,{modelValue:d.value.height,"onUpdate:modelValue":e[4]||(e[4]=i=>d.value.height=i),modelModifiers:{number:!0},placeholder:"图表高度，数字类型"},null,8,["modelValue"])]),_:1})],64)):$("",!0)]),_:1}),o(h,{label:"图表配置",name:"two"},{default:m(()=>[o(u,{label:"保存名称"},{default:m(()=>[o(n,{modelValue:a.name,"onUpdate:modelValue":e[5]||(e[5]=i=>a.name=i),placeholder:"保存名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),o(W,{modelValue:a.visible,"onUpdate:modelValue":e[6]||(e[6]=i=>a.visible=i),size:"60%",direction:a.direction,class:"ace-dialog","append-to-body":!0,"before-close":p},{header:m(()=>[r("div",{innerHTML:a.dialogTitle},null,8,Ve)]),default:m(()=>[a.visible?(b(),V("div",we)):$("",!0),r("div",De,[o(R,{type:"primary",size:"small",onClick:O},{default:m(()=>e[8]||(e[8]=[se(" 确定 ")])),_:1})])]),_:1},8,["modelValue","direction"]),o(ce,{ref_key:"vueFileEl",ref:f},null,512)])),[[H,a.loading]])}}});typeof L=="function"&&L(Te);export{Te as default};
