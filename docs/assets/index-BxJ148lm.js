import{d as B,l as r,G as q,h as F,r as p,o as y,c as N,i as n,w as i,F as O,a as S,b as R,m as h,f as U,s as $,v as z,g as A,S as k,A as M,u as H,L as J,p as K,q as W}from"./index-BIFij2q2.js";const X={style:{width:"100%"}},G=B({__name:"table",props:{modelValue:{default:()=>[]},type:{}},emits:["update:modelValue"],setup(D,{emit:v}){const d=D,g=v,c=r(),o=r(),l=r([]),b=r(d.type);q(()=>d.modelValue,t=>{l.value=t},{deep:!0,immediate:!0});const m=r(!1),_=r({list:[{type:"input",control:{modelValue:"",placeholder:"数据库字段名称"},config:{disabledEdit:!0},name:"name",formItem:{label:"表名字"},customRules:[{type:"required",message:"名字不能为空",trigger:"blur"},{type:"numberLetter",message:"只能为字母数字",trigger:"blur"}]},{type:"select",control:{modelValue:"",appendToBody:!0},options:[{label:"INT",value:"INT"},{label:"VARCHAR",value:"VARCHAR"},{label:"TEXT",value:"TEXT"},{label:"DATETIME",value:"DATETIME"},{label:"FLOAT",value:"FLOAT"},{label:"BOOLEAN",value:"BOOLEAN"}],config:{optionsType:0,disabledEdit:!0},name:"type",formItem:{label:"类型"},customRules:[{type:"required",message:"类型不能为空",trigger:"change"}]},{type:"input",control:{modelValue:""},config:{disabledEdit:!0},name:"length",formItem:{label:"长度/值"}},{type:"input",control:{modelValue:""},config:{disabledEdit:!0},name:"default",formItem:{label:"默认"}},{type:"input",control:{modelValue:"",size:"small"},config:{disabledEdit:!0},name:"remark",formItem:{label:"注释"}},{type:"switch",control:{modelValue:!0},config:{disabledEdit:!0},name:"empty",formItem:{label:"空"}},{type:"input",control:{modelValue:"",placeholder:"中文标题名称"},config:{},name:"label",formItem:{label:"标题"}},{type:"select",control:{modelValue:"",appendToBody:!0},options:[{label:"单行文本",value:"input"},{label:"多行文本",value:"textarea"},{label:"单选框组",value:"radio"},{label:"多选框组",value:"checkbox"},{label:"开关",value:"switch"},{label:"下拉选择框",value:"select"},{label:"日期选择框",value:"datePicker"},{label:"计数器",value:"inputNumber"},{label:"级联选择器",value:"cascader"},{label:"滑块",value:"slider"},{label:"图片/文件",value:"upload"},{label:"富文本",value:"tinymce"}],config:{optionsType:0},name:"filedType",formItem:{label:"组件类型"}},{type:"switch",control:{modelValue:!1},config:{},name:"search",formItem:{label:"模糊搜索"}}],form:{labelWidth:"60px",class:"form-row-3",size:"small",name:"source"},config:{}}),V=F(()=>{const t=[];return _.value.list.forEach(e=>{var a;t.push({label:(a=e.formItem)==null?void 0:a.label,prop:e.name})}),t}),E=(t,e)=>{m.value=!0,c.value.setValue(t),o.value=e,b.value=d.type},w=(t,e)=>{if(m.value=!1,d.type===2&&t.isNew!==1){k.error("新添加的才能删除");return}l.value.splice(e,1)},I=()=>{c.value.resetFields(),m.value=!0,o.value=void 0,b.value=1},T=()=>{if(o.value!==void 0){const t=c.value.getValue();l.value.splice(o.value,1,t),o.value=void 0,m.value=!1}else c.value.validate((t,e)=>{if(t){let a=!1;if(l.value.forEach(s=>{s.name===e.name&&(a=!0)}),["INT","VARCHAR"].includes(e.type)&&!e.length){k.error(`名字列${e.name}的长度值不能为空`);return}if(a){k.error(`数据表名字${e.name}已存在`);return}e.isNew=1,l.value.push(e),m.value=!1}});g("update:modelValue",l.value)};return(t,e)=>{const a=p("el-table-column"),s=p("el-button"),f=p("el-table"),C=p("ak-form");return y(),N("div",X,[n(f,{data:l.value,style:{"margin-bottom":"10px"}},{default:i(()=>[(y(!0),N(O,null,S(V.value,u=>(y(),R(a,{key:u.prop,prop:u.prop,label:u.label},null,8,["prop","label"]))),128)),n(a,{width:"110px"},{default:i(({row:u,$index:x})=>[n(s,{type:"primary",link:"",onClick:L=>E(u,x)},{default:i(()=>[h("编辑")]),_:2},1032,["onClick"]),u.isNew?(y(),R(s,{key:0,type:"primary",link:"",onClick:L=>w(u,x)},{default:i(()=>[h("删除")]),_:2},1032,["onClick"])):U("",!0)]),_:1})]),_:1},8,["data"]),n(s,{onClick:I,size:"small"},{default:i(()=>[h("添加一行")]),_:1}),$(A("div",null,[n(C,{ref_key:"formEl",ref:c,data:_.value,type:b.value},{default:i(()=>[n(s,{onClick:T,type:"primary"},{default:i(()=>[h("保存")]),_:1})]),_:1},8,["data","type"])],512),[[z,m.value]])])}}}),P=A("div",{class:"tips"}," 提示：默认会添加id自增主键；其中标题作为表单的label值，组件类型仅用于一健创建表单；模糊搜索用于条件查询时 ",-1),Q=B({__name:"index",setup(D){const v=M(),d=H(),g=r(),c=r(),o=r([]),l=J({visible:!1,title:"",type:1,id:""}),b=e=>{l.visible=!0,l.title="修改数据源",l.type=2,l.id=e,W(()=>{c.value.getData({id:e})})},m=r({columns:[{label:"勾选",type:"selection",prop:"selection"},{prop:"id",label:"编号"},{prop:"name",label:"名称",width:150},{prop:"tableName",label:"数据表名",width:150},{prop:"category",label:"分类",config:{tagList:{0:"success"},dictKey:"sys-source"}},{prop:"status",label:"状态",config:{tagList:{0:"info",1:"success"},dictKey:"sys-status"}},{prop:"creatUser",label:"创建人"},{prop:"updateDate",label:"修改时间",config:{formatter:"{y}-{m}-{d} {h}:{i}:{s}"},width:170},{label:"操作",prop:"__control",width:"200px"}],controlBtn:[{label:"新增",type:"primary",click:()=>{l.visible=!0,l.title="创建数据源",l.type=1,l.id=""}},{label:"删除",key:"del",type:"danger"}],operateBtn:[{label:"编辑",click:e=>{b(e.id)}},{label:"删除",key:"del"},{label:"一键创建表单",click:e=>{d.push({path:"/design/form",query:{source:e.id}})}}],config:{expand:!0,searchJump:!0}}),_=r({list:[{type:"input",control:{modelValue:"",placeholder:"请输入名称"},name:"name",formItem:{label:"名称"}},{type:"input",control:{modelValue:"",placeholder:"请输入数据库表名"},name:"tableName",formItem:{label:"数据表名"}}],config:{submitCancel:!0}}),V=r({list:[{type:"input",control:{modelValue:"",placeholder:"请输入数据源名称"},config:{},name:"name",formItem:{label:"名称"},customRules:[{type:"required",message:"请输入数据源名称",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入数据表名"},config:{disabledEdit:!0},name:"tableName",formItem:{label:"数据表名"},customRules:[{type:"required",message:"请输入创建生成的数据表名",trigger:"blur"}]},{type:"select",control:{modelValue:"",appendToBody:!0},options:[],config:{optionsType:2,optionsFun:"sys-source"},name:"category",formItem:{label:"分类"}},{type:"input",control:{modelValue:"",placeholder:"数据库表注释"},config:{disabledEdit:!0},name:"remark",formItem:{label:"表注释"}},{type:"switch",control:{modelValue:1,activeValue:1,inactiveValue:0},config:{},name:"status",formItem:{label:"状态"}},{type:"title",control:{modelValue:"数据库表字段"},config:{span:24},name:"title"}],form:{labelWidth:"100px",class:"form-row-2",size:"default",name:"source"},config:{submitCancel:!0,submitUrl:"sourceCreat",editUrl:"sourceEdit",requestUrl:"sourceById"}}),E=(e,a)=>{const s=JSON.parse(a.tableData);return s.forEach(f=>{f.isNew&&delete f.isNew}),o.value=s,a},w=e=>l.type===1&&!o.value.length?(k.error("数据库表字段内容不能为空"),!1):(e.tableData=JSON.stringify(o.value),e),I=e=>{e==="success"&&(l.visible=!1,g.value.getListData(),t())},T=e=>{e==="reset"&&(l.visible=!1,t())},t=e=>{o.value=[],e&&e()};return K(()=>{v.query.source&&b(v.query.source)}),(e,a)=>{const s=p("ak-list"),f=p("ak-form"),C=p("el-dialog");return y(),N("div",null,[n(s,{ref_key:"tableListEl",ref:g,"request-url":"sourceList","delete-url":"sourceDelete","search-data":_.value,data:m.value},null,8,["search-data","data"]),n(C,{modelValue:l.visible,"onUpdate:modelValue":a[1]||(a[1]=u=>l.visible=u),title:l.title,width:"1000px","destroy-on-close":"","before-close":t},{default:i(()=>[n(f,{ref_key:"formEl",ref:c,data:V.value,type:l.type,"submit-url":"sourceCreat","edit-url":"sourceEdit","request-url":"sourceById","before-submit":w,"after-submit":I,"after-fetch":E,params:{id:l.id},onBtnClick:T},{default:i(()=>[n(G,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=u=>o.value=u),type:l.type},null,8,["modelValue","type"])]),_:1},8,["data","type","params"]),P]),_:1},8,["modelValue","title"])])}}});export{Q as default};
