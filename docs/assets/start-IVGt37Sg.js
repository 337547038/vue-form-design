import{d as T,A as x,u as V,k as F,l as s,h as y,p as R,r as u,B as $,s as j,o as g,c as L,i as r,w as i,C as A,b as M,f as O,g as l,x as P,D as w,j as z,E as k}from"./index-58CrIaYW.js";const G={class:"container-apply-start"},H=l("div",{class:"status"},[l("ul",null,[l("li",{class:"s1"},"● 已完成"),l("li",{class:"s2"},"● 进行中"),l("li",{class:"s3"},"● 未进行"),l("li",{class:"s4"},"● 已拒绝"),l("li",{class:"s5"},"● 跳过")])],-1),J=T({__name:"start",setup(K){const t=x(),h=V();F().changeBreadcrumb([{label:"工作台"},{label:t.query.id?"我发起的":"发起流程"}]);const d=s(),m=s(),f=s({list:[],form:{}}),p=s(!0),_=s(),b=s(),q=y(()=>t.query.id?2:1),v=y(()=>z("userInfo",!0)),I=()=>{const a={id:t.query.flowId};P("flowFrom",a).then(n=>{const{flow:o,form:e}=n.data;d.value.setValue(w(o.data)),f.value=w(e.data),_.value=e.id,b.value=o.name,p.value=!1;const c=t.query.id;c&&m.value.getData({formId:e.id,id:c})})},S=a=>{var e;const n={form:a,flow:{flowId:t.query.flowId,formId:_.value,id:t.query.id,userId:v.value.id,title:`${v.value.userName}提交的${b.value}申请审批`,creatTime:new Date}},o=(e=f.value.events)==null?void 0:e.beforeSubmit;return typeof o=="function"?o(n):n},D=a=>{a==="success"?h.push({path:"/task/applyed"}):console.log("提交失败")},B=s({columns:[{label:"节点名称",prop:"nodeName"},{label:"处理人",prop:"name"},{label:"任务状态",prop:"status",config:{}},{label:"开始时间",prop:"startTime",config:{formatter:"{y}-{m}-{d} {h}:{i}:{s}"}},{label:"结束时间",prop:"endTime",config:{formatter:"{y}-{m}-{d} {h}:{i}:{s}"}},{label:"审批意见",prop:"remark"}],config:{columnsSetting:!1}});return R(()=>{I()}),(a,n)=>{const o=u("ak-form"),e=u("el-tab-pane"),c=u("ak-flow"),C=u("ak-list"),E=u("el-tabs"),N=$("loading");return j((g(),L("div",G,[r(E,null,{default:i(()=>[r(e,{label:"表单信息"},{default:i(()=>[r(o,{ref_key:"formEl",ref:m,data:f.value,"before-submit":S,"after-submit":D,type:q.value,disabled:!!A(t).query.id,"request-url":"getFormContent","submit-url":"flowSave","edit-url":"editFormContent"},null,8,["data","type","disabled"])]),_:1}),r(e,{label:"流程图",name:"flow",class:"flow-box"},{default:i(()=>[H,r(c,{type:1,ref_key:"flowEl",ref:d},null,512)]),_:1}),a.$route.query.id?(g(),M(e,{key:0,label:"流转记录",name:"change"},{default:i(()=>[r(C,{ref:"tableListEl",data:B.value},null,8,["data"])]),_:1})):O("",!0)]),_:1})])),[[N,p.value]])}}});typeof k=="function"&&k(J);export{J as default};
