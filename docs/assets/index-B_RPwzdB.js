import{d as C,k as E,l as c,y as N,u as S,h as g,p as B,r as i,c as L,o as D,f as F,j as a,w as f,m as j,N as v,a0 as R,X as z,q as M,z as _}from"./index-CYQNA_yI.js";const O={class:"design-flow-container"},P={class:"tools"},Q=C({__name:"index",setup(U){E().changeBreadcrumb([{label:"系统工具"},{label:"流程设计"}]);const m=c(),l=c(),d=N(),p=S(),n=c(d.query.tabs||"info"),k=c({list:[{type:"input",control:{modelValue:"",placeholder:"请输入流程名称"},config:{},name:"name",formItem:{label:"流程名称"},customRules:[{type:"required",message:"请输入流程名称",trigger:"blur"}]},{type:"select",control:{modelValue:""},options:[],config:{optionsType:1,optionsFun:"designList",method:"post",debug:!0,label:"name",value:"id",before:e=>(e.query={},e.query.type=1,e.query.status=1,e.query.category=2,e)},name:"source",formItem:{label:"流程表单",rules:[{required:!0,message:"请选择流程表单",trigger:"blur"}]}},{type:"switch",control:{modelValue:1,activeValue:1,inactiveValue:0},options:[],config:{optionsType:2},name:"status",formItem:{label:"状态"}},{type:"component",control:{modelValue:"",colorPicker:!0},config:{componentName:"DiyIconfont"},name:"icon",formItem:{label:"流程图标"}},{type:"select",control:{modelValue:""},options:[],config:{optionsType:2,optionsFun:"sys-flow"},name:"category",formItem:{label:"所在分组"}},{type:"select",control:{modelValue:""},options:[],config:{optionsType:1,optionsFun:"roleList",label:"name",value:"id"},name:"roleId",formItem:{label:"角色权限",hideLabel:!1}},{type:"textarea",control:{modelValue:""},config:{span:24},name:"remark",formItem:{label:"备注说明",hideLabel:!1}}],form:{class:"form-row-2",labelWidth:"110px",size:"default"},config:{}}),t=g(()=>d.query.id),b=g(()=>t.value?"edit":"add"),V=e=>{e.paneName},w=()=>{l.value.flowValidate(0)?m.value.submit():v.error("请为审批和抄送节点设置审批人")},h=(e,o)=>(o==="submit"&&(t.value&&(e.id=t.value),e.type=3,l.value?.getValue&&(e.data=R(l.value?.getValue()))),e),q=(e,o,s)=>{if(s==="fetch")l.value.setValue(z(e.data));else if(s==="submit")n.value==="info"?(n.value="flow",t.value||(p.push({path:"/design/flow",query:{id:e,tabs:"flow"}}),M(()=>{y()}))):p.push({path:"/design/flow/list"});else if(s==="validate"&&n.value==="flow"){let r;try{for(const u in e)if(!r){r=e[u][0].message;break}v.error(r)}catch{}}return e},y=()=>{t.value&&m.value.getData({id:t.value})};return B(()=>{y()}),(e,o)=>{const s=i("el-button"),r=i("ak-form"),u=i("el-tab-pane"),I=i("ak-flow"),T=i("el-tabs");return D(),L("div",O,[F("div",P,[a(s,{type:"primary",onClick:w},{default:f(()=>[...o[1]||(o[1]=[j(" 保存 ",-1)])]),_:1})]),a(T,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=x=>n.value=x),class:"flow-tabs",onTabClick:V},{default:f(()=>[a(u,{label:"基础信息",name:"info",class:"tabs-info"},{default:f(()=>[a(r,{ref_key:"formEl",ref:m,data:k.value,"operate-type":b.value,"submit-url":b.value==="add"?"designSave":"designEdit","request-url":"designById",before:h,after:q},null,8,["data","operate-type","submit-url"])]),_:1}),a(u,{label:"审批流程",name:"flow"},{default:f(()=>[a(I,{ref_key:"flowEl",ref:l},null,512)]),_:1})]),_:1},8,["modelValue"])])}}});typeof _=="function"&&_(Q);export{Q as default};
