import{d as O,l as a,h as A,i as M,G as P,p as G,r as i,c as g,o as k,F as T,j as o,w as r,f as u,t as x,m as f,q as E,A as N,N as I}from"./index-CYQNA_yI.js";import{F as R}from"./tabs-BqYhDfP6.js";const H={class:"flow-detail-drawer"},J={class:"header"},K={class:"face"},Q=["src"],W={key:1,class:"icon-user"},X={class:"name"},Y={class:"button"},Z=O({__name:"drawerTodo",setup(F,{expose:p}){const m=a(),c=A(()=>M("userInfo",!0)),l=P({visible:!1,callback:"",obj:{},loading:!0}),y=(t,e)=>{l.visible=!0,l.obj=t,l.callback=e,E(()=>{m.value.initFlowForm(t)})},s=a(),b=()=>{N("postDetail",{id:c.value.postId}).then(t=>{s.value=t.data.name})},d=a(),v=a(),_=a(),w=t=>{t==="ok"?d.value.submit({status:1,content:"同意"}):t==="no"?d.value.submit({status:0,content:"拒绝"}):t==="to"&&(v.value="",_.value="",E(()=>{C.value.open()}))},C=a(),D=t=>{if(t?.length){console.log("obj",t);const e={id:l.obj?.id,userId:v.value,userName:_.value,nodeName:l.obj.currentNode};N("flowToUser",e).then(V=>{l.visible=!1,I.success(V.message),l.callback&&l.callback()}).catch(()=>{})}else I.error("请选择用户")},S=a({list:[{type:"divider",control:{},config:{},formItem:{label:"审批意见"}},{type:"radio",control:{modelValue:"1",placeholder:"请选择常用审批意见"},options:[{label:"同意",value:1},{label:"拒绝",value:0}],config:{optionsType:0,span:8},name:"status",formItem:{label:"快选审批意见"}},{type:"textarea",control:{modelValue:"同意"},config:{},name:"content",formItem:{label:"审批意见",rules:[{required:!0,message:"请输入审批意见",trigger:"change"}]}}],form:{size:"default"},config:{submitCancel:[{label:"提交审批",type:"primary",key:"submit"}]}}),j=t=>(t.id=l.obj?.id,t),B=(t,e)=>{e&&(l.visible=!1,l.callback&&l.callback())},L=({name:t,value:e})=>{t==="type"&&d.value.setValue({content:e===1?"同意":"拒绝"})};return G(()=>{b()}),p({open:y}),(t,e)=>{const V=i("el-tag"),h=i("el-button"),U=i("ak-form"),$=i("el-divider"),q=i("el-drawer"),z=i("user-dialog");return k(),g(T,null,[o(q,{modelValue:l.visible,"onUpdate:modelValue":e[3]||(e[3]=n=>l.visible=n),"destroy-on-close":"","with-header":!1,size:"1200px"},{default:r(()=>[u("div",H,[u("div",J,[u("div",K,[c.value.picture?(k(),g("img",{key:0,style:{width:"40px",height:"40px","border-radius":"50%",display:"block"},src:c.value.picture,alt:""},null,8,Q)):(k(),g("i",W))]),u("div",null,[u("div",X,x(c.value.userName),1),o(V,null,{default:r(()=>[f(x(s.value)+"审批中",1)]),_:1})]),u("div",Y,[o(h,{type:"success",onClick:e[0]||(e[0]=n=>w("ok"))},{default:r(()=>[...e[6]||(e[6]=[f(" 一键同意 ",-1)])]),_:1}),o(h,{type:"danger",onClick:e[1]||(e[1]=n=>w("no"))},{default:r(()=>[...e[7]||(e[7]=[f(" 一键拒绝 ",-1)])]),_:1}),o(h,{type:"primary",onClick:e[2]||(e[2]=n=>w("to"))},{default:r(()=>[...e[8]||(e[8]=[f(" 流转 ",-1)])]),_:1})])]),o(R,{ref_key:"flowTabsEl",ref:m},{default:r(()=>[o(U,{ref_key:"formOptionsEl",ref:d,data:S.value,"submit-url":"flowShenPi",before:j,after:B,onChange:L},null,8,["data"]),o($,null,{default:r(()=>[...e[9]||(e[9]=[f("申请信息",-1)])]),_:1})]),_:1},512)])]),_:1},8,["modelValue"]),o(z,{ref_key:"userDialogEl",ref:C,modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=n=>v.value=n),"user-name":_.value,"onUpdate:userName":e[5]||(e[5]=n=>_.value=n),onChange:D},null,8,["modelValue","user-name"])],64)}}}),le={__name:"todo",setup(F){const p=a(),m=a(),c=s=>(s.task="todo",s),l=a({list:[{type:"input",control:{modelValue:"",placeholder:"请输入审批标题"},config:{},name:"title",formItem:{label:"审批标题"}}],form:{size:"default"},config:{submitCancel:!0}}),y=a({columns:[{prop:"title",label:"审批标题"},{prop:"creatTime",label:"发起时间",render:"datetime",config:{}},{prop:"status",label:"流程状态",render:"tag",replaceValue:"sys-flow-status",custom:{0:"primary",1:"info",2:"warning",3:"success",4:"danger",5:"danger"}},{prop:"__control",label:"操作",render:"buttons",buttons:[{type:"primary",label:"审批",click:s=>{const b=p.value.getListData;m.value.open(s,b)}}]}],config:{expand:!0}});return(s,b)=>{const d=i("ak-list");return k(),g(T,null,[u("div",null,[o(d,{ref_key:"tableListEl",ref:p,"api-key":{list:"flowList"},"search-data":l.value,data:y.value,before:c},null,8,["search-data","data"])]),o(Z,{ref_key:"drawerEl",ref:m},null,512)],64)}}};export{le as default};
