import{d as le,l as W,h as q,p as pe,b as N,w as i,r as z,o as h,j as l,f as $,m as F,I as ee,J as _e,c as D,a as Z,F as G,e as H,q as re,L as xe,M as ne,G as de,B as Ce,C as Se,n as Y,t as te,N as Q,s as ie,O as Ie,P as ce,Q as $e,x as oe,v as be,R as fe,S as ke,U as Te,V as ue,k as Ve,W as Ae,y as De,u as Re,X as ve,Y as Ue,Z as Ee,$ as ze,a0 as ge,A as Me,z as ye}from"./index-CbbnYBXf.js";import{u as se,g as Oe,r as V,_ as Le,c as Be,a as Ne,b as Fe}from"./screenGroup.vue_vue_type_script_setup_true_lang-CFTgUNMT.js";import{_ as Pe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-BlNczKsE.js";import{_ as qe,a as We,g as Je,b as He}from"./aceTooptip-DKh8eAgu.js";const Xe=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],ae={bg:Xe},Ye={class:"img-list"},Ge=["onClick"],Ke=["src"],Qe={key:0},Ze=le({__name:"upload",emits:["click"],setup(j,{expose:B,emit:M}){const _=M,r=W(!1),O=W(),s=W("bg"),b=q(()=>{if(!ae)return[];const A=[];for(const d in ae)A.push(d);return A}),P=q(()=>s.value.name==="upload"?[]:ae?ae[s.value]:[]),m=q(()=>`./static/screen/${s.value}/`),x=A=>{r.value=!1,_("click",m.value+A,O.value)},C=A=>{s.value="upload",re(()=>{P.value.unshift(A.path)})};return B({open:(A,d)=>{r.value=!0,O.value=d,A?s.value=A:s.value=b.value[0]}}),pe(()=>{}),(A,d)=>{const u=z("el-button"),R=z("el-upload"),E=z("el-tab-pane"),v=z("el-tabs"),S=z("el-dialog");return h(),N(S,{modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=c=>r.value=c),width:"800px",title:"选择上传图片"},{default:i(()=>{var c;return[l(R,{action:ee(_e),"on-success":C,"show-file-list":!1},{default:i(()=>[l(u,{type:"primary"},{default:i(()=>d[2]||(d[2]=[F(" 上传 ")])),_:1})]),_:1},8,["action"]),l(v,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=e=>s.value=e)},{default:i(()=>[(h(!0),D(G,null,Z(b.value,e=>(h(),N(E,{key:e,label:e,name:e},null,8,["label","name"]))),128)),l(E,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),$("div",Ye,[$("ul",null,[(h(!0),D(G,null,Z(P.value,e=>(h(),D("li",{key:e,onClick:a=>x(e)},[$("img",{src:m.value+e,alt:""},null,8,Ke)],8,Ge))),128))]),(c=P.value)!=null&&c.length?H("",!0):(h(),D("p",Qe," 暂无相关素材资源 "))])]}),_:1},8,["modelValue"])}}}),je=xe(Ze,[["__scopeId","data-v-53e58595"]]),et={key:0},tt=le({__name:"configControl",emits:["openDrawer"],setup(j,{emit:B}){const M=B,_=ne("screenData"),r=q(()=>_.value.config||{}),O=se(),s=q(()=>O.controlAttr),b=q(()=>{var c,e,a,n;return((e=(c=s.value)==null?void 0:c.config)==null?void 0:e.lock)||((n=(a=s.value)==null?void 0:a.position)==null?void 0:n.display)}),P=W(),m=q(()=>s.value.type),x=de({bgColor:"",bgUpload:"",bgSelect:""}),C=Ce(()=>r.value,c=>{if(!Object.keys(s.value).length){const e=c.background||"";if(e.indexOf("url")!==-1){const a=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),n=e.match(a);Object.assign(x,{bgUpload:n,bgSelect:2})}else Object.assign(x,{bgColor:e,bgSelect:1})}},{immediate:!0}),I=()=>{let c="";switch(x.bgSelect){case 1:c=x.bgColor;break;case 2:c=`url(${x.bgUpload})`;break}A("background",c)},A=(c,e)=>{_.value.config=Object.assign({},r.value,{[c]:e})},d=q(()=>{var c,e,a,n;if(Object.keys(s.value).length){const{config:t={},position:p,type:k}=s.value;return[{type:"group",title:"位置信息"},{label:"width",value:p.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:p.height,placeholder:"请输入高度",key:"height",path:"position"},{label:"left",value:p.left,placeholder:"图层位置",key:"left",path:"position"},{label:"top",value:p.top,key:"top",path:"position"},{label:"right",value:p.right,placeholder:"设置后left为auto",key:"right",path:"position"},{label:"bottom",value:p.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:p.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:t.lock,key:"lock"},{type:"switch",label:"隐藏",value:p.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:t.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:t.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:t.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:t.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:t.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:t.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:(c=t.style)==null?void 0:c.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:(e=t.style)==null?void 0:e.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:(a=t.style)==null?void 0:a.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:(n=t.style)==null?void 0:n.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:t.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:t.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:t.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:t.speed,key:"speed",vShow:["table"]}].filter(w=>{let g=!0;return w.vShow&&(g=w.vShow.includes(k)),w.vHide&&(g=!w.vHide.includes(k)),g})}return[]}),u=(c,e)=>{var a;c.path==="position"?s.value.position[c.key]=e:c.path==="style"?((a=s.value.config)!=null&&a.style||(s.value.config.style={}),s.value.config.style[c.key]=e):s.value.config[c.key]=e},R=(c,e)=>{P.value.open(c,e)},E=(c,e)=>{switch(e){case"screenBg":x.bgUpload=c,I();break;case"src":s.value.config.src=c;break}},v=(c,e)=>{var k,w,g;let a="",n,t="";switch(c){case"editCss":a="css";break;case"before":case"after":e?n=r.value&&r.value[c]:(t="获取数据响应处理之后事件，可对请求返回数据进行处理",n=s.value.config&&s.value.config[c]);break;case"style":a="json",n=((k=s.value.config)==null?void 0:k.style)||{},t="可输入更多的css样式，须为json格式";break;case"echartsEdit":n=s.value.option,t="可参考echarts相关例子编辑";break;case"tablePropsEdit":a="json",n=((w=s.value.config)==null?void 0:w.props)||{},t="支持所有表格props属性，可参考el-table。json格式";break;case"editData":const y=s.value.type;t="图表数据，替换相关数据返回即可",["text","sText"].includes(y)?(n=(g=s.value.config)==null?void 0:g.text,t="编辑文本内容数据"):n=s.value.option,y==="table"&&(t="表格列表数据。根据设定的table-column列数据设置对应的数据");break}const p={content:n,codeType:a,type:c,title:t,isGlobal:e,callback:y=>{switch(c){case"before":case"after":e?r.value[c]=y:s.value.config[c]=y;break;case"style":s.value.config.style=y;break;case"echartsEdit":s.value.option=y;break;case"tablePropsEdit":s.value.config.props=y;break;case"editData":const f=s.value.type;["text","sText"].includes(f)?s.value.config.text=y:s.value.option=y;break}}};console.log("open",p),M("openDrawer",p)},S=()=>{Oe(r.value).then(()=>{Q.success("连接成功")}).catch(c=>{Q.error(c.msg||"连接失败")})};return Se(()=>{C()}),(c,e)=>{const a=z("el-switch"),n=z("el-color-picker"),t=z("el-input"),p=z("el-option"),k=z("el-select"),w=z("el-input-number"),g=z("el-form-item"),y=z("el-button"),f=z("el-form"),T=z("el-radio"),L=z("el-radio-group"),U=z("el-tab-pane"),X=z("el-tabs");return h(),D("div",{class:Y(["main-right",{lock:b.value}])},[l(X,{class:"tabs","model-value":"position"},{default:i(()=>[l(U,{label:"属性配置",name:"position"},{default:i(()=>[l(f,{size:"small"},{default:i(()=>[(h(!0),D(G,null,Z(d.value,(o,K)=>(h(),N(g,{key:K,label:o.label},{default:i(()=>[o.type==="group"?(h(),D("h3",et,te(o.title),1)):o.type==="switch"?(h(),N(a,{key:1,"model-value":o.value,class:Y([o.key]),onChange:J=>u(o,J)},null,8,["model-value","class","onChange"])):o.type==="color"?(h(),N(n,{key:2,"show-alpha":"","model-value":o.value,onChange:J=>u(o,J)},null,8,["model-value","onChange"])):o.type==="textarea"?(h(),N(t,{key:3,type:"textarea",placeholder:o.placeholder,"model-value":o.value,onChange:J=>u(o,J)},null,8,["placeholder","model-value","onChange"])):o.type==="select"?(h(),N(k,{key:4,"allow-create":o.allowCreate,filterable:o.filterable,placeholder:o.placeholder,"model-value":o.value,onChange:J=>u(o,J)},{default:i(()=>[(h(!0),D(G,null,Z(o.options,(J,we)=>(h(),N(p,{key:J,label:J,value:we},null,8,["label","value"]))),128))]),_:2},1032,["allow-create","filterable","placeholder","model-value","onChange"])):o.type==="number"?(h(),N(w,{key:5,"controls-position":"right",placeholder:o.placeholder,"model-value":o.value,onInput:J=>u(o,J)},null,8,["placeholder","model-value","onInput"])):(h(),N(t,{key:6,placeholder:o.placeholder,"model-value":o.value,onInput:J=>u(o,J)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(m.value)?(h(),N(g,{key:0,class:"upload-image"},{default:i(()=>[l(t,{modelValue:s.value.config.src,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.config.src=o),placeholder:"请输入图片地址"},null,8,["modelValue"]),l(y,{type:"primary",onClick:e[1]||(e[1]=o=>R(m.value==="image"?"img":"bg","src"))},{default:i(()=>e[25]||(e[25]=[F(" 选择图片 ")])),_:1})]),_:1})):H("",!0),["line","bar","pie","echarts"].includes(m.value)?(h(),N(g,{key:1},{default:i(()=>[l(y,{type:"primary",onClick:e[2]||(e[2]=o=>v("echartsEdit"))},{default:i(()=>e[26]||(e[26]=[F(" 图表编辑 ")])),_:1})]),_:1})):H("",!0),["text","sText","image","background","border","clock"].includes(m.value)?(h(),N(g,{key:2},{default:i(()=>[l(y,{type:"primary",onClick:e[3]||(e[3]=o=>v("style"))},{default:i(()=>e[27]||(e[27]=[F(" 编辑更多内联样式 ")])),_:1})]),_:1})):H("",!0),["table"].includes(m.value)?(h(),N(g,{key:3},{default:i(()=>[l(y,{type:"primary",onClick:e[4]||(e[4]=o=>v("tablePropsEdit"))},{default:i(()=>e[28]||(e[28]=[F(" 表格属性 ")])),_:1})]),_:1})):H("",!0)]),_:1}),["line","bar","pie","echarts","text","sText","table"].includes(m.value)?(h(),N(f,{key:0,size:"small"},{default:i(()=>[l(g,null,{default:i(()=>e[29]||(e[29]=[$("h3",null,"数据",-1)])),_:1}),l(g,{label:"数据类型"},{default:i(()=>[l(L,{modelValue:s.value.config.optionsType,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.config.optionsType=o)},{default:i(()=>[l(T,{value:0,style:{"margin-right":"4px"}},{default:i(()=>e[30]||(e[30]=[F(" 静态/全局 ")])),_:1}),l(T,{value:1},{default:i(()=>e[31]||(e[31]=[F(" 动态 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),s.value.config.optionsType!==1?(h(),N(g,{key:0},{default:i(()=>[l(y,{type:"primary",onClick:e[6]||(e[6]=o=>v("editData"))},{default:i(()=>e[32]||(e[32]=[F(" 编辑数据 ")])),_:1})]),_:1})):H("",!0),s.value.config.optionsType===1?(h(),D(G,{key:1},[l(g,null,{default:i(()=>[l(t,{modelValue:s.value.config.requestUrl,"onUpdate:modelValue":e[8]||(e[8]=o=>s.value.config.requestUrl=o),placeholder:"接口URL或api中的key"},{prepend:i(()=>[l(k,{modelValue:s.value.config.method,"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.config.method=o),style:{width:"60px"}},{default:i(()=>[l(p,{label:"get",value:"get"}),l(p,{label:"post",value:"post"}),l(p,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"刷新时间"},{default:i(()=>[l(w,{modelValue:s.value.config.loopTime,"onUpdate:modelValue":e[9]||(e[9]=o=>s.value.config.loopTime=o),disabled:""},null,8,["modelValue"])]),_:1}),l(g,null,{default:i(()=>e[33]||(e[33]=[$("h3",null,"接口数据处理事件",-1)])),_:1}),l(g,null,{default:i(()=>[l(y,{type:"primary",onClick:e[10]||(e[10]=o=>v("before"))},{default:i(()=>e[34]||(e[34]=[F(" before事件 ")])),_:1})]),_:1}),l(g,null,{default:i(()=>[l(y,{type:"primary",onClick:e[11]||(e[11]=o=>v("after"))},{default:i(()=>e[35]||(e[35]=[F(" after事件 ")])),_:1})]),_:1})],64)):H("",!0)]),_:1})):H("",!0)]),_:1}),l(U,{label:"大屏配置",name:"screen"},{default:i(()=>[l(f,{size:"small"},{default:i(()=>[l(g,{label:"大屏宽度"},{default:i(()=>[l(t,{placeholder:"请输入大屏宽度","model-value":r.value.width,onInput:e[12]||(e[12]=o=>A("width",o))},null,8,["model-value"])]),_:1}),l(g,{label:"大屏高度"},{default:i(()=>[l(t,{placeholder:"请输入大屏高度","model-value":r.value.height,onInput:e[13]||(e[13]=o=>A("height",o))},null,8,["model-value"])]),_:1}),l(g,{class:"color-picker",label:"主色"},{default:i(()=>[l(n,{"show-alpha":"","model-value":r.value.primary,onChange:e[14]||(e[14]=o=>A("primary",o))},null,8,["model-value"])]),_:1}),l(g,{label:"背景"},{default:i(()=>[l(k,{modelValue:x.bgSelect,"onUpdate:modelValue":e[15]||(e[15]=o=>x.bgSelect=o),onChange:I},{default:i(()=>[l(p,{value:1,label:"背景色"}),l(p,{value:2,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),x.bgSelect===1?(h(),N(g,{key:0,class:"color-picker"},{default:i(()=>[l(n,{modelValue:x.bgColor,"onUpdate:modelValue":e[16]||(e[16]=o=>x.bgColor=o),"show-alpha":"",onChange:I},null,8,["modelValue"])]),_:1})):H("",!0),x.bgSelect===2?(h(),N(g,{key:1,class:"upload-image"},{default:i(()=>[l(t,{modelValue:x.bgUpload,"onUpdate:modelValue":e[17]||(e[17]=o=>x.bgUpload=o),placeholder:"请输入图片地址",onChange:I},null,8,["modelValue"]),l(y,{type:"primary",onClick:e[18]||(e[18]=o=>R("bg","screenBg"))},{default:i(()=>e[36]||(e[36]=[F(" 上传 ")])),_:1})]),_:1})):H("",!0),l(g,null,{default:i(()=>[l(y,{onClick:e[19]||(e[19]=o=>v("editCss"))},{default:i(()=>e[37]||(e[37]=[F(" 编辑样式 ")])),_:1})]),_:1}),l(g,null,{default:i(()=>e[38]||(e[38]=[$("h3",null,"全局数据",-1)])),_:1}),l(g,null,{default:i(()=>[l(t,{"model-value":r.value.requestUrl,placeholder:"接口URL或api中的key",onInput:e[21]||(e[21]=o=>A("requestUrl",o))},{prepend:i(()=>[l(k,{"model-value":r.value.method,style:{width:"60px"},onChange:e[20]||(e[20]=o=>A("method",o))},{default:i(()=>[l(p,{label:"get",value:"get"}),l(p,{label:"post",value:"post"}),l(p,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),r.value.requestUrl?(h(),N(g,{key:2},{default:i(()=>[l(y,{type:"primary",onClick:S},{default:i(()=>e[39]||(e[39]=[F(" 连接测试 ")])),_:1})]),_:1})):H("",!0),l(g,{label:"刷新时间"},{default:i(()=>[l(w,{disabled:"","model-value":r.value.loopTime,onInput:e[22]||(e[22]=o=>A("loopTime",o))},null,8,["model-value"])]),_:1}),l(g,null,{default:i(()=>e[40]||(e[40]=[$("h3",null,"接口数据处理事件",-1)])),_:1}),l(g,null,{default:i(()=>[l(y,{type:"primary",onClick:e[23]||(e[23]=o=>v("before",!0))},{default:i(()=>e[41]||(e[41]=[F(" before事件 ")])),_:1})]),_:1}),l(g,null,{default:i(()=>[l(y,{type:"primary",onClick:e[24]||(e[24]=o=>v("after",!0))},{default:i(()=>e[42]||(e[42]=[F(" after事件 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(je,{ref_key:"uploadImageEl",ref:P,onClick:E},null,512)],2)}}}),lt={class:"main-left"},ot={class:"components-list scroll"},st={class:"title"},at=["title"],nt={class:"scroll layer-list"},it=["onClick"],rt=["onUpdate:modelValue"],ct=["title"],ut={class:"icon-group"},pt=["onClick"],dt=["onClick"],ft=le({__name:"controlLeft",setup(j){const B=se(),M=ne("screenData")||{},_=q(()=>{let m=[];return M.value.list.forEach(x=>{var C;x.id!=="rect"&&(m.push(x),["div","group"].includes(x.type)&&((C=x.list)!=null&&C.length)&&(x.list.forEach(I=>{I.pid=x.id}),m=[...m,...x.list]))}),m}),r={line:"line",bar:"bar",pie:"pie",echarts:"",table:"table",text:"text2",sText:"sText",image:"image",background:"image",border:"border",clock:"time",div:"div",group:"div",component:"component"},O=m=>`icon-${r[m.type]}`,s=(m,x)=>{var C;switch(x){case"display":m.position.display=!m.position.display;break;case"lock":m.config.lock=!m.config.lock,m.type==="div"&&((C=m.list)==null||C.forEach(I=>{I.config.lock=!m.config.lock}));break;case"active":B.setActiveId(m.id),B.setControlAttr(m);break;case"del":M.value.list.forEach((I,A)=>{var d;I.id===m.id?M.value.list.splice(A,1):["div","group"].includes(I.type)&&((d=I.list)!=null&&d.length)&&I.list.forEach((u,R)=>{u.id===m.id&&I.list.splice(R,1)})});break}},b=W([{label:"图表",children:[{type:"line",label:"折线图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:"柱状图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:"饼图",position:{width:300,height:300},option:{grid:{left:0,top:0,right:0,bottom:0},series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:"通用图表",position:{width:400,height:300},option:{grid:{left:0,top:0,right:0,bottom:0}}}]},{label:"表格",children:[{type:"table",label:"表格",position:{width:500,height:300},option:{columns:[],list:[]}}]},{label:"辅助",children:[{type:"text",label:"文本",position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:"滚动文本",position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:"图片",position:{width:100,height:50},config:{src:""}},{type:"background",label:"背景",position:{width:100,height:50},config:{src:""}},{type:"border",label:"边框",position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}},{type:"clock",label:"当前时间",position:{width:150,height:30}}]},{label:"布局",children:[{type:"div",label:"div布局",position:{height:100},list:[]}]},{label:"自定义组件",children:[{type:"component",label:"自定义",position:{width:200,height:200},config:{}}]}]),P=m=>ce(m);return(m,x)=>{const C=z("el-tab-pane"),I=z("el-popconfirm"),A=z("el-tabs");return h(),D("div",lt,[l(A,{"model-value":"component",class:"tabs"},{default:i(()=>[l(C,{label:"组件",name:"component"},{default:i(()=>[$("div",ot,[(h(!0),D(G,null,Z(b.value,(d,u)=>(h(),D("div",{key:u},[$("div",st,te(d.label),1),l(ee($e),{modelValue:d.children,"onUpdate:modelValue":R=>d.children=R,"item-key":"label",tag:"ul",group:{name:"screen",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:P},{item:i(({element:R})=>[$("li",{class:Y([R.type])},[$("i",{class:Y(`icon-${r[R.type]}`)},null,2),$("span",{title:R.label},te(R.label),9,at)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),l(C,{label:"图层",name:"layer"},{default:i(()=>[$("div",nt,[$("ul",null,[(h(!0),D(G,null,Z(_.value,(d,u)=>{var R,E,v,S;return h(),D("li",{key:u,class:Y({active:ee(B).activeId===d.id,lock:(R=d.config)==null?void 0:R.lock,display:(E=d.position)==null?void 0:E.display,"text-indent":d.pid})},[$("div",{class:"name",onClick:c=>s(d,"active")},[$("i",{class:Y(O(d))},null,2),ee(B).activeId===d.id?ie((h(),D("input",{key:0,"onUpdate:modelValue":c=>d.layerName=c},null,8,rt)),[[Ie,d.layerName]]):(h(),D("span",{key:1,title:d.layerName||d.id},te(d.layerName||d.id),9,ct))],8,it),$("div",ut,[$("i",{class:Y(["icon",[(v=d.position)!=null&&v.display?"icon-eye-close":"icon-eye"]]),onClick:c=>s(d,"display")},null,10,pt),$("i",{class:Y(["icon",[(S=d.config)!=null&&S.lock?"icon-lock":"icon-lock-open"]]),onClick:c=>s(d,"lock")},null,10,dt),l(I,{title:"确认删除",onConfirm:c=>s(d,"del")},{reference:i(()=>x[0]||(x[0]=[$("i",{class:"icon-del"},null,-1)])),_:2},1032,["onConfirm"])])],2)}),128))])])]),_:1})]),_:1})])}}}),vt={class:"ruler-box"},he=le({__name:"ruler",props:{direction:{default:"h"},scale:{},showRuler:{type:Boolean},size:{}},setup(j){const B=j,M=q(()=>({width:parseInt(B.size)*B.scale/100+"px"})),_=q(()=>{const r=parseInt(B.size)+100,O=[];for(let s=0;s<r;s=s+100)O.push(s);return O});return(r,O)=>ie((h(),D("div",{class:Y(["screen-ruler",`ruler-${r.direction}`]),style:oe(M.value)},[$("div",vt,[(h(!0),D(G,null,Z(_.value,s=>(h(),D("span",{key:s,style:oe({width:`${r.scale}px`})},te(s),5))),128))])],6)),[[be,r.showRuler]])}}),gt=["onClick"],yt=le({__name:"rightMenu",setup(j,{expose:B}){const M=ne("screenData"),_=se(),r=W({}),O=W(!1),s=q(()=>{let I=r.value.type;["tempRect","group"].includes(I)||(I="single");const A={tempRect:["merge","left","right","top","bottom","horizontally","verticalCenter","del","lock","display"],group:["copy","split","del","lock","display"],single:["copy","del","lock","display"]};return[{key:"merge",label:"组合"},{key:"split",label:"拆分"},{key:"left",label:"左对齐"},{key:"right",label:"右对齐"},{key:"top",label:"顶部对齐"},{key:"bottom",label:"底部对齐"},{key:"horizontally",label:"水平居中"},{key:"verticalCenter",label:"垂直居中"},{key:"copy",label:"复制"},{key:"del",label:"删除"},{key:"lock",label:"锁定"},{key:"display",label:"隐藏"}].filter(d=>A[I].includes(d.key))}),b=q(()=>({left:`${r.value.x+10}px`,top:`${r.value.y+10}px`})),P=()=>{setTimeout(()=>{x()},1e3)},m=I=>{M.value.list.forEach((u,R)=>{u.id===r.value.id&&d(u,R,M.value.list),u.list&&Array.isArray(u.list)&&u.list.forEach((E,v)=>{E.id===r.value.id&&d(E,v,u.list)}),A(u)});function A(u){if(r.value.type==="tempRect")switch(I){case"display":_.tempActiveId.includes(u.id)&&(u.position.display=!0);break;case"lock":_.tempActiveId.includes(u.id)&&(u.config.lock=!0);break}}function d(u,R,E){const v=r.value.type;switch(I){case"copy":const S=ce(u);S.id=S.type+new Date().getTime(),S.layerName="复制"+S.layerName,E.push(S),Q.success("复制成功");break;case"del":v==="tempRect"?(u.position.display=!0,M.value.list=M.value.list.filter(f=>!_.tempActiveId.includes(f.id))):E.splice(R,1),Q.success("删除成功");break;case"lock":v==="tempRect"?u.position.display=!0:u.config.lock=!0,["div","group"].includes(v)&&u.list&&Array.isArray(u.list)&&u.list.forEach(f=>{f.config.lock=!0}),Q.success("锁定成功");break;case"display":u.position.display=!0,Q.success("隐藏成功");break;case"horizontally":case"verticalCenter":const{top:c,height:e,left:a,width:n}=u.position;let t=V(c)+V(e)/2,p="top",k="height";I==="verticalCenter"&&(t=V(a)+V(n)/2,p="left",k="width");let w=0;for(const f in _.tempActiveId){const T=E.filter(L=>L.id===_.tempActiveId[f])[0];T.position[p]=t-V(T.position[k])/2,T.position[k]>w&&(w=V(T.position[k]))}u.position[k]=w+"px",u.position[p]=t-w/2;break;case"left":case"top":const g=I==="left"?"width":"height";if(v==="tempRect"){const f=V(u.position[I]);let T=0;for(const L in _.tempActiveId){const U=E.filter(X=>X.id===_.tempActiveId[L])[0];U.position[I]=f,U.position[g]>T&&(T=V(U.position[g]))}u.position[g]=T+"px"}break;case"bottom":if(v==="tempRect"){const{height:f,top:T}=u.position,L=V(f)+V(T);let U=0;for(const X in _.tempActiveId){const o=E.filter(K=>K.id===_.tempActiveId[X])[0];o.position.top=L-V(o.position.height),o.position.height>U&&(U=V(o.position.height))}u.position.height=U+"px",u.position.top=`${L-U}px`}break;case"right":if(v==="tempRect"){const{width:f,left:T}=u.position,L=V(f)+V(T);let U=0;for(const X in _.tempActiveId){const o=E.filter(K=>K.id===_.tempActiveId[X])[0];o.position.left=L-V(o.position.width),o.position.width>U&&(U=V(o.position.width))}u.position.width=U+"px",u.position.left=`${L-U}px`}break;case"merge":const y=ce(u);y.type="group",y.id=y.type+new Date().getTime(),y.layerName="组合层",y.list=[],y.config={},E.forEach(f=>{if(_.tempActiveId.includes(f.id)){f.position.left=Math.abs(y.position.left-V(f.position.left)),f.position.top=Math.abs(y.position.top-V(f.position.top));const T=f.position.width;typeof T=="number"||T.indexOf("px")!==-1?f.position.width=V(T)/u.position.width*100+"%":T.indexOf("%"),y.list.push(f)}f.id==="rect"&&(f.position.display=!0)}),E.push(y),M.value.list=M.value.list.filter(f=>!_.tempActiveId.includes(f.id)),_.setActiveId(y.id),_.setControlAttr(y);break;case"split":u.list.forEach(f=>{const{left:T,top:L,width:U}=f.position,{left:X,top:o,width:K}=u.position;delete f.pId,f.position.left=V(X)+T,f.position.top=V(o)+L,U.toString().indexOf("%")!==-1&&(typeof K=="number"||K.toString().indexOf("px")!==-1)&&(f.position.width=V(K)*V(U)/100+"px"),E.push(f)}),M.value.list=M.value.list.filter(f=>f.id!==u.id);break}}x()},x=()=>{O.value=!1};return B({open:I=>{r.value=I,O.value=!0},close:x}),(I,A)=>ie((h(),D("div",{class:"screen-right-menu",style:oe(b.value),onMouseleave:P},[$("ul",null,[(h(!0),D(G,null,Z(s.value,d=>(h(),D("li",{key:d.key,onClick:u=>m(d.key)},te(d.label),9,gt))),128))])],36)),[[be,O.value]])}}),ht={key:0,class:"no-date"},mt={class:"design-footer"},bt={class:"control-tip"},kt={class:"center"},wt={class:"item"},_t={class:"item slider"},xt={class:"item"},Ct=le({__name:"design",props:{preview:{type:Boolean}},setup(j){const B=W(!0),M=()=>{B.value=!1,re(()=>{B.value=!0})},_=ne("screenData"),r=se(),O=W(),s=q(()=>r.controlTip),b=de({scale:100,autoScale:100,ruler:!0,offset:[0,0],moveFlag:!1,ctrlPress:!1});ue("stateData",b);const P=q(()=>{const{width:a,height:n,background:t,primary:p}=_.value.config,k=b.scale/100;return{width:a,height:n,background:t,transform:`scale(${k})`,color:p}}),m=a=>{I(),b.moveFlag=!0;const n=a.offsetX,t=a.offsetY;let p=0,k=0,w=0,g=0;document.onmousemove=y=>{if(!b.moveFlag)return;const f=(y.pageX-b.offset[0])/(b.scale/100),T=(y.pageY-b.offset[1])/(b.scale/100);w=Math.min(n,f),g=Math.min(t,T),p=Math.abs(n-f),k=Math.abs(t-T);let L=!0;p>10&&k>10&&(L=!1),c({left:w+"px",top:g+"px",width:p+"px",height:k+"px",display:L})},document.onmouseup=function(){var y;if(b.moveFlag){if(p>10&&k>10){A({left:w,top:g,width:p,height:k});const f=(y=r.tempActiveId)==null?void 0:y.length;if(f>1)r.setControlTip(`当前选区选中 ${f} 个组件目标，可使用键盘方向键调整位置`),e(),r.setActiveId("rect");else if(c({display:!0}),f===1){const T=r.tempActiveId[0];r.setActiveId(T);const L=_.value.list.filter(U=>U.id===T);r.setControlAttr(L[0])}}b.moveFlag=!1,document.onmousemove=null}}},x=W();ue("openRightMenu",a=>{x.value.open(a)});const I=()=>{r.setControlAttr({}),r.setActiveId(""),r.setTempActiveId([]),r.setControlTip("可按住Ctrl键选中多个"),c({display:!0}),x.value.close()},A=a=>{r.setTempActiveId([]),_.value.list.forEach(t=>{!Be(t.position)&&n(t.position,a)&&Ne(t)&&r.setTempActiveId(t.id)});function n(t,p){const k=V(t.left),w=V(t.top),g=k+V(t.width),y=w+V(t.height),f=V(p.left),T=V(p.top),L=f+V(p.width),U=T+V(p.height),X=k<L&&f<g,o=w<U&&T<y;return X&&o}},d=W({100:{style:{}}}),u=a=>{const n=r.getScreenConfig(a)||!1;setTimeout(()=>{S()},500),r.setScreenConfig(a,!n)},R=a=>{O.value.scrollTo(0,0),a==="auto"?b.scale=b.autoScale:b.scale=100,r.setScreenConfig("scale",b.scale)},E=a=>{r.setScreenConfig("scale",a)};fe(document,"keydown",a=>{a.key==="Control"&&(b.ctrlPress||(r.setTempActiveId([]),r.setActiveId(""),c({display:!0})),b.ctrlPress=!0);const n=["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"];if(r.activeId&&n.includes(a.key)){const t=_.value.list.filter(p=>p.id===r.activeId);t!=null&&t.length&&v(t[0],a.key),r.activeId==="rect"&&_.value.list.forEach(p=>{v(p,a.key)}),a.preventDefault()}});const v=(a,n)=>{const t=a.position,p=V(t.left),k=V(t.top);switch(n){case"ArrowRight":t.left=p+1;break;case"ArrowLeft":t.left=p-1;break;case"ArrowDown":t.top=k+1;break;case"ArrowUp":t.top=k-1;break}};fe(document,"keyup",()=>{b.ctrlPress=!1});const S=()=>{re(()=>{var p;const a=O.value.offsetWidth,n=parseInt((p=_.value.config)==null?void 0:p.width);if(a&&n){const k=parseInt(`${a/n*100}`),w=r.getScreenConfig("scale");b.autoScale=k,b.scale=parseInt(w)||k}const t=O.value.getBoundingClientRect();b.offset[0]=t.left+20,b.offset[1]=t.top+20})},c=a=>{const n=_.value.list.filter(t=>t.id==="rect");n[0].position=a},e=()=>{const a={left:0,top:0,ex:0,ey:0,zIndex:1};_.value.list.forEach(t=>{if(r.tempActiveId.includes(t.id)){const{left:p,top:k,width:w,height:g,zIndex:y}=t.position,f=parseInt(p),T=parseInt(k),L=parseInt(w),U=parseInt(g);a.left=n(a.left,f),a.top=n(a.top,T),a.ex=Math.max(a.ex,L+f),a.ey=Math.max(a.ey,U+T),a.zIndex=Math.max(a.zIndex,y||1)}}),c({left:a.left,top:a.top,width:Math.abs(a.ex-a.left),height:Math.abs(a.ey-a.top),display:!1,zIndex:a.zIndex+1});function n(t,p){return t===0?p:Math.min(t,p)}};return pe(()=>{S()}),ke(()=>{}),(a,n)=>{const t=z("el-button"),p=z("el-switch"),k=z("el-slider");return h(),D(G,null,[$("div",{ref_key:"designBoxEl",ref:O,class:"design-box"},[l(t,{class:"preview-refresh",onClick:M},{default:i(()=>n[7]||(n[7]=[F(" 刷新 ")])),_:1}),l(he,{scale:b.scale,"show-ruler":b.ruler,size:P.value.width},null,8,["scale","show-ruler","size"]),l(he,{scale:b.scale,"show-ruler":b.ruler,direction:"v",size:P.value.height},null,8,["scale","show-ruler","size"]),$("div",{class:Y([{preview:a.preview},"design-canvas"]),style:oe(P.value),onMousedown:Te(m,["left"])},[B.value?(h(),N(Le,{key:0,modelValue:ee(_).list,"onUpdate:modelValue":n[0]||(n[0]=w=>ee(_).list=w),onItemClick:e},null,8,["modelValue"])):H("",!0)],38),ee(_).list.length?H("",!0):(h(),D("div",ht," 请从左则组件栏拖动组件到设计区域 "))],512),$("div",mt,[$("i",{class:"icon-menu icon",onClick:n[1]||(n[1]=w=>u("left"))}),$("div",bt,te(s.value),1),$("div",kt,[$("div",wt,[n[8]||(n[8]=$("label",{class:"label"},"标尺",-1)),l(p,{modelValue:b.ruler,"onUpdate:modelValue":n[2]||(n[2]=w=>b.ruler=w),size:"small"},null,8,["modelValue"])]),$("div",_t,[n[9]||(n[9]=$("label",{class:"label"},"缩放比例",-1)),l(k,{modelValue:b.scale,"onUpdate:modelValue":n[3]||(n[3]=w=>b.scale=w),marks:d.value,max:200,min:b.autoScale-30,"show-stops":"",size:"small",onChange:E},null,8,["modelValue","marks","min"])]),$("div",xt,[l(t,{link:"",type:"primary",onClick:n[4]||(n[4]=w=>R("auto"))},{default:i(()=>n[10]||(n[10]=[F(" 自适应 ")])),_:1}),l(t,{link:"",type:"primary",onClick:n[5]||(n[5]=w=>R("100"))},{default:i(()=>n[11]||(n[11]=[F(" 100% ")])),_:1})])]),$("i",{class:"icon-menu icon",onClick:n[6]||(n[6]=w=>u("right"))})]),l(yt,{ref_key:"rightMenuEl",ref:x},null,512)],64)}}}),me=JSON.stringify({list:[{id:"rect",type:"tempRect",position:{width:200,height:200,display:!0}}],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff",method:"get"}}),St={class:"container-screen"},It={class:"main-box"},$t=le({__name:"index",setup(j){const B=De(),M=Re(),_=Ve(),r=se();_.changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]),_.setCollapseMenu(!0);const O=v=>!r.getScreenConfig(v),s=W(!1),b=W(!1),P=W(),m=W(JSON.parse(me));ue("screenData",m);const x=v=>{switch(r.setControlAttr({}),v){case"del":m.value=JSON.parse(me);break;case"eye":b.value=!0;break;case"json":d({type:"json",content:m.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":P.value.openScreen(m.value);break;case"save":R();break}},C=de({visible:!1,title:"",direction:"ltr",content:"",codeType:"",callback:""}),I=()=>{u()},A=v=>{try{let S;switch(C.codeType){case"json":S=Ue(v);break;case"css":S=v;break;default:S=ve(v)}switch(typeof C.callback=="function"&&C.callback(S),C.type){case"editCss":m.value.config.style=v,Ee("screenStyle",v,!0);break;case"json":m.value=ve(v);break}u()}catch(S){Q.error(S.message||"未知原因")}},d=v=>{const{type:S="",direction:c,codeType:e,title:a,callback:n,content:t,isGlobal:p}=v;C.direction=c||"ltr",C.type=S,C.codeType=e||"",C.title=a||Je[S],C.visible=!0,C.callback=n;let k=e==="json"?ze(t,!0):ge(t,!0);switch(S){case"editCss":k=m.value.config.style||"";break;case"before":case"after":if(!t){let w=S;S==="after"&&(w=p?"afterScreenGlobal":"afterScreen"),k=He(w)}break}C.content=k},u=()=>{C.visible=!1,C.type="",C.title="",C.codeType="",C.callback="",C.content=""},R=()=>{const v={data:ge(m.value),name:"未命名可视化大屏",type:4};let S="designSave";const c=B.query.id;c&&(Object.assign(v,{id:c}),delete v.name,S="designEdit"),s.value=!0,Me(S,v).then(e=>{Q({message:e.message||"保存成功！",type:"success"}),c||M.push({path:"/design/screen/list"}),s.value=!1}).catch(e=>{Q.error(e.message||"保存异常"),s.value=!1})},E=()=>{s.value=!0,Fe(B.query.id).then(v=>{s.value=!1,m.value=v}).catch(()=>{s.value=!1})};return pe(()=>{E()}),ke(()=>{}),(v,S)=>{const c=Ae("loading");return ie((h(),D("div",St,[b.value?(h(),D("i",{key:0,class:"icon-close close-preview",onClick:S[0]||(S[0]=e=>b.value=!1)})):H("",!0),l(ft,{style:oe({width:O("left")?"":"0px"})},null,8,["style"]),$("div",It,[l(qe,{onClick:x}),l(Ct,{preview:b.value},null,8,["preview"])]),l(tt,{style:oe({width:O("right")?"":"0px"}),onOpenDrawer:d},null,8,["style"]),l(Pe,{modelValue:C.visible,"onUpdate:modelValue":S[1]||(S[1]=e=>C.visible=e),"code-type":C.codeType,content:C.content,direction:C.direction,title:C.title,onConfirm:A,onBeforeClose:I},null,8,["modelValue","code-type","content","direction","title"]),l(We,{ref_key:"vueFileEl",ref:P},null,512)])),[[c,s.value]])}}});typeof ye=="function"&&ye($t);export{$t as default};
