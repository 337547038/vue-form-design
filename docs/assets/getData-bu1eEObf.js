import{d as Z,l as C,G as pe,p as A,o as l,c as y,t as j,ag as ee,h as T,L as de,g as O,z as D,ae as te,n as J,$ as fe,H as we,S as ke,r as oe,s as ae,v as ne,U as se,F as re,a as ie,f as w,i as le,w as ce,m as Te,b as V,V as G,e as De,ab as _e,ah as he,q as Se,x as $e,D as me,Z as Me,W as xe}from"./index-PaNBskVU.js";const Fe=Z({__name:"nowTime",props:{config:{}},setup(o){const r=o,a=C(),t=C(),s=()=>{const n=r.config.dateTime;!n||n&&n.indexOf("{i}")!==-1?a.value=setInterval(()=>{t.value=ee(new Date,n)},1e3):t.value=ee(new Date,n)};return pe(()=>r.config.dateTime,()=>{clearInterval(a.value),s()},{immediate:!0}),A(()=>{}),(n,i)=>(l(),y("div",null,j(t.value),1))}}),Ie=Z({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(o){const r=o,a=T(()=>({width:r.width,height:r.height,overflow:"hidden"})),t=de({left:0,top:0,duration:0}),s=T(()=>["left","right"].includes(r.direction)),n=T(()=>{const p=r.step>1?`transform ${t.duration}s`:"";return s.value?{display:"flex",width:parseInt(r.width)*2+"px",transform:`translateX(${t.left}px)`,transition:p}:{transform:`translateY(${t.top}px)`,transition:p}}),i=C(),M=C(),x=()=>{const p=i.value,R=M.value,B=()=>{const F=R.offsetWidth,E=R.offsetHeight;switch(r.direction){case"left":t.left+F<=0?(t.left=0,t.duration=0):(t.left=t.left-r.step,t.duration=.3);break;case"right":t.left>=0?(t.left=-F,t.duration=0):(t.left=t.left+r.step,t.duration=.3);break;case"bottom":t.top>=0?(t.top=-E,t.duration=0):(t.top=t.top+r.step,t.duration=.3);break;default:t.top+E<=0?(t.top=0,t.duration=0):(t.top=t.top-r.step,t.duration=.3)}};let z=setInterval(B,r.speed);p.onmouseenter=function(){clearInterval(z)},p.onmouseleave=function(){z=setInterval(B,r.speed)}};return A(()=>{x()}),(p,R)=>(l(),y("div",{ref_key:"container",ref:i,class:J([`marquess-${p.direction}`,"marquee-container"]),style:D(a.value)},[O("div",{style:D(n.value),class:"inner-container"},[O("div",{ref_key:"container1",ref:M,style:D({display:s.value?"flex":""})},[te(p.$slots,"default")],4),O("div",{style:D({display:s.value?"flex":""})},[te(p.$slots,"default")],4)],4)],6))}}),Ne=(o,r,a,t)=>(console.log(o,r,a,t),a),ge=o=>{try{return/^-?\d+(\.\d+)?$/.test(o.toString())}catch{return!1}},k=o=>{if(Number.isFinite(o))return Math.round(o);if(!o)return o;const r=o.match(/^(-?\d+(\.\d+)?)(px|em|rem|%|vh|vw)?$/);return r?Math.round(r[1]):0},q=o=>o===0||o==="0"?0:ge(o)?Math.round(o)+"px":o,W=o=>ge(o)?!0:o&&typeof o=="string"?o.indexOf("px")!==-1:!1,ue=(o,r)=>{const a=o.bottom||o.bottom===0,t=o.right||o.right===0,s=!W(o.left),n=!W(o.top),i=!W(o.width),M=!W(o.height),x=a||t||n||i||M||s||n;return r&&x&&fe.error("仅支持使用了left和top的px单位允许操作!"),x},He=o=>{const{type:r,groupId:a,config:t={},position:s={}}=o;return!(r==="group"||r==="tempRect"||a||t.lock||s.display)},qe=["onMousedown"],Re=["onMousedown"],Be={class:"position"},ze=["innerHTML"],Ce=["src"],Oe={key:0},Xe=Z({__name:"screen",props:{data:{},type:{default:1},current:{type:Boolean},scale:{default:100}},emits:["contextmenu","changeEvent"],setup(o,{emit:r}){const a=o,t=r,s=de({left:0,top:0,width:0,height:0,moveFlag:!1}),n=T(()=>a.data.config||{}),i=T(()=>Object.assign({},{width:"100%",height:"100%"},n.value.style||{})),M=T(()=>{let e={};return n.value.src&&(e={backgroundImage:`url(${n.value.src})`}),Object.assign(n.value.style||{},e)}),x=T(()=>{if(!a.data.position)return{};const{left:e,top:c,height:d,width:_,zIndex:m,display:f,right:h,bottom:u}=a.data.position,g=q(h),v=q(u);return{left:q(s.left)||(h?"":q(e)),right:g,bottom:v,top:q(s.top)||(u?"":q(c)),width:q(s.width||_),height:q(s.height||d),zIndex:m||1,display:f?"none":""}}),p=e=>{n.value.lock||(e.preventDefault(),e.stopPropagation())},R=(e,c)=>{if(a.data.type==="group")return;let d=!0;const _=e.pageX,m=e.pageY,{width:f,height:h,left:u,top:g}=a.data.position;if(ue(a.data.position,!0))return;const v=k(f),b=k(h),Y=k(u),L=k(g);document.onmousemove=Q=>{if(!d)return;const S=Q.pageX-_,$=Q.pageY-m;let I=v,N=b,U=Y,P=L;switch(c){case 1:I=v-S,N=b-$,P=L+$,U=Y+S;break;case 4:I=v-S,U=Y+S;break;case 6:I=v-S,U=Y+S,N=b+$;break;case 2:N=b-$,P=L+$;break;case 7:N=b+$;break;case 3:I=v+S,N=b-$,P=L+$;break;case 5:I=v+S;break;case 8:I=v+S,N=b+$;break}I<50||N<30||t("changeEvent",{type:"resize",width:I,height:N,left:U,top:P})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,d=!1},e.stopPropagation()},B=e=>{if(a.data.type==="group")return;const{left:c,top:d}=a.data.position;s.moveFlag=!0;const _=e.pageX,m=e.pageY,f=k(c),h=k(d);let u=0,g=0;ue(a.data.position,!0)?(console.log("不能拖动"),s.moveFlag=!1):(s.left=f,s.top=h),document.onmousemove=v=>{if(!s.moveFlag)return;const b=a.scale/100;u=k((v.pageX-_)/b),g=k((v.pageY-m)/b),s.left=k(u+f),s.top=k(g+h),t("changeEvent",{type:"moveTip",left:s.left,top:s.top})},document.onmouseup=function(){s.moveFlag&&(t("changeEvent",{type:"move",moveX:u,moveY:g,left:s.left,top:s.top}),s.left=0,s.top=0,s.moveFlag=!1,document.onmousemove=null)}},z=T(()=>{var c;const e=X.value||((c=a.data.option)==null?void 0:c.list);return n.value.carousel?[...e,...e]:e}),F=C(),E=()=>{if(!n.value.carousel||!F.value||a.data.type!=="table")return;const e=F.value.querySelector(".el-scrollbar__wrap");function c(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let d=setInterval(c,n.value.speed||30);F.value.onmouseenter=function(){clearInterval(d)},F.value.onmouseleave=function(){d=setInterval(c,n.value.speed||30)}},ve=pe(()=>{var e;return(e=a.data.option)==null?void 0:e.list},()=>{Se(()=>{E()})},{immediate:!0}),K=T(()=>{switch(a.data.type){case"text":case"sText":return n.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return a.data.option}return""}),H=C(),X=T(()=>n.value.optionsType===1&&H.value?H.value:!1),ye=()=>{if(["image","background","border","clock"].includes(a.data.type))return;const{optionsType:e,requestUrl:c,method:d="post"}=n.value,{beforeFetch:_,afterFetch:m}=a.data.events||{};e===1&&c&&he({requestUrl:c,params:{},beforeFetch:_,options:{method:d}}).then(f=>{const h=f.data;typeof m=="function"?H.value=m(h,K.value):H.value=Ne(m,h,K.value)}).catch(f=>{console.log(f)})},be=e=>{t("contextmenu",{x:e.pageX,y:e.pageY,type:a.data.type}),e.preventDefault()};return we(()=>{ve()}),A(()=>{ye()}),ke(()=>{}),(e,c)=>{var m,f,h;const d=oe("el-table-column"),_=oe("el-table");return l(),y("div",{class:J([{["group-"+e.data.type]:!0,[(m=e.data.config)==null?void 0:m.class]:(f=e.data.config)==null?void 0:f.class},"group"]),style:D(x.value),onMousedown:p},[e.type===0&&!((h=e.data.config)!=null&&h.lock)?ae((l(),y("div",{key:0,class:"resize-box",onContextmenu:be,onMousedown:se(B,["left","stop"])},[(l(),y(re,null,ie(8,u=>ae(O("span",{key:u,class:J(`rs${u}`),onMousedown:se(g=>R(g,u),["stop"])},null,42,Re),[[ne,e.data.type!=="tempRect"]])),64)),O("div",Be,j(JSON.stringify(a.data.position)),1)],40,qe)),[[ne,e.current]]):w("",!0),["text","border"].includes(e.data.type)?(l(),y("div",{key:1,style:D(i.value),innerHTML:X.value||n.value.text},null,12,ze)):w("",!0),e.data.type==="sText"?(l(),y("div",{key:2,style:D(i.value)},[le(Ie,{direction:n.value.direction,height:`${e.data.position.height}px`,speed:n.value.speed,step:n.value.step,width:`${e.data.position.width}px`},{default:ce(()=>[Te(j(X.value||n.value.text),1)]),_:1},8,["direction","height","speed","step","width"])],4)):w("",!0),e.data.type==="image"?(l(),y("img",{key:3,src:n.value.src,style:D(i.value),alt:"请选择或上传图片",class:"default-img"},null,12,Ce)):w("",!0),e.data.type==="background"?(l(),y("div",{key:4,style:D(M.value),class:"default-bg"},[n.value.src?w("",!0):(l(),y("span",Oe,"请选择或上传图片"))],4)):w("",!0),e.data.type==="table"?(l(),y("div",{key:5,ref_key:"tableEl",ref:F,class:"screen-table"},[le(_,G(n.value.props,{data:z.value,height:`${a.data.position.height}`,style:{width:"100%"}}),{default:ce(()=>{var u;return[(l(!0),y(re,null,ie((u=e.data.option)==null?void 0:u.columns,g=>(l(),V(d,G(g,{key:g.prop}),null,16))),128))]}),_:1},16,["data","height"])],512)):w("",!0),e.data.type==="clock"?(l(),V(Fe,{key:6,config:n.value,style:D(i.value)},null,8,["config","style"])):w("",!0),["component"].includes(e.data.type)?(l(),V(De(n.value.component),G({key:7},n.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):w("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(l(),V(_e,{key:8,height:e.data.position.height,option:X.value||e.data.option,width:e.data.position.width||"100%"},null,8,["height","option","width"])):w("",!0)],38)}}}),Ye=(o,r)=>new Promise((a,t)=>{if(!o)return t();$e("designById",{id:o}).then(s=>{var B;const n=s.data,i=me(n.data);(B=i.config)!=null&&B.style&&Me("screenStyle",i.config.style,!0);const{requestUrl:M,beforeFetch:x,afterFetch:p,method:R}=i.config;he({requestUrl:M,beforeFetch:x,afterFetch:p,route:r,params:{},options:{method:R}}).then(z=>{window.getScreenGlobal=z.data,a({screenData:i,globalData:z.data})}).catch(()=>{t({screenData:i})})}).catch(s=>{console.log("catch",s),fe.error(s.message||"加载异常"),t()})}),Le=o=>{const r=xe(o).replace(/"{{.*?}}"/g,function(a){return a.slice(3,-3)}).replace(/{{.*?}}/g,function(a){return new Function("return "+a.slice(2,-2))()});return me(r)};export{Xe as _,q as a,He as b,ue as c,Le as d,Ye as g,k as r};
