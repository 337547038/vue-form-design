import{d as E,A as T,k as _,l as o,L as k,p as A,r,o as B,c as D,i as s,w as x,q as C,$ as m}from"./index-c2fb2e62.js";const q=E({__name:"index",setup(L){const i=T(),p=_(),n=o(),u=o(),e=k({visible:!1,title:"",type:1,id:""}),c=t=>{e.visible=!0,e.title="修改数据源",e.type=2,e.id=t,C(()=>{u.value.getData({id:t})})},d=o({columns:[{label:"勾选",type:"selection",prop:"selection"},{prop:"id",label:"编号"},{prop:"name",label:"名称",width:150},{prop:"tableName",label:"数据表名",width:150},{prop:"category",label:"分类",config:{tagList:{0:"success"},dictKey:"sys-source"}},{prop:"status",label:"状态",config:{tagList:{0:"info",1:"success"},dictKey:"sys-status"}},{prop:"creatName",label:"创建人"},{prop:"updateDate",label:"修改时间",config:{formatter:"{y}-{m}-{d} {h}:{i}:{s}"},width:170},{label:"操作",prop:"__control",width:"200px"}],controlBtn:[{label:"新增",type:"primary",click:()=>{e.visible=!0,e.title="创建数据源",e.type=1,e.id=""}},{label:"删除",key:"del",type:"danger"}],operateBtn:[{label:"编辑",click:t=>{c(t.id)}},{label:"删除",key:"del"},{label:"一键创建表单",click:t=>{p.push({path:"/design/form",query:{source:t.id}})}}],config:{expand:!0,searchJump:!0}}),f=o({list:[{type:"input",control:{modelValue:"",placeholder:"请输入名称"},name:"name",formItem:{label:"名称"}},{type:"input",control:{modelValue:"",placeholder:"请输入数据库表名"},name:"tableName",formItem:{label:"数据表名"}}],config:{submitCancel:!0}}),b=o({list:[{type:"input",control:{modelValue:"",placeholder:"请输入数据源名称"},config:{},name:"name",formItem:{label:"名称"},customRules:[{type:"required",message:"请输入数据源名称",trigger:"blur"}]},{type:"input",control:{modelValue:"",placeholder:"请输入数据表名"},config:{disabledEdit:!0},name:"tableName",formItem:{label:"数据表名"},customRules:[{type:"required",message:"请输入创建生成的数据表名",trigger:"blur"}]},{type:"select",control:{modelValue:"",appendToBody:!0},options:[],config:{optionsType:2,optionsFun:"sys-source"},name:"category",formItem:{label:"分类"}},{type:"input",control:{modelValue:"",placeholder:"数据库表注释"},config:{disabledEdit:!0},name:"remark",formItem:{label:"表注释"}},{type:"switch",control:{modelValue:1,activeValue:1,inactiveValue:0},config:{},name:"status",formItem:{label:"状态"}},{type:"title",control:{modelValue:"数据库表字段"},config:{span:24},name:"title"},{type:"table",list:[{type:"input",control:{modelValue:"",size:"small",placeholder:"中文标题名称"},config:{},name:"label",formItem:{label:"标题"}},{type:"input",control:{modelValue:"",size:"small"},config:{},name:"name",formItem:{label:"表名字"},customRules:[{type:"required",message:"名字不能为空",trigger:"blur"},{type:"numberLetter",message:"只能为字母数字",trigger:"blur"}]},{type:"select",control:{modelValue:"",appendToBody:!0,size:"small"},options:[{label:"INT",value:"INT"},{label:"VARCHAR",value:"VARCHAR"},{label:"TEXT",value:"TEXT"},{label:"DATETIME",value:"DATETIME"},{label:"FLOAT",value:"FLOAT"},{label:"BOOLEAN",value:"BOOLEAN"}],config:{optionsType:0},name:"type",formItem:{label:"类型"},customRules:[{type:"required",message:"类型不能为空",trigger:"change"}]},{type:"input",control:{modelValue:"",size:"small"},config:{},name:"length",formItem:{label:"长度/值"}},{type:"input",control:{modelValue:"",size:"small"},config:{},name:"default",formItem:{label:"默认"}},{type:"switch",control:{modelValue:!1,size:"small"},config:{},name:"empty",formItem:{label:"空"}},{type:"input",control:{modelValue:"",size:"small"},config:{},name:"remark",formItem:{label:"注释"}},{type:"switch",control:{modelValue:!0,size:"small"},config:{},name:"enterable",formItem:{label:"可录入"}}],tableData:[],control:{border:!0},config:{disabledEdit:!0,addBtnText:"添加一行",delBtnText:"删除",span:24},name:"tableData"},{type:"txt",control:{modelValue:"提示：默认会添加id自增主键；可录入表示要在表单里作入录入字段，如更新时间这类字段一般为不可录入，其他字段对应数据库字段"},config:{span:24}}],form:{labelWidth:"100px",class:"form-row-2",size:"default",name:"source"},config:{submitCancel:!0,submitUrl:"sourceCreat",editUrl:"sourceEdit",requestUrl:"sourceById"}}),y=t=>{if(e.type===1){if(!t.tableData.length)return m.error("数据库表字段内容不能为空"),!1;const l=[];if(t.tableData.forEach(a=>{["INT","VARCHAR"].includes(a.type)&&!a.length&&l.push(`名字列${a.name}的长度值不能为空`)}),l.length)return m.error(l.join(",")),!1}return e.type===2&&(t.id=e.id),t},g=t=>{t==="success"&&(e.visible=!1,n.value.getListData())},h=t=>{t==="reset"&&(e.visible=!1)};return A(()=>{i.query.source&&c(i.query.source)}),(t,l)=>{const a=r("ak-list"),V=r("ak-form"),v=r("el-dialog");return B(),D("div",null,[s(a,{ref_key:"tableListEl",ref:n,"request-url":"sourceList","delete-url":"sourceDelete","search-data":f.value,data:d.value},null,8,["search-data","data"]),s(v,{modelValue:e.visible,"onUpdate:modelValue":l[0]||(l[0]=I=>e.visible=I),title:e.title,width:"800px","destroy-on-close":""},{default:x(()=>[s(V,{ref_key:"formEl",ref:u,data:b.value,type:e.type,"submit-url":"sourceCreat","edit-url":"sourceEdit","request-url":"sourceById","before-ubmit":y,"after-submit":g,onBtnClick:h},null,8,["data","type"])]),_:1},8,["modelValue","title"])])}}});export{q as default};
