import{ai as Me,j as Ne,y as _e,d as K,l as Y,H as be,p as ie,o as f,c as T,t as ee,ag as ue,h as D,M as ke,g as z,z as _,ae as pe,n as te,a0 as Ie,a3 as oe,I as xe,U as Fe,r as de,V as ne,F as fe,a as he,s as ge,v as me,f as S,i as se,w as ae,m as Re,b as X,W as J,e as Ee,_ as Oe,ah as Ce,X as qe,E as Te,q as Ve,aj as ve,ak as Xe,D as ye,R as Ye,x as ze,$ as Be}from"./index-DjT9YCnt.js";import{f as He}from"./formatScreen-Da2ud_Q5.js";const De=Me("screen",{state:()=>({controlAttr:{},activeId:"",screenConfig:Ne("screenConfig",!0)||{},controlTip:"",tempActiveId:[]}),actions:{setTempActiveId(t){if(typeof t=="string"&&t){const s=this.tempActiveId.indexOf(t);s!==-1?this.tempActiveId.splice(s,1):this.tempActiveId.push(t)}else this.tempActiveId=t},setControlTip(t){this.controlTip=t},setControlAttr(t){this.controlAttr=t},setScreenConfig(t,s){this.screenConfig[t]=s,_e("screenConfig",this.screenConfig,0)},getScreenConfig(t){return this.screenConfig[t]},setActiveId(t){this.activeId=t}}}),Ue=K({__name:"nowTime",props:{config:{}},setup(t){const s=t,i=Y(),o=Y(),p=()=>{const d=s.config.dateTime;!d||d&&d.indexOf("{i}")!==-1?i.value=setInterval(()=>{o.value=ue(new Date,d)},1e3):o.value=ue(new Date,d)};return be(()=>s.config.dateTime,()=>{clearInterval(i.value),p()},{immediate:!0}),ie(()=>{}),(d,a)=>(f(),T("div",null,ee(o.value),1))}}),Pe=K({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(t){const s=t,i=D(()=>({width:s.width,height:s.height,overflow:"hidden"})),o=ke({left:0,top:0,duration:0}),p=D(()=>["left","right"].includes(s.direction)),d=D(()=>{const g=s.step>1?`transform ${o.duration}s`:"";return p.value?{display:"flex",width:parseInt(s.width)*2+"px",transform:`translateX(${o.left}px)`,transition:g}:{transform:`translateY(${o.top}px)`,transition:g}}),a=Y(),n=Y(),v=()=>{const g=a.value,x=n.value,$=()=>{const l=x.offsetWidth,c=x.offsetHeight;switch(s.direction){case"left":o.left+l<=0?(o.left=0,o.duration=0):(o.left=o.left-s.step,o.duration=.3);break;case"right":o.left>=0?(o.left=-l,o.duration=0):(o.left=o.left+s.step,o.duration=.3);break;case"bottom":o.top>=0?(o.top=-c,o.duration=0):(o.top=o.top+s.step,o.duration=.3);break;default:o.top+c<=0?(o.top=0,o.duration=0):(o.top=o.top-s.step,o.duration=.3)}};let A=setInterval($,s.speed);g.onmouseenter=function(){clearInterval(A)},g.onmouseleave=function(){A=setInterval($,s.speed)}};return ie(()=>{v()}),(g,x)=>(f(),T("div",{ref_key:"container",ref:a,class:te([`marquess-${g.direction}`,"marquee-container"]),style:_(i.value)},[z("div",{style:_(d.value),class:"inner-container"},[z("div",{ref_key:"container1",ref:n,style:_({display:p.value?"flex":""})},[pe(g.$slots,"default")],4),z("div",{style:_({display:p.value?"flex":""})},[pe(g.$slots,"default")],4)],4)],6))}}),Se=t=>{try{return/^-?\d+(\.\d+)?$/.test(t.toString())}catch{return!1}},N=t=>{if(Number.isFinite(t))return Math.round(t);if(!t)return t;const s=t.match(/^(-?\d+(\.\d+)?)(px|em|rem|%|vh|vw)?$/);return s?Math.round(s[1]):0},V=t=>t===0||t==="0"?0:Se(t)?Math.round(t)+"px":t,G=t=>Se(t)?!0:t&&typeof t=="string"?t.indexOf("px")!==-1:!1,we=(t,s)=>{const i=t.bottom||t.bottom===0,o=t.right||t.right===0,p=!G(t.left),d=!G(t.top),a=!G(t.width),n=!G(t.height),v=i||o||d||a||n||p||d;return s&&v&&Ie.error("仅支持使用了left和top的px单位允许操作!"),v},et=t=>{const{type:s,config:i={},position:o={}}=t;return!(s==="div"||s==="group"||s==="tempRect"||i.lock||o.display)},Le=["onMousedown"],We=["innerHTML"],Ge=["src"],Je={key:0},Ke=K({__name:"screen",props:{data:{default:()=>({})},type:{default:1},scale:{default:100}},emits:["changeEvent"],setup(t,{emit:s}){const i=t,o=s,p=De(),d=D(()=>p.activeId),a=ke({left:0,top:0,width:0,height:0,moveFlag:!1}),n=D(()=>i.data.config||{}),v=D(()=>Object.assign({},{width:"100%",height:"100%"},n.value.style||{})),g=D(()=>{let e={};return n.value.src&&(e={backgroundImage:`url(${n.value.src})`}),Object.assign(n.value.style||{},e)}),x=D(()=>{if(!i.data.position)return{};const{left:e,top:u,height:m,width:y,zIndex:k,display:w,right:b,bottom:h}=i.data.position,I=V(b),C=V(h);return{left:V(a.left)||(b?"":V(e)),right:I,bottom:C,top:V(a.top)||(h?"":V(u)),width:V(a.width||y),height:V(a.height||m),zIndex:k||1,display:w?"none":""}}),$=e=>e.toString().indexOf("%")!==-1?"100%":e,A=e=>{n.value.lock||(e.preventDefault(),e.stopPropagation())},l=(e,u)=>{if(i.data.type==="group")return;let m=!0;const y=e.pageX,k=e.pageY,{width:w,height:b,left:h,top:I}=i.data.position;if(we(i.data.position,!0))return;const C=N(w),M=N(b),U=N(h),P=N(I);document.onmousemove=ce=>{if(!m)return;const R=ce.pageX-y,E=ce.pageY-k;let O=C,q=M,L=U,W=P;switch(u){case 1:O=C-R,q=M-E,W=P+E,L=U+R;break;case 4:O=C-R,L=U+R;break;case 6:O=C-R,L=U+R,q=M+E;break;case 2:q=M-E,W=P+E;break;case 7:q=M+E;break;case 3:O=C+R,q=M-E,W=P+E;break;case 5:O=C+R;break;case 8:O=C+R,q=M+E;break}O<50||q<30||o("changeEvent",{type:"resize",width:O,height:q,left:L,top:W})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,m=!1},e.stopPropagation()},c=e=>{const{left:u,top:m}=i.data.position;a.moveFlag=!0;const y=e.pageX,k=e.pageY,w=N(u),b=N(m);let h=0,I=0;we(i.data.position,!0)?(console.log("不能拖动"),a.moveFlag=!1):(a.left=w,a.top=b),document.onmousemove=C=>{if(!a.moveFlag)return;const M=i.scale/100;h=N((C.pageX-y)/M),I=N((C.pageY-k)/M),a.left=N(h+w),a.top=N(I+b),o("changeEvent",{type:"moveTip",left:a.left,top:a.top})},document.onmouseup=function(){a.moveFlag&&(o("changeEvent",{type:"move",moveX:h,moveY:I,left:a.left,top:a.top}),a.left=0,a.top=0,a.moveFlag=!1,document.onmousemove=null)}},r=D(()=>{var u;const e=H.value||((u=i.data.option)==null?void 0:u.list);return n.value.carousel?[...e,...e]:e}),F=Y(),Q=()=>{if(!n.value.carousel||!F.value||i.data.type!=="table")return;const e=F.value.querySelector(".el-scrollbar__wrap");function u(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let m=setInterval(u,n.value.speed||30);F.value.onmouseenter=function(){clearInterval(m)},F.value.onmouseleave=function(){m=setInterval(u,n.value.speed||30)}},Z=be(()=>{var e;return(e=i.data.option)==null?void 0:e.list},()=>{Ve(()=>{Q()})},{immediate:!0}),re=D(()=>{switch(i.data.type){case"text":case"sText":return n.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return i.data.option}return""}),B=Y(),H=D(()=>n.value.optionsType===1&&B.value?B.value:!1),$e=()=>{if(["image","background","border","clock"].includes(i.data.type))return;const{optionsType:e,requestUrl:u,method:m="post"}=n.value,{beforeFetch:y,afterFetch:k}=i.data.events||{};e===1&&u&&Ce({requestUrl:u,params:{},beforeFetch:y,options:{method:m}}).then(w=>{const b=w.data;typeof k=="function"?B.value=k(b,re.value):B.value=He(k,b,re.value)}).catch(w=>{console.log(w)})},j=e=>{if(!e)return e;const u=typeof e=="object"?qe(e):e;if(u.indexOf("{{")!==-1&&u.indexOf("}}")!==-1){const m=u.replace(/"{{.*?}}"/g,function(y){return y.slice(3,-3)}).replace(/{{.*?}}/g,function(y){return new Function("return "+y.slice(2,-2))()});return Te(m)}return e},le=oe("openRightMenu",null),Ae=e=>{typeof le=="function"&&le({x:e.pageX,y:e.pageY,type:i.data.type,id:i.data.id}),e.preventDefault()};return xe(()=>{Z()}),ie(()=>{$e()}),Fe(()=>{}),(e,u)=>{var k,w,b;const m=de("el-table-column"),y=de("el-table");return f(),T("div",{class:te([{["group-"+e.data.type]:!0,[(k=e.data.config)==null?void 0:k.class]:(w=e.data.config)==null?void 0:w.class},"group"]),style:_(x.value),onMousedown:A},[e.type===0&&!((b=e.data.config)!=null&&b.lock)?(f(),T("div",{key:0,class:"resize-box",onContextmenu:Ae,onMousedown:ne(c,["left","stop"])},[(f(),T(fe,null,he(8,h=>ge(z("span",{key:h,class:te(`rs${h}`),onMousedown:ne(I=>l(I,h),["stop"])},null,42,Le),[[me,d.value===e.data.id&&e.data.type!=="tempRect"]])),64)),ge(z("div",{class:"position"},ee(JSON.stringify(e.data.position)),513),[[me,d.value===e.data.id]])],32)):S("",!0),["text","border"].includes(e.data.type)?(f(),T("div",{key:1,style:_(v.value),innerHTML:j(H.value||n.value.text)},null,12,We)):S("",!0),e.data.type==="sText"?(f(),T("div",{key:2,style:_(v.value)},[se(Pe,{direction:n.value.direction,height:`${e.data.position.height}px`,speed:n.value.speed,step:n.value.step,width:`${e.data.position.width}px`},{default:ae(()=>[Re(ee(j(H.value||n.value.text)),1)]),_:1},8,["direction","height","speed","step","width"])],4)):S("",!0),e.data.type==="image"?(f(),T("img",{key:3,src:n.value.src,style:_(v.value),alt:"请选择或上传图片",class:"default-img"},null,12,Ge)):S("",!0),e.data.type==="background"?(f(),T("div",{key:4,style:_(g.value),class:"default-bg"},[n.value.src?S("",!0):(f(),T("span",Je,"请选择或上传图片"))],4)):S("",!0),e.data.type==="table"?(f(),T("div",{key:5,ref_key:"tableEl",ref:F,class:"screen-table"},[se(y,J(n.value.props,{data:r.value,height:`${i.data.position.height}`,style:{width:"100%"}}),{default:ae(()=>{var h;return[(f(!0),T(fe,null,he((h=e.data.option)==null?void 0:h.columns,I=>(f(),X(m,J({ref_for:!0},I,{key:I.prop}),null,16))),128))]}),_:1},16,["data","height"])],512)):S("",!0),e.data.type==="clock"?(f(),X(Ue,{key:6,config:n.value,style:_(v.value)},null,8,["config","style"])):S("",!0),["component"].includes(e.data.type)?(f(),X(Ee(n.value.component),J({key:7},n.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):S("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(f(),X(Oe,{key:8,height:$(e.data.position.height),option:j(H.value||e.data.option),width:$(e.data.position.width)||"100%"},null,8,["height","option","width"])):S("",!0),["div","group"].includes(e.data.type)?(f(),X(Qe,{key:9,modelValue:e.data.list,"onUpdate:modelValue":u[0]||(u[0]=h=>e.data.list=h),"data-type":"div",pId:e.data.id},null,8,["modelValue","pId"])):S("",!0)],38)}}}),Qe=K({__name:"screenGroup",props:ve({pId:{}},{modelValue:{},modelModifiers:{}}),emits:ve(["itemClick"],["update:modelValue"]),setup(t,{emit:s}){const i=t,o=s,p=Xe(t,"modelValue"),d=oe("screenData")||{},a=oe("stateData")||{},n=De(),v=D(()=>{const{width:l}=d.value.config;return l}),g=l=>{var c;if(a.ctrlPress){if(i.pId)return;n.setTempActiveId(l.id),n.setActiveId(l.id),n.setControlAttr(l);const r=(c=n.tempActiveId)==null?void 0:c.length;n.setControlTip(`当前选中${r}个`),r>1&&(n.setActiveId("rect"),o("itemClick"))}else A(l),n.setControlTip("可使用键盘方向键调整位置")},x=(l,c)=>{c.type==="moveTip"&&n.setControlTip(`当前位置：${c.left}:${c.top}`),l.position.left=c.left,l.position.top=c.top,c.width&&(l.position.width=c.width),c.height&&(l.position.height=c.height),l.type==="tempRect"&&c.type==="move"&&p.value.forEach(r=>{n.tempActiveId.includes(r.id)&&(r.position.left=parseInt(r.position.left)+c.moveX,r.position.top=parseInt(r.position.top)+c.moveY)})},$=l=>{const c=l.newIndex,r=p.value[c];if((l.target&&l.target.getAttribute("data-type"))==="div"&&r.type==="div"){p.value.splice(c,1);return}delete r.label,delete r.icon;const{offsetX:Q,offsetY:Z}=l.originalEvent;r.position||(r.position={}),r.config||(r.config={}),r.id=r.type+new Date().getTime(),r.layerName=r.id,r.type==="div"&&(r.position.width=v.value),r.position.left=Q,r.position.top=Z,A(r)},A=l=>{n.setActiveId(l.id),n.setControlAttr(l)};return(l,c)=>(f(),X(ye(Ye),J({group:"screen",animation:200,handle:".none"},{list:p.value,class:"drag",itemKey:"id",name:"fade",ghostClass:"ghost",onAdd:$}),{item:ae(({element:r})=>[se(Ke,{data:r,scale:ye(a).scale,type:0,onChangeEvent:F=>x(r,F),onClick:ne(F=>g(r),["stop"])},null,8,["data","scale","onChangeEvent","onClick"])]),_:1},16,["list"]))}}),tt=(t,s)=>new Promise((i,o)=>{if(!t)return o();ze("designById",{id:t}).then(p=>{var $;const d=p.data,a=Te(d.data);($=a.config)!=null&&$.style&&Be("screenStyle",a.config.style,!0);const{requestUrl:n,beforeFetch:v,afterFetch:g,method:x}=a.config;n?Ce({requestUrl:n,beforeFetch:v,afterFetch:g,route:s,params:{},options:{method:x}}).then(A=>{window.getScreenGlobal=A.data,i({screenData:a,globalData:A.data})}).catch(()=>{o({screenData:a})}):i({screenData:a})}).catch(p=>{console.log("catch",p),Ie.error(p.message||"加载异常"),o()})});export{Qe as _,et as a,Ke as b,we as c,tt as g,N as r,De as u};
