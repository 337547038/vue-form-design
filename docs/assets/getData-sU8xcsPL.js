import{d as J,l as C,H as ue,p as A,o as l,c as v,t as j,ag as Z,h as T,M as pe,g as R,z as _,ae as ee,n as G,I as ve,U as ye,r as te,s as ae,v as oe,V as ne,F as se,a as le,f as b,i as re,w as ie,m as we,b as P,W,e as be,_ as ke,ah as de,q as Te,x as _e,E as fe,$ as De,a0 as Ie,X as Se}from"./index-DjT9YCnt.js";import{f as $e}from"./formatScreen-Da2ud_Q5.js";import{a as q,c as ce,r as k}from"./utils-Cmr_u3Fd.js";const Fe=J({__name:"nowTime",props:{config:{}},setup(y){const s=y,o=C(),t=C(),n=()=>{const a=s.config.dateTime;!a||a&&a.indexOf("{i}")!==-1?o.value=setInterval(()=>{t.value=Z(new Date,a)},1e3):t.value=Z(new Date,a)};return ue(()=>s.config.dateTime,()=>{clearInterval(o.value),n()},{immediate:!0}),A(()=>{}),(a,c)=>(l(),v("div",null,j(t.value),1))}}),Me=J({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(y){const s=y,o=T(()=>({width:s.width,height:s.height,overflow:"hidden"})),t=pe({left:0,top:0,duration:0}),n=T(()=>["left","right"].includes(s.direction)),a=T(()=>{const u=s.step>1?`transform ${t.duration}s`:"";return n.value?{display:"flex",width:parseInt(s.width)*2+"px",transform:`translateX(${t.left}px)`,transition:u}:{transform:`translateY(${t.top}px)`,transition:u}}),c=C(),z=C(),E=()=>{const u=c.value,N=z.value,B=()=>{const $=N.offsetWidth,X=N.offsetHeight;switch(s.direction){case"left":t.left+$<=0?(t.left=0,t.duration=0):(t.left=t.left-s.step,t.duration=.3);break;case"right":t.left>=0?(t.left=-$,t.duration=0):(t.left=t.left+s.step,t.duration=.3);break;case"bottom":t.top>=0?(t.top=-X,t.duration=0):(t.top=t.top+s.step,t.duration=.3);break;default:t.top+X<=0?(t.top=0,t.duration=0):(t.top=t.top-s.step,t.duration=.3)}};let x=setInterval(B,s.speed);u.onmouseenter=function(){clearInterval(x)},u.onmouseleave=function(){x=setInterval(B,s.speed)}};return A(()=>{E()}),(u,N)=>(l(),v("div",{ref_key:"container",ref:c,class:G([`marquess-${u.direction}`,"marquee-container"]),style:_(o.value)},[R("div",{style:_(a.value),class:"inner-container"},[R("div",{ref_key:"container1",ref:z,style:_({display:n.value?"flex":""})},[ee(u.$slots,"default")],4),R("div",{style:_({display:n.value?"flex":""})},[ee(u.$slots,"default")],4)],4)],6))}}),qe=["onMousedown"],Ne={class:"position"},Be=["innerHTML"],xe=["src"],ze={key:0},Xe=J({__name:"screen",props:{data:{},type:{default:1},current:{type:Boolean},scale:{default:100}},emits:["contextmenu","changeEvent"],setup(y,{emit:s}){const o=y,t=s,n=pe({left:0,top:0,width:0,height:0,moveFlag:!1}),a=T(()=>o.data.config||{}),c=T(()=>Object.assign({},{width:"100%",height:"100%"},a.value.style||{})),z=T(()=>{let e={};return a.value.src&&(e={backgroundImage:`url(${a.value.src})`}),Object.assign(a.value.style||{},e)}),E=T(()=>{if(!o.data.position)return{};const{left:e,top:r,height:p,width:D,zIndex:m,display:d,right:f,bottom:i}=o.data.position,h=q(f),g=q(i);return{left:q(n.left)||(f?"":q(e)),right:h,bottom:g,top:q(n.top)||(i?"":q(r)),width:q(n.width||D),height:q(n.height||p),zIndex:m||1,display:d?"none":""}}),u=e=>{a.value.lock||(e.preventDefault(),e.stopPropagation())},N=(e,r)=>{if(o.data.type==="group")return;let p=!0;const D=e.pageX,m=e.pageY,{width:d,height:f,left:i,top:h}=o.data.position;if(ce(o.data.position,!0))return;const g=k(d),w=k(f),O=k(i),U=k(h);document.onmousemove=Q=>{if(!p)return;const I=Q.pageX-D,S=Q.pageY-m;let F=g,M=w,L=O,V=U;switch(r){case 1:F=g-I,M=w-S,V=U+S,L=O+I;break;case 4:F=g-I,L=O+I;break;case 6:F=g-I,L=O+I,M=w+S;break;case 2:M=w-S,V=U+S;break;case 7:M=w+S;break;case 3:F=g+I,M=w-S,V=U+S;break;case 5:F=g+I;break;case 8:F=g+I,M=w+S;break}F<50||M<30||t("changeEvent",{type:"resize",width:F,height:M,left:L,top:V})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,p=!1},e.stopPropagation()},B=e=>{if(o.data.type==="group")return;const{left:r,top:p}=o.data.position;n.moveFlag=!0;const D=e.pageX,m=e.pageY,d=k(r),f=k(p);let i=0,h=0;ce(o.data.position,!0)?(console.log("不能拖动"),n.moveFlag=!1):(n.left=d,n.top=f),document.onmousemove=g=>{if(!n.moveFlag)return;const w=o.scale/100;i=k((g.pageX-D)/w),h=k((g.pageY-m)/w),n.left=k(i+d),n.top=k(h+f),t("changeEvent",{type:"moveTip",left:n.left,top:n.top})},document.onmouseup=function(){n.moveFlag&&(t("changeEvent",{type:"move",moveX:i,moveY:h,left:n.left,top:n.top}),n.left=0,n.top=0,n.moveFlag=!1,document.onmousemove=null)}},x=T(()=>{var r;const e=Y.value||((r=o.data.option)==null?void 0:r.list);return a.value.carousel?[...e,...e]:e}),$=C(),X=()=>{if(!a.value.carousel||!$.value||o.data.type!=="table")return;const e=$.value.querySelector(".el-scrollbar__wrap");function r(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let p=setInterval(r,a.value.speed||30);$.value.onmouseenter=function(){clearInterval(p)},$.value.onmouseleave=function(){p=setInterval(r,a.value.speed||30)}},me=ue(()=>{var e;return(e=o.data.option)==null?void 0:e.list},()=>{Te(()=>{X()})},{immediate:!0}),K=T(()=>{switch(o.data.type){case"text":case"sText":return a.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return o.data.option}return""}),H=C(),Y=T(()=>a.value.optionsType===1&&H.value?H.value:!1),he=()=>{if(["image","background","border","clock"].includes(o.data.type))return;const{optionsType:e,requestUrl:r,method:p="post"}=a.value,{beforeFetch:D,afterFetch:m}=o.data.events||{};e===1&&r&&de({requestUrl:r,params:{},beforeFetch:D,options:{method:p}}).then(d=>{const f=d.data;typeof m=="function"?H.value=m(f,K.value):H.value=$e(m,f,K.value)}).catch(d=>{console.log(d)})},ge=e=>{t("contextmenu",{x:e.pageX,y:e.pageY,type:o.data.type}),e.preventDefault()};return ve(()=>{me()}),A(()=>{he()}),ye(()=>{}),(e,r)=>{var m,d,f;const p=te("el-table-column"),D=te("el-table");return l(),v("div",{class:G([{["group-"+e.data.type]:!0,[(m=e.data.config)==null?void 0:m.class]:(d=e.data.config)==null?void 0:d.class},"group"]),style:_(E.value),onMousedown:u},[e.type===0&&!((f=e.data.config)!=null&&f.lock)?ae((l(),v("div",{key:0,class:"resize-box",onContextmenu:ge,onMousedown:ne(B,["left","stop"])},[(l(),v(se,null,le(8,i=>ae(R("span",{key:i,class:G(`rs${i}`),onMousedown:ne(h=>N(h,i),["stop"])},null,42,qe),[[oe,e.data.type!=="tempRect"]])),64)),R("div",Ne,j(JSON.stringify(o.data.position)),1)],544)),[[oe,e.current]]):b("",!0),["text","border"].includes(e.data.type)?(l(),v("div",{key:1,style:_(c.value),innerHTML:Y.value||a.value.text},null,12,Be)):b("",!0),e.data.type==="sText"?(l(),v("div",{key:2,style:_(c.value)},[re(Me,{direction:a.value.direction,height:`${e.data.position.height}px`,speed:a.value.speed,step:a.value.step,width:`${e.data.position.width}px`},{default:ie(()=>[we(j(Y.value||a.value.text),1)]),_:1},8,["direction","height","speed","step","width"])],4)):b("",!0),e.data.type==="image"?(l(),v("img",{key:3,src:a.value.src,style:_(c.value),alt:"请选择或上传图片",class:"default-img"},null,12,xe)):b("",!0),e.data.type==="background"?(l(),v("div",{key:4,style:_(z.value),class:"default-bg"},[a.value.src?b("",!0):(l(),v("span",ze,"请选择或上传图片"))],4)):b("",!0),e.data.type==="table"?(l(),v("div",{key:5,ref_key:"tableEl",ref:$,class:"screen-table"},[re(D,W(a.value.props,{data:x.value,height:`${o.data.position.height}`,style:{width:"100%"}}),{default:ie(()=>{var i;return[(l(!0),v(se,null,le((i=e.data.option)==null?void 0:i.columns,h=>(l(),P(p,W({ref_for:!0},h,{key:h.prop}),null,16))),128))]}),_:1},16,["data","height"])],512)):b("",!0),e.data.type==="clock"?(l(),P(Fe,{key:6,config:a.value,style:_(c.value)},null,8,["config","style"])):b("",!0),["component"].includes(e.data.type)?(l(),P(be(a.value.component),W({key:7},a.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):b("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(l(),P(ke,{key:8,height:e.data.position.height,option:Y.value||e.data.option,width:e.data.position.width||"100%"},null,8,["height","option","width"])):b("",!0)],38)}}}),He=(y,s)=>new Promise((o,t)=>{if(!y)return t();_e("designById",{id:y}).then(n=>{var B;const a=n.data,c=fe(a.data);(B=c.config)!=null&&B.style&&De("screenStyle",c.config.style,!0);const{requestUrl:z,beforeFetch:E,afterFetch:u,method:N}=c.config;de({requestUrl:z,beforeFetch:E,afterFetch:u,route:s,params:{},options:{method:N}}).then(x=>{window.getScreenGlobal=x.data,o({screenData:c,globalData:x.data})}).catch(()=>{t({screenData:c})})}).catch(n=>{console.log("catch",n),Ie.error(n.message||"加载异常"),t()})}),Ye=y=>{const s=Se(y).replace(/"{{.*?}}"/g,function(o){return o.slice(3,-3)}).replace(/{{.*?}}/g,function(o){return new Function("return "+o.slice(2,-2))()});return fe(s)};export{Xe as _,Ye as a,He as g};
