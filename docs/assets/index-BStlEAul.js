import{_ as Ne,g as Ve,b as we,a as Te}from"./aceTooptip-D_rKBMD-.js";import{d as de,G as ce,c as f,e as x,o as s,n as me,f as S,F as $,a as z,m as U,t as re,y as be,l as ee,h as Q,p as he,r as A,b as w,A as ie,X as se,w as n,j as o,I as oe,O as $e,Q as fe,M as Ie,a8 as xe,a4 as pe,a9 as Se,B as De,q as Pe,a7 as Fe,N as Z,k as Oe,u as Ee,W as Ae,s as Be,a0 as Y,Y as qe,V as Le,z as Ce}from"./index-CYQNA_yI.js";import{_ as Re}from"./aceDrawer.vue_vue_type_script_setup_true_lang-Cqswi1EC.js";const ve=[],ue={optionsType:0},_e=[{title:"基础字段",children:[{type:"input",label:"单行文本",icon:"input",control:{modelValue:""},config:{}},{type:"textarea",label:"多行文本",icon:"textarea",control:{modelValue:""},config:{}},{type:"radio",label:"单选框组",icon:"radio",control:{modelValue:""},options:ve,config:ue},{type:"checkbox",label:"多选框组",icon:"checkbox",control:{modelValue:[]},options:ve,config:ue},{type:"select",label:"下拉选择框",icon:"select",control:{modelValue:"",teleported:!0},options:ve,config:ue},{type:"datePicker",label:"日期选择器",icon:"date",control:{modelValue:"",type:"date"},config:{}},{type:"timePicker",label:"时间选择器",icon:"time",control:{modelValue:""},config:{}},{type:"colorPicker",label:"取色器",icon:"color",control:{modelValue:""},config:{}},{type:"switch",label:"开关",icon:"switch",control:{modelValue:!1},config:{}},{type:"inputNumber",label:"计数器",icon:"number",control:{modelValue:0},config:{}},{type:"cascader",label:"级联选择器",icon:"cascader",control:{modelValue:[]},options:[],config:ue},{type:"rate",label:"评分",icon:"rate",control:{modelValue:0},config:{}},{type:"slider",label:"滑块",icon:"slider",control:{modelValue:0},config:{}},{type:"treeSelect",label:"树形控件",icon:"tree2",control:{modelValue:"",data:[],renderAfterExpand:!1},config:{optionsType:0}},{type:"txt",label:"文字",icon:"text",control:{modelValue:""},config:{}},{type:"title",label:"标题",icon:"title",control:{modelValue:"标题"},config:{}},{type:"button",label:"按钮",icon:"button",control:{label:"保存"},config:{}}]},{title:"高级字段",children:[{type:"table",label:"子表",icon:"table",list:[],tableData:[],control:{border:!0},config:{addBtnText:"添加一行"}},{type:"component",label:"自定义组件",icon:"component",control:{modelValue:""},config:{}},{type:"upload",label:"图片/文件",icon:"image",control:{modelValue:""},config:{}},{type:"chunkUpload",label:"选择上传",icon:"upload",control:{modelValue:""},config:{}},{type:"tinymce",label:"tinymce富文本",icon:"tinymce",control:{modelValue:""},config:{}}]},{title:"布局字段",children:[{type:"grid",label:"格栅布局",icon:"grid",columns:[{attr:{span:12},list:[]},{attr:{span:12},list:[]}],control:{},config:{}},{type:"tabs",label:"标签页",icon:"tabs",columns:[{label:"Tab1",list:[]}],control:{},config:{}},{type:"card",label:"卡片布局",icon:"card",list:[],control:{},config:{}},{type:"flex",label:"弹性字段",icon:"flex",list:[],tableData:[],control:{},config:{addBtnText:"添加一行"}},{type:"divider",label:"分割线",icon:"divider",control:{},config:{}},{type:"div",label:"div容器",icon:"div",control:{},config:{},list:[]}]},{title:"扩展组件",children:[{type:"expand-user",label:"选择用户",icon:"user",control:{modelValue:""},config:{}}]}],ze={key:0,class:"no-date"},He={key:1,class:"list"},je=["onClick"],Ke=["src"],Je=de({__name:"template",emits:["click"],setup(K,{expose:J,emit:D}){const H=D,p=ce({visible:!1,list:[]}),c=()=>{p.visible=!0,F()},F=()=>{const v=import.meta.globEager("./template/*.ts");p.list=[],Object.keys(v).forEach(t=>{const h=v[t];p.list.push({imgPath:h.imgPath,title:h.title,formData:h.formData})})},g=v=>{H("click",v.formData),p.visible=!1};return J({open:c}),(v,t)=>p.visible?(s(),f("div",{key:0,class:me(["use-template",{active:p.visible}])},[S("span",{class:"close icon-close",onClick:t[0]||(t[0]=h=>p.visible=!1)}),p.list.length===0?(s(),f("div",ze," 暂无可用模板 ")):(s(),f("div",He,[(s(!0),f($,null,z(p.list,(h,M)=>(s(),f("div",{key:M,class:"item",onClick:le=>g(h)},[S("img",{src:h.imgPath,alt:""},null,8,Ke),U(re(h.title),1)],8,je))),128))]))],2)):x("",!0)}}),Me={class:"components-list"},We={key:0},Ge={class:"content"},Qe={class:"title"},Xe=["title"],Ye=de({__name:"dragControl",emits:["clickCheck","click"],setup(K,{emit:J}){const D=be(),H=J,p=ee([]),c=["input","radio","checkbox","select","datePicker","timePicker","inputNumber","cascader","component","button"],F=Q(()=>D.query.type==="search"),g=Q(()=>{if(F.value){const C=[];return _e.forEach(V=>{if(V.children){const _=V.children.filter(E=>c.includes(E.type));_&&_.length&&C.push({title:V.title,children:_})}}),C}else return _e}),v=C=>fe(C),t=C=>{ie("designById",{id:C}).then(V=>{const _=se(V.data.data);_&&_.list&&h(_.list)})},h=C=>{C.forEach(V=>{V.type==="grid"||V.type==="tabs"?V.columns.forEach(_=>{h(_.list)}):V.type==="card"?h(V.list):c.includes(V.type)&&V.type!=="button"&&p.value.push(V)})},M=(C,V)=>{if(V){const _=fe(C);delete _.rules,delete _.customRules,H("clickCheck",_)}},le=ee(),ne=()=>{le.value.open()},O=C=>{H("click",C)};return he(()=>{const{type:C,id:V}=D.query;C==="search"&&V&&t(V)}),(C,V)=>{const _=A("el-checkbox");return s(),f("div",Me,[F.value&&p.value?.length?(s(),f("div",We,[V[0]||(V[0]=S("div",{class:"title"}," 快速选择表单字段 ",-1)),S("div",Ge,[(s(!0),f($,null,z(p.value,E=>(s(),w(_,{key:E.name,onChange:I=>M(E,I)},{default:n(()=>[U(re(E.formItem?.label),1)]),_:2},1032,["onChange"]))),128))])])):x("",!0),(s(!0),f($,null,z(g.value,(E,I)=>(s(),f("div",{key:I},[S("div",Qe,[U(re(E.title)+" ",1),I===0&&!F.value?(s(),f("div",{key:0,class:"template",onClick:ne}," 使用模板 ")):x("",!0)]),o(oe($e),{modelValue:E.children,"onUpdate:modelValue":j=>E.children=j,"item-key":"key123",tag:"ul",group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:v},{item:n(({element:j})=>[S("li",{class:me([j.type])},[S("i",{class:me(`icon-${j.icon}`)},null,2),S("span",{title:j.label},re(j.label),9,Xe)],2)]),_:1},8,["modelValue","onUpdate:modelValue"])]))),128)),F.value?x("",!0):(s(),w(Je,{key:1,ref_key:"useTemplateEl",ref:le,onClick:O},null,512))])}}}),Ze={class:"sidebar-tools"},el=["onClick"],ll={key:1},tl={key:0},al=["onClick"],ol={key:0},nl=["onClick"],sl={key:3},rl=de({__name:"formControlAttr",emits:["openDialog"],setup(K,{expose:J,emit:D}){const H=D,p=Ie("formData"),c=Q(()=>p.value.config),F=Q(()=>p.value.form),g=xe(),v=be(),t=Q(()=>g.controlAttr),h=Q(()=>v.query.type==="search"),M=ee([]),le=Q(()=>[{label:"表单名称",placeholder:"用于保存的表单名称",value:c.value.name,key:"name",path:"config",hide:h.value},{label:"数据源",placeholder:"请选择数据源",value:pe(c.value.sourceId),type:"select",options:M.value,key:"sourceId",path:"config",hide:h.value||!M.value?.length,clearable:!0},{label:"表单标识",value:F.value.name,placeholder:"表单唯一标识，可为空",key:"name",hide:h.value},{label:"表单标签宽度",value:F.value.labelWidth,placeholder:"表单label宽，如180px",key:"labelWidth"},{label:"表单样式名称",value:F.value.class,placeholder:"额外添加的表单class类名",key:"class",type:"select",options:[{label:"无样式",value:"none"},{label:"每行两列",value:"form-row-2"},{label:"每行三列",value:"form-row-3"},{label:"每行四列",value:"form-row-4"}],hide:h.value,clearable:!0},{label:"字段名后添加冒号",value:F.value.showColon,key:"showColon",type:"switch"},{label:"组件尺寸",value:F.value.size,type:"select",key:"size",options:[{label:"large",value:"large"},{label:"default",value:"default"},{label:"small",value:"small"}]},{label:"快速添加确定取消按钮",value:c.value.submitCancel,type:"switch",path:"config",key:"submitCancel"},{label:"将object转string提交",value:c.value.transformData,type:"switch",path:"config",key:"transformData",hide:h.value}]),ne=Q(()=>{if(Object.keys(t.value).length){const{control:a={},type:e,name:d,config:u={},formItem:P={},attr:y={}}=t.value;let m=!1;if(e==="table"){const b=t.value?.list;b&&b.length>0&&(m=b[0].type==="index")}return[{label:"自定义Class",value:u.className,placeholder:"样式类名",path:"config.className"},{label:"字段标识",value:d,type:O.dataSourceFiledList?.length?"select":"text",placeholder:"字段唯一标识，对应数据库",dict:O.dataSourceFiledList,path:"name",vHide:["grid","tabs","card","title","gridChild","tableColumn","divider","txt","div","button"],eventName:"filedNameKey"},{label:"占位内容",value:a.placeholder,placeholder:"placeholder",path:"control.placeholder",vShow:["password","input","textarea","select","date","number","datePicker","tinymce","timePicker","treeSelect"]},{label:"按钮类型",value:a.type,path:"control.type",type:"select",dict:{primary:"primary",success:"success",info:"info",warning:"warning",danger:"danger"},vShow:["button"],clearable:!0},{label:"按钮名称",value:a.label,path:"control.label",vShow:["button"]},{label:"按钮事件",value:a.key,path:"control.key",type:"select",dict:{submit:"提交表单",reset:"重置表单",cancel:"取消返回",none:"无动作(自定义)"},vShow:["button"]},{label:"label值",value:P.label,path:"formItem.label",vHide:["table","grid","tabs","title","gridChild","div","inputSlot","flex","button","txt"]},{label:"隐藏label",value:P.hideLabel,path:"formItem.hideLabel",type:"switch",vHide:["table","grid","tabs","title","gridChild","divider","card","div","inputSlot","flex","button","txt"]},{label:"显示类型",value:u.showType,path:"config.showType",type:"select",dict:{input:"文本选择框",img:"图片",btn:"上传按钮"},vShow:["chunkUpload"]},{label:"按钮文本",value:u.btnText,placeholder:"按钮文本，默认为选择文件",path:"config.btnText",vShow:["chunkUpload"],vIf:u.showType==="img"},{label:"可选数量",value:u.limit,placeholder:"可选择的个数，默认1个",path:"config.limit",vShow:["chunkUpload"]},{label:"接受的文件类型",value:u.accept,placeholder:"接受的文件类型，input原生属性",path:"config.accept",vShow:["chunkUpload"]},{label:"是否自动上传",value:u.auto,path:"config.auto",type:"switch",vShow:["chunkUpload"]},{label:"帮助信息",value:u.help,path:"config.help",vHide:["table","grid","tabs","gridChild","divider","div","inputSlot","flex","button","txt"]},{label:"表单栅格",value:u.span,placeholder:"表单区域栅格宽，0为自动宽",path:"config.span",vHide:["gridChild"],isNum:!0},{label:"文本值",value:a.modelValue,placeholder:"支持html",path:"control.modelValue",vShow:["txt"],inputStyle:"textarea"},{label:"设为密码",value:e,type:"select",dict:{input:"文本",password:"密码"},path:"type",vShow:["input","password"],vIf:h.value},{label:"文本域高度",value:a.rows,placeholder:"输入框行数",path:"control.rows",vShow:["textarea"],isNum:!0},{label:"前缀",value:u.prepend,placeholder:"文本前缀",path:"config.prepend",vShow:["input","password"]},{label:"后缀",value:u.append,placeholder:"文本后缀",path:"config.append",vShow:["input","password"]},{label:"状态打开时的值",value:a.activeValue,placeholder:"状态打开时的值",path:"control.activeValue",vShow:["switch"],isNum:!0},{label:"状态关闭时的值",value:a.inactiveValue,placeholder:"状态关闭时的值",path:"control.inactiveValue",vShow:["switch"],isNum:!0},{label:"增加按钮文案",value:u.addBtnText,path:"config.addBtnText",type:"text",vShow:["flex","table"]},{label:"删除按钮文案",value:u.delBtnText,path:"config.delBtnText",type:"text",vShow:["flex","table"]},{label:"是否多选",value:a.multiple,path:"control.multiple",type:"switch",vShow:["select","treeSelect"],eventName:"selectMultiple"},{label:"可清空",value:a.clearable,path:"control.clearable",type:"switch",vShow:["select"]},{label:"是否禁用",value:a.disabled,path:"control.disabled",type:"switch",vShow:["input","password","textarea","radio","checkbox","select","date","switch","number","cascader","upload","rate","tinymce","treeSelect","datePicker","timePicker"],vIf:h.value},{label:"是否禁用编辑",value:u.disabledEdit,path:"config.disabledEdit",type:"switch",vShow:["input","password","textarea","radio","checkbox","select","date","switch","number","cascader","upload","treeSelect","table","flex","datePicker","timePicker"],vIf:h.value},{label:"添加页隐藏",value:u.displayAdd,path:"config.displayAdd",type:"switch",vIf:h.value,vHide:["inputSlot"]},{label:"编辑页隐藏",value:u.displayEdit,path:"config.displayEdit",type:"switch",vIf:h.value,vHide:["inputSlot"]},{label:"详情页隐藏",value:u.displayDetail,path:"config.displayDetail",type:"switch",vIf:h.value,vHide:["inputSlot"]},{label:"设为Input输入框的前/后缀",value:e==="inputSlot",path:"",type:"switch",vShow:["select","inputSlot"],eventName:"setInputSlot"},{label:"标题",value:a.modelValue,path:"control.modelValue",vShow:["title"]},{label:"占据的列数span",value:y.span,path:"attr.span",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"左侧的间隔格数offset",value:y.offset,path:"attr.offset",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"向右移动格数push",value:y.push,path:"attr.push",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"向左移动格数pull",value:y.pull,path:"attr.pull",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"序号列",value:m,type:"switch",vShow:["table"],eventName:"tableColumn1"},{label:"组件名",value:u.componentName,placeholder:"全局注册的组件名称",path:"config.componentName",vShow:["component"]},{label:"上传地址",value:a.action,placeholder:"图片/文件上传地址,可不填有默认值",path:"control.action",vShow:["upload"]},{label:"文件字段名",value:a.name,placeholder:"上传的文件字段名,默认file",path:"control.name",vShow:["upload"]},{label:"提示文字",value:u.tip,placeholder:"提示说明文字",path:"config.tip",vShow:["upload"]},{label:"按钮文本",value:u.btnText,placeholder:"上传按钮文本",path:"config.btnText",vShow:["upload"]},{label:"direction",type:"select",dict:{horizontal:"horizontal",vertical:"vertical"},placeholder:"分割线方向，默认horizontal",value:a.direction,path:"control.direction",vShow:["divider"]},{label:"border-style",placeholder:"分隔符样式，默认solid",value:a.borderStyle,path:"control.borderStyle",vShow:["divider"]},{label:"content-position",type:"select",dict:{left:"left",right:"right",center:"center"},value:a.contentPosition,path:"control.contentPosition",vShow:["divider"]},{label:"最小值",value:a.min,path:"control.min",vShow:["slider"],eventName:"formatNumber",isNum:!0},{label:"最大值",value:a.max,path:"control.max",vShow:["rate","slider"],eventName:"formatNumber",isNum:!0},{label:"步长",value:a.step,path:"control.step",vShow:["slider"],eventName:"formatNumber",isNum:!0},{label:"type",value:a.type,path:"control.type",vShow:["datePicker"],type:"select",placeholder:"显示类型",dict:{year:"year",month:"month",date:"date",datetime:"datetime",week:"week",datetimerange:"datetimerange",daterange:"daterange",monthrange:"monthrange"}},{label:"format",value:a.format,path:"control.format",vShow:["datePicker","timePicker"],placeholder:"显示在输入框中的格式"},{label:"value-format",value:a.valueFormat,path:"control.valueFormat",vShow:["datePicker","timePicker"],placeholder:"绑定的值"},{label:"color-format",value:a.colorFormat,path:"control.colorFormat",type:"select",placeholder:"写入 v-model 的颜色的格式",dict:{hsl:"hsl",hsv:"hsv",hex:"hex",rgb:"rgb"},vShow:["colorPicker"]},{label:"文本高度",value:a.height,path:"control.height",placeholder:"文本高度(预览查看效果)",vShow:["tinymce"]},{label:"文本宽度",value:a.width,path:"control.width",placeholder:"文本宽度(预览查看效果)",vShow:["tinymce"]},{label:"图片上传地址",value:a.imgUrl,path:"control.imgUrl",placeholder:"图片上传地址",vShow:["tinymce"]},{label:"附件上传地址",value:a.blobUrl,path:"control.blobUrl",placeholder:"附件上传地址",vShow:["tinymce"]},{label:"显示模式",value:u.style,path:"config.style",placeholder:"显示风格(预览查看效果)",type:"select",dict:{default:"default",simple:"simple"},vShow:["tinymce"]},{label:"隐藏显示",value:u.hidden,path:"config.hidden",placeholder:"条件表达式，如$.name===1"},{label:"禁用显示",value:u.disabled,path:"config.disabled",placeholder:"条件表达式，如$.name===1",vHide:["txt","title","table","grid","tabs","card","flex","divider","div"]}].filter(b=>{let ae=!0;return b.vShow&&(ae=b.vShow.includes(e)),b.vHide&&(ae=!b.vHide.includes(e)),b.vIf&&(ae=!1),ae})}else return[]}),O=ce({dataSourceFiledList:[],customRulesList:[...Se,{type:"rules",label:"自定义正则"}],tabsName:"second"});De(()=>g.activeKey,a=>{a&&(O.tabsName="first")});const C=(a,e)=>{switch(a.eventName){case"selectMultiple":t.value.control.modelValue=e?[]:"";break;case"tableColumn1":k(e);break;case"formatNumber":break;case"filedNameKey":a.type==="select"&&O.dataSourceFiledList.forEach(d=>{d.name===e&&(t.value.formItem&&(t.value.formItem.label=d.label),t.value.name=d.label)});break;case"setInputSlot":e?(t.value.type="inputSlot",Z.success(`请在对应的Input输入框属性前后缀设置key:${t.value.name}`)):t.value.type="select";break}if(a.path){const d=a.isNum?pe(e):e;V(t.value,a.path,d)}},V=(a,e,d)=>{let u=a;const P=e.split(".");let y=0;for(y;y<P.length-1;y++){const b=P[y];if(b in u)u=u[b];else throw new Error(`${b} is undefined`)}const m=P[y],G=u[P[y]];return d!==void 0&&(u[m]=d),{obj:u,key:m,value:G}},_=(a,e)=>{e==="tabs"?t.value.columns.splice(a,1):t.value.options.splice(a,1)},E=a=>{const e=t.value.type;e==="cascader"?I("cascader"):e==="treeSelect"?I("treeSelect"):a==="tabs"?t.value.columns.push({label:"标签名称",list:[]}):t.value.options.push({label:"",value:""})},I=a=>{let e=t.value.control;const{type:d,config:u,options:P,control:y}=t.value;let m="";switch(d==="button"&&(e=u,a="button"),a){case"editCss":m="css";break;case"editRules":e=t.value.formItem?.rules||[];break;case"treeSelect":e=y.data;break;case"cascader":e=P;break;case"beforeOption":e=u.before;break;case"afterOption":e=u.after;break}H("openDialog",{content:e,codeType:m,type:a,callback:b=>{switch(a){case"editRules":t.value.formItem||(t.value.formItem={}),t.value.formItem.rules=b;break;case"editProps":t.value.control={},Object.assign(t.value.control,b);break;case"treeSelect":t.value.control.data=b;break;case"cascader":t.value.options=b;break;case"beforeOption":t.value.config.before=b;break;case"afterOption":t.value.config.after=b;break;case"button":t.value.config=b;break}}})},j=a=>{t.value.formItem?.rules||(t.value.formItem.rules=[]),a?t.value.formItem.rules.push({required:!0,message:"必填项",trigger:"change"}):t.value.formItem.rules.splice(0,1)},W=(a,e)=>{if(a&&a.length===0||Object.keys(t.value).length===0)return!1;const d=a.indexOf(t.value.type);return e?d!==-1:d===-1},k=a=>{const e={name:"index",type:"index",item:{label:"序号"},control:{},config:{}};a?t.value.list.unshift(e):t.value.list.splice(0,1)},i=Q(()=>{const a=t.value?.formItem?.rules;return!!(a&&a.length>0)}),N=()=>{t.value.customRules||(t.value.customRules=[]),t.value.customRules.push({type:"required",message:"必填项",trigger:"blur"})},B=a=>{t.value.customRules?.splice(a,1)},q=a=>{a.key==="sourceId"&&(X(a.value),g.setActiveKey(""),g.setControlAttr({})),a.path==="config"?p.value.config[a.key]=a.value:p.value.form[a.key]=a.value},L=a=>{switch(a){case 1:return"数据源接口URL或api的key";case 2:return"字典key，默认为字段标识"}return""},T=(a,e)=>{const d=Se.filter(u=>u.type===e);d&&d.length&&(a.message=d[0].message)},te=()=>{h.value||ie("sourceList").then(a=>{M.value=a.data.list})},X=(a,e)=>{h.value||!a||ie("sourceById",{id:a}).then(d=>{const u=d.data?.tableData;try{O.dataSourceFiledList=JSON.parse(u)}catch{O.dataSourceFiledList=[]}e&&e(O.dataSourceFiledList)}).catch(d=>{console.log(d)})};return he(()=>{Pe(()=>{te()})}),J({getFormFieldBySource:X}),(a,e)=>{const d=A("el-option"),u=A("el-select"),P=A("el-switch"),y=A("el-input"),m=A("el-form-item"),G=A("el-col"),b=A("el-button"),ae=A("el-checkbox"),ye=A("el-form"),ge=A("el-tab-pane"),Ue=A("el-tabs");return s(),f("div",Ze,[o(Ue,{modelValue:O.tabsName,"onUpdate:modelValue":e[25]||(e[25]=l=>O.tabsName=l)},{default:n(()=>[o(ge,{label:"字段配置",name:"first"},{default:n(()=>[o(ye,{size:"small",class:"form"},{default:n(()=>[e[40]||(e[40]=S("div",{class:"h3"},[S("h3",null,"通用属性")],-1)),(s(!0),f($,null,z(ne.value,(l,R)=>(s(),w(m,{key:R,label:l.label},{default:n(()=>[l.type==="select"?(s(),w(u,{key:0,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,placeholder:l.placeholder,filterable:l.path==="name","allow-create":l.path==="name",clearable:l.clearable,onChange:r=>C(l,r)},{default:n(()=>[(s(!0),f($,null,z(l.dict,(r,ke)=>(s(),w(d,{key:ke,value:l.path==="name"?r.name:ke,label:l.path==="name"?`${r.label}(${r.name})`:r},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","filterable","allow-create","clearable","onChange"])):l.type==="switch"?(s(),w(P,{key:1,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,onChange:r=>C(l,r)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(s(),w(y,{key:2,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,type:l.inputStyle,placeholder:l.placeholder,onInput:r=>C(l,r)},null,8,["modelValue","onUpdate:modelValue","type","placeholder","onInput"]))]),_:2},1032,["label"]))),128)),W(["tabs"],!0)?(s(),f($,{key:0},[e[27]||(e[27]=S("div",{class:"h3"},[S("h3",null,"标签配置项")],-1)),(s(!0),f($,null,z(t.value.columns,(l,R)=>(s(),w(m,{key:R},{default:n(()=>[o(G,{span:12},{default:n(()=>[o(y,{modelValue:l.label,"onUpdate:modelValue":r=>l.label=r,placeholder:"标签配置项"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(G,{span:2,offset:1},{default:n(()=>[S("i",{class:"icon-del",onClick:r=>_(R,"tabs")},null,8,el)]),_:2},1024)]),_:2},1024))),128)),o(m,null,{default:n(()=>[o(b,{onClick:e[0]||(e[0]=l=>E("tabs"))},{default:n(()=>[...e[26]||(e[26]=[U(" 增加标签 ",-1)])]),_:1})]),_:1})],64)):x("",!0),W(["radio","select","checkbox","cascader","inputSlot","treeSelect"],!0)?(s(),f("div",ll,[e[33]||(e[33]=S("div",{class:"h3"},[S("h3",null,"选项配置")],-1)),W(["select"],!0)?(s(),w(m,{key:0,label:"添加全部项"},{default:n(()=>[o(y,{modelValue:t.value.config.addAll,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.config.addAll=l),placeholder:"请输入全部项文案"},null,8,["modelValue"])]),_:1})):x("",!0),o(m,{label:"选项数据源"},{default:n(()=>[o(u,{modelValue:t.value.config.optionsType,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.config.optionsType=l),onChange:e[3]||(e[3]=l=>t.value.config.optionsFun="")},{default:n(()=>[o(d,{value:0,label:"固定选项"}),o(d,{value:1,label:"数据源"}),o(d,{value:2,label:"接口字典"})]),_:1},8,["modelValue"])]),_:1}),t.value.config.optionsType===0?(s(),f($,{key:1},[t.value.type!=="cascader"?(s(),f("div",tl,[(s(!0),f($,null,z(t.value.options,(l,R)=>(s(),w(m,{key:R},{default:n(()=>[o(G,{span:10},{default:n(()=>[o(y,{modelValue:l.label,"onUpdate:modelValue":r=>l.label=r,placeholder:"选项标签"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(G,{span:10,offset:1},{default:n(()=>[o(y,{modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,placeholder:"选项值"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(G,{span:2,offset:1},{default:n(()=>[S("i",{class:"icon-del",onClick:r=>_(R)},null,8,al)]),_:2},1024)]),_:2},1024))),128))])):x("",!0),o(m,null,{default:n(()=>[o(b,{onClick:E},{default:n(()=>[U(re(t.value.type==="cascader"?"编辑":"新增"),1)]),_:1})]),_:1})],64)):(s(),f($,{key:2},[o(m,null,{default:n(()=>[o(y,{modelValue:t.value.config.optionsFun,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.config.optionsFun=l),placeholder:L(t.value.config.optionsType)},Fe({_:2},[t.value.config.optionsType===1?{name:"prepend",fn:n(()=>[o(u,{modelValue:t.value.config.method,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.config.method=l),style:{width:"80px"}},{default:n(()=>[o(d,{label:"get",value:"get"}),o(d,{label:"post",value:"post"})]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),t.value.config.optionsType===1?(s(),f($,{key:0},[o(m,{label:"指定label属性值"},{default:n(()=>[o(y,{modelValue:t.value.config.label,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.config.label=l),placeholder:"指定选项标签为选项对象的某个属性值"},null,8,["modelValue"])]),_:1}),o(m,{label:"指定value属性值"},{default:n(()=>[o(y,{modelValue:t.value.config.value,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.config.value=l),placeholder:"指定选项的值为选项对象的某个属性值"},null,8,["modelValue"])]),_:1}),o(m,{label:"是否可筛选"},{default:n(()=>[o(P,{modelValue:t.value.control.filterable,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.control.filterable=l)},null,8,["modelValue"])]),_:1}),W(["select"],!0)?(s(),f($,{key:0},[o(m,{label:"开启远程数据Remote"},{default:n(()=>[o(P,{modelValue:t.value.control.remote,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.control.remote=l)},null,8,["modelValue"])]),_:1}),o(m,{label:"缓存数据结果"},{default:n(()=>[o(P,{modelValue:t.value.config.cache,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.config.cache=l)},null,8,["modelValue"])]),_:1}),o(m,{label:"联动关联设置"},{default:n(()=>[o(y,{modelValue:t.value.config.linkage,"onUpdate:modelValue":e[11]||(e[11]=l=>t.value.config.linkage=l),placeholder:"请输入关联的组件name"},null,8,["modelValue"])]),_:1}),t.value.config.remote||t.value.config.linkage?(s(),w(m,{key:0,label:"远程数据参数字段名"},{default:n(()=>[o(y,{modelValue:t.value.config.queryName,"onUpdate:modelValue":e[12]||(e[12]=l=>t.value.config.queryName=l),placeholder:"远程数据参数字段名"},null,8,["modelValue"])]),_:1})):x("",!0)],64)):x("",!0)],64)):x("",!0),t.value.config.optionsType===1?(s(),w(m,{key:1},{default:n(()=>[o(b,{onClick:e[13]||(e[13]=l=>I("beforeOption"))},{default:n(()=>[...e[28]||(e[28]=[U(" before事件 ",-1)])]),_:1}),o(b,{onClick:e[14]||(e[14]=l=>I("afterOption"))},{default:n(()=>[...e[29]||(e[29]=[U(" after事件 ",-1)])]),_:1})]),_:1})):x("",!0)],64)),o(m,{label:"尝试转换value值为"},{default:n(()=>[o(u,{modelValue:t.value.config.transformData,"onUpdate:modelValue":e[15]||(e[15]=l=>t.value.config.transformData=l),placeholder:"可尝试将值转换类型"},{default:n(()=>[o(d,{value:"none"},{default:n(()=>[...e[30]||(e[30]=[U(" 不转换 ",-1)])]),_:1}),o(d,{value:"number"},{default:n(()=>[...e[31]||(e[31]=[U(" number ",-1)])]),_:1}),o(d,{value:"string"},{default:n(()=>[...e[32]||(e[32]=[U(" string ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])):x("",!0),!h.value&&W(["txt","title","table","grid","tabs","card","switch","gridChild","tableColumn","divider","div","button"])?(s(),f($,{key:2},[e[37]||(e[37]=S("div",{class:"h3"},[S("h3",null,"校验设置")],-1)),W(["input","password","component"],!0)?(s(),f("div",ol,[(s(!0),f($,null,z(t.value.customRules,(l,R)=>(s(),w(m,{key:l.type},{default:n(()=>[o(y,{modelValue:l.message,"onUpdate:modelValue":r=>l.message=r,placeholder:"校验提示信息"},{prepend:n(()=>[o(u,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,style:{width:"80px"},onChange:r=>T(l,r)},{default:n(()=>[(s(!0),f($,null,z(O.customRulesList,r=>(s(),w(d,{key:r.type,label:r.label,value:r.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),append:n(()=>[S("i",{class:"icon-del",onClick:r=>B(R)},null,8,nl)]),_:2},1032,["modelValue","onUpdate:modelValue"]),l.type==="rules"?(s(),w(y,{key:0,modelValue:l.rules,"onUpdate:modelValue":r=>l.rules=r,placeholder:"正则表达式"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),l.type==="methods"?(s(),w(y,{key:1,modelValue:l.methods,"onUpdate:modelValue":r=>l.methods=r,placeholder:"方法名称，此方法仅适用于导出vue文件"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)]),_:2},1024))),128)),o(m,null,{default:n(()=>[o(b,{onClick:N},{default:n(()=>[...e[34]||(e[34]=[U(" 快速添加 ",-1)])]),_:1}),o(b,{onClick:e[16]||(e[16]=l=>I("editRules"))},{default:n(()=>[...e[35]||(e[35]=[U(" 编写校验规则 ",-1)])]),_:1})]),_:1})])):(s(),w(m,{key:1},{default:n(()=>[o(ae,{"model-value":i.value,onChange:j},{default:n(()=>[...e[36]||(e[36]=[U(" 必填 ",-1)])]),_:1},8,["model-value"]),t.value.item?.rules&&t.value.item?.rules[0]?(s(),w(y,{key:0,modelValue:t.value.item.rules[0].message,"onUpdate:modelValue":e[17]||(e[17]=l=>t.value.item.rules[0].message=l),placeholder:"自定义必填错误提示"},null,8,["modelValue"])):x("",!0)]),_:1}))],64)):x("",!0),W(["grid","card","gridChild","divider","div"])?(s(),f("div",sl,[e[39]||(e[39]=S("div",{class:"h3"},[S("h3",null,"其他属性")],-1)),o(b,{size:"small",onClick:e[18]||(e[18]=l=>I("editProps"))},{default:n(()=>[...e[38]||(e[38]=[U(" 编辑属性 ",-1)])]),_:1})])):x("",!0)]),_:1})]),_:1}),o(ge,{label:"表单配置",name:"second"},{default:n(()=>[o(ye,{size:"small",class:"form"},{default:n(()=>[(s(!0),f($,null,z(le.value.filter(l=>!l.hide),(l,R)=>(s(),w(m,{key:R,label:l.label},{default:n(()=>[l.type==="select"?(s(),w(u,{key:0,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,filterable:l.key==="class","allow-create":l.key==="class",placeholder:l.placeholder,clearable:l.clearable,onChange:r=>q(l)},{default:n(()=>[(s(!0),f($,null,z(l.options,r=>(s(),w(d,{key:r.label||r.name,label:r.label||r.name,value:oe(pe)(r.value??r.id)},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","filterable","allow-create","placeholder","clearable","onChange"])):l.type==="switch"?(s(),w(P,{key:1,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,onChange:r=>q(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(s(),w(y,{key:2,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,placeholder:l.placeholder,onInput:r=>q(l)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"]))]),_:2},1032,["label"]))),128)),o(m,null,{default:n(()=>[o(b,{type:"primary",onClick:e[19]||(e[19]=l=>I("editCss"))},{default:n(()=>[...e[41]||(e[41]=[U(" 编辑表单样式 ",-1)])]),_:1})]),_:1}),h.value?x("",!0):(s(),f($,{key:0},[e[45]||(e[45]=S("div",{class:"h3"},[S("h3",null,"接口数据事件")],-1)),o(m,{label:"提交保存url"},{default:n(()=>[o(y,{modelValue:oe(p).config.submitUrl,"onUpdate:modelValue":e[20]||(e[20]=l=>oe(p).config.submitUrl=l),placeholder:"表单提交的url，通用提交时可不设置"},null,8,["modelValue"])]),_:1}),o(m,{label:"获取表单数据url"},{default:n(()=>[o(y,{modelValue:oe(p).config.requestUrl,"onUpdate:modelValue":e[21]||(e[21]=l=>oe(p).config.requestUrl=l),placeholder:"获取表单数据url，通用提交时可不设置"},null,8,["modelValue"])]),_:1}),o(m,{class:"event-btn"},{default:n(()=>[o(b,{type:"primary",onClick:e[22]||(e[22]=l=>I("before"))},{default:n(()=>[...e[42]||(e[42]=[U(" before事件 ",-1)])]),_:1}),o(b,{type:"primary",onClick:e[23]||(e[23]=l=>I("after"))},{default:n(()=>[...e[43]||(e[43]=[U(" after事件 ",-1)])]),_:1}),o(b,{type:"primary",onClick:e[24]||(e[24]=l=>I("change"))},{default:n(()=>[...e[44]||(e[44]=[U(" change改变事件 ",-1)])]),_:1})]),_:1})],64))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),il=K=>{const J=[];return K.forEach(D=>{const H=ul(D);let p={};switch(D.filedType){case"select":p={control:{},options:[],config:{optionsType:0}};break;case"radio":p={options:[],config:{optionsType:0}};break;case"checkbox":case"cascader":p={control:{modelValue:[]},options:[],config:{optionsType:0}};break;case"switch":p={control:{modelValue:!1},options:[]};break;case"datePicker":p={control:{type:"date"}};break;case"inputNumber":case"slider":p={control:{modelValue:0}};break}J.push(Object.assign({},H,p))}),J},ul=K=>fe({type:K.filedType,control:{modelValue:""},config:{},name:K.name,formItem:{label:K.label}}),cl={class:"design-container"},dl={class:"main-body"},pl={class:"main-form"},vl={key:0,class:"empty-tips"},ml={class:"dialog-footer"},fl=de({name:"DesignFormIndex",__name:"index",setup(K){Oe().changeBreadcrumb([{label:"系统工具"},{label:"表单设计"}]);const D=xe(),H=Ee(),p=be(),c=ee({list:[],form:{size:"default"},config:{submitCancel:!0}}),F=ee();Le("formData",c);const g=ce({editor:{},loading:!1,formDataPreview:{},previewVisible:!1,operateType:p.query.type}),v=ce({visible:!1,type:"",title:"",codeType:"",direction:void 0,callback:""}),t=ee(),h=ee(),M=()=>{const k=p.query.id;k&&(g.loading=!0,ie("designById",{id:k}).then(i=>{const N=i.data;if(N.data){const B=se(N.data);B&&Object.keys(B).length&&(c.value=B)}c.value.config.sourceId=N.source,c.value.config.name=N.name,N.source&&g.operateType!=="search"&&h.value.getFormFieldBySource(N.source),g.loading=!1}).catch(i=>{Z.error(i.message||"加载异常"),g.loading=!1}))},le=()=>{const{id:k,redirect:i}=p.query,{submitUrl:N,requestUrl:B}=c.value.config;if(!c.value.config.sourceId&&(!N||!B)&&g.operateType!=="search"){Z.error("请选择数据源或配置接口url地址，否则表单无法提交保存");return}let q={data:Y(c.value),source:c.value.config.sourceId,name:c.value.config.name||"未命名",type:1},L="designSave";k?(Object.assign(q,{id:k}),L="designEdit"):q.status=1,g.operateType==="search"&&(q={data:Y(c.value),id:k}),g.loading=!0,ie(L,q).then(T=>{Z({message:T.message||"保存成功！",type:"success"});const te=i||"/design/form/list",X={};i&&i.indexOf("?")!==-1&&i.split("?")[1].split("&").forEach(d=>{const u=d.split("=");X[u[0]]=u[1]}),H.push({path:te,query:X}),g.loading=!1}).catch(T=>{Z.error(T.message||"保存异常"),g.loading=!1}),D.setActiveKey(""),D.setControlAttr({})},ne=k=>{switch(k){case"del":c.value=JSON.parse(F.value),D.setActiveKey(""),D.setControlAttr({});break;case"eye":D.setActiveKey(""),D.setControlAttr({}),g.previewVisible=!0;let i=Y(c.value);const N=c.value.form.name,B=new RegExp(`get${N}ControlByName`,"g");i=i.replace(B,`getPreview${N}ControlByName`),g.formDataPreview=se(i),g.formDataPreview.form.name=`Preview${N}`;break;case"json":O({type:"creatJson",content:c.value});break;case"save":le();break;case"vue":t.value.open(c.value);break}},O=k=>{const{type:i,direction:N,codeType:B,callback:q,content:L}=k;v.direction=N||"ltr",v.type=i,v.codeType=B||"",v.title=Ve[i],v.visible=!0,v.callback=q;let T;switch(i){case"editCss":T=c.value.config?.style||"";break;case"before":case"after":case"change":const te=c.value.events||{};if(te[i])T=Y(te[i],!0);else{let a=i;i!=="change"&&(a=i+"Type"),T=we(a,"form")}break;case"beforeOption":case"afterOption":const X=i.replace("Option","");L?T=Y(L,!0):T=we(X),v.title=Ve[X];break;case"creatJson":T=Y(L,!0);break;default:T=Y(L,!0)}v.content=T},C=k=>{try{let i;switch(v.codeType){case"json":i=qe(k);break;case"css":i=k;break;default:i=se(k)}switch(typeof v.callback=="function"&&v.callback(i),v.type){case"editCss":c.value.config||(c.value.config={}),c.value.config.style=i;break;case"before":case"after":case"change":c.value.events||(c.value.events={}),c.value.events[v.type]=i;break;case"creatJson":c.value=i;break}_()}catch(i){Z.error(i.message||"未知原因")}},V=()=>{_()},_=()=>{v.visible=!1,v.type="",v.title="",v.codeType="",v.callback="",v.content=""},E=ee(),I=()=>{E.value.validate((k,i)=>{if(k)Z.success("校验通过"),console.log(i);else return Z.error("校验不通过"),!1})},j=k=>{c.value=se(Y(k))},W=k=>{c.value.list.push(k)};return he(()=>{M(),F.value=JSON.stringify(c.value);const k=p.query.source;k&&(c.value.config.sourceId=k,h.value.getFormFieldBySource(k,i=>{c.value.list=il(i)}))}),(k,i)=>{const N=A("ak-form"),B=A("el-button"),q=A("el-dialog"),L=Ae("loading");return s(),f("div",cl,[o(Ye,{onClickCheck:W,onClick:j},null,8,["onClickCheck"]),S("div",dl,[o(Ne,{onClick:ne}),Be((s(),f("div",pl,[c.value.list?.length===0?(s(),f("div",vl," 从左侧拖拽来添加字段 ")):x("",!0),o(N,{data:c.value,"operate-type":k.$route.query.type==="search"?"designSearch":"design"},null,8,["data","operate-type"])])),[[L,g.loading]])]),o(rl,{ref_key:"formControlAttrEl",ref:h,onOpenDialog:O},null,512),o(Re,{modelValue:v.visible,"onUpdate:modelValue":i[0]||(i[0]=T=>v.visible=T),title:v.title,direction:v.direction,content:v.content,"code-type":v.codeType,onBeforeClose:V,onConfirm:C},null,8,["modelValue","title","direction","content","code-type"]),["search"].includes(g.operateType)?x("",!0):(s(),w(Te,{key:0,ref_key:"vueFileEl",ref:t},null,512)),o(q,{modelValue:g.previewVisible,"onUpdate:modelValue":i[2]||(i[2]=T=>g.previewVisible=T),title:"预览",fullscreen:!0},{footer:n(()=>[S("div",ml,[o(B,{size:"small",type:"primary",onClick:I},{default:n(()=>[...i[3]||(i[3]=[U(" 提交 ",-1)])]),_:1}),o(B,{size:"small",onClick:i[1]||(i[1]=T=>g.previewVisible=!1)},{default:n(()=>[...i[4]||(i[4]=[U(" 取消 ",-1)])]),_:1})])]),default:n(()=>[g.previewVisible?(s(),w(N,{key:0,ref_key:"previewForm",ref:E,data:g.formDataPreview},null,8,["data"])):x("",!0)]),_:1},8,["modelValue"])])}}});typeof Ce=="function"&&Ce(fl);export{fl as default};
