import{d as D,x,r as n,a as C,b as B,A as E,o as S,c as T,m as r,w as d,u as F,l as a,s as i,E as v,C as R,q as c,G as U,g as V,D as N}from"./index-8ad7f075.js";const j={class:"container-apply-start"},A=a("div",{class:"status"},[a("ul",null,[a("li",{class:"s1"},"● 已完成"),a("li",{class:"s2"},"● 进行中"),a("li",{class:"s3"},"● 未进行"),a("li",{class:"s4"},"● 已拒绝"),a("li",{class:"s5"},"● 跳过")])],-1),O=D({__name:"start",setup(G){x().changeBreadcrumb([{label:"工作台"},{label:"发起流程"}]);const t=V(),f=N(),_=n(),m=n(),p=n({list:[],form:{}}),y=n(!0),b=C(()=>t.query.id?2:1),u=n(),g=()=>{const e={id:t.query.flowId};i("designById",e).then(s=>{_.value.setValue(v(s.data.data)),u.value=s.data.source,i("designById",{id:s.data.source}).then(l=>{p.value=v(l.data.data),R(()=>{y.value=!1})});const o=t.query.id;o&&m.value.getData({formId:u.value,id:o})})},h=e=>(e.formId=u.value,t.query.id&&(e.id=t.query.id),e),w=(e,s)=>{if(e==="success"){if(t.query.id){f.push({path:"/task/applyed"});return}const o={userId:0,flowId:t.query.flowId,formId:s.data.insertId,title:"user的请假审批",creatTime:new Date};i("flowSave",o).then(()=>{f.push({path:"/task/applyed"})}).catch(l=>{console.log(l)})}else console.log("提交失败")};return B(()=>{g()}),(e,s)=>{const o=c("ak-form"),l=c("el-tab-pane"),I=c("ak-flow"),k=c("el-tabs"),q=U("loading");return E((S(),T("div",j,[r(k,null,{default:d(()=>[r(l,{label:"表单信息"},{default:d(()=>[r(o,{ref_key:"formEl",ref:m,formData:p.value,beforeSubmit:h,afterSubmit:w,type:F(b),requestUrl:"getFormContent",addUrl:"saveFormContent",editUrl:"editFormContent"},null,8,["formData","type"])]),_:1}),r(l,{label:"流程图",name:"flow",class:"flow-box"},{default:d(()=>[A,r(I,{type:1,ref_key:"flowEl",ref:_},null,512)]),_:1})]),_:1})])),[[q,y.value]])}}});export{O as default};
