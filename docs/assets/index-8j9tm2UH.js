import{_ as Ne,g as Ve,b as _e,a as Te}from"./aceTooptip-BYJtI7gJ.js";import{d as ve,L as pe,o as r,c as f,g as k,F as $,a as j,m as N,t as ce,n as he,f as x,A as ye,l as ae,h as Z,p as ge,r as B,b as g,w as n,i as a,C as le,Q as $e,S as be,x as ue,D as ie,O as De,a8 as xe,a9 as we,G as Ie,q as Pe,a7 as Fe,a4 as me,P as te,k as Oe,u as Ee,U as Ae,B as Be,s as Le,a0 as ee,Y as Re,E as Se}from"./index-CDYjrzCG.js";import{_ as qe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-B7k-_fcU.js";const fe=[],de={optionsType:0},Ce=[{title:"基础字段",children:[{type:"input",label:"单行文本",icon:"input",control:{modelValue:""},config:{}},{type:"textarea",label:"多行文本",icon:"textarea",control:{modelValue:""},config:{}},{type:"radio",label:"单选框组",icon:"radio",control:{modelValue:""},options:fe,config:de},{type:"checkbox",label:"多选框组",icon:"checkbox",control:{modelValue:[]},options:fe,config:de},{type:"select",label:"下拉选择框",icon:"select",control:{modelValue:"",teleported:!0},options:fe,config:de},{type:"datePicker",label:"日期选择器",icon:"date",control:{modelValue:"",type:"date"},config:{}},{type:"timePicker",label:"时间选择器",icon:"time",control:{modelValue:""},config:{}},{type:"colorPicker",label:"取色器",icon:"color",control:{modelValue:""},config:{}},{type:"switch",label:"开关",icon:"switch",control:{modelValue:!1},config:{}},{type:"inputNumber",label:"计数器",icon:"number",control:{modelValue:0},config:{}},{type:"cascader",label:"级联选择器",icon:"cascader",control:{modelValue:[]},options:[],config:de},{type:"rate",label:"评分",icon:"rate",control:{modelValue:0},config:{}},{type:"slider",label:"滑块",icon:"slider",control:{modelValue:0},config:{}},{type:"treeSelect",label:"树形控件",icon:"tree2",control:{modelValue:"",data:[],renderAfterExpand:!1},config:{optionsType:0}},{type:"txt",label:"文字",icon:"text",control:{modelValue:""},config:{}},{type:"title",label:"标题",icon:"title",control:{modelValue:"标题"},config:{}},{type:"button",label:"按钮",icon:"button",control:{label:"保存"},config:{}}]},{title:"高级字段",children:[{type:"table",label:"子表",icon:"table",list:[],tableData:[],control:{border:!0},config:{addBtnText:"添加一行"}},{type:"component",label:"自定义组件",icon:"component",control:{modelValue:""},config:{}},{type:"upload",label:"图片/文件",icon:"image",control:{modelValue:""},config:{}},{type:"chunkUpload",label:"选择上传",icon:"upload",control:{modelValue:""},config:{}},{type:"tinymce",label:"tinymce富文本",icon:"tinymce",control:{modelValue:""},config:{}}]},{title:"布局字段",children:[{type:"grid",label:"格栅布局",icon:"grid",columns:[{attr:{span:12},list:[]},{attr:{span:12},list:[]}],control:{},config:{}},{type:"tabs",label:"标签页",icon:"tabs",columns:[{label:"Tab1",list:[]}],control:{},config:{}},{type:"card",label:"卡片布局",icon:"card",list:[],control:{},config:{}},{type:"flex",label:"弹性字段",icon:"flex",list:[],tableData:[],control:{},config:{addBtnText:"添加一行"}},{type:"divider",label:"分割线",icon:"divider",control:{},config:{}},{type:"div",label:"div容器",icon:"div",control:{},config:{},list:[]}]},{title:"扩展组件",children:[{type:"expand-user",label:"选择用户",icon:"user",control:{modelValue:""},config:{}}]}],Ke={key:0,class:"no-date"},ze={key:1,class:"list"},He=["onClick"],je=["src"],Je=ve({__name:"template",emits:["click"],setup(Q,{expose:Y,emit:P}){const J=P,u=pe({visible:!1,list:[]}),d=()=>{u.visible=!0,O()},O=()=>{const v=import.meta.globEager("./template/*.ts");u.list=[],Object.keys(v).forEach(t=>{const h=v[t];u.list.push({imgPath:h.imgPath,title:h.title,formData:h.formData})})},b=v=>{J("click",v.formData),u.visible=!1};return Y({open:d}),(v,t)=>u.visible?(r(),f("div",{key:0,class:he(["use-template",{active:u.visible}])},[k("span",{class:"close icon-close",onClick:t[0]||(t[0]=h=>u.visible=!1)}),u.list.length===0?(r(),f("div",Ke,"暂无可用模板")):(r(),f("div",ze,[(r(!0),f($,null,j(u.list,(h,X)=>(r(),f("div",{class:"item",key:X,onClick:oe=>b(h)},[k("img",{src:h.imgPath,alt:""},null,8,je),N(ce(h.title),1)],8,He))),128))]))],2)):x("",!0)}}),Me={class:"components-list"},Ge={key:0},We=k("div",{class:"title"},"快速选择表单字段",-1),Qe={class:"content"},Ye={class:"title"},Xe=["title"],Ze=ve({__name:"dragControl",emits:["clickCheck","click"],setup(Q,{emit:Y}){const P=ye(),J=Y,u=ae([]),d=["input","radio","checkbox","select","datePicker","timePicker","inputNumber","cascader","component","button"],O=Z(()=>P.query.type==="search"),b=Z(()=>{if(O.value){const w=[];return Ce.forEach(V=>{if(V.children){const S=V.children.filter(M=>d.includes(M.type));S&&S.length&&w.push({title:V.title,children:S})}}),w}else return Ce}),v=w=>be(w),t=w=>{ue("designById",{id:w}).then(V=>{const S=ie(V.data.data);S&&S.list&&h(S.list)})},h=w=>{w.forEach(V=>{V.type==="grid"||V.type==="tabs"?V.columns.forEach(S=>{h(S.list)}):V.type==="card"?h(V.list):d.includes(V.type)&&V.type!=="button"&&u.value.push(V)})},X=(w,V)=>{if(V){const S=be(w);delete S.rules,delete S.customRules,J("clickCheck",S)}},oe=ae(),re=()=>{oe.value.open()},E=w=>{J("click",w)};return ge(()=>{const{type:w,id:V}=P.query;w==="search"&&V&&t(V)}),(w,V)=>{var M;const S=B("el-checkbox");return r(),f("div",Me,[O.value&&((M=u.value)!=null&&M.length)?(r(),f("div",Ge,[We,k("div",Qe,[(r(!0),f($,null,j(u.value,U=>(r(),g(S,{key:U.name,onChange:H=>X(U,H)},{default:n(()=>{var H;return[N(ce((H=U.formItem)==null?void 0:H.label),1)]}),_:2},1032,["onChange"]))),128))])])):x("",!0),(r(!0),f($,null,j(b.value,(U,H)=>(r(),f("div",{key:H},[k("div",Ye,[N(ce(U.title)+" ",1),H===0&&!O.value?(r(),f("div",{key:0,class:"template",onClick:re}," 使用模板 ")):x("",!0)]),a(le($e),{itemKey:"key123",tag:"ul",modelValue:U.children,"onUpdate:modelValue":F=>U.children=F,group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:v},{item:n(({element:F})=>[k("li",{class:he([F.type])},[k("i",{class:he(`icon-${F.icon}`)},null,2),k("span",{title:F.label},ce(F.label),9,Xe)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),O.value?x("",!0):(r(),g(Je,{key:1,ref_key:"useTemplateEl",ref:oe,onClick:E},null,512))])}}}),el={class:"sidebar-tools"},ll=k("div",{class:"h3"},[k("h3",null,"通用属性")],-1),tl=k("div",{class:"h3"},[k("h3",null,"标签配置项")],-1),al=["onClick"],ol={key:1},nl=k("div",{class:"h3"},[k("h3",null,"选项配置")],-1),sl={key:0},rl=["onClick"],il=k("div",{class:"h3"},[k("h3",null,"校验设置")],-1),cl={key:0},ul=["onClick"],dl={key:3},pl=k("div",{class:"h3"},[k("h3",null,"其他属性")],-1),vl=k("div",{class:"h3"},[k("h3",null,"接口数据事件")],-1),ml=ve({__name:"formControlAttr",emits:["openDialog"],setup(Q,{expose:Y,emit:P}){const J=P,u=De("formData"),d=Z(()=>u.value.config),O=Z(()=>u.value.form),b=xe(),v=ye(),t=Z(()=>b.controlAttr),h=Z(()=>v.query.type==="search"),X=ae([]),oe=Z(()=>{var s;return[{label:"表单名称",placeholder:"用于保存的表单名称",value:d.value.name,key:"name",path:"config",hide:h.value},{label:"数据源",placeholder:"请选择数据源",value:me(d.value.sourceId),type:"select",options:X.value,key:"sourceId",path:"config",hide:h.value||!((s=X.value)!=null&&s.length),clearable:!0},{label:"表单标识",value:O.value.name,placeholder:"表单唯一标识，可为空",key:"name",hide:h.value},{label:"表单标签宽度",value:O.value.labelWidth,placeholder:"表单label宽，如180px",key:"labelWidth"},{label:"表单样式名称",value:O.value.class,placeholder:"额外添加的表单class类名",key:"class",type:"select",options:[{label:"无样式",value:"none"},{label:"每行两列",value:"form-row-2"},{label:"每行三列",value:"form-row-3"},{label:"每行四列",value:"form-row-4"}],hide:h.value,clearable:!0},{label:"字段名后添加冒号",value:O.value.showColon,key:"showColon",type:"switch"},{label:"组件尺寸",value:O.value.size,type:"select",key:"size",options:[{label:"large",value:"large"},{label:"default",value:"default"},{label:"small",value:"small"}]},{label:"快速添加确定取消按钮",value:d.value.submitCancel,type:"switch",path:"config",key:"submitCancel"},{label:"将object转string提交",value:d.value.transformData,type:"switch",path:"config",key:"transformData"}]}),re=Z(()=>{var s,l;if(Object.keys(t.value).length){const{control:o={},type:y,name:I,config:c={},formItem:m={},attr:R={}}=t.value;let C=!1;if(y==="table"){const z=(s=t.value)==null?void 0:s.list;z&&z.length>0&&(C=z[0].type==="index")}return[{label:"自定义Class",value:c.className,placeholder:"样式类名",path:"config.className"},{label:"字段标识",value:I,type:(l=E.dataSourceFiledList)!=null&&l.length?"select":"text",placeholder:"字段唯一标识，对应数据库",dict:E.dataSourceFiledList,path:"name",vHide:["grid","tabs","card","title","gridChild","tableColumn","divider","txt","div","button"],eventName:"filedNameKey"},{label:"占位内容",value:o.placeholder,placeholder:"placeholder",path:"control.placeholder",vShow:["password","input","textarea","select","date","number","datePicker","tinymce","timePicker","treeSelect"]},{label:"按钮类型",value:o.type,path:"control.type",type:"select",dict:{primary:"primary",success:"success",info:"info",warning:"warning",danger:"danger"},vShow:["button"],clearable:!0},{label:"按钮名称",value:o.label,path:"control.label",vShow:["button"]},{label:"按钮事件",value:o.key,path:"control.key",type:"select",dict:{submit:"提交表单",reset:"重置表单",cancel:"取消返回",none:"无动作(自定义)"},vShow:["button"]},{label:"label值",value:m.label,path:"formItem.label",vHide:["table","grid","tabs","title","gridChild","div","inputSlot","flex","button","txt"]},{label:"隐藏label",value:m.hideLabel,path:"formItem.hideLabel",type:"switch",vHide:["table","grid","tabs","title","gridChild","divider","card","div","inputSlot","flex","button","txt"]},{label:"显示类型",value:c.showType,path:"config.showType",type:"select",dict:{input:"文本选择框",img:"图片",btn:"上传按钮"},vShow:["chunkUpload"]},{label:"按钮文本",value:c.btnText,placeholder:"按钮文本，默认为选择文件",path:"config.btnText",vShow:["chunkUpload"],vIf:c.showType==="img"},{label:"可选数量",value:c.limit,placeholder:"可选择的个数，默认1个",path:"config.limit",vShow:["chunkUpload"]},{label:"接受的文件类型",value:c.accept,placeholder:"接受的文件类型，input原生属性",path:"config.accept",vShow:["chunkUpload"]},{label:"是否自动上传",value:c.auto,path:"config.auto",type:"switch",vShow:["chunkUpload"]},{label:"帮助信息",value:c.help,path:"config.help",vHide:["table","grid","tabs","gridChild","divider","div","inputSlot","flex","button","txt"]},{label:"表单栅格",value:c.span,placeholder:"表单区域栅格宽，0为自动宽",path:"config.span",vHide:["gridChild"],isNum:!0},{label:"文本值",value:o.modelValue,placeholder:"支持html",path:"control.modelValue",vShow:["txt"],inputStyle:"textarea"},{label:"设为密码",value:y,type:"select",dict:{input:"文本",password:"密码"},path:"type",vShow:["input","password"],vIf:h.value},{label:"文本域高度",value:o.rows,placeholder:"输入框行数",path:"control.rows",vShow:["textarea"],isNum:!0},{label:"前缀",value:c.prepend,placeholder:"文本前缀",path:"config.prepend",vShow:["input","password"]},{label:"后缀",value:c.append,placeholder:"文本后缀",path:"config.append",vShow:["input","password"]},{label:"状态打开时的值",value:o.activeValue,placeholder:"状态打开时的值",path:"control.activeValue",vShow:["switch"],isNum:!0},{label:"状态关闭时的值",value:o.inactiveValue,placeholder:"状态关闭时的值",path:"control.inactiveValue",vShow:["switch"],isNum:!0},{label:"增加按钮文案",value:c.addBtnText,path:"config.addBtnText",type:"text",vShow:["flex","table"]},{label:"删除按钮文案",value:c.delBtnText,path:"config.delBtnText",type:"text",vShow:["flex","table"]},{label:"是否多选",value:o.multiple,path:"control.multiple",type:"switch",vShow:["select","treeSelect"],eventName:"selectMultiple"},{label:"可清空",value:o.clearable,path:"control.clearable",type:"switch",vShow:["select"]},{label:"是否禁用",value:o.disabled,path:"control.disabled",type:"switch",vShow:["input","password","textarea","radio","checkbox","select","date","switch","number","cascader","upload","rate","tinymce","treeSelect","datePicker","timePicker"],vIf:h.value},{label:"是否禁用编辑",value:c.disabledEdit,path:"config.disabledEdit",type:"switch",vShow:["input","password","textarea","radio","checkbox","select","date","switch","number","cascader","upload","treeSelect","table","flex","datePicker","timePicker"],vIf:h.value},{label:"添加页隐藏",value:c.displayAdd,path:"config.displayAdd",type:"switch",vIf:h.value,vHide:["inputSlot"]},{label:"编辑页隐藏",value:c.displayEdit,path:"config.displayEdit",type:"switch",vIf:h.value,vHide:["inputSlot"]},{label:"详情页隐藏",value:c.displayDetail,path:"config.displayDetail",type:"switch",vIf:h.value,vHide:["inputSlot"]},{label:"设为Input输入框的前/后缀",value:y==="inputSlot",path:"",type:"switch",vShow:["select","inputSlot"],eventName:"setInputSlot"},{label:"标题",value:o.modelValue,path:"control.modelValue",vShow:["title"]},{label:"占据的列数span",value:R.span,path:"attr.span",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"左侧的间隔格数offset",value:R.offset,path:"attr.offset",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"向右移动格数push",value:R.push,path:"attr.push",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"向左移动格数pull",value:R.pull,path:"attr.pull",vShow:["gridChild"],eventName:"formatNumber",isNum:!0},{label:"序号列",value:C,type:"switch",vShow:["table"],eventName:"tableColumn1"},{label:"组件名",value:c.componentName,placeholder:"全局注册的组件名称",path:"config.componentName",vShow:["component"]},{label:"上传地址",value:o.action,placeholder:"图片/文件上传地址,可不填有默认值",path:"control.action",vShow:["upload"]},{label:"文件字段名",value:o.name,placeholder:"上传的文件字段名,默认file",path:"control.name",vShow:["upload"]},{label:"提示文字",value:c.tip,placeholder:"提示说明文字",path:"config.tip",vShow:["upload"]},{label:"按钮文本",value:c.btnText,placeholder:"上传按钮文本",path:"config.btnText",vShow:["upload"]},{label:"direction",type:"select",dict:{horizontal:"horizontal",vertical:"vertical"},placeholder:"分割线方向，默认horizontal",value:o.direction,path:"control.direction",vShow:["divider"]},{label:"border-style",placeholder:"分隔符样式，默认solid",value:o.borderStyle,path:"control.borderStyle",vShow:["divider"]},{label:"content-position",type:"select",dict:{left:"left",right:"right",center:"center"},value:o.contentPosition,path:"control.contentPosition",vShow:["divider"]},{label:"最小值",value:o.min,path:"control.min",vShow:["slider"],eventName:"formatNumber",isNum:!0},{label:"最大值",value:o.max,path:"control.max",vShow:["rate","slider"],eventName:"formatNumber",isNum:!0},{label:"步长",value:o.step,path:"control.step",vShow:["slider"],eventName:"formatNumber",isNum:!0},{label:"type",value:o.type,path:"control.type",vShow:["datePicker"],type:"select",placeholder:"显示类型",dict:{year:"year",month:"month",date:"date",datetime:"datetime",week:"week",datetimerange:"datetimerange",daterange:"daterange",monthrange:"monthrange"}},{label:"format",value:o.format,path:"control.format",vShow:["datePicker","timePicker"],placeholder:"显示在输入框中的格式"},{label:"value-format",value:o.valueFormat,path:"control.valueFormat",vShow:["datePicker","timePicker"],placeholder:"绑定的值"},{label:"color-format",value:o.colorFormat,path:"control.colorFormat",type:"select",placeholder:"写入 v-model 的颜色的格式",dict:{hsl:"hsl",hsv:"hsv",hex:"hex",rgb:"rgb"},vShow:["colorPicker"]},{label:"文本高度",value:o.height,path:"control.height",placeholder:"文本高度(预览查看效果)",vShow:["tinymce"]},{label:"文本宽度",value:o.width,path:"control.width",placeholder:"文本宽度(预览查看效果)",vShow:["tinymce"]},{label:"图片上传地址",value:o.imgUrl,path:"control.imgUrl",placeholder:"图片上传地址",vShow:["tinymce"]},{label:"附件上传地址",value:o.blobUrl,path:"control.blobUrl",placeholder:"附件上传地址",vShow:["tinymce"]},{label:"显示模式",value:c.style,path:"config.style",placeholder:"显示风格(预览查看效果)",type:"select",dict:{default:"default",simple:"simple"},vShow:["tinymce"]},{label:"隐藏显示",value:c.hidden,path:"config.hidden",placeholder:"条件表达式，如$.name===1"},{label:"禁用显示",value:c.disabled,path:"config.disabled",placeholder:"条件表达式，如$.name===1",vHide:["txt","title","table","grid","tabs","card","flex","divider","div"]}].filter(z=>{let ne=!0;return z.vShow&&(ne=z.vShow.includes(y)),z.vHide&&(ne=!z.vHide.includes(y)),z.vIf&&(ne=!1),ne})}else return[]}),E=pe({dataSourceFiledList:[],customRulesList:[...we,{type:"rules",label:"自定义正则"}],tabsName:"second"});Ie(()=>b.activeKey,s=>{s&&(E.tabsName="first")});const w=(s,l)=>{switch(s.eventName){case"selectMultiple":t.value.control.modelValue=l?[]:"";break;case"tableColumn1":_(l);break;case"formatNumber":break;case"filedNameKey":s.type==="select"&&E.dataSourceFiledList.forEach(o=>{o.name===l&&(t.value.formItem&&(t.value.formItem.label=o.label),t.value.name=o.label)});break;case"setInputSlot":l?(t.value.type="inputSlot",te.success(`请在对应的Input输入框属性前后缀设置key:${t.value.name}`)):t.value.type="select";break}if(s.path){const o=s.isNum?me(l):l;s.path&&V(t.value,s.path,o)}},V=(s,l,o)=>{let y=s;const I=l.split(".");let c=0;for(c;c<I.length-1;c++){const C=I[c];if(C in y)y=y[C];else throw new Error(`${C} is undefined`)}const m=I[c],R=y[I[c]];return o!==void 0&&(y[m]=o),{obj:y,key:m,value:R}},S=(s,l)=>{l==="tabs"?t.value.columns.splice(s,1):t.value.options.splice(s,1)},M=s=>{const l=t.value.type;l==="cascader"?U("cascader"):l==="treeSelect"?U("treeSelect"):s==="tabs"?t.value.columns.push({label:"标签名称",list:[]}):t.value.options.push({label:"",value:""})},U=s=>{var C;let l=t.value.control;const{type:o,config:y,options:I,control:c}=t.value;let m="";switch(o==="button"&&(l=y,s="button"),s){case"editCss":m="css";break;case"editRules":l=((C=t.value.formItem)==null?void 0:C.rules)||[];break;case"treeSelect":l=c.data;break;case"cascader":l=I;break;case"beforeOption":l=y.before;break;case"afterOption":l=y.after;break}J("openDialog",{content:l,codeType:m,type:s,callback:W=>{switch(s){case"editRules":t.value.formItem||(t.value.formItem={}),t.value.formItem.rules=W;break;case"editProps":t.value.control={},Object.assign(t.value.control,W);break;case"treeSelect":t.value.control.data=W;break;case"cascader":t.value.options=W;break;case"beforeOption":t.value.config.before=W;break;case"afterOption":t.value.config.after=W;break;case"button":t.value.config=W;break}}})},H=s=>{var l;(l=t.value.formItem)!=null&&l.rules||(t.value.formItem.rules=[]),s?t.value.formItem.rules.push({required:!0,message:"必填项",trigger:"change"}):t.value.formItem.rules.splice(0,1)},F=(s,l)=>{if(s&&s.length===0||Object.keys(t.value).length===0)return!1;const o=s.indexOf(t.value.type);return l?o!==-1:o===-1},_=s=>{const l={name:"index",type:"index",item:{label:"序号"},control:{},config:{}};s?t.value.list.unshift(l):t.value.list.splice(0,1)},p=Z(()=>{var l,o;const s=(o=(l=t.value)==null?void 0:l.formItem)==null?void 0:o.rules;return s&&s.length>0}),T=()=>{t.value.customRules||(t.value.customRules=[]),t.value.customRules.push({type:"required",message:"必填项",trigger:"blur"})},D=s=>{var l;(l=t.value.customRules)==null||l.splice(s,1)},G=s=>{s.key==="sourceId"&&(se(s.value),b.setActiveKey(""),b.setControlAttr({})),s.path==="config"?u.value.config[s.key]=s.value:u.value.form[s.key]=s.value},q=s=>{switch(s){case 1:return"数据源接口URL或api的key";case 2:return"字典key，默认为字段标识"}return""},A=(s,l)=>{const o=we.filter(y=>y.type===l);o&&o.length&&(s.message=o[0].message)},K=()=>{h.value||ue("sourceList").then(s=>{X.value=s.data.list})},se=(s,l)=>{h.value||!s||ue("sourceById",{id:s}).then(o=>{var I;const y=(I=o.data)==null?void 0:I.tableData;try{E.dataSourceFiledList=JSON.parse(y)}catch{E.dataSourceFiledList=[]}l&&l(E.dataSourceFiledList)}).catch(o=>{console.log(o)})};return ge(()=>{Pe(()=>{K()})}),Y({getFormFieldBySource:se}),(s,l)=>{const o=B("el-option"),y=B("el-select"),I=B("el-switch"),c=B("el-input"),m=B("el-form-item"),R=B("el-col"),C=B("el-button"),W=B("el-checkbox"),z=B("el-form"),ne=B("el-tab-pane"),Ue=B("el-tabs");return r(),f("div",el,[a(Ue,{modelValue:E.tabsName,"onUpdate:modelValue":l[26]||(l[26]=e=>E.tabsName=e)},{default:n(()=>[a(ne,{label:"字段配置",name:"first"},{default:n(()=>[a(z,{size:"small",class:"form"},{default:n(()=>[ll,(r(!0),f($,null,j(re.value,(e,L)=>(r(),g(m,{key:L,label:e.label},{default:n(()=>[e.type==="select"?(r(),g(y,{key:0,placeholder:e.placeholder,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filterable:e.path==="name","allow-create":e.path==="name",clearable:e.clearable,onChange:i=>w(e,i)},{default:n(()=>[(r(!0),f($,null,j(e.dict,(i,ke)=>(r(),g(o,{key:ke,value:e.path==="name"?i.name:ke,label:e.path==="name"?`${i.label}(${i.name})`:i},null,8,["value","label"]))),128))]),_:2},1032,["placeholder","modelValue","onUpdate:modelValue","filterable","allow-create","clearable","onChange"])):e.type==="switch"?(r(),g(I,{key:1,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,onChange:i=>w(e,i)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(r(),g(c,{key:2,type:e.inputStyle,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,placeholder:e.placeholder,onInput:i=>w(e,i)},null,8,["type","modelValue","onUpdate:modelValue","placeholder","onInput"]))]),_:2},1032,["label"]))),128)),F(["tabs"],!0)?(r(),f($,{key:0},[tl,(r(!0),f($,null,j(t.value.columns,(e,L)=>(r(),g(m,{key:L},{default:n(()=>[a(R,{span:12},{default:n(()=>[a(c,{placeholder:"标签配置项",modelValue:e.label,"onUpdate:modelValue":i=>e.label=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(R,{span:2,offset:1},{default:n(()=>[k("i",{class:"icon-del",onClick:i=>S(L,"tabs")},null,8,al)]),_:2},1024)]),_:2},1024))),128)),a(m,null,{default:n(()=>[a(C,{onClick:l[0]||(l[0]=e=>M("tabs"))},{default:n(()=>[N("增加标签")]),_:1})]),_:1})],64)):x("",!0),F(["radio","select","checkbox","cascader","inputSlot","treeSelect"],!0)?(r(),f("div",ol,[nl,F(["select"],!0)?(r(),g(m,{key:0,label:"添加全部项"},{default:n(()=>[a(c,{placeholder:"请输入全部项文案",modelValue:t.value.config.addAll,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.config.addAll=e)},null,8,["modelValue"])]),_:1})):x("",!0),a(m,{label:"选项数据源"},{default:n(()=>[a(y,{modelValue:t.value.config.optionsType,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.config.optionsType=e),onChange:l[3]||(l[3]=e=>t.value.config.optionsFun="")},{default:n(()=>[a(o,{value:0,label:"固定选项"}),a(o,{value:1,label:"数据源"}),a(o,{value:2,label:"接口字典"})]),_:1},8,["modelValue"])]),_:1}),t.value.config.optionsType===0?(r(),f($,{key:1},[t.value.type!=="cascader"?(r(),f("div",sl,[(r(!0),f($,null,j(t.value.options,(e,L)=>(r(),g(m,{key:L},{default:n(()=>[a(R,{span:10},{default:n(()=>[a(c,{placeholder:"选项标签",modelValue:e.label,"onUpdate:modelValue":i=>e.label=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(R,{span:10,offset:1},{default:n(()=>[a(c,{placeholder:"选项值",modelValue:e.value,"onUpdate:modelValue":i=>e.value=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(R,{span:2,offset:1},{default:n(()=>[k("i",{class:"icon-del",onClick:i=>S(L)},null,8,rl)]),_:2},1024)]),_:2},1024))),128))])):x("",!0),a(m,null,{default:n(()=>[a(C,{onClick:M},{default:n(()=>[N(ce(t.value.type==="cascader"?"编辑":"新增"),1)]),_:1})]),_:1})],64)):(r(),f($,{key:2},[a(m,null,{default:n(()=>[a(c,{modelValue:t.value.config.optionsFun,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.config.optionsFun=e),placeholder:q(t.value.config.optionsType)},Fe({_:2},[t.value.config.optionsType===1?{name:"prepend",fn:n(()=>[a(y,{modelValue:t.value.config.method,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.config.method=e),style:{width:"80px"}},{default:n(()=>[a(o,{label:"get",value:"get"}),a(o,{label:"post",value:"post"})]),_:1},8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),t.value.config.optionsType===1?(r(),f($,{key:0},[a(m,{label:"指定label属性值"},{default:n(()=>[a(c,{modelValue:t.value.config.label,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.config.label=e),placeholder:"指定选项标签为选项对象的某个属性值"},null,8,["modelValue"])]),_:1}),a(m,{label:"指定value属性值"},{default:n(()=>[a(c,{modelValue:t.value.config.value,"onUpdate:modelValue":l[7]||(l[7]=e=>t.value.config.value=e),placeholder:"指定选项的值为选项对象的某个属性值"},null,8,["modelValue"])]),_:1}),a(m,{label:"是否可筛选"},{default:n(()=>[a(I,{modelValue:t.value.control.filterable,"onUpdate:modelValue":l[8]||(l[8]=e=>t.value.control.filterable=e)},null,8,["modelValue"])]),_:1}),F(["select"],!0)?(r(),f($,{key:0},[a(m,{label:"开启远程数据Remote"},{default:n(()=>[a(I,{modelValue:t.value.control.remote,"onUpdate:modelValue":l[9]||(l[9]=e=>t.value.control.remote=e)},null,8,["modelValue"])]),_:1}),a(m,{label:"缓存数据结果"},{default:n(()=>[a(I,{modelValue:t.value.config.cache,"onUpdate:modelValue":l[10]||(l[10]=e=>t.value.config.cache=e)},null,8,["modelValue"])]),_:1}),a(m,{label:"联动关联设置"},{default:n(()=>[a(c,{modelValue:t.value.config.linkage,"onUpdate:modelValue":l[11]||(l[11]=e=>t.value.config.linkage=e),placeholder:"请输入关联的组件name"},null,8,["modelValue"])]),_:1}),t.value.config.remote||t.value.config.linkage?(r(),g(m,{key:0,label:"远程数据参数字段名"},{default:n(()=>[a(c,{placeholder:"远程数据参数字段名",modelValue:t.value.config.queryName,"onUpdate:modelValue":l[12]||(l[12]=e=>t.value.config.queryName=e)},null,8,["modelValue"])]),_:1})):x("",!0)],64)):x("",!0)],64)):x("",!0),t.value.config.optionsType===1?(r(),g(m,{key:1},{default:n(()=>[a(C,{onClick:l[13]||(l[13]=e=>U("beforeOption"))},{default:n(()=>[N("before事件 ")]),_:1}),a(C,{onClick:l[14]||(l[14]=e=>U("afterOption"))},{default:n(()=>[N("after事件 ")]),_:1})]),_:1})):x("",!0)],64)),a(m,{label:"尝试转换value值为"},{default:n(()=>[a(y,{modelValue:t.value.config.transformData,"onUpdate:modelValue":l[15]||(l[15]=e=>t.value.config.transformData=e),placeholder:"默认为number"},{default:n(()=>[a(o,{value:"none"},{default:n(()=>[N("不转换")]),_:1}),a(o,{value:"number"},{default:n(()=>[N("number")]),_:1}),a(o,{value:"string"},{default:n(()=>[N("string")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):x("",!0),!h.value&&F(["txt","title","table","grid","tabs","card","switch","gridChild","tableColumn","divider","div","button"])?(r(),f($,{key:2},[il,F(["input","password","component"],!0)?(r(),f("div",cl,[(r(!0),f($,null,j(t.value.customRules,(e,L)=>(r(),g(m,{key:e.type},{default:n(()=>[a(c,{modelValue:e.message,"onUpdate:modelValue":i=>e.message=i,placeholder:"校验提示信息"},{prepend:n(()=>[a(y,{modelValue:e.type,"onUpdate:modelValue":i=>e.type=i,style:{width:"80px"},onChange:i=>A(e,i)},{default:n(()=>[(r(!0),f($,null,j(E.customRulesList,i=>(r(),g(o,{key:i.type,label:i.label,value:i.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),append:n(()=>[k("i",{class:"icon-del",onClick:i=>D(L)},null,8,ul)]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.type==="rules"?(r(),g(c,{key:0,placeholder:"正则表达式",modelValue:e.rules,"onUpdate:modelValue":i=>e.rules=i},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),e.type==="methods"?(r(),g(c,{key:1,placeholder:"方法名称，此方法仅适用于导出vue文件",modelValue:e.methods,"onUpdate:modelValue":i=>e.methods=i},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)]),_:2},1024))),128)),a(m,null,{default:n(()=>[a(C,{onClick:T},{default:n(()=>[N("快速添加")]),_:1}),a(C,{onClick:l[16]||(l[16]=e=>U("editRules"))},{default:n(()=>[N("编写校验规则 ")]),_:1})]),_:1})])):(r(),g(m,{key:1},{default:n(()=>{var e,L;return[a(W,{modelValue:p.value,onChange:H},{default:n(()=>[N("必填 ")]),_:1},8,["modelValue"]),(e=t.value.item)!=null&&e.rules&&((L=t.value.item)!=null&&L.rules[0])?(r(),g(c,{key:0,placeholder:"自定义必填错误提示",modelValue:t.value.item.rules[0].message,"onUpdate:modelValue":l[17]||(l[17]=i=>t.value.item.rules[0].message=i)},null,8,["modelValue"])):x("",!0)]}),_:1}))],64)):x("",!0),F(["grid","card","gridChild","divider","div"])?(r(),f("div",dl,[pl,a(C,{size:"small",onClick:l[18]||(l[18]=e=>U("editProps"))},{default:n(()=>[N("编辑属性 ")]),_:1})])):x("",!0)]),_:1})]),_:1}),a(ne,{label:"表单配置",name:"second"},{default:n(()=>[a(z,{size:"small",class:"form"},{default:n(()=>[(r(!0),f($,null,j(oe.value.filter(e=>!e.hide),(e,L)=>(r(),g(m,{label:e.label,key:L},{default:n(()=>[e.type==="select"?(r(),g(y,{key:0,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filterable:e.key==="class","allow-create":e.key==="class",placeholder:e.placeholder,clearable:e.clearable,onChange:i=>G(e)},{default:n(()=>[(r(!0),f($,null,j(e.options,i=>(r(),g(o,{label:i.label||i.name,key:i.label||i.name,value:le(me)(i.value??i.id)},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","filterable","allow-create","placeholder","clearable","onChange"])):e.type==="switch"?(r(),g(I,{key:1,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,onChange:i=>G(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(r(),g(c,{key:2,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,placeholder:e.placeholder,onInput:i=>G(e)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"]))]),_:2},1032,["label"]))),128)),a(m,null,{default:n(()=>[a(C,{onClick:l[19]||(l[19]=e=>U("editCss")),type:"primary"},{default:n(()=>[N("编辑表单样式 ")]),_:1})]),_:1}),h.value?x("",!0):(r(),f($,{key:0},[vl,a(m,{label:"新增数据保存url"},{default:n(()=>[a(c,{placeholder:"表单提交的url，通用提交时可不设置",modelValue:le(u).apiKey.add,"onUpdate:modelValue":l[20]||(l[20]=e=>le(u).apiKey.add=e)},null,8,["modelValue"])]),_:1}),a(m,{label:"修改数据保存url"},{default:n(()=>[a(c,{placeholder:"修改提交的url，通用提交时可不设置",modelValue:le(u).apiKey.edit,"onUpdate:modelValue":l[21]||(l[21]=e=>le(u).apiKey.edit=e)},null,8,["modelValue"])]),_:1}),a(m,{label:"获取表单数据url"},{default:n(()=>[a(c,{placeholder:"获取表单数据url，通用提交时可不设置",modelValue:le(u).apiKey.get,"onUpdate:modelValue":l[22]||(l[22]=e=>le(u).apiKey.get=e)},null,8,["modelValue"])]),_:1}),a(m,{class:"event-btn"},{default:n(()=>[a(C,{type:"primary",onClick:l[23]||(l[23]=e=>U("before"))},{default:n(()=>[N("before事件 ")]),_:1}),a(C,{type:"primary",onClick:l[24]||(l[24]=e=>U("after"))},{default:n(()=>[N("after事件 ")]),_:1}),a(C,{type:"primary",onClick:l[25]||(l[25]=e=>U("change"))},{default:n(()=>[N("change改变事件 ")]),_:1})]),_:1})],64))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),fl=Q=>{const Y=[];return Q.forEach(P=>{const J=hl(P);let u={};switch(P.filedType){case"select":u={control:{appendToBody:!0},options:[],config:{optionsType:0}};break;case"radio":u={options:[],config:{optionsType:0}};break;case"checkbox":case"cascader":u={control:{modelValue:[]},options:[],config:{optionsType:0}};break;case"switch":u={control:{modelValue:!1},options:[]};break;case"datePicker":u={control:{type:"date"}};break;case"inputNumber":case"slider":u={control:{modelValue:0}};break}Y.push(Object.assign({},J,u))}),Y},hl=Q=>be({type:Q.filedType,control:{modelValue:""},config:{},name:Q.name,formItem:{label:Q.label}}),bl=fl,yl={class:"design-container"},gl={class:"main-body"},kl={class:"main-form"},Vl={key:0,class:"empty-tips"},_l={class:"dialog-footer"},wl=ve({name:"designFormIndex",__name:"index",setup(Q){Oe().changeBreadcrumb([{label:"系统工具"},{label:"表单设计"}]);const P=xe(),J=Ee(),u=ye(),d=ae({list:[],form:{size:"default"},config:{submitCancel:!0},apiKey:{}}),O=ae();Ae("formData",d);const b=pe({editor:{},loading:!1,formDataPreview:{},previewVisible:!1,operateType:u.query.type}),v=pe({visible:!1,type:"",title:"",codeType:"",direction:void 0,callback:""}),t=ae(),h=ae(),X=()=>{const _=u.query.id;_&&(b.loading=!0,ue("designById",{id:_}).then(p=>{const T=p.data;if(T.data){const D=ie(T.data);D&&Object.keys(D).length&&(d.value=D)}d.value.config.sourceId=T.source,d.value.config.name=T.name,T.source&&b.designType!=="search"&&h.value.getFormFieldBySource(T.source),b.loading=!1}).catch(p=>{te.error(p.message||"加载异常"),b.loading=!1}))},oe=()=>{const{submitUrl:_,editUrl:p,requestUrl:T}=d.value.config;if(!d.value.config.sourceId&&(!_||!p||!T)&&b.designType!=="search"){te.error("请选择数据源或配置接口url地址，否则表单无法提交保存");return}let D={data:ee(d.value),source:d.value.config.sourceId,name:d.value.config.name,type:1},G="designSave";u.id?(Object.assign(D,{id:u.id}),G="designEdit"):D.status=1,b.designType==="search"&&(D={data:ee(d.value),id:u.id}),b.loading=!0,ue(G,D).then(q=>{te({message:q.message||"保存成功！",type:"success"});const A=u.redirect||"/design/form/list",K={};u.redirect&&u.redirect.indexOf("?")!==-1&&u.redirect.split("?")[1].split("&").forEach(l=>{const o=l.split("=");K[o[0]]=o[1]}),J.push({path:A,query:K}),b.loading=!1}).catch(q=>{te.error(q.message||"保存异常"),b.loading=!1}),P.setActiveKey(""),P.setControlAttr({})},re=_=>{switch(_){case"del":d.value=JSON.parse(O.value),P.setActiveKey(""),P.setControlAttr({});break;case"eye":P.setActiveKey(""),P.setControlAttr({}),b.previewVisible=!0;let p=ee(d.value);const T=d.value.form.name,D=new RegExp(`get${T}ControlByName`,"g");p=p.replace(D,`getPreview${T}ControlByName`),b.formDataPreview=ie(p),b.formDataPreview.form.name=`Preview${T}`;break;case"json":E({type:"creatJson",content:d.value});break;case"save":oe();break;case"vue":t.value.open(d.value);break}},E=_=>{var K;const{type:p,direction:T,codeType:D,callback:G,content:q}=_;v.direction=T||"ltr",v.type=p,v.codeType=D||"",v.title=Ve[p],v.visible=!0,v.callback=G;let A;switch(p){case"editCss":A=((K=d.value.config)==null?void 0:K.style)||"";break;case"before":case"after":case"change":const se=d.value.events||{};se[p]?A=ee(se[p],!0):A=_e(p);break;case"beforeOption":case"afterOption":const s=p.replace("Option","");q?A=ee(q,!0):A=_e(s),v.title=Ve[s];break;case"creatJson":A=ee(q,!0);break;default:A=ee(q,!0)}v.content=A},w=_=>{try{let p;switch(v.codeType){case"json":p=Re(_);break;case"css":p=_;break;default:p=ie(_)}switch(typeof v.callback=="function"&&v.callback(p),v.type){case"editCss":d.value.config||(d.value.config={}),d.value.config.style=p;break;case"before":case"after":case"change":d.value.events||(d.value.events={}),d.value.events[v.type]=p;break;case"creatJson":d.value=p;break}S()}catch(p){te.error(p.message||"未知原因")}},V=()=>{S()},S=()=>{v.visible=!1,v.type="",v.title="",v.codeType="",v.callback="",v.content=""},M=ae(),U=()=>{M.value.validate((_,p)=>{if(_)te.success("校验通过"),console.log(p);else return te.error("校验不通过"),!1})},H=_=>{d.value=ie(ee(_))},F=_=>{d.value.list.push(_)};return ge(()=>{X(),O.value=JSON.stringify(d.value),u.source&&h.value.getFormFieldBySource(u.source,_=>{d.value.list=bl(_)})}),(_,p)=>{var A;const T=B("ak-form"),D=B("el-button"),G=B("el-dialog"),q=Be("loading");return r(),f("div",yl,[a(Ze,{onClickCheck:F,onClick:H},null,8,["onClickCheck"]),k("div",gl,[a(Ne,{onClick:re}),Le((r(),f("div",kl,[((A=d.value.list)==null?void 0:A.length)===0?(r(),f("div",Vl," 从左侧拖拽来添加字段 ")):x("",!0),a(T,{data:d.value,operateType:_.$route.query.type==="search"?"search":"design"},null,8,["data","operateType"])])),[[q,b.loading]])]),a(ml,{ref_key:"formControlAttrEl",ref:h,onOpenDialog:E},null,512),a(qe,{modelValue:v.visible,"onUpdate:modelValue":p[0]||(p[0]=K=>v.visible=K),title:v.title,direction:v.direction,content:v.content,"code-type":v.codeType,onBeforeClose:V,onConfirm:w},null,8,["modelValue","title","direction","content","code-type"]),["search"].includes(b.designType)?x("",!0):(r(),g(Te,{key:0,ref_key:"vueFileEl",ref:t},null,512)),a(G,{modelValue:b.previewVisible,"onUpdate:modelValue":p[2]||(p[2]=K=>b.previewVisible=K),title:"预览",fullscreen:!0},{footer:n(()=>[k("div",_l,[a(D,{size:"small",type:"primary",onClick:U},{default:n(()=>[N(" 提交 ")]),_:1}),a(D,{size:"small",onClick:p[1]||(p[1]=K=>b.previewVisible=!1)},{default:n(()=>[N(" 取消 ")]),_:1})])]),default:n(()=>[b.previewVisible?(r(),g(T,{key:0,data:b.formDataPreview,ref_key:"previewForm",ref:M},null,8,["data"])):x("",!0)]),_:1},8,["modelValue"])])}}});typeof Se=="function"&&Se(wl);export{wl as default};
