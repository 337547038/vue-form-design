import{d as le,l as H,h as q,p as ue,r as M,o as y,b as L,w as s,i as l,m as N,C as ee,M as we,c as R,a as Z,F as X,g as S,f as J,q as me,N as xe,O as ne,L as pe,G as Ce,H as Se,t as te,n as K,P as Q,Q as Ie,s as ie,R as $e,S as ce,v as be,z as oe,U as re,V as de,W as ke,X as Te,A as Ve,u as Ae,k as De,B as Re,D as fe,Y as Ue,Z as Ee,$ as ze,a0 as ve,x as Me,E as he}from"./index-CDYjrzCG.js";import{u as ae,g as Oe,r as I,_ as Le,c as Be,a as Ne,b as Fe}from"./screenGroup.vue_vue_type_script_setup_true_lang-Cdgq1aiv.js";import{_ as Pe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-B7k-_fcU.js";import{_ as qe,a as We,g as He,b as Je}from"./aceTooptip-BYJtI7gJ.js";const Ke=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],se={bg:Ke},Xe={class:"img-list"},Ye=["onClick"],Ge=["src"],Qe={key:0},Ze=le({__name:"upload",emits:["click"],setup(j,{expose:A,emit:g}){const $=g,b=H(!1),h=H(),a=H("bg"),F=q(()=>{if(!se)return[];const T=[];for(const p in se)T.push(p);return T}),B=q(()=>a.value.name==="upload"?[]:se?se[a.value]:[]),m=q(()=>`./static/screen/${a.value}/`),w=T=>{b.value=!1,$("click",m.value+T,h.value)},_=T=>{a.value="upload",me(()=>{B.value.unshift(T.path)})};return A({open:(T,p)=>{b.value=!0,h.value=p,T?a.value=T:a.value=F.value[0]}}),ue(()=>{}),(T,p)=>{const c=M("el-button"),U=M("el-upload"),E=M("el-tab-pane"),v=M("el-tabs"),C=M("el-dialog");return y(),L(C,{modelValue:b.value,"onUpdate:modelValue":p[1]||(p[1]=t=>b.value=t),width:"800px",title:"选择上传图片"},{default:s(()=>{var t;return[l(U,{action:ee(we),"on-success":_,"show-file-list":!1},{default:s(()=>[l(c,{type:"primary"},{default:s(()=>[N("上传")]),_:1})]),_:1},8,["action"]),l(v,{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=e=>a.value=e)},{default:s(()=>[(y(!0),R(X,null,Z(F.value,e=>(y(),L(E,{label:e,name:e,key:e},null,8,["label","name"]))),128)),l(E,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),S("div",Xe,[S("ul",null,[(y(!0),R(X,null,Z(B.value,e=>(y(),R("li",{key:e,onClick:i=>w(e)},[S("img",{src:m.value+e,alt:""},null,8,Ge)],8,Ye))),128))]),(t=B.value)!=null&&t.length?J("",!0):(y(),R("p",Qe,"暂无相关素材资源"))])]}),_:1},8,["modelValue"])}}}),je=xe(Ze,[["__scopeId","data-v-631dd2e4"]]),et={key:0},tt=S("h3",null,"数据",-1),lt=S("h3",null,"接口数据处理事件",-1),ot=S("h3",null,"全局数据",-1),at=S("h3",null,"接口数据处理事件",-1),st=le({__name:"configControl",emits:["openDrawer"],setup(j,{emit:A}){const g=A,$=ne("screenData"),b=q(()=>$.value.config||{}),h=ae(),a=q(()=>h.controlAttr),F=q(()=>{var t,e,i,u;return((e=(t=a.value)==null?void 0:t.config)==null?void 0:e.lock)||((u=(i=a.value)==null?void 0:i.position)==null?void 0:u.display)}),B=H(),m=q(()=>a.value.type),w=pe({bgColor:"",bgUpload:"",bgSelect:""}),_=Ce(()=>b.value,t=>{if(!Object.keys(a.value).length){const e=t.background||"";if(e.indexOf("url")!==-1){const i=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),u=e.match(i);Object.assign(w,{bgUpload:u,bgSelect:2})}else Object.assign(w,{bgColor:e,bgSelect:1})}},{immediate:!0}),x=()=>{let t="";switch(w.bgSelect){case 1:t=w.bgColor;break;case 2:t=`url(${w.bgUpload})`;break}T("background",t)},T=(t,e)=>{$.value.config=Object.assign({},b.value,{[t]:e})},p=q(()=>{var t,e,i,u;if(Object.keys(a.value).length){const{config:n={},position:f,type:z}=a.value;return[{type:"group",title:"位置信息"},{label:"width",value:f.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:f.height,placeholder:"请输入高度",key:"height",path:"position"},{label:"left",value:f.left,placeholder:"图层位置",key:"left",path:"position"},{label:"top",value:f.top,key:"top",path:"position"},{label:"right",value:f.right,placeholder:"设置后left为auto",key:"right",path:"position"},{label:"bottom",value:f.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:f.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:n.lock,key:"lock"},{type:"switch",label:"隐藏",value:f.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:n.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:n.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:n.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:n.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:n.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:n.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:(t=n.style)==null?void 0:t.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:(e=n.style)==null?void 0:e.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:(i=n.style)==null?void 0:i.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:(u=n.style)==null?void 0:u.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:n.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:n.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:n.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:n.speed,key:"speed",vShow:["table"]}].filter(D=>{let d=!0;return D.vShow&&(d=D.vShow.includes(z)),D.vHide&&(d=!D.vHide.includes(z)),d})}return[]}),c=(t,e)=>{var i;t.path==="position"?a.value.position[t.key]=e:t.path==="style"?((i=a.value.config)!=null&&i.style||(a.value.config.style={}),a.value.config.style[t.key]=e):a.value.config[t.key]=e},U=(t,e)=>{B.value.open(t,e)},E=(t,e)=>{switch(e){case"screenBg":w.bgUpload=t,x();break;case"src":a.value.config.src=t;break}},v=(t,e)=>{var D,d,k;let i="",u,n="",f=t;switch(t){case"editCss":i="css";break;case"before":case"after":e?(u=b.value&&b.value[t],f="afterScreen"):(n="获取数据响应处理之后事件，可对请求返回数据进行处理",u=a.value.config&&a.value.config[t]);break;case"style":i="json",u=((D=a.value.config)==null?void 0:D.style)||{},n="可输入更多的css样式，须为json格式";break;case"echartsEdit":u=a.value.option,n="可参考echarts相关例子编辑";break;case"tablePropsEdit":i="json",u=((d=a.value.config)==null?void 0:d.props)||{},n="支持所有表格props属性，可参考el-table。json格式";break;case"editData":const r=a.value.type;n="图表数据，替换相关数据返回即可",["text","sText"].includes(r)?(u=(k=a.value.config)==null?void 0:k.text,n="编辑文本内容数据"):u=a.value.option,r==="table"&&(n="表格列表数据。根据设定的table-column列数据设置对应的数据");break}const z={content:u,codeType:i,type:f,title:n,callback:r=>{switch(t){case"before":case"after":e?b.value[t]=r:a.value.config[t]=r;break;case"style":a.value.config.style=r;break;case"echartsEdit":a.value.option=r;break;case"tablePropsEdit":a.value.config.props=r;break;case"editData":const V=a.value.type;["text","sText"].includes(V)?a.value.config.text=r:a.value.option=r;break}}};console.log("open",z),g("openDrawer",z)},C=()=>{Oe(b.value).then(()=>{Q.success("连接成功")}).catch(t=>{Q.error(t.msg||"连接失败")})};return Se(()=>{_()}),(t,e)=>{const i=M("el-switch"),u=M("el-color-picker"),n=M("el-input"),f=M("el-option"),z=M("el-select"),D=M("el-input-number"),d=M("el-form-item"),k=M("el-button"),r=M("el-form"),V=M("el-radio"),P=M("el-radio-group"),O=M("el-tab-pane"),Y=M("el-tabs");return y(),R("div",{class:K(["main-right",{lock:F.value}])},[l(Y,{class:"tabs","model-value":"position"},{default:s(()=>[l(O,{label:"属性配置",name:"position"},{default:s(()=>[l(r,{size:"small"},{default:s(()=>[(y(!0),R(X,null,Z(p.value,(o,G)=>(y(),L(d,{label:o.label,key:G},{default:s(()=>[o.type==="group"?(y(),R("h3",et,te(o.title),1)):o.type==="switch"?(y(),L(i,{key:1,"model-value":o.value,onChange:W=>c(o,W),class:K([o.key])},null,8,["model-value","onChange","class"])):o.type==="color"?(y(),L(u,{key:2,"show-alpha":"",onChange:W=>c(o,W),"model-value":o.value},null,8,["onChange","model-value"])):o.type==="textarea"?(y(),L(n,{key:3,type:"textarea",placeholder:o.placeholder,onChange:W=>c(o,W),"model-value":o.value},null,8,["placeholder","onChange","model-value"])):o.type==="select"?(y(),L(z,{key:4,allowCreate:o.allowCreate,filterable:o.filterable,placeholder:o.placeholder,onChange:W=>c(o,W),"model-value":o.value},{default:s(()=>[(y(!0),R(X,null,Z(o.options,(W,_e)=>(y(),L(f,{key:W,label:W,value:_e},null,8,["label","value"]))),128))]),_:2},1032,["allowCreate","filterable","placeholder","onChange","model-value"])):o.type==="number"?(y(),L(D,{key:5,"controls-position":"right",placeholder:o.placeholder,"model-value":o.value,onInput:W=>c(o,W)},null,8,["placeholder","model-value","onInput"])):(y(),L(n,{key:6,placeholder:o.placeholder,"model-value":o.value,onInput:W=>c(o,W)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(m.value)?(y(),L(d,{key:0,class:"upload-image"},{default:s(()=>[l(n,{placeholder:"请输入图片地址",modelValue:a.value.config.src,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.config.src=o)},null,8,["modelValue"]),l(k,{type:"primary",onClick:e[1]||(e[1]=o=>U(m.value==="image"?"img":"bg","src"))},{default:s(()=>[N("选择图片 ")]),_:1})]),_:1})):J("",!0),["line","bar","pie","echarts"].includes(m.value)?(y(),L(d,{key:1},{default:s(()=>[l(k,{type:"primary",onClick:e[2]||(e[2]=o=>v("echartsEdit"))},{default:s(()=>[N("图表编辑 ")]),_:1})]),_:1})):J("",!0),["text","sText","image","background","border","clock"].includes(m.value)?(y(),L(d,{key:2},{default:s(()=>[l(k,{type:"primary",onClick:e[3]||(e[3]=o=>v("style"))},{default:s(()=>[N("编辑更多内联样式 ")]),_:1})]),_:1})):J("",!0),["table"].includes(m.value)?(y(),L(d,{key:3},{default:s(()=>[l(k,{type:"primary",onClick:e[4]||(e[4]=o=>v("tablePropsEdit"))},{default:s(()=>[N("表格属性 ")]),_:1})]),_:1})):J("",!0)]),_:1}),["line","bar","pie","echarts","text","sText","table"].includes(m.value)?(y(),L(r,{key:0,size:"small"},{default:s(()=>[l(d,null,{default:s(()=>[tt]),_:1}),l(d,{label:"数据类型"},{default:s(()=>[l(P,{modelValue:a.value.config.optionsType,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.config.optionsType=o)},{default:s(()=>[l(V,{value:0,style:{"margin-right":"4px"}},{default:s(()=>[N("静态/全局 ")]),_:1}),l(V,{value:1},{default:s(()=>[N("动态")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.config.optionsType!==1?(y(),L(d,{key:0},{default:s(()=>[l(k,{type:"primary",onClick:e[6]||(e[6]=o=>v("editData"))},{default:s(()=>[N("编辑数据 ")]),_:1})]),_:1})):J("",!0),a.value.config.optionsType===1?(y(),R(X,{key:1},[l(d,null,{default:s(()=>[l(n,{modelValue:a.value.config.requestUrl,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.config.requestUrl=o),placeholder:"接口URL或api中的key"},{prepend:s(()=>[l(z,{modelValue:a.value.config.method,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.config.method=o),style:{width:"60px"}},{default:s(()=>[l(f,{label:"get",value:"get"}),l(f,{label:"post",value:"post"}),l(f,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"刷新时间"},{default:s(()=>[l(D,{modelValue:a.value.config.loopTime,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.config.loopTime=o),disabled:""},null,8,["modelValue"])]),_:1}),l(d,null,{default:s(()=>[lt]),_:1}),l(d,null,{default:s(()=>[l(k,{type:"primary",onClick:e[10]||(e[10]=o=>v("before"))},{default:s(()=>[N("before事件 ")]),_:1})]),_:1}),l(d,null,{default:s(()=>[l(k,{type:"primary",onClick:e[11]||(e[11]=o=>v("after"))},{default:s(()=>[N("after事件 ")]),_:1})]),_:1})],64)):J("",!0)]),_:1})):J("",!0)]),_:1}),l(O,{label:"大屏配置",name:"screen"},{default:s(()=>[l(r,{size:"small"},{default:s(()=>[l(d,{label:"大屏宽度"},{default:s(()=>[l(n,{placeholder:"请输入大屏宽度","model-value":b.value.width,onInput:e[12]||(e[12]=o=>T("width",o))},null,8,["model-value"])]),_:1}),l(d,{label:"大屏高度"},{default:s(()=>[l(n,{placeholder:"请输入大屏高度","model-value":b.value.height,onInput:e[13]||(e[13]=o=>T("height",o))},null,8,["model-value"])]),_:1}),l(d,{class:"color-picker",label:"主色"},{default:s(()=>[l(u,{"show-alpha":"",onChange:e[14]||(e[14]=o=>T("primary",o)),"model-value":b.value.primary},null,8,["model-value"])]),_:1}),l(d,{label:"背景"},{default:s(()=>[l(z,{modelValue:w.bgSelect,"onUpdate:modelValue":e[15]||(e[15]=o=>w.bgSelect=o),onChange:x},{default:s(()=>[l(f,{value:1,label:"背景色"}),l(f,{value:2,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),w.bgSelect===1?(y(),L(d,{key:0,class:"color-picker"},{default:s(()=>[l(u,{"show-alpha":"",modelValue:w.bgColor,"onUpdate:modelValue":e[16]||(e[16]=o=>w.bgColor=o),onChange:x},null,8,["modelValue"])]),_:1})):J("",!0),w.bgSelect===2?(y(),L(d,{key:1,class:"upload-image"},{default:s(()=>[l(n,{placeholder:"请输入图片地址",modelValue:w.bgUpload,"onUpdate:modelValue":e[17]||(e[17]=o=>w.bgUpload=o),onChange:x},null,8,["modelValue"]),l(k,{type:"primary",onClick:e[18]||(e[18]=o=>U("bg","screenBg"))},{default:s(()=>[N("上传 ")]),_:1})]),_:1})):J("",!0),l(d,null,{default:s(()=>[l(k,{onClick:e[19]||(e[19]=o=>v("editCss"))},{default:s(()=>[N("编辑样式")]),_:1})]),_:1}),l(d,null,{default:s(()=>[ot]),_:1}),l(d,null,{default:s(()=>[l(n,{"model-value":b.value.requestUrl,placeholder:"接口URL或api中的key",onInput:e[21]||(e[21]=o=>T("requestUrl",o))},{prepend:s(()=>[l(z,{"model-value":b.value.method,style:{width:"60px"},onChange:e[20]||(e[20]=o=>T("method",o))},{default:s(()=>[l(f,{label:"get",value:"get"}),l(f,{label:"post",value:"post"}),l(f,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),b.value.requestUrl?(y(),L(d,{key:2},{default:s(()=>[l(k,{type:"primary",onClick:C},{default:s(()=>[N("连接测试 ")]),_:1})]),_:1})):J("",!0),l(d,{label:"刷新时间"},{default:s(()=>[l(D,{disabled:"","model-value":b.value.loopTime,onInput:e[22]||(e[22]=o=>T("loopTime",o))},null,8,["model-value"])]),_:1}),l(d,null,{default:s(()=>[at]),_:1}),l(d,null,{default:s(()=>[l(k,{type:"primary",onClick:e[23]||(e[23]=o=>v("before",!0))},{default:s(()=>[N("before事件 ")]),_:1})]),_:1}),l(d,null,{default:s(()=>[l(k,{type:"primary",onClick:e[24]||(e[24]=o=>v("after",!0))},{default:s(()=>[N("after事件 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(je,{ref_key:"uploadImageEl",ref:B,onClick:E},null,512)],2)}}}),nt={class:"main-left"},it={class:"components-list scroll"},ct={class:"title"},rt=["title"],ut={class:"scroll layer-list"},pt=["onClick"],dt=["onUpdate:modelValue"],ft=["title"],vt={class:"icon-group"},ht=["onClick"],gt=["onClick"],yt=S("i",{class:"icon-del"},null,-1),mt=le({__name:"controlLeft",setup(j){const A=ae(),g=ne("screenData")||{},$=q(()=>{let m=[];return g.value.list.forEach(w=>{var _;w.id!=="rect"&&(m.push(w),["div","group"].includes(w.type)&&((_=w.list)!=null&&_.length)&&(w.list.forEach(x=>{x.pid=w.id}),m=[...m,...w.list]))}),m}),b={line:"line",bar:"bar",pie:"pie",echarts:"",table:"table",text:"text2",sText:"sText",image:"image",background:"image",border:"border",clock:"time",div:"div",group:"div",component:"component"},h=m=>`icon-${b[m.type]}`,a=(m,w)=>{var _;switch(w){case"display":m.position.display=!m.position.display;break;case"lock":m.config.lock=!m.config.lock,m.type==="div"&&((_=m.list)==null||_.forEach(x=>{x.config.lock=!m.config.lock}));break;case"active":A.setActiveId(m.id),A.setControlAttr(m);break;case"del":g.value.list.forEach((x,T)=>{var p;x.id===m.id?g.value.list.splice(T,1):["div","group"].includes(x.type)&&((p=x.list)!=null&&p.length)&&x.list.forEach((c,U)=>{c.id===m.id&&x.list.splice(U,1)})});break}},F=H([{label:"图表",children:[{type:"line",label:"折线图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:"柱状图",position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:"饼图",position:{width:300,height:300},option:{grid:{left:0,top:0,right:0,bottom:0},series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:"通用图表",position:{width:400,height:300},option:{grid:{left:0,top:0,right:0,bottom:0}}}]},{label:"表格",children:[{type:"table",label:"表格",position:{width:500,height:300},option:{columns:[],list:[]}}]},{label:"辅助",children:[{type:"text",label:"文本",position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:"滚动文本",position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:"图片",position:{width:100,height:50},config:{src:""}},{type:"background",label:"背景",position:{width:100,height:50},config:{src:""}},{type:"border",label:"边框",position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}},{type:"clock",label:"当前时间",position:{width:150,height:30}}]},{label:"布局",children:[{type:"div",label:"div布局",position:{height:100},list:[]}]},{label:"自定义组件",children:[{type:"component",label:"自定义",position:{width:200,height:200},config:{}}]}]),B=m=>ce(m);return(m,w)=>{const _=M("el-tab-pane"),x=M("el-popconfirm"),T=M("el-tabs");return y(),R("div",nt,[l(T,{"model-value":"component",class:"tabs"},{default:s(()=>[l(_,{label:"组件",name:"component"},{default:s(()=>[S("div",it,[(y(!0),R(X,null,Z(F.value,(p,c)=>(y(),R("div",{key:c},[S("div",ct,te(p.label),1),l(ee(Ie),{itemKey:"label",tag:"ul",modelValue:p.children,"onUpdate:modelValue":U=>p.children=U,group:{name:"screen",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:B},{item:s(({element:U})=>[S("li",{class:K([U.type])},[S("i",{class:K(`icon-${b[U.type]}`)},null,2),S("span",{title:U.label},te(U.label),9,rt)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),l(_,{label:"图层",name:"layer"},{default:s(()=>[S("div",ut,[S("ul",null,[(y(!0),R(X,null,Z($.value,(p,c)=>{var U,E,v,C;return y(),R("li",{key:c,class:K({active:ee(A).activeId===p.id,lock:(U=p.config)==null?void 0:U.lock,display:(E=p.position)==null?void 0:E.display,"text-indent":p.pid})},[S("div",{class:"name",onClick:t=>a(p,"active")},[S("i",{class:K(h(p))},null,2),ee(A).activeId===p.id?ie((y(),R("input",{key:0,"onUpdate:modelValue":t=>p.layerName=t},null,8,dt)),[[$e,p.layerName]]):(y(),R("span",{key:1,title:p.layerName||p.id},te(p.layerName||p.id),9,ft))],8,pt),S("div",vt,[S("i",{onClick:t=>a(p,"display"),class:K(["icon",[(v=p.position)!=null&&v.display?"icon-eye-close":"icon-eye"]])},null,10,ht),S("i",{onClick:t=>a(p,"lock"),class:K(["icon",[(C=p.config)!=null&&C.lock?"icon-lock":"icon-lock-open"]])},null,10,gt),l(x,{title:"确认删除",onConfirm:t=>a(p,"del")},{reference:s(()=>[yt]),_:2},1032,["onConfirm"])])],2)}),128))])])]),_:1})]),_:1})])}}}),bt={class:"ruler-box"},ge=le({__name:"ruler",props:{direction:{default:"h"},scale:{},showRuler:{type:Boolean},size:{}},setup(j){const A=j,g=q(()=>({width:parseInt(A.size)*A.scale/100+"px"})),$=q(()=>{const b=parseInt(A.size)+100,h=[];for(let a=0;a<b;a=a+100)h.push(a);return h});return(b,h)=>ie((y(),R("div",{class:K(["screen-ruler",`ruler-${b.direction}`]),style:oe(g.value)},[S("div",bt,[(y(!0),R(X,null,Z($.value,a=>(y(),R("span",{key:a,style:oe({width:`${b.scale}px`})},te(a),5))),128))])],6)),[[be,b.showRuler]])}}),kt=["onClick"],_t=le({__name:"rightMenu",setup(j,{expose:A}){const g=ne("screenData"),$=ae(),b=H({}),h=H(!1),a=q(()=>{let x=b.value.type;["tempRect","group"].includes(x)||(x="single");const T={tempRect:["merge","left","right","top","bottom","horizontally","verticalCenter","del","lock","display"],group:["copy","split","del","lock","display"],single:["copy","del","lock","display"]};return[{key:"merge",label:"组合"},{key:"split",label:"拆分"},{key:"left",label:"左对齐"},{key:"right",label:"右对齐"},{key:"top",label:"顶部对齐"},{key:"bottom",label:"底部对齐"},{key:"horizontally",label:"水平居中"},{key:"verticalCenter",label:"垂直居中"},{key:"copy",label:"复制"},{key:"del",label:"删除"},{key:"lock",label:"锁定"},{key:"display",label:"隐藏"}].filter(p=>T[x].includes(p.key))}),F=q(()=>({left:`${b.value.x+10}px`,top:`${b.value.y+10}px`})),B=()=>{setTimeout(()=>{w()},1e3)},m=x=>{g.value.list.forEach((c,U)=>{c.id===b.value.id&&p(c,U,g.value.list),c.list&&Array.isArray(c.list)&&c.list.forEach((E,v)=>{E.id===b.value.id&&p(E,v,c.list)}),T(c)});function T(c){if(b.value.type==="tempRect")switch(x){case"display":$.tempActiveId.includes(c.id)&&(c.position.display=!0);break;case"lock":$.tempActiveId.includes(c.id)&&(c.config.lock=!0);break}}function p(c,U,E){const v=b.value.type;switch(x){case"copy":const C=ce(c);C.id=C.type+new Date().getTime(),C.layerName="复制"+C.layerName,E.push(C),Q.success("复制成功");break;case"del":v==="tempRect"?(c.position.display=!0,g.value.list=g.value.list.filter(r=>!$.tempActiveId.includes(r.id))):E.splice(U,1),Q.success("删除成功");break;case"lock":v==="tempRect"?c.position.display=!0:c.config.lock=!0,["div","group"].includes(v)&&c.list&&Array.isArray(c.list)&&c.list.forEach(r=>{r.config.lock=!0}),Q.success("锁定成功");break;case"display":c.position.display=!0,Q.success("隐藏成功");break;case"horizontally":case"verticalCenter":const{top:t,height:e,left:i,width:u}=c.position;let n=I(t)+I(e)/2,f="top",z="height";x==="verticalCenter"&&(n=I(i)+I(u)/2,f="left",z="width");let D=0;for(const r in $.tempActiveId){const V=E.filter(P=>P.id===$.tempActiveId[r])[0];V.position[f]=n-I(V.position[z])/2,V.position[z]>D&&(D=I(V.position[z]))}c.position[z]=D+"px",c.position[f]=n-D/2;break;case"left":case"top":const d=x==="left"?"width":"height";if(v==="tempRect"){const r=I(c.position[x]);let V=0;for(const P in $.tempActiveId){const O=E.filter(Y=>Y.id===$.tempActiveId[P])[0];O.position[x]=r,O.position[d]>V&&(V=I(O.position[d]))}c.position[d]=V+"px"}break;case"bottom":if(v==="tempRect"){const{height:r,top:V}=c.position,P=I(r)+I(V);let O=0;for(const Y in $.tempActiveId){const o=E.filter(G=>G.id===$.tempActiveId[Y])[0];o.position.top=P-I(o.position.height),o.position.height>O&&(O=I(o.position.height))}c.position.height=O+"px",c.position.top=`${P-O}px`}break;case"right":if(v==="tempRect"){const{width:r,left:V}=c.position,P=I(r)+I(V);let O=0;for(const Y in $.tempActiveId){const o=E.filter(G=>G.id===$.tempActiveId[Y])[0];o.position.left=P-I(o.position.width),o.position.width>O&&(O=I(o.position.width))}c.position.width=O+"px",c.position.left=`${P-O}px`}break;case"merge":const k=ce(c);k.type="group",k.id=k.type+new Date().getTime(),k.layerName="组合层",k.list=[],k.config={},E.forEach(r=>{if($.tempActiveId.includes(r.id)){r.position.left=Math.abs(k.position.left-I(r.position.left)),r.position.top=Math.abs(k.position.top-I(r.position.top));const V=r.position.width;typeof V=="number"||V.indexOf("px")!==-1?r.position.width=I(V)/c.position.width*100+"%":V.indexOf("%"),k.list.push(r)}r.id==="rect"&&(r.position.display=!0)}),E.push(k),g.value.list=g.value.list.filter(r=>!$.tempActiveId.includes(r.id)),$.setActiveId(k.id),$.setControlAttr(k);break;case"split":c.list.forEach(r=>{const{left:V,top:P,width:O}=r.position,{left:Y,top:o,width:G}=c.position;delete r.pId,r.position.left=I(Y)+V,r.position.top=I(o)+P,O.toString().indexOf("%")!==-1&&(typeof G=="number"||G.toString().indexOf("px")!==-1)&&(r.position.width=I(G)*I(O)/100+"px"),E.push(r)}),g.value.list=g.value.list.filter(r=>r.id!==c.id);break}}w()},w=()=>{h.value=!1};return A({open:x=>{b.value=x,h.value=!0},close:w}),(x,T)=>ie((y(),R("div",{class:"screen-right-menu",style:oe(F.value),onMouseleave:B},[S("ul",null,[(y(!0),R(X,null,Z(a.value,p=>(y(),R("li",{key:p.key,onClick:c=>m(p.key)},te(p.label),9,kt))),128))])],36)),[[be,h.value]])}}),wt={key:0,class:"no-date"},xt={class:"design-footer"},Ct={class:"control-tip"},St={class:"center"},It={class:"item"},$t=S("label",{class:"label"},"标尺",-1),Tt={class:"item slider"},Vt=S("label",{class:"label"},"缩放比例",-1),At={class:"item"},Dt=le({__name:"design",props:{preview:{type:Boolean}},setup(j){const A=ne("screenData"),g=ae(),$=H(),b=q(()=>g.controlTip),h=pe({scale:100,autoScale:100,ruler:!0,offset:[0,0],moveFlag:!1,ctrlPress:!1});re("stateData",h);const a=q(()=>{const{width:t,height:e,background:i,primary:u}=A.value.config,n=h.scale/100;return{width:t,height:e,background:i,transform:`scale(${n})`,color:u}}),F=t=>{w(),h.moveFlag=!0;const e=t.offsetX,i=t.offsetY;let u=0,n=0,f=0,z=0;document.onmousemove=D=>{if(!h.moveFlag)return;const d=(D.pageX-h.offset[0])/(h.scale/100),k=(D.pageY-h.offset[1])/(h.scale/100);f=Math.min(e,d),z=Math.min(i,k),u=Math.abs(e-d),n=Math.abs(i-k);let r=!0;u>10&&n>10&&(r=!1),v({left:f+"px",top:z+"px",width:u+"px",height:n+"px",display:r})},document.onmouseup=function(){var D;if(h.moveFlag){if(u>10&&n>10){_({left:f,top:z,width:u,height:n});const d=(D=g.tempActiveId)==null?void 0:D.length;if(d>1)g.setControlTip(`当前选区选中 ${d} 个组件目标，可使用键盘方向键调整位置`),C(),g.setActiveId("rect");else if(v({display:!0}),d===1){const k=g.tempActiveId[0];g.setActiveId(k);const r=A.value.list.filter(V=>V.id===k);g.setControlAttr(r[0])}}h.moveFlag=!1,document.onmousemove=null}}},B=H();re("openRightMenu",t=>{B.value.open(t)});const w=()=>{g.setControlAttr({}),g.setActiveId(""),g.setTempActiveId([]),g.setControlTip("可按住Ctrl键选中多个"),v({display:!0}),B.value.close()},_=t=>{g.setTempActiveId([]),A.value.list.forEach(i=>{!Be(i.position)&&e(i.position,t)&&Ne(i)&&g.setTempActiveId(i.id)});function e(i,u){const n=I(i.left),f=I(i.top),z=n+I(i.width),D=f+I(i.height),d=I(u.left),k=I(u.top),r=d+I(u.width),V=k+I(u.height),P=n<r&&d<z,O=f<V&&k<D;return P&&O}},x=H({100:{style:{}}}),T=t=>{const e=g.getScreenConfig(t)||!1;setTimeout(()=>{E()},500),g.setScreenConfig(t,!e)},p=t=>{$.value.scrollTo(0,0),t==="auto"?h.scale=h.autoScale:h.scale=100,g.setScreenConfig("scale",h.scale)},c=t=>{g.setScreenConfig("scale",t)};de(document,"keydown",t=>{t.key==="Control"&&(h.ctrlPress||(g.setTempActiveId([]),g.setActiveId(""),v({display:!0})),h.ctrlPress=!0);const e=["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"];if(g.activeId&&e.includes(t.key)){const i=A.value.list.filter(u=>u.id===g.activeId);i!=null&&i.length&&U(i[0],t.key),g.activeId==="rect"&&A.value.list.forEach(u=>{U(u,t.key)}),t.preventDefault()}});const U=(t,e)=>{const i=t.position,u=I(i.left),n=I(i.top);switch(e){case"ArrowRight":i.left=u+1;break;case"ArrowLeft":i.left=u-1;break;case"ArrowDown":i.top=n+1;break;case"ArrowUp":i.top=n-1;break}};de(document,"keyup",()=>{h.ctrlPress=!1});const E=()=>{me(()=>{var u;const t=$.value.offsetWidth,e=parseInt((u=A.value.config)==null?void 0:u.width);if(t&&e){const n=parseInt(`${t/e*100}`),f=g.getScreenConfig("scale");h.autoScale=n,h.scale=parseInt(f)||n}const i=$.value.getBoundingClientRect();h.offset[0]=i.left+20,h.offset[1]=i.top+20})},v=t=>{const e=A.value.list.filter(i=>i.id==="rect");e[0].position=t},C=()=>{const t={left:0,top:0,ex:0,ey:0,zIndex:1};A.value.list.forEach(i=>{if(g.tempActiveId.includes(i.id)){const{left:u,top:n,width:f,height:z,zIndex:D}=i.position,d=parseInt(u),k=parseInt(n),r=parseInt(f),V=parseInt(z);t.left=e(t.left,d),t.top=e(t.top,k),t.ex=Math.max(t.ex,r+d),t.ey=Math.max(t.ey,V+k),t.zIndex=Math.max(t.zIndex,D||1)}}),v({left:t.left,top:t.top,width:Math.abs(t.ex-t.left),height:Math.abs(t.ey-t.top),display:!1,zIndex:t.zIndex+1});function e(i,u){return i===0?u:Math.min(i,u)}};return ue(()=>{E()}),ke(()=>{}),(t,e)=>{const i=M("el-switch"),u=M("el-slider"),n=M("el-button");return y(),R(X,null,[S("div",{ref_key:"designBoxEl",ref:$,class:"design-box"},[l(ge,{scale:h.scale,"show-ruler":h.ruler,size:a.value.width},null,8,["scale","show-ruler","size"]),l(ge,{scale:h.scale,"show-ruler":h.ruler,direction:"v",size:a.value.height},null,8,["scale","show-ruler","size"]),S("div",{class:K([{preview:t.preview},"design-canvas"]),style:oe(a.value),onMousedown:Te(F,["left"])},[l(Le,{modelValue:ee(A).list,"onUpdate:modelValue":e[0]||(e[0]=f=>ee(A).list=f),onItemClick:C},null,8,["modelValue"])],38),ee(A).list.length?J("",!0):(y(),R("div",wt," 请从左则组件栏拖动组件到设计区域 "))],512),S("div",xt,[S("i",{class:"icon-menu icon",onClick:e[1]||(e[1]=f=>T("left"))}),S("div",Ct,te(b.value),1),S("div",St,[S("div",It,[$t,l(i,{modelValue:h.ruler,"onUpdate:modelValue":e[2]||(e[2]=f=>h.ruler=f),size:"small"},null,8,["modelValue"])]),S("div",Tt,[Vt,l(u,{modelValue:h.scale,"onUpdate:modelValue":e[3]||(e[3]=f=>h.scale=f),marks:x.value,max:200,min:h.autoScale-30,"show-stops":"",size:"small",onChange:c},null,8,["modelValue","marks","min"])]),S("div",At,[l(n,{link:"",type:"primary",onClick:e[4]||(e[4]=f=>p("auto"))},{default:s(()=>[N("自适应 ")]),_:1}),l(n,{link:"",type:"primary",onClick:e[5]||(e[5]=f=>p("100"))},{default:s(()=>[N("100% ")]),_:1})])]),S("i",{class:"icon-menu icon",onClick:e[6]||(e[6]=f=>T("right"))})]),l(_t,{ref_key:"rightMenuEl",ref:B},null,512)],64)}}}),Rt=JSON.stringify({list:[{id:"rect",type:"tempRect",position:{width:200,height:200,display:!0}}],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff",method:"get"}}),ye=Rt,Ut={class:"container-screen"},Et={class:"main-box"},zt=le({__name:"index",setup(j){const A=Ve(),g=Ae(),$=De(),b=ae();$.changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]),$.setCollapseMenu(!0);const h=v=>!b.getScreenConfig(v),a=H(!1),F=H(!1),B=H(),m=H(JSON.parse(ye));re("screenData",m);const w=v=>{switch(b.setControlAttr({}),v){case"del":m.value=JSON.parse(ye);break;case"eye":F.value=!0;break;case"json":p({type:"json",content:m.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":B.value.openScreen(m.value);break;case"save":U();break}},_=pe({visible:!1,title:"",direction:"ltr",content:"",codeType:"",callback:""}),x=()=>{c()},T=v=>{try{let C;switch(_.codeType){case"json":C=Ue(v);break;case"css":C=v;break;default:C=fe(v)}switch(typeof _.callback=="function"&&_.callback(C),_.type){case"editCss":m.value.config.style=v,Ee("screenStyle",v,!0);break;case"json":m.value=fe(v);break}c()}catch(C){Q.error(C.message||"未知原因")}},p=v=>{const{type:C="",direction:t,codeType:e,title:i,callback:u,content:n}=v;_.direction=t||"ltr",_.type=C,_.codeType=e||"",_.title=i||He[C],_.visible=!0,_.callback=u;let f=e==="json"?ze(n):ve(n,!0);switch(C){case"editCss":f=m.value.config.style||"";break;case"before":case"after":case"afterScreen":n||(f=Je(C));break}_.content=f},c=()=>{_.visible=!1,_.type="",_.title="",_.codeType="",_.callback="",_.content=""},U=()=>{const v={data:ve(m.value),name:"未命名可视化大屏",type:4};let C="designSave";const t=A.query.id;t&&(Object.assign(v,{id:t}),delete v.name,C="designEdit"),a.value=!0,Me(C,v).then(e=>{Q({message:e.message||"保存成功！",type:"success"}),t||g.push({path:"/design/screen/list"}),a.value=!1}).catch(e=>{Q.error(e.message||"保存异常"),a.value=!1})},E=()=>{a.value=!0,Fe(A.query.id).then(v=>{a.value=!1,m.value=v}).catch(()=>{a.value=!1})};return ue(()=>{E()}),ke(()=>{}),(v,C)=>{const t=Re("loading");return ie((y(),R("div",Ut,[F.value?(y(),R("i",{key:0,class:"icon-close close-preview",onClick:C[0]||(C[0]=e=>F.value=!1)})):J("",!0),l(mt,{style:oe({width:h("left")?"":"0px"})},null,8,["style"]),S("div",Et,[l(qe,{onClick:w}),l(Dt,{preview:F.value},null,8,["preview"])]),l(st,{style:oe({width:h("right")?"":"0px"}),onOpenDrawer:p},null,8,["style"]),l(Pe,{modelValue:_.visible,"onUpdate:modelValue":C[1]||(C[1]=e=>_.visible=e),"code-type":_.codeType,content:_.content,direction:_.direction,title:_.title,onConfirm:T,onBeforeClose:x},null,8,["modelValue","code-type","content","direction","title"]),l(We,{ref_key:"vueFileEl",ref:B},null,512)])),[[t,a.value]])}}});typeof he=="function"&&he(zt);export{zt as default};
