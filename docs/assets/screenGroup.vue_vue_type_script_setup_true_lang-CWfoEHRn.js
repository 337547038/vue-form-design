import{ah as $e,j as Ne,ai as xe,A as _e,X as we,Z as Oe,N as be,aj as ke,d as K,l as B,B as Ie,p as ie,o as f,c as I,t as ee,ak as ce,h as C,G as Ce,g as Y,x as $,af as ue,n as te,M as oe,C as Ee,U as Re,r as pe,V as ne,F as de,a as fe,s as ge,v as he,f as D,i as se,w as ae,m as Ve,b as X,a3 as W,e as qe,ac as Fe,a0 as Xe,q as Be,a1 as me,a2 as Ye,I as ve,O as ze}from"./index-BR7JSMnu.js";const Te=$e("screen",{state:()=>({controlAttr:{},activeId:"",screenConfig:Ne("screenConfig",!0)||{},controlTip:"",tempActiveId:[]}),actions:{setTempActiveId(t){if(typeof t=="string"&&t){const s=this.tempActiveId.indexOf(t);s!==-1?this.tempActiveId.splice(s,1):this.tempActiveId.push(t)}else this.tempActiveId=t},setControlTip(t){this.controlTip=t},setControlAttr(t){this.controlAttr=t},setScreenConfig(t,s){this.screenConfig[t]=s,xe("screenConfig",this.screenConfig,0)},getScreenConfig(t){return this.screenConfig[t]},setActiveId(t){this.activeId=t}}}),je=t=>new Promise((s,a)=>{if(!t)return a();_e("designById",{id:t}).then(async o=>{var i;const d=o.data,u=we(d.data);(i=u.config)!=null&&i.style&&Oe("screenStyle",u.config.style,!0),window.getScreenGlobal={},await He(u.config),s(u)}).catch(o=>{console.log("catch",o),be.error(o.message||"加载异常"),a()})}),He=t=>new Promise((s,a)=>{const{requestUrl:o,before:d,after:u,method:i}=t;o?ke({apiKey:o,before:d,after:u,params:{},options:{method:i},type:"none"}).then(n=>{window.getScreenGlobal=n.data,s(n.data)}).catch(n=>{a(n)}):s({})}),Pe=K({__name:"nowTime",props:{config:{}},setup(t){const s=t,a=B(),o=B(),d=()=>{const u=s.config.dateTime;!u||u&&u.indexOf("{i}")!==-1?a.value=setInterval(()=>{o.value=ce(new Date,u)},1e3):o.value=ce(new Date,u)};return Ie(()=>s.config.dateTime,()=>{clearInterval(a.value),d()},{immediate:!0}),ie(()=>{}),(u,i)=>(f(),I("div",null,ee(o.value),1))}}),Ue=K({__name:"marquee",props:{width:{},height:{},speed:{default:30},direction:{default:"top"},step:{default:1}},setup(t){const s=t,a=C(()=>({width:s.width,height:s.height,overflow:"hidden"})),o=Ce({left:0,top:0,duration:0}),d=C(()=>["left","right"].includes(s.direction)),u=C(()=>{const m=s.step>1?`transform ${o.duration}s`:"";return d.value?{display:"flex",width:parseInt(s.width)*2+"px",transform:`translateX(${o.left}px)`,transition:m}:{transform:`translateY(${o.top}px)`,transition:m}}),i=B(),n=B(),T=()=>{const m=i.value,V=n.value,q=()=>{const l=V.offsetWidth,c=V.offsetHeight;switch(s.direction){case"left":o.left+l<=0?(o.left=0,o.duration=0):(o.left=o.left-s.step,o.duration=.3);break;case"right":o.left>=0?(o.left=-l,o.duration=0):(o.left=o.left+s.step,o.duration=.3);break;case"bottom":o.top>=0?(o.top=-c,o.duration=0):(o.top=o.top+s.step,o.duration=.3);break;default:o.top+c<=0?(o.top=0,o.duration=0):(o.top=o.top-s.step,o.duration=.3)}};let F=setInterval(q,s.speed);m.onmouseenter=function(){clearInterval(F)},m.onmouseleave=function(){F=setInterval(q,s.speed)}};return ie(()=>{T()}),(m,V)=>(f(),I("div",{ref_key:"container",ref:i,class:te([`marquess-${m.direction}`,"marquee-container"]),style:$(a.value)},[Y("div",{style:$(u.value),class:"inner-container"},[Y("div",{ref_key:"container1",ref:n,style:$({display:d.value?"flex":""})},[ue(m.$slots,"default")],4),Y("div",{style:$({display:d.value?"flex":""})},[ue(m.$slots,"default")],4)],4)],6))}}),Se=t=>{try{return/^-?\d+(\.\d+)?$/.test(t.toString())}catch{return!1}},M=t=>{if(Number.isFinite(t))return Math.round(t);if(!t)return t;const s=t.match(/^(-?\d+(\.\d+)?)(px|em|rem|%|vh|vw)?$/);return s?Math.round(s[1]):0},R=t=>t===0||t==="0"?0:Se(t)?Math.round(t)+"px":t,L=t=>Se(t)?!0:t&&typeof t=="string"?t.indexOf("px")!==-1:!1,ye=(t,s)=>{const a=t.bottom||t.bottom===0,o=t.right||t.right===0,d=!L(t.left),u=!L(t.top),i=!L(t.width),n=!L(t.height),T=a||o||u||i||n||d||u;return s&&T&&be.error("仅支持使用了left和top的px单位允许操作!"),T},et=t=>{const{type:s,config:a={},position:o={}}=t;return!(s==="div"||s==="group"||s==="tempRect"||a.lock||o.display)},Ge=["onMousedown"],Le=["innerHTML"],We=["src"],Ke={key:0},Je=K({__name:"screen",props:{data:{default:()=>({})},type:{default:1},scale:{default:100}},emits:["changeEvent"],setup(t,{emit:s}){const a=t,o=s,d=Te(),u=C(()=>d.activeId),i=Ce({left:0,top:0,width:0,height:0,moveFlag:!1}),n=C(()=>a.data.config||{}),T=C(()=>Object.assign({},{width:"100%",height:"100%"},n.value.style||{})),m=C(()=>{let e={};return n.value.src&&(e={backgroundImage:`url(${n.value.src})`}),Object.assign(n.value.style||{},e)}),V=C(()=>{if(!a.data.position)return{};const{left:e,top:p,height:h,width:v,zIndex:S,display:y,right:w,bottom:g}=a.data.position,b=R(w),k=R(g);return{left:R(i.left)||(w?"":R(e)),right:b,bottom:k,top:R(i.top)||(g?"":R(p)),width:R(i.width||v),height:R(i.height||h),zIndex:S||1,display:y?"none":""}}),q=e=>e.toString().indexOf("%")!==-1?"100%":e,F=e=>{n.value.lock||(e.preventDefault(),e.stopPropagation())},l=(e,p)=>{if(a.data.type==="group")return;let h=!0;const v=e.pageX,S=e.pageY,{width:y,height:w,left:g,top:b}=a.data.position;if(ye(a.data.position,!0))return;const k=M(y),A=M(w),H=M(g),P=M(b);document.onmousemove=le=>{if(!h)return;const x=le.pageX-v,_=le.pageY-S;let O=k,E=A,U=H,G=P;switch(p){case 1:O=k-x,E=A-_,G=P+_,U=H+x;break;case 4:O=k-x,U=H+x;break;case 6:O=k-x,U=H+x,E=A+_;break;case 2:E=A-_,G=P+_;break;case 7:E=A+_;break;case 3:O=k+x,E=A-_,G=P+_;break;case 5:O=k+x;break;case 8:O=k+x,E=A+_;break}O<50||E<30||o("changeEvent",{type:"resize",width:O,height:E,left:U,top:G})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,h=!1},e.stopPropagation()},c=e=>{const{left:p,top:h}=a.data.position;i.moveFlag=!0;const v=e.pageX,S=e.pageY,y=M(p),w=M(h);let g=0,b=0;ye(a.data.position,!0)?(console.log("不能拖动"),i.moveFlag=!1):(i.left=y,i.top=w),document.onmousemove=k=>{if(!i.moveFlag)return;const A=a.scale/100;g=M((k.pageX-v)/A),b=M((k.pageY-S)/A),i.left=M(g+y),i.top=M(b+w),o("changeEvent",{type:"moveTip",left:i.left,top:i.top})},document.onmouseup=function(){i.moveFlag&&(o("changeEvent",{type:"move",moveX:g,moveY:b,left:i.left,top:i.top}),i.left=0,i.top=0,i.moveFlag=!1,document.onmousemove=null)}},r=C(()=>{var p;const e=z.value||((p=a.data.option)==null?void 0:p.list);return n.value.carousel?[...e,...e]:e}),N=B(),J=()=>{if(!n.value.carousel||!N.value||a.data.type!=="table")return;const e=N.value.querySelector(".el-scrollbar__wrap");function p(){e.scrollTop+=1,e.clientHeight+e.scrollTop===e.scrollHeight&&(e.scrollTop=e.scrollTop-e.scrollHeight/2)}let h=setInterval(p,n.value.speed||30);N.value.onmouseenter=function(){clearInterval(h)},N.value.onmouseleave=function(){h=setInterval(p,n.value.speed||30)}},Z=Ie(()=>{var e;return(e=a.data.option)==null?void 0:e.list},()=>{Be(()=>{J()})},{immediate:!0}),De=C(()=>{switch(a.data.type){case"text":case"sText":return n.value.text;case"line":case"bar":case"pie":case"echarts":case"table":return a.data.option}return""}),Q=B(),z=C(()=>n.value.optionsType===1&&Q.value?Q.value:!1),Ae=()=>{if(["image","background","border","clock"].includes(a.data.type))return;const{optionsType:e,requestUrl:p,method:h="post",before:v,after:S}=n.value;e===1&&p&&ke({apiKey:p,params:{},before:v,options:{method:h},type:"none"}).then(y=>{const w=y.data;typeof S=="function"&&(Q.value=S(w,De.value))}).catch(y=>{console.log(y)})},j=e=>{if(!e)return e;const p=typeof e=="object"?Xe(e):e;if(p.indexOf("{{")!==-1&&p.indexOf("}}")!==-1){const h=p.replace(/"{{.*?}}"/g,function(v){return v.slice(3,-3)}).replace(/{{.*?}}/g,function(v){return new Function("return "+v.slice(2,-2))()});return we(h)}return e},re=oe("openRightMenu",null),Me=e=>{typeof re=="function"&&re({x:e.pageX,y:e.pageY,type:a.data.type,id:a.data.id}),e.preventDefault()};return Ee(()=>{Z()}),ie(()=>{Ae()}),Re(()=>{}),(e,p)=>{var S,y,w;const h=pe("el-table-column"),v=pe("el-table");return f(),I("div",{class:te([{["group-"+e.data.type]:!0,[(S=e.data.config)==null?void 0:S.class]:(y=e.data.config)==null?void 0:y.class},"group"]),style:$(V.value),onMousedown:F},[e.type===0&&!((w=e.data.config)!=null&&w.lock)?(f(),I("div",{key:0,class:"resize-box",onContextmenu:Me,onMousedown:ne(c,["left","stop"])},[(f(),I(de,null,fe(8,g=>ge(Y("span",{key:g,class:te(`rs${g}`),onMousedown:ne(b=>l(b,g),["stop"])},null,42,Ge),[[he,u.value===e.data.id&&e.data.type!=="tempRect"]])),64)),ge(Y("div",{class:"position"},ee(JSON.stringify(e.data.position)),513),[[he,u.value===e.data.id]])],32)):D("",!0),["text","border"].includes(e.data.type)?(f(),I("div",{key:1,style:$(T.value),innerHTML:j(z.value||n.value.text)},null,12,Le)):D("",!0),e.data.type==="sText"?(f(),I("div",{key:2,style:$(T.value)},[se(Ue,{direction:n.value.direction,height:`${e.data.position.height}px`,speed:n.value.speed,step:n.value.step,width:`${e.data.position.width}px`},{default:ae(()=>[Ve(ee(j(z.value||n.value.text)),1)]),_:1},8,["direction","height","speed","step","width"])],4)):D("",!0),e.data.type==="image"?(f(),I("img",{key:3,src:n.value.src,style:$(T.value),alt:"请选择或上传图片",class:"default-img"},null,12,We)):D("",!0),e.data.type==="background"?(f(),I("div",{key:4,style:$(m.value),class:"default-bg"},[n.value.src?D("",!0):(f(),I("span",Ke,"请选择或上传图片"))],4)):D("",!0),e.data.type==="table"?(f(),I("div",{key:5,ref_key:"tableEl",ref:N,class:"screen-table"},[se(v,W(n.value.props,{data:r.value,height:`${a.data.position.height}`,style:{width:"100%"}}),{default:ae(()=>{var g;return[(f(!0),I(de,null,fe((g=e.data.option)==null?void 0:g.columns,b=>(f(),X(h,W({ref_for:!0},b,{key:b.prop}),null,16))),128))]}),_:1},16,["data","height"])],512)):D("",!0),e.data.type==="clock"?(f(),X(Pe,{key:6,config:n.value,style:$(T.value)},null,8,["config","style"])):D("",!0),["component"].includes(e.data.type)?(f(),X(qe(n.value.component),W({key:7},n.value,{height:e.data.position.height,width:e.data.position.width||"100%"}),null,16,["height","width"])):D("",!0),["line","bar","pie","echarts"].includes(e.data.type)?(f(),X(Fe,{key:8,height:q(e.data.position.height),option:j(z.value||e.data.option),width:q(e.data.position.width)||"100%"},null,8,["height","option","width"])):D("",!0),["div","group"].includes(e.data.type)?(f(),X(Ze,{key:9,modelValue:e.data.list,"onUpdate:modelValue":p[0]||(p[0]=g=>e.data.list=g),"data-type":"div","p-id":e.data.id},null,8,["modelValue","p-id"])):D("",!0)],38)}}}),Ze=K({__name:"screenGroup",props:me({pId:{default:""}},{modelValue:{},modelModifiers:{}}),emits:me(["itemClick"],["update:modelValue"]),setup(t,{emit:s}){const a=t,o=s,d=Ye(t,"modelValue"),u=oe("screenData")||{},i=oe("stateData")||{},n=Te(),T=C(()=>{const{width:l}=u.value.config;return l}),m=l=>{var c;if(i.ctrlPress){if(a.pId)return;n.setTempActiveId(l.id),n.setActiveId(l.id),n.setControlAttr(l);const r=(c=n.tempActiveId)==null?void 0:c.length;n.setControlTip(`当前选中${r}个`),r>1&&(n.setActiveId("rect"),o("itemClick"))}else F(l),n.setControlTip("可使用键盘方向键调整位置")},V=(l,c)=>{c.type==="moveTip"&&n.setControlTip(`当前位置：${c.left}:${c.top}`),l.position.left=c.left,l.position.top=c.top,c.width&&(l.position.width=c.width),c.height&&(l.position.height=c.height),l.type==="tempRect"&&c.type==="move"&&d.value.forEach(r=>{n.tempActiveId.includes(r.id)&&(r.position.left=parseInt(r.position.left)+c.moveX,r.position.top=parseInt(r.position.top)+c.moveY)})},q=l=>{const c=l.newIndex,r=d.value[c];if((l.target&&l.target.getAttribute("data-type"))==="div"&&r.type==="div"){d.value.splice(c,1);return}delete r.label,delete r.icon;const{offsetX:J,offsetY:Z}=l.originalEvent;r.position||(r.position={}),r.config||(r.config={}),r.id=r.type+new Date().getTime(),r.layerName=r.id,r.type==="div"&&(r.position.width=T.value),r.position.left=J,r.position.top=Z,F(r)},F=l=>{n.setActiveId(l.id),n.setControlAttr(l)};return(l,c)=>(f(),X(ve(ze),W({group:"screen",animation:200,handle:".none"},{list:d.value,class:"drag","item-key":"id",name:"fade","ghost-class":"ghost",onAdd:q}),{item:ae(({element:r})=>[se(Je,{data:r,scale:ve(i).scale,type:0,onChangeEvent:N=>V(r,N),onClick:ne(N=>m(r),["stop"])},null,8,["data","scale","onChangeEvent","onClick"])]),_:1},16,["list"]))}});export{Ze as _,et as a,je as b,ye as c,Je as d,He as g,M as r,Te as u};
