import{d as ae,l as j,h as H,p as ye,r as L,o as h,b as B,w as p,i,m as N,C as be,c as F,a as ne,F as Z,g as _,f as X,q as Te,M as Ue,N as Le,O as ue,L as ke,G as Fe,H as Ae,t as se,n as ee,P as ve,Q as Ve,s as _e,v as Ee,z as ie,R as xe,S as De,U as we,V as ze,W as he,D as me,X as Me,A as Oe,u as Be,k as Pe,B as je,Y as qe,Z as Ke,$ as ge,a0 as Ne,x as We,a1 as Ce,E as Ie}from"./index--gPzAhw2.js";import{_ as Xe}from"./aceDrawer.vue_vue_type_script_setup_true_lang-fF5QPMZl.js";import{_ as Ye,a as Ge,g as He,b as Je}from"./aceTooptip-hpltvwg-.js";import{_ as Qe,a as Se,c as $e,b as Ze,r as U,g as et}from"./getData-9G6_E3PU.js";const tt=["bg.jpg","bg2.jpg","bg3.jpg","head_bg.png"],pe={bg:tt},lt={class:"img-list"},ot=["onClick"],nt=["src"],st={key:0},at=ae({__name:"upload",emits:["click"],setup(te,{expose:O,emit:T}){const W=T,g=j(!1),c=j(),w=j("bg"),e=H(()=>{if(!pe)return[];const x=[];for(const r in pe)x.push(r);return x}),P=H(()=>w.value.name==="upload"?[]:pe?pe[w.value]:[]),Y=H(()=>`./static/screen/${w.value}/`),y=x=>{g.value=!1,W("click",Y.value+x,c.value)},b=x=>{w.value="upload",Te(()=>{P.value.unshift(x.path)})};return O({open:(x,r)=>{g.value=!0,c.value=r,x?w.value=x:w.value=e.value[0]}}),ye(()=>{}),(x,r)=>{const A=L("el-button"),J=L("el-upload"),V=L("el-tab-pane"),M=L("el-tabs"),d=L("el-dialog");return h(),B(d,{modelValue:g.value,"onUpdate:modelValue":r[1]||(r[1]=n=>g.value=n),width:"800px",title:"选择上传图片"},{default:p(()=>{var n;return[i(J,{action:be(Ue),"on-success":b,"show-file-list":!1},{default:p(()=>[i(A,{type:"primary"},{default:p(()=>[N("上传")]),_:1})]),_:1},8,["action"]),i(M,{modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=C=>w.value=C)},{default:p(()=>[(h(!0),F(Z,null,ne(e.value,C=>(h(),B(V,{label:C,name:C,key:C},null,8,["label","name"]))),128)),i(V,{label:"上传",name:"upload"})]),_:1},8,["modelValue"]),_("div",lt,[_("ul",null,[(h(!0),F(Z,null,ne(P.value,C=>(h(),F("li",{key:C,onClick:S=>y(C)},[_("img",{src:Y.value+C,alt:""},null,8,nt)],8,ot))),128))]),(n=P.value)!=null&&n.length?X("",!0):(h(),F("p",st,"暂无相关素材资源"))])]}),_:1},8,["modelValue"])}}}),it=Le(at,[["__scopeId","data-v-631dd2e4"]]),ct={key:0},rt=_("h3",null,"数据",-1),pt=_("h3",null,"接口数据处理事件",-1),ut=_("h3",null,"全局数据",-1),dt=_("h3",null,"接口数据处理事件",-1),ft=ae({__name:"configControl",props:{config:{}},emits:["update:config","openDrawer","update"],setup(te,{emit:O}){const T=te,W=O,g=ue(),c=H(()=>g.screenControlAttr),w=H(()=>{var d,n,C,S;return((n=(d=c.value)==null?void 0:d.config)==null?void 0:n.lock)||((S=(C=c.value)==null?void 0:C.position)==null?void 0:S.display)}),e=j(),P=H(()=>c.value.type),Y=d=>{W("update:config",Object.assign({},T.config,d))},y=ke({bgColor:"",bgLinear:"",bgAngle:0,bgUpload:"",bgSelect:""}),b=Fe(()=>T.config,d=>{if(!Object.keys(c.value).length){const n=d.background||"";if(n.indexOf("url")!==-1){const C=new RegExp("(?<=url\\()(.*?)(?=\\))","g"),S=n.match(C);Object.assign(y,{bgUpload:S,bgSelect:3})}else if(n.indexOf("linear")!==-1){const S=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")).split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/);Object.assign(y,{bgColor:S[1].trim(),bgLinear:S[2].trim(),bgAngle:Number(S[0].replace("deg","")),bgSelect:2})}else Object.assign(y,{bgColor:n,bgSelect:1})}},{immediate:!0}),m=()=>{let d="";switch(y.bgSelect){case 1:d=y.bgColor;break;case 2:d=`linear-gradient(${y.bgAngle}deg, ${y.bgColor}, ${y.bgLinear})`;break;case 3:d=`url(${y.bgUpload})`;break}x("background",d)},x=(d,n)=>{Y({[d]:n})},r=H(()=>{var d,n,C,S;if(Object.keys(c.value).length){const{config:k={},position:E,type:q}=c.value;return[{type:"group",title:"位置信息"},{label:"width",value:E.width,placeholder:"请输入宽度",key:"width",path:"position"},{label:"height",value:E.height,placeholder:"请输入高度",key:"height",path:"position"},{label:"left",value:E.left,placeholder:"图层位置",key:"left",path:"position"},{label:"top",value:E.top,key:"top",path:"position"},{label:"right",value:E.right,placeholder:"设置后left为auto",key:"right",path:"position"},{label:"bottom",value:E.bottom,placeholder:"设置后top为auto",key:"bottom",path:"position"},{type:"number",label:"zIndex",value:E.zIndex,placeholder:"请输入层级",key:"zIndex",path:"position"},{type:"group",title:"属性信息"},{type:"switch",label:"锁定",value:k.lock,key:"lock"},{type:"switch",label:"隐藏",value:E.display,key:"display",path:"position"},{label:"样式类名",placeholder:"方便引用个性化样式",value:k.class,key:"class"},{label:"文本内容",placeholder:"请输入文本内容",value:k.text,key:"text",vShow:["text"]},{type:"select",label:"滚动方向",placeholder:"请选择滚动方向",value:k.direction,key:"direction",vShow:["sText"],options:{left:"从左到右",right:"从右到左",top:"从上到下",bottom:"从下到上"}},{type:"number",label:"滚动速度",placeholder:"滚动速度，数字越大速度越慢",value:k.speed,key:"speed",vShow:["sText"]},{type:"number",label:"滚动步长",placeholder:"每单位时间滚动的距离，默认1",value:k.step,key:"step",vShow:["sText"]},{type:"textarea",label:"文本内容",placeholder:"请输入文本内容，支持html",value:k.text,key:"text",vShow:["sText"]},{label:"字体大小",placeholder:"文本字体大小,如14px",value:(d=k.style)==null?void 0:d.fontSize,key:"fontSize",path:"style",vShow:["text","clock"]},{label:"边框",placeholder:"如1px solid #000",value:(n=k.style)==null?void 0:n.border,key:"border",path:"style",vShow:["border"]},{type:"color",label:"背景颜色",value:(C=k.style)==null?void 0:C.background,key:"background",path:"style",vShow:["border"]},{type:"color",label:"字体颜色",value:(S=k.style)==null?void 0:S.color,key:"color",path:"style",vShow:["text","clock"]},{type:"select",label:"时间格式",value:k.dateTime,key:"dateTime",allowCreate:!0,filterable:!0,placeholder:"选择或创建时间格式",vShow:["clock"],options:{"{y}-{m}-{d}":"{y}-{m}-{d}","{h}:{i}:{s}":"{h}:{i}:{s}","{y}-{m}-{d} {h}:{i}:{s}":"{y}-{m}-{d} {h}:{i}:{s}","{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}":"{y}年{m}月{d}日 {h}:{i}:{s} 星期{w}"}},{label:"组件名称",value:k.component,placeholder:"全局注册的组件名称",key:"component",vShow:["component"]},{type:"switch",label:"是否轮播",value:k.carousel,key:"carousel",vShow:["table"]},{type:"number",label:"滚动速度",placeholder:"开启轮播有效",value:k.speed,key:"speed",vShow:["table"]}].filter(u=>{let o=!0;return u.vShow&&(o=u.vShow.includes(q)),u.vHide&&(o=!u.vHide.includes(q)),o})}return[]}),A=(d,n)=>{var C;d.path==="position"?c.value.position[d.key]=n:d.path==="style"?((C=c.value.config)!=null&&C.style||(c.value.config.style={}),c.value.config.style[d.key]=n):c.value.config[d.key]=n,["zIndex","display","lock"].includes(d.key)&&W("update")},J=(d,n)=>{e.value.open(d,n)},V=(d,n)=>{switch(n){case"screenBg":y.bgUpload=d,m();break;case"src":c.value.config.src=d;break}},M=(d,n)=>{var o,t,l;let C="",S,k="",E="",q=d;switch(d==="afterFetchScreen"&&(q="afterFetch"),d){case"editCss":C="css";break;case"beforeFetch":case"afterFetch":case"afterFetchScreen":n?(d==="afterFetch"&&(E="这里返回的数据在当前页面可使用getScreenGlobal()方法获取"),S=T.config&&T.config[q]):S=c.value.events&&c.value.events[q];break;case"style":C="json",S=((o=c.value.config)==null?void 0:o.style)||{},k="可输入更多的css样式，须为json格式";break;case"echartsEdit":S=c.value.option,k="可参考echarts相关例子编辑";break;case"tablePropsEdit":C="json",S=((t=c.value.config)==null?void 0:t.props)||{},k="支持所有表格props属性，可参考el-table。json格式";break;case"editData":const s=c.value.type;k="图表数据，替换相关数据返回即可",["text","sText"].includes(s)?(S=(l=c.value.config)==null?void 0:l.text,k="编辑文本内容数据"):S=c.value.option,s==="table"&&(k="表格列表数据。根据设定的table-column列数据设置对应的数据");break}W("openDrawer",{content:S,codeType:C,type:d,title:k,tips:E,callback:s=>{switch(d){case"beforeFetch":case"afterFetch":case"afterFetchScreen":n?T.config[q]=s:(c.value.events||(c.value.events={}),c.value.events[q]=s);break;case"style":c.value.config.style=s;break;case"echartsEdit":c.value.option=s;break;case"tablePropsEdit":c.value.config.props=s;break;case"editData":const f=c.value.type;["text","sText"].includes(f)?c.value.config.text=s:c.value.option=s;break}}})};return Ae(()=>{b()}),(d,n)=>{const C=L("el-switch"),S=L("el-color-picker"),k=L("el-input"),E=L("el-option"),q=L("el-select"),u=L("el-input-number"),o=L("el-form-item"),t=L("el-button"),l=L("el-form"),s=L("el-radio"),f=L("el-radio-group"),v=L("el-tab-pane"),I=L("el-slider"),D=L("el-tabs");return h(),F("div",{class:ee(["main-right",{lock:w.value}])},[i(D,{class:"tabs","model-value":"position"},{default:p(()=>[i(v,{label:"属性配置",name:"position"},{default:p(()=>[i(l,{size:"small"},{default:p(()=>[(h(!0),F(Z,null,ne(r.value,(a,K)=>(h(),B(o,{label:a.label,key:K},{default:p(()=>[a.type==="group"?(h(),F("h3",ct,se(a.title),1)):a.type==="switch"?(h(),B(C,{key:1,"model-value":a.value,onChange:R=>A(a,R),class:ee([a.key])},null,8,["model-value","onChange","class"])):a.type==="color"?(h(),B(S,{key:2,"show-alpha":"",onChange:R=>A(a,R),"model-value":a.value},null,8,["onChange","model-value"])):a.type==="textarea"?(h(),B(k,{key:3,type:"textarea",placeholder:a.placeholder,onChange:R=>A(a,R),"model-value":a.value},null,8,["placeholder","onChange","model-value"])):a.type==="select"?(h(),B(q,{key:4,allowCreate:a.allowCreate,filterable:a.filterable,placeholder:a.placeholder,onChange:R=>A(a,R),"model-value":a.value},{default:p(()=>[(h(!0),F(Z,null,ne(a.options,(R,Q)=>(h(),B(E,{key:R,label:R,value:Q},null,8,["label","value"]))),128))]),_:2},1032,["allowCreate","filterable","placeholder","onChange","model-value"])):a.type==="number"?(h(),B(u,{key:5,"controls-position":"right",placeholder:a.placeholder,"model-value":a.value,onInput:R=>A(a,R)},null,8,["placeholder","model-value","onInput"])):(h(),B(k,{key:6,placeholder:a.placeholder,"model-value":a.value,onInput:R=>A(a,R)},null,8,["placeholder","model-value","onInput"]))]),_:2},1032,["label"]))),128)),["image","background"].includes(P.value)?(h(),B(o,{key:0,class:"upload-image"},{default:p(()=>[i(k,{placeholder:"请输入图片地址",modelValue:c.value.config.src,"onUpdate:modelValue":n[0]||(n[0]=a=>c.value.config.src=a)},null,8,["modelValue"]),i(t,{type:"primary",onClick:n[1]||(n[1]=a=>J(P.value==="image"?"img":"bg","src"))},{default:p(()=>[N("选择图片")]),_:1})]),_:1})):X("",!0),["line","bar","pie","echarts"].includes(P.value)?(h(),B(o,{key:1},{default:p(()=>[i(t,{type:"primary",onClick:n[2]||(n[2]=a=>M("echartsEdit"))},{default:p(()=>[N("图表编辑")]),_:1})]),_:1})):X("",!0),["text","sText","image","background","border","clock"].includes(P.value)?(h(),B(o,{key:2},{default:p(()=>[i(t,{type:"primary",onClick:n[3]||(n[3]=a=>M("style"))},{default:p(()=>[N("编辑更多内联样式")]),_:1})]),_:1})):X("",!0),["table"].includes(P.value)?(h(),B(o,{key:3},{default:p(()=>[i(t,{type:"primary",onClick:n[4]||(n[4]=a=>M("tablePropsEdit"))},{default:p(()=>[N("表格属性")]),_:1})]),_:1})):X("",!0)]),_:1}),["line","bar","pie","echarts","text","sText","table"].includes(P.value)?(h(),B(l,{key:0,size:"small"},{default:p(()=>[i(o,null,{default:p(()=>[rt]),_:1}),i(o,{label:"数据类型"},{default:p(()=>[i(f,{modelValue:c.value.config.optionsType,"onUpdate:modelValue":n[5]||(n[5]=a=>c.value.config.optionsType=a)},{default:p(()=>[i(s,{label:0,style:{"margin-right":"4px"}},{default:p(()=>[N("静态/全局")]),_:1}),i(s,{label:1},{default:p(()=>[N("动态")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.value.config.optionsType!==1?(h(),B(o,{key:0},{default:p(()=>[i(t,{type:"primary",onClick:n[6]||(n[6]=a=>M("editData"))},{default:p(()=>[N("编辑数据")]),_:1})]),_:1})):X("",!0),c.value.config.optionsType===1?(h(),F(Z,{key:1},[i(o,null,{default:p(()=>[i(k,{modelValue:c.value.config.requestUrl,"onUpdate:modelValue":n[8]||(n[8]=a=>c.value.config.requestUrl=a),placeholder:"接口URL或api中的key"},{prepend:p(()=>[i(q,{modelValue:c.value.config.method,"onUpdate:modelValue":n[7]||(n[7]=a=>c.value.config.method=a),style:{width:"60px"}},{default:p(()=>[i(E,{label:"get",value:"get"}),i(E,{label:"post",value:"post"}),i(E,{label:"ws",value:"ws",disabled:""})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),i(o,{label:"刷新时间"},{default:p(()=>[i(u,{modelValue:c.value.config.loopTime,"onUpdate:modelValue":n[9]||(n[9]=a=>c.value.config.loopTime=a),disabled:""},null,8,["modelValue"])]),_:1}),i(o,null,{default:p(()=>[pt]),_:1}),i(o,null,{default:p(()=>[i(t,{onClick:n[10]||(n[10]=a=>M("beforeFetch"))},{default:p(()=>[N("beforeFetch")]),_:1})]),_:1}),i(o,null,{default:p(()=>[i(t,{onClick:n[11]||(n[11]=a=>M("afterFetchScreen"))},{default:p(()=>[N("afterFetch")]),_:1})]),_:1})],64)):X("",!0)]),_:1})):X("",!0)]),_:1}),i(v,{label:"大屏配置",name:"screen"},{default:p(()=>[i(l,{size:"small"},{default:p(()=>[i(o,{label:"大屏宽度"},{default:p(()=>[i(k,{placeholder:"请输入大屏宽度","model-value":d.config.width,onInput:n[12]||(n[12]=a=>x("width",a))},null,8,["model-value"])]),_:1}),i(o,{label:"大屏高度"},{default:p(()=>[i(k,{placeholder:"请输入大屏高度","model-value":d.config.height,onInput:n[13]||(n[13]=a=>x("height",a))},null,8,["model-value"])]),_:1}),i(o,{class:"color-picker",label:"主色"},{default:p(()=>[i(S,{"show-alpha":"",onChange:n[14]||(n[14]=a=>x("primary",a)),"model-value":d.config.primary},null,8,["model-value"])]),_:1}),i(o,{label:"背景"},{default:p(()=>[i(q,{modelValue:y.bgSelect,"onUpdate:modelValue":n[15]||(n[15]=a=>y.bgSelect=a),onChange:m},{default:p(()=>[i(E,{value:1,label:"背景色"}),i(E,{value:2,label:"渐变色"}),i(E,{value:3,label:"背景图"})]),_:1},8,["modelValue"])]),_:1}),y.bgSelect!==3?(h(),B(o,{key:0,class:"color-picker"},{default:p(()=>[i(S,{"show-alpha":"",modelValue:y.bgColor,"onUpdate:modelValue":n[16]||(n[16]=a=>y.bgColor=a),onChange:m},null,8,["modelValue"])]),_:1})):X("",!0),y.bgSelect===2?(h(),F(Z,{key:1},[i(o,{class:"color-picker"},{default:p(()=>[i(S,{"show-alpha":"",modelValue:y.bgLinear,"onUpdate:modelValue":n[17]||(n[17]=a=>y.bgLinear=a),onChange:m},null,8,["modelValue"])]),_:1}),i(o,{label:"渐变角度"},{default:p(()=>[i(I,{modelValue:y.bgAngle,"onUpdate:modelValue":n[18]||(n[18]=a=>y.bgAngle=a),max:360,onChange:m},null,8,["modelValue"])]),_:1})],64)):X("",!0),y.bgSelect===3?(h(),B(o,{key:2,class:"upload-image"},{default:p(()=>[i(k,{placeholder:"请输入图片地址",modelValue:y.bgUpload,"onUpdate:modelValue":n[19]||(n[19]=a=>y.bgUpload=a),onChange:m},null,8,["modelValue"]),i(t,{type:"primary",onClick:n[20]||(n[20]=a=>J("bg","screenBg"))},{default:p(()=>[N("上传")]),_:1})]),_:1})):X("",!0),i(o,null,{default:p(()=>[i(t,{onClick:n[21]||(n[21]=a=>M("editCss"))},{default:p(()=>[N("编辑样式")]),_:1})]),_:1}),i(o,null,{default:p(()=>[ut]),_:1}),i(o,null,{default:p(()=>[i(k,{"model-value":d.config.requestUrl,placeholder:"接口URL或api中的key",onInput:n[23]||(n[23]=a=>x("requestUrl",a))},{prepend:p(()=>[i(q,{"model-value":d.config.method,style:{width:"60px"},onChange:n[22]||(n[22]=a=>x("method",a))},{default:p(()=>[i(E,{label:"get",value:"get"}),i(E,{label:"post",value:"post"}),i(E,{label:"ws",value:"ws",disabled:""})]),_:1},8,["model-value"])]),_:1},8,["model-value"])]),_:1}),i(o,{label:"刷新时间"},{default:p(()=>[i(u,{disabled:"","model-value":d.config.loopTime,onInput:n[24]||(n[24]=a=>x("loopTime",a))},null,8,["model-value"])]),_:1}),i(o,null,{default:p(()=>[dt]),_:1}),i(o,null,{default:p(()=>[i(t,{onClick:n[25]||(n[25]=a=>M("beforeFetch",!0))},{default:p(()=>[N("beforeFetch")]),_:1})]),_:1}),i(o,null,{default:p(()=>[i(t,{onClick:n[26]||(n[26]=a=>M("afterFetch",!0))},{default:p(()=>[N("afterFetch")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),i(it,{ref_key:"uploadImageEl",ref:e,onClick:V},null,512)],2)}}}),gt={class:"main-left"},vt={class:"components-list scroll"},ht={class:"title"},mt=["title"],yt={class:"scroll layer-list"},bt=["onClick"],kt=["onClick"],_t=["onClick"],xt=_("i",{class:"icon-del"},null,-1),wt=ae({__name:"controlLeft",emits:["update","update:active"],setup(te,{expose:O,emit:T}){const W=T,g={line:["折线图","line"],bar:["柱状图","bar"],pie:["饼图","pie"],echarts:["通用图表",""],table:["表格","table"],text:["文本","text2"],sText:["滚动文本","stext"],image:["图片","image"],background:["背景","image"],border:["边框","border"],clock:["当前时间","time"],component:["自定义","component"]},c=ue(),w=H(()=>c.activeIndex),e=j([]),P=j([{label:"图表",children:[{type:"line",label:g.line[0],icon:g.line[1],position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[150,230,224,218,135,147,260],type:"line"}]}},{type:"bar",label:g.bar[0],icon:g.bar[1],position:{width:400,height:300},option:{xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},grid:{left:0,top:0,right:0,bottom:30},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]}},{type:"pie",label:g.pie[0],icon:g.pie[1],position:{width:300,height:300},option:{grid:{left:0,top:0,right:0,bottom:0},series:[{type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]}},{type:"echarts",label:g.echarts[0],icon:g.echarts[1],position:{width:400,height:300},option:{grid:{left:0,top:0,right:0,bottom:0}}}]},{label:"表格",children:[{type:"table",label:g.table[0],icon:g.table[1],position:{width:500,height:300},option:{columns:[],list:[]}}]},{label:"辅助",children:[{type:"text",label:g.text[0],icon:g.text[1],position:{width:100,height:30},config:{text:"文本内容"}},{type:"sText",label:g.sText[0],icon:g.sText[1],position:{width:100,height:30},config:{text:"滚动文本内容"}},{type:"image",label:g.image[0],icon:g.image[1],position:{width:100,height:50},config:{src:""}},{type:"background",label:g.background[0],icon:g.background[1],position:{width:100,height:50},config:{src:""}},{type:"border",label:g.border[0],icon:g.border[1],position:{width:100,height:100},config:{style:{border:"1px solid #fff"}}}]},{label:"其他",children:[{type:"clock",label:g.clock[0],icon:g.clock[1],position:{width:150,height:30}}]},{label:"自定义组件",children:[{type:"component",label:g.component[0],icon:g.component[1],position:{width:200,height:200},config:{}}]}]),Y=m=>ve(m),y=(m,x)=>{let r=!1;switch(x){case"display":r=!m.display,m.display=r;break;case"lock":r=!m.lock,m.lock=r;break;case"active":c.setActiveIndex([m.index]);break}W("update",x,m.index,r)};return O({setLayer:m=>{const x=[];m.forEach((r,A)=>{r.type==="group"?x.push({label:"合并组",zIndex:r.position.zIndex||0,display:r.position.display,lock:r.config.lock,index:A,icon:"",groupId:r.id,type:"group"}):r.type!=="tempRect"&&x.push({label:g[r.type][0],icon:g[r.type][1],zIndex:r.position.zIndex||0,display:r.position.display,lock:r.config.lock,index:A,groupId:r.groupId})}),e.value=x.sort(function(r,A){return r.groupId<A.groupId?-1:r.groupId>A.groupId?1:r.icon.localeCompare(A.icon)})}}),(m,x)=>{const r=L("el-tab-pane"),A=L("el-popconfirm"),J=L("el-tabs");return h(),F("div",gt,[i(J,{"model-value":"component",class:"tabs"},{default:p(()=>[i(r,{label:"组件",name:"component"},{default:p(()=>[_("div",vt,[(h(!0),F(Z,null,ne(P.value,(V,M)=>(h(),F("div",{key:M},[_("div",ht,se(V.label),1),i(be(Ve),{itemKey:"label",tag:"ul",modelValue:V.children,"onUpdate:modelValue":d=>V.children=d,group:{name:"form",pull:"clone",put:!1},"ghost-class":"ghost",sort:!1,clone:Y},{item:p(({element:d})=>[_("li",{class:ee([d.type])},[_("i",{class:ee(`icon-${d.icon}`)},null,2),_("span",{title:d.label},se(d.label),9,mt)],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1}),i(r,{label:"图层",name:"layer"},{default:p(()=>[_("div",yt,[_("ul",null,[(h(!0),F(Z,null,ne(e.value,(V,M)=>(h(),F("li",{key:M,class:ee({active:w.value.includes(V.index),lock:V.lock,display:V.display,isGroup:V.groupId&&!V.type})},[_("span",{onClick:d=>y(V,"active")},[_("i",{class:ee(`icon-${V.icon}`)},null,2),N(" "+se(V.label),1)],8,bt),_("i",{onClick:d=>y(V,"display"),class:ee(["icon",[V.display?"icon-eye-close":"icon-eye"]])},null,10,kt),_("i",{onClick:d=>y(V,"lock"),class:ee(["icon",[V.lock?"icon-lock":"icon-lock-open"]])},null,10,_t),i(A,{title:"确认删除",onConfirm:d=>y({index:V.index},"del")},{reference:p(()=>[xt]),_:2},1032,["onConfirm"])],2))),128))])])]),_:1})]),_:1})])}}}),Ct={class:"ruler-box"},Re=ae({__name:"ruler",props:{direction:{default:"h"},scale:{},showRuler:{type:Boolean},size:{},scroll:{}},setup(te){const O=te,T=H(()=>{let c={};return O.direction==="v"&&O.scroll[0]>0&&(c={left:O.scroll[0]+20+"px"}),{width:O.size,...c}}),W=H(()=>{const c=O.direction==="h"?1920:1080,w=[];for(let e=0;e<c;e=e+100)w.push(e);return w}),g=c=>parseInt(`${c/O.scale*100}`);return(c,w)=>_e((h(),F("div",{class:ee(["screen-ruler",`ruler-${c.direction}`]),style:ie(T.value)},[_("div",Ct,[(h(!0),F(Z,null,ne(W.value,e=>(h(),F("span",{key:e},se(g(e)),1))),128))])],6)),[[Ee,c.showRuler]])}}),It=["onMousedown"],St={key:0,class:"no-date"},$t={class:"design-footer"},Rt={class:"control-tip"},Tt={class:"center"},Vt={class:"item"},Et=_("label",{class:"label"},"标尺",-1),Dt={class:"item slider"},Ut=_("label",{class:"label"},"缩放比例",-1),Lt={class:"item"},Ft=ae({__name:"design",props:{preview:{type:Boolean},data:{default:()=>({})},updatePosition:{},screenContextmenu:{}},emits:["draggableAdd"],setup(te,{emit:O}){const T=te,W=O,g=ue(),c=j(),w=j(""),e=ke({scale:100,autoScale:100,activeTool:"mouse",activeIndex:-1,scroll:[0,0],ruler:!0,offset:[0,0],rect:{left:"0px",top:"0px",width:"0px",height:"0px",display:"none"},tempRectIndex:[],ctrlPress:!1}),P=H(()=>{const{width:t,height:l,background:s,primary:f}=T.data.config,v=e.scale/100;return{width:t,height:l,background:s,transform:`scale(${v})`,color:f,cursor:e.activeTool==="mouse"?"default":"pointer"}}),Y=()=>{const t=c.value.scrollTop,l=c.value.scrollLeft;e.scroll=[l,t]},y=t=>t.type==="tempRect"?!!e.tempRectIndex.length:!0,b=t=>{const l=t.newIndex,s=T.data.list[l];delete s.label,delete s.icon;const{pageX:f,pageY:v}=t.originalEvent;s.position||(s.position={}),s.config||(s.config={}),s.position.left=Se(f-e.offset[0]+e.scroll[0]),s.position.top=Se(v-e.offset[1]+e.scroll[1]),e.activeIndex=l,n(s),W("draggableAdd")},m=t=>{const l=T.data.list;let s=-1;l.forEach((f,v)=>{f.type==="tempRect"&&(s=v,f.position=t,e.activeIndex=v)}),s===-1&&(l.push({type:"tempRect",position:t}),e.activeIndex=l.length-1)},x=()=>{const t={left:0,top:0,ex:0,ey:0};for(let s=0;s<e.tempRectIndex.length;s++){const f=T.data.list[e.tempRectIndex[s]],{left:v,top:I,width:D,height:a}=f.position,K=parseInt(v),R=parseInt(I),Q=parseInt(D),le=parseInt(a);t.left=l(t.left,K),t.top=l(t.top,R),t.ex=Math.max(t.ex,Q+K),t.ey=Math.max(t.ey,le+R)}return{left:t.left,top:t.top,width:Math.abs(t.ex-t.left),height:Math.abs(t.ey-t.top)};function l(s,f){return s===0?f:Math.min(s,f)}},r=()=>{if(T.data.list.forEach((l,s)=>{!$e(l.position)&&t(l.position)&&Ze(l)&&(e.tempRectIndex.includes(s)||e.tempRectIndex.push(s))}),e.tempRectIndex.length>1){w.value=`当前选区选中 ${e.tempRectIndex.length} 个组件目标，可使用键盘方向键调整位置`;const{left:l,top:s,width:f,height:v}=x();return e.rect={left:l+"px",top:s+"px",width:f+"px",height:v+"px",display:"none"},!0}else return e.rect.display="none",!1;function t(l){const s=U(l.left),f=U(l.top),v=s+U(l.width),I=f+U(l.height),D=U(e.rect.left),a=U(e.rect.top),K=D+U(e.rect.width),R=a+U(e.rect.height),Q=s<K&&D<v,le=f<R&&a<I;return Q&&le}},A=t=>{J(),e.moveFlag=!0;const l=c.value.scrollTop,s=c.value.scrollLeft,f=t.pageX+s,v=t.pageY+l,I=(t.pageX-e.offset[0]-20+e.scroll[0])/(e.scale/100),D=(t.pageY-e.offset[1]-20+e.scroll[1])/(e.scale/100);e.activeTool==="mouse"&&(e.rect={left:I+"px",top:D+"px",width:"0px",height:"0px",display:""}),document.onmousemove=a=>{if(e.moveFlag)if(e.activeTool==="mouse"){const K=(a.pageX-e.offset[0]-20+e.scroll[0])/(e.scale/100),R=(a.pageY-e.offset[1]-20+e.scroll[1])/(e.scale/100),Q=I>K?K:I,le=D>R?R:D;e.rect={left:Q+"px",top:le+"px",width:Math.abs(I-K)+"px",height:Math.abs(D-R)+"px",display:""}}else{const K=f-a.pageX,R=v-a.pageY;c.value.scrollTo(K,R)}},document.onmouseup=function(){if(!e.moveFlag)return;const{width:a,height:K}=e.rect;if(e.rect.display="none",parseInt(a)>10&&parseInt(K)>10&&r()){const Q=Object.assign({},e.rect,{display:!1});m(Q)}e.moveFlag=!1,document.onmousemove=null}},J=()=>{e.tempRectIndex=[],e.activeIndex=-1,n({});const t=["可按住Alt拖动设计区域","可按住Ctrl键选中多个"],l=Me(0,1);w.value=t[l]},V=t=>{t.preventDefault()},M=(t,l)=>{if(e.ctrlPress){if(e.tempRectIndex.push(l),e.activeIndex=l,w.value="可按住Ctrl键选中多个",e.tempRectIndex.length>1){const s=x();m(s)}}else t.type!=="tempRect"&&(e.tempRectIndex=[],e.activeIndex=l,n(t)),w.value="可使用键盘方向键调整位置"},d=(t,l,s)=>{l.type==="moveTip"&&(w.value=`当前位置：${l.left}:${l.top}`),T.updatePosition(t,l,s)},n=t=>{g.setScreenControlAttr(t)},C=j({100:{style:{}}}),S=t=>{const l=g.getDataScreen(t)||!1;setTimeout(()=>{u()},500),g.setDataScreen(t,!l)},k=t=>{c.value.scrollTo(0,0),t==="auto"?e.scale=e.autoScale:e.scale=100,g.setDataScreen("scale",e.scale)},E=t=>{g.setDataScreen("scale",t)};xe(document,"keydown",t=>{t.key==="Control"&&(e.ctrlPress||(e.tempRectIndex=[]),e.ctrlPress=!0),t.key==="Alt"&&(e.activeTool="process");const l=["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"];if(e.activeIndex!==-1&&l.includes(t.key)){const s=T.data.list[e.activeIndex],f=$e(s==null?void 0:s.position,!0),v={type:"keydown",eventKey:t.key};f||T.updatePosition(e.activeIndex,v,e.tempRectIndex),t.preventDefault()}}),xe(document,"keyup",()=>{e.activeTool!=="mouse"&&(e.activeTool="mouse"),e.ctrlPress=!1});const q=t=>{const l=Object.assign({},t,{activeIndex:e.activeIndex,tempRectIndex:e.tempRectIndex,callback:(s,f)=>{switch(s){case"canvasClick":J();break;case"merge":J(),e.activeIndex=f==null?void 0:f.index,n(T.data.list[f.index]);break}}});T.screenContextmenu(l)},u=()=>{Te(()=>{var f;const t=c.value.offsetWidth,l=parseInt((f=T.data.config)==null?void 0:f.width);if(t&&l){const v=parseInt(`${t/l*100}`),I=g.getDataScreen("scale");e.autoScale=v,e.scale=parseInt(I)||v}const s=c.value.getBoundingClientRect();e.offset[1]=s.top+document.documentElement.scrollTop-(document.documentElement.clientTop||0),e.offset[0]=s.left+document.documentElement.scrollLeft-(document.documentElement.clientLeft||0)})},o=t=>{const l=he(t).replace(/"{{.*?}}"/g,function(s){return s.slice(3,-3)}).replace(/{{.*?}}/g,function(s){return new Function("return "+s.slice(2,-2))()});return me(l)};return ye(()=>{u()}),De(()=>{}),(t,l)=>{const s=L("el-switch"),f=L("el-slider"),v=L("el-button");return h(),F(Z,null,[_("div",{ref_key:"designBoxEl",ref:c,class:"design-box",onScroll:Y},[i(Re,{scale:e.scale,scroll:e.scroll,"show-ruler":e.ruler,size:"1920px"},null,8,["scale","scroll","show-ruler"]),i(Re,{scale:e.scale,scroll:e.scroll,"show-ruler":e.ruler,direction:"v",size:"1080px"},null,8,["scale","scroll","show-ruler"]),_("div",{class:ee([{preview:t.preview},"design-canvas"]),style:ie(P.value),onContextmenu:V,onMousedown:we(A,["left"])},[i(be(Ve),ze({group:"form",animation:200,handle:".none"},{list:t.data.list,class:"drag",itemKey:"id",name:"fade",onAdd:b}),{item:p(({element:I,index:D})=>[y(I)?(h(),B(Qe,{key:0,current:e.activeIndex===D,data:o(I),scale:e.scale,type:0,onContextmenu:q,onChangeEvent:a=>d(D,a,e.tempRectIndex),onClick:we(a=>M(I,D),["stop"])},null,8,["current","data","scale","onChangeEvent","onClick"])):X("",!0)]),_:1},16,["list"]),_("div",{style:ie(e.rect),class:"draw-react"},null,4)],46,It),t.data.list.length?X("",!0):(h(),F("div",St," 请从左则组件栏拖动组件到设计区域 "))],544),_("div",$t,[_("i",{class:"icon-menu icon",onClick:l[0]||(l[0]=I=>S("left"))}),_("div",Rt,se(w.value),1),_("div",Tt,[_("div",Vt,[Et,i(s,{modelValue:e.ruler,"onUpdate:modelValue":l[1]||(l[1]=I=>e.ruler=I),size:"small"},null,8,["modelValue"])]),_("div",Dt,[Ut,i(f,{modelValue:e.scale,"onUpdate:modelValue":l[2]||(l[2]=I=>e.scale=I),marks:C.value,max:200,min:e.autoScale-30,"show-stops":"",size:"small",onChange:E},null,8,["modelValue","marks","min"])]),_("div",Lt,[i(v,{link:"",type:"primary",onClick:l[3]||(l[3]=I=>k("auto"))},{default:p(()=>[N("自适应 ")]),_:1}),i(v,{link:"",type:"primary",onClick:l[4]||(l[4]=I=>k("100"))},{default:p(()=>[N("100% ")]),_:1})])]),_("i",{class:"icon-menu icon",onClick:l[5]||(l[5]=I=>S("right"))})])],64)}}}),At=["onClick"],zt=ae({__name:"rightMenu",emits:["click"],setup(te,{expose:O,emit:T}){const W=T,g=j({}),c=j(!1),w=H(()=>{let m=g.value.type;["tempRect","group"].includes(m)||(m="single");const x={tempRect:["merge","left","right","top","bottom","horizontally","verticalCenter","del","lock","display"],group:["copy","split","del","lock","display"],single:["copy","del","lock","display"]};return[{key:"merge",label:"组合"},{key:"split",label:"拆分"},{key:"left",label:"左对齐"},{key:"right",label:"右对齐"},{key:"top",label:"顶部对齐"},{key:"bottom",label:"底部对齐"},{key:"horizontally",label:"水平居中"},{key:"verticalCenter",label:"垂直居中"},{key:"copy",label:"复制"},{key:"del",label:"删除"},{key:"lock",label:"锁定"},{key:"display",label:"隐藏"}].filter(r=>x[m].includes(r.key))}),e=H(()=>({left:`${g.value.x+10}px`,top:`${g.value.y+10}px`})),P=()=>{setTimeout(()=>{y()},1e3)},Y=m=>{W("click",m,g.value),y()},y=()=>{c.value=!1};return O({open:m=>{g.value=m,c.value=!0},close:y}),(m,x)=>_e((h(),F("div",{class:"screen-right-menu",style:ie(e.value),onMouseleave:P},[_("ul",null,[(h(!0),F(Z,null,ne(w.value,r=>(h(),F("li",{key:r.key,onClick:A=>Y(r.key)},se(r.label),9,At))),128))])],36)),[[Ee,c.value]])}}),Mt={class:"container-screen"},Ot={class:"main-box"},Bt=ae({__name:"index",setup(te){const O=Oe(),T=Be(),W=Pe(),g=ue();W.changeBreadcrumb([{label:"系统工具"},{label:"可视化大屏设计"}]),W.setCollapseMenu(!0);const c=u=>!g.getDataScreen(u),w=j(!1),e=j(!1),P=j(),Y=j(),y=j(),b=j({list:[],config:{width:"1920px",height:"1080px",background:"#000",style:"",primary:"#409eff"}}),m=()=>{Y.value.setLayer(b.value.list)},x=u=>{switch(g.setScreenControlAttr({}),u){case"del":b.value.list=[],m();break;case"eye":e.value=!0;break;case"json":V({type:"json",content:b.value,title:"可编辑修改或将已生成的脚本粘贴进来"});break;case"vue":y.value.openScreen(b.value);break;case"save":E();break}},r=ke({visible:!1,title:"",direction:"ltr",content:"",codeType:"",callback:""}),A=()=>{M()},J=u=>{try{let o;switch(r.codeType){case"json":o=qe(u);break;case"css":o=u;break;default:o=me(u)}switch(typeof r.callback=="function"&&r.callback(o),r.type){case"editCss":b.value.config.style=u,Ke("screenStyle",u,!0);break;case"json":b.value=me(u),m();break}M()}catch(o){ge.error(o.message||"未知原因")}},V=u=>{const{type:o="",direction:t,codeType:l,title:s,callback:f,content:v,tips:I}=u;r.direction=t||"ltr",r.type=o,r.codeType=l||"",r.title=s||He[o],r.visible=!0,r.callback=f;let D=l==="json"?Ne(v,!0):he(v,!0);switch(o){case"editCss":D=b.value.config.style||"";break;case"beforeFetch":case"afterFetch":case"afterFetchScreen":v||(D=Je(o,I));break}r.content=D},M=()=>{r.visible=!1,r.type="",r.title="",r.codeType="",r.callback="",r.content=""},d=(u,o,t)=>{if(o.type==="move"){const s=b.value.list[u];s.position.left=o.left,s.position.top=o.top,s.type==="tempRect"&&t.forEach(f=>{const v=b.value.list[f];v.position.left=parseInt(v.position.left)+o.moveX,v.position.top=parseInt(v.position.top)+o.moveY})}if(o.type==="resize"){const s=b.value.list[u];s.position.left=o.left,s.position.top=o.top,s.position.width=o.width,s.position.height=o.height}if(o.type==="keydown"){const{type:s}=b.value.list[u];l(u,o.eventKey),s==="tempRect"&&(t!=null&&t.length)&&t.forEach(f=>{l(f,o.eventKey)})}function l(s,f){const{position:v}=b.value.list[s],I=U(v.left),D=U(v.top);switch(f){case"ArrowRight":v.left=I+1;break;case"ArrowLeft":v.left=I-1;break;case"ArrowDown":v.top=D+1;break;case"ArrowUp":v.top=D-1;break}}},n=(u,o,t)=>{const l=b.value.list,s=l[o],f=s.id;["display","lock"].includes(u)&&(u==="display"?l[o].position[u]=t:l[o].config[u]=t,f&&s.type==="group"&&l.forEach(v=>{v.groupId===f&&(u==="display"?v.position.display=t:v.config.lock=t)})),u==="active"&&g.setScreenControlAttr(l[o]),u==="del"&&(b.value.list.splice(o,1),f&&s.type==="group"&&(b.value.list=l.filter(v=>v.groupId!==f))),m()},C=j(),S=u=>{C.value.open(u)},k=(u,o)=>{console.log(u,o);const t=b.value.list,l=t[o.activeIndex],s=l.id,f=l.type,{left:v,top:I,width:D,height:a}=l.position;switch(u){case"copy":const K=ve(l);if(s){const $=Ce(8);K.id=$,t.forEach(z=>{if(z.groupId===s){const oe=ve(z);oe.groupId=$,b.value.list.push(oe)}})}b.value.list.push(K);break;case"del":if(b.value.list.splice(o.activeIndex,1),s&&l.type==="group"&&(b.value.list=t.filter($=>$.groupId!==s)),f==="tempRect")for(let $=o.tempRectIndex.length-1;$>=0;$--)b.value.list.splice(o.tempRectIndex[$],1);o.callback("canvasClick");break;case"lock":case"display":if(f!=="tempRect"&&(u==="display"?l.position[u]=!0:l.config[u]=!0),s&&t.forEach($=>{$.groupId===s&&(u==="display"?$.position.display=!0:$.config.lock=!0)}),f==="tempRect"){for(let $=0;$<o.tempRectIndex.length;$++)u==="display"?t[o.tempRectIndex[$]].position.display=!0:t[o.tempRectIndex[$]].config.lock=!0;l.position.display=!0}break;case"merge":const R=Ce(8);b.value.list.push({type:"group",position:{left:v,top:I,width:D,height:a,zIndex:110},config:{},id:R});const Q=b.value.list.length-1;o.callback("merge",{index:Q}),m();break;case"split":t.forEach($=>{$.groupId===s&&delete $.groupId}),b.value.list.splice(o.activeIndex,1),o.callback("canvasClick"),m();break;case"left":case"top":const le=u==="left"?"width":"height";if(f==="tempRect"){const $=U(l.position[u]);let z=0;for(const oe in o.tempRectIndex){const G=t[o.tempRectIndex[oe]];G.position[u]=$,G.position[le]>z&&(z=U(G.position[le]))}l.position[le]=z+"px"}break;case"right":if(f==="tempRect"){const $=U(D)+U(v);let z=0;for(const oe in o.tempRectIndex){const G=t[o.tempRectIndex[oe]];G.position.left=$-U(G.position.width),G.position.width>z&&(z=U(G.position.width))}l.position.width=z+"px",l.position.left=`${$-z}px`}break;case"bottom":if(f==="tempRect"){const $=U(a)+U(I);let z=0;for(const oe in o.tempRectIndex){const G=t[o.tempRectIndex[oe]];G.position.top=$-U(G.position.height),G.position.height>z&&(z=U(G.position.height))}l.position.height=z+"px",l.position.top=`${$-z}px`}break;case"horizontally":case"verticalCenter":let de=U(I)+U(a)/2,fe="top",ce="height";u==="verticalCenter"&&(de=U(v)+U(D)/2,fe="left",ce="width");let re=0;for(const $ in o.tempRectIndex){const z=t[o.tempRectIndex[$]];z.position[fe]=de-U(z.position[ce])/2,z.position[ce]>re&&(re=U(z.position[ce]))}l.position[ce]=re+"px",l.position[fe]=de-re/2;break}},E=()=>{const u={data:he(b.value),name:"未命名可视化大屏",type:4};let o="designSave";const t=O.query.id;t&&(Object.assign(u,{id:t}),delete u.name,o="designEdit"),w.value=!0,We(o,u).then(l=>{ge({message:l.message||"保存成功！",type:"success"}),t||T.push({path:"/design/screen/list"}),w.value=!1}).catch(l=>{ge.error(l.message||"保存异常"),w.value=!1})},q=()=>{w.value=!0,et(O.query.id).then(u=>{w.value=!1,b.value=u.screenData,m()}).catch(u=>{u!=null&&u.screenData&&(b.value=u.screenData),w.value=!1})};return ye(()=>{q()}),De(()=>{}),(u,o)=>{const t=je("loading");return _e((h(),F("div",Mt,[e.value?(h(),F("i",{key:0,class:"icon-close close-preview",onClick:o[0]||(o[0]=l=>e.value=!1)})):X("",!0),i(wt,{ref_key:"controlLeftEl",ref:Y,style:ie({width:c("left")?"":"0px"}),onUpdate:n},null,8,["style"]),_("div",Ot,[i(Ye,{onClick:x}),i(Ft,{preview:e.value,data:b.value,"update-position":d,screenContextmenu:S,onDraggableAdd:m},null,8,["preview","data"])]),i(ft,{ref_key:"configEl",ref:P,config:b.value.config,"onUpdate:config":o[1]||(o[1]=l=>b.value.config=l),style:ie({width:c("right")?"":"0px"}),onUpdate:m,onOpenDrawer:V},null,8,["config","style"]),i(Xe,{modelValue:r.visible,"onUpdate:modelValue":o[2]||(o[2]=l=>r.visible=l),"code-type":r.codeType,content:r.content,direction:r.direction,title:r.title,onConfirm:J,onBeforeClose:A},null,8,["modelValue","code-type","content","direction","title"]),i(Ge,{ref_key:"vueFileEl",ref:y},null,512),i(zt,{ref_key:"rightMenuEl",ref:C,onClick:k},null,512)])),[[t,w.value]])}}});typeof Ie=="function"&&Ie(Bt);export{Bt as default};
